{"version":3,"sources":["./src/ui/ResultAttachments/ResultAttachments.ts","./src/ui/ResultAttachments/DefaultResultAttachmentTemplate.ts","./sass/_ResultAttachments.scss"],"names":[],"mappings":"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","file":"ResultAttachments__36d30dcb7330ecf06f4d.js","sourcesContent":["import { Template } from '../Templates/Template';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { DefaultResultAttachmentTemplate } from './DefaultResultAttachmentTemplate';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { Utils } from '../../utils/Utils';\nimport { QueryUtils } from '../../utils/QueryUtils';\nimport { Initialization, IInitializationParameters } from '../Base/Initialization';\nimport { Assert } from '../../misc/Assert';\nimport { $$ } from '../../utils/Dom';\nimport * as _ from 'underscore';\nimport { exportGlobally } from '../../GlobalExports';\n\nimport 'styling/_ResultAttachments';\nimport { TemplateComponentOptions } from '../Base/TemplateComponentOptions';\n\nexport interface IResultAttachmentsOptions {\n  resultTemplate?: Template;\n  subResultTemplate?: Template;\n  maximumAttachmentLevel?: number;\n}\n\n/**\n * The `ResultAttachments` component renders attachments in a result set, for example when displaying emails. This\n * component is usable inside a result template when there is an active [`Folding`]{@link Folding} component in the\n * page.\n *\n * This component is a result template component (see [Result Templates](https://docs.coveo.com/en/413/)).\n * @notSupportedIn salesforcefree\n */\nexport class ResultAttachments extends Component {\n  static ID = 'ResultAttachments';\n\n  static doExport = () => {\n    exportGlobally({\n      ResultAttachments: ResultAttachments,\n      DefaultResultAttachmentTemplate: DefaultResultAttachmentTemplate\n    });\n  };\n\n  /**\n   * The options for the component\n   * @componentOptions\n   */\n  static options: IResultAttachmentsOptions = {\n    /**\n     * Specifies the template to use to render each attachment for a top result.\n     *\n     * You can specify a previously registered template to use either by referring to its HTML `id` attribute or to a\n     * CSS selector (see {@link TemplateCache}).\n     *\n     * **Examples:**\n     *\n     * Specifying a previously registered template by referring to its HTML `id` attribute:\n     *\n     * ```html\n     * <div class=\"CoveoResultAttachments\" data-result-template-id=\"Foo\"></div>\n     * ```\n     *\n     * Specifying a previously registered template by referring to a CSS selector:\n     *\n     * ```html\n     * <div class='CoveoResultAttachments' data-result-template-selector=\".Foo\"></div>\n     * ```\n     *\n     * If you do not specify a custom folding template, the component uses the default result attachment template.\n     */\n    resultTemplate: TemplateComponentOptions.buildTemplateOption({\n      defaultFunction: e => new DefaultResultAttachmentTemplate()\n    }),\n\n    /**\n     * Specifies the template to use to render sub-attachments, which are attachments within attachments, for example\n     * when multiple files are embedded within a `.zip` attachment.\n     *\n     * Sub-attachments can themselves contain sub-attachments, and so on up to a certain level (see the\n     * [`maximumAttachmentLevel`]{@link ResultAttachments.options.maximumAttachmentLevel} option).\n     *\n     * You can specify a previously registered template to use either by referring to its HTML `id` attribute or to a\n     * CSS selector (see {@link TemplateCache}).\n     *\n     * **Example:**\n     *\n     * Specifying a previously registered template by referring to its HTML `id` attribute:\n     *\n     * ```html\n     * <div class=\"CoveoResultAttachments\" data-sub-result-template-id=\"Foo\"></div>\n     * ```\n     *\n     * Specifying a previously registered template by referring to a CSS selector:\n     *\n     * ```html\n     * <div class=\"CoveoResultAttachments\" data-sub-result-template-selector=\".Foo\"></div>\n     * ```\n     *\n     * By default, this option uses the same template you specify for the\n     * [`resultTemplate`]{@link ResultAttachments.options.resultTemplate} option.\n     */\n    subResultTemplate: TemplateComponentOptions.buildTemplateOption({\n      postProcessing: (value: Template, options: IResultAttachmentsOptions) => (value != null ? value : options.resultTemplate)\n    }),\n\n    /**\n     * Specifies the maximum nesting depth. Beyond this depth, the component stops rendering sub-attachments.\n     *\n     * Default value is `5`. Minimum value is `0`.\n     */\n    maximumAttachmentLevel: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0 })\n  };\n\n  private attachments: IQueryResult[];\n\n  /**\n   * Creates a new `ResultAttachments` component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `ResultAttachments` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   * @param result The result to associate the component with.\n   * @param attachmentLevel The nesting depth.\n   */\n  constructor(\n    public element: HTMLElement,\n    public options?: IResultAttachmentsOptions,\n    public bindings?: IComponentBindings,\n    result?: IQueryResult,\n    public attachmentLevel = 0\n  ) {\n    super(element, ResultAttachments.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, ResultAttachments, options);\n\n    this.attachments = result.attachments;\n    if (Utils.isNonEmptyArray(this.attachments)) {\n      this.renderAttachments();\n    }\n  }\n\n  private renderAttachments() {\n    _.each(this.attachments, attachment => {\n      QueryUtils.setStateObjectOnQueryResult(this.queryStateModel.get(), attachment);\n      QueryUtils.setSearchInterfaceObjectOnQueryResult(this.searchInterface, attachment);\n      let subTemplatePromise =\n        this.attachmentLevel > 0\n          ? this.options.subResultTemplate.instantiateToElement(attachment)\n          : this.options.resultTemplate.instantiateToElement(attachment);\n\n      subTemplatePromise.then((container: HTMLElement) => {\n        this.autoCreateComponentsInsideResult(container, _.extend({}, attachment, { attachments: [] }));\n\n        $$(container).addClass('coveo-result-attachments-container');\n        this.element.appendChild(container);\n\n        if (this.attachmentHasSubAttachment(attachment) && this.attachmentLevel < this.options.maximumAttachmentLevel) {\n          var childAttachmentContainer = $$('div').el;\n          container.appendChild(childAttachmentContainer);\n          new ResultAttachments(childAttachmentContainer, this.options, this.bindings, attachment, this.attachmentLevel + 1);\n        }\n      });\n    });\n  }\n\n  private attachmentHasSubAttachment(attachment: IQueryResult) {\n    if (Utils.isNonEmptyArray(attachment.attachments)) {\n      return true;\n    } else if (Utils.isNonEmptyArray(attachment.childResults)) {\n      attachment.attachments = attachment.childResults;\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  private autoCreateComponentsInsideResult(element: HTMLElement, result: IQueryResult) {\n    Assert.exists(element);\n    var initOptions = this.searchInterface.options;\n    var initParameters: IInitializationParameters = {\n      options: initOptions,\n      bindings: this.getBindings(),\n      result: result\n    };\n    Initialization.automaticallyCreateComponentsInside(element, initParameters, [ResultAttachments.ID]);\n  }\n}\n\nInitialization.registerAutoCreateComponent(ResultAttachments);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultAttachments/ResultAttachments.ts","import { Template } from '../Templates/Template';\nimport { IQueryResult } from '../../rest/QueryResult';\n\nexport class DefaultResultAttachmentTemplate extends Template {\n  constructor() {\n    super();\n  }\n\n  instantiateToString(queryResult?: IQueryResult): string {\n    return '<div><span class=\"CoveoIcon\"></span> <a class=\"CoveoResultLink\"></a> <span class=\"CoveoQuickview\"></span></div>';\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultAttachments/DefaultResultAttachmentTemplate.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_ResultAttachments.scss\n// module id = 652\n// module chunks = 42 88"],"sourceRoot":""}
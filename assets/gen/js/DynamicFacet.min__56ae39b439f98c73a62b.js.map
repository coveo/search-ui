{"version":3,"sources":["DynamicFacet.min__56ae39b439f98c73a62b.js","./src/utils/ResultListUtils.ts","./src/ui/ResponsiveComponents/ResponsiveComponentsUtils.ts","./src/ui/DynamicFacet/DynamicFacet.ts","./src/utils/DependsOnManager.ts","./src/ui/FacetsMobileMode/FacetsMobileMode.ts","./src/rest/Facet/FacetRequest.ts","./src/ui/ResultList/ResultListRenderer.ts","./src/ui/ResponsiveComponents/ResponsiveFacetColumn.ts","./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValueMoreLessButton.ts","./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValue.ts","./src/ui/DynamicFacetManager/DynamicFacetManager.ts","./src/ui/Facet/FacetUtils.ts","./src/ui/Templates/TableTemplate.ts","./src/ui/Templates/DefaultRecommendationTemplate.ts","./src/ui/Templates/TemplateToHtml.ts","./src/ui/FocusTrap/FocusTrap.ts","./src/ui/Templates/CoreHelpers.ts","./src/ui/DynamicFacet/DynamicFacetHeader/DynamicFacetHeaderButton.ts","./src/controllers/DynamicFacetRequestBuilder.ts","./src/ui/DynamicFacet/DynamicFacetHeader/DynamicFacetHeader.ts","./src/rest/Facet/FacetSortCriteria.ts","./src/ui/Combobox/Combobox.ts","./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValueCheckbox.ts","./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValues.ts","./src/controllers/DynamicFacetQueryController.ts","./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValueRenderer.ts","./src/ui/ResponsiveComponents/ResponsiveDefaultResultTemplate.ts","./src/ui/ResultList/ResultContainer.ts","./src/ui/ResultList/ResultListCardRenderer.ts","./src/ui/ResultList/ResultListTableRenderer.ts","./src/ui/ResponsiveComponents/ResponsiveDropdown/ResponsiveDropdownModalContent.ts","./src/events/FacetsMobileModeEvents.ts","./src/ui/DynamicFacet/DynamicFacetHeader/DynamicFacetHeaderCollapseToggle.ts","./src/ui/Combobox/ComboboxInput.ts","./src/ui/Combobox/ComboboxValues.ts","./src/ui/ResponsiveComponents/ResponsiveDynamicFacets.ts","./src/ui/DynamicFacet/DynamicFacetBreadcrumbs.ts","./src/ui/DynamicFacetSearch/DynamicFacetSearch.ts","./src/controllers/FacetSearchController.ts","./src/ui/DynamicFacetSearch/DynamicFacetSearchValueRenderer.ts","./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValueCreator.ts","./src/rest/Facet/FacetValueState.ts","./src/ui/ResponsiveComponents/ResponsiveFacetOptions.ts","./src/ui/ResultList/ResultList.ts"],"names":["webpackJsonpCoveo__temporary","111","module","exports","__webpack_require__","Object","defineProperty","value","hideIfInfiniteScrollEnabled","cmp","ResultListUtils","isInfiniteScrollEnabled","searchInterface","element","disable","$$","hide","warnIfComponentNotNeeded","enable","unhide","root","resultList","getActiveResultList","options","enableInfiniteScroll","scrollToTop","Logger","this","warn","window","scrollTo","searchInterfacePosition","getBoundingClientRect","top","scrollContainer","infiniteScrollContainer","pageYOffset","scrollTop","resultLists","getResultLists","find","disabled","findAll","cssClass","map","el","Component","get","ResultList","computeCssClassName","allResultListsUseInfiniteScroll","notNeededComponentWarning","filter","length","cmpCssClass","computeCssClassNameForType","type","message","126","shouldDrawFacetSlider","facetSliderElement","ResponsiveDropdownContent","isTargetInsideOpenedDropdown","isSmallFacetActivated","isSmallTabsActivated","hasClass","smallTabsClassName","smallFacetClassName","isSmallRecommendationActivated","smallRecommendationClassName","activateSmallTabs","addClass","deactivateSmallTabs","removeClass","activateSmallFacet","deactivateSmallFacet","activateSmallRecommendation","deactivateSmallRecommendation","ResponsiveComponentsUtils","137","__extends","extendStatics","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","verb","v","op","f","TypeError","_","y","label","ops","pop","trys","push","g","sent","throw","return","Symbol","iterator","bindings","classId","DynamicFacet","ID","listenToQueryStateChange","moreValuesAvailable","isDynamicFacet","isFieldValueCompatible","handleQueryStateChangedIncluded","querySelectedValues","currentSelectedValues","values","selectedValues","validQuerySelectedValues","valuesToSelect","difference","valuesToDeselect","Utils","isNonEmptyArray","selectMultipleValues","deselectMultipleValues","ComponentOptions","initComponentOptions","initDynamicFacetQueryController","initDependsOnManager","initQueryEvents","initQueryStateEvents","initBreadCrumbEvents","initComponentStateEvents","initValues","verifyCollapsingConfiguration","isCollapsed","enableCollapse","collapsedByDefault","ResponsiveDynamicFacets","init","_this","field","slice","enumerable","configurable","FacetType","specific","selectValue","Assert","exists","ensureDom","logger","info","forEach","select","updateQueryStateModel","deselectValue","hasSelectedValue","deselect","toggleSelectValue","facetValue","toggleSelect","getCaptionForStringValue","FacetUtils","getDisplayValueFromValueCaption","valueCaption","showMoreValues","additionalNumberOfValues","numberOfValues","dynamicFacetQueryController","increaseNumberOfValuesToRequest","triggerNewIsolatedQuery","logAnalyticsFacetShowMoreLess","analyticsActionCauseList","dynamicFacetShowMore","showLessValues","resetNumberOfValuesToRequest","dynamicFacetShowLess","reset","hasActiveValues","clearAll","render","enablePreventAutoSelectionFlag","updateAppearance","toggleCollapse","expand","collapse","enableFreezeCurrentValuesFlag","enableFreezeFacetOrderFlag","enableScrollToTop","activeValues","analyticsFacetState","toString","id","title","facetType","facetPosition","position","facetField","facetId","facetTitle","logAnalyticsEvent","actionCause","facetMeta","usageAnalytics","logSearchEvent","putStateIntoQueryBuilder","queryBuilder","putFacetIntoQueryBuilder","putStateIntoAnalytics","pendingEvent","getPendingSearchEvent","addFacetState","isCurrentlyDisplayed","isVisible","bind","onRootElement","QueryEvents","duringQuery","doneBuildingQuery","data","handleDoneBuildingQuery","deferredQuerySuccess","handleQuerySuccess","results","queryError","onNoValues","includedAttributeId","QueryStateModel","getFacetId","queryStateModel","registerNewAttribute","onQueryState","MODEL_EVENTS","CHANGE","undefined","handleQueryStateChanged","includeInBreadcrumb","BreadcrumbEvents","populateBreadcrumb","args","handlePopulateBreadcrumb","clearBreadcrumb","DynamicFacetValues","DynamicFacetValueCreator","componentStateId","componentStateModel","registerComponent","DynamicFacetQueryController","dynamicFacetManager","isNullOrUndefined","facets","notImplementedError","handleQueryResults","index","findIndex","facetResponse","onNewValues","header","hideLoading","createFromResponse","resetValues","attributes","breadcrumbs","DynamicFacetBreadcrumbs","facetInfo","ref","dependsOnManager","DependsOnManager","createDom","createAndAppendContent","createAndAppendHeader","createAndAppendSearch","createAndAppendValues","DynamicFacetHeader","clear","appendChild","enableFacetSearch","search","DynamicFacetSearch","set","toggleClear","hasSelectedValues","toggleSearchDisplay","toggleClass","hasDisplayedValues","triggerNewQuery","beforeExecuteQuery","beforeSendingQuery","ignoreWarningSearchEvent","queryController","executeQuery","e_1","_a","getQueryResults","showLoading","error","cause","logCustomEvent","basicAnalyticsFacetMeta","logClearAllToAnalytics","dynamicFacetClearAll","doExport","exportGlobally","ResponsiveFacetOptions","buildStringOption","postProcessing","sanitizedValue","replace","isNonEmptyString","maxCharLength","section","buildLocalizedStringOption","localizedString","l","priority","buildFieldOption","required","sortCriteria","isFacetSortCriteria","buildNumberOption","min","defaultValue","buildBooleanOption","enableMoreLess","useLeadingWildcardInFacetSearch","depend","numberOfValuesInBreadcrumb","defaultFunction","DeviceUtils","isMobileDevice","buildJsonOption","dependsOn","dependsOnCondition","buildCustomOption","injectionDepth","filterFacetCount","Initialization","registerAutoCreateComponent","173","facet","buildingQuery","handleBuildingQuery","getDependsOn","InitializationEvents","afterComponentsInitialization","setupDependentFacet","parentFacetRef","getParentFacet","resetIfConditionUnfullfiled","getDependsOnCondition","getId","component","conditionOption","isFunction","parentHasSelectedValues","parent","valuesExistForFacetWithId","ComponentsTypes","getAllFacetsFromSearchInterface","allFacetsInInterface","potentialParentFacet","potentialDependentFacet","dependentFacets","dependentFacet","some","175","FacetsMobileMode","preventScrolling","findParentScrollLockable","breakpoint","isModal","displayOverlayWhileOpen","buildChildHtmlElementOption","180","211","resultListOptions","autoCreateComponentsFn","renderResults","resultElements","append","resultDisplayedCallback","all","getStartFragment","getEndFragment","startFrag","endFrag","resultsFragment","document","createDocumentFragment","each","resultElement","getResult","resultsContainer","ResultListRenderer","212","coveoRoot","responsiveDropdown","componentsInFacetColumn","preservePositionOriginalValues","SearchInterface","dropdownHeaderLabel","getDropdownHeaderLabel","dropdown","buildDropdown","bindDropdownContentEvents","bindFacetsMobileModeEvents","registerOnCloseHandler","registerQueryEvents","initializeBreakpoint","responsiveBreakpoint","responsiveComponentConstructor","findColumn","ResponsiveComponentsManager","register","ResponsiveFacetColumn","column","getComponents","facetsMobileModeComponent","accept","preservePosition","needDropdownWrapper","needSmallMode","handleResizeEvent","changeToSmallMode","changeToLargeMode","isOpened","dropdownContent","positionDropdown","dismissFacetSearches","facetSearch","currentlyDisplayedResults","dismissSearchResults","width","ResponsiveComponents","getMediumScreenWidth","responsiveComponents","getResponsiveMode","close","disableFacetPreservePosition","DROPDOWN_HEADER_WRAPPER_CSS_CLASS","dropdownHeader","restoreFacetPreservePositionValue","cleanUp","buildDropdownContent","buildDropdownHeader","ResponsiveDropdown","facetsMobileModeOptions","disablePopupBackground","enableScrollLocking","dropdownContentElement","filterByContainer","className","style","filterBy","text","prepend","ResponsiveDropdownModalContent","DROPDOWN_MIN_WIDTH","DROPDOWN_WIDTH_RATIO","dropdownHeaderElement","content","ResponsiveDropdownHeader","defaultBreakpoint","facetsMobileModeBreakpoint","on","noResults","handleNoResults","querySuccess","handleQueryError","debounce","isFacetSearchScrolledIntoView","positionSearchResults","DEBOUNCE_SCROLL_WAIT","registerOnOpenHandler","trigger","FacetsMobileModeEvents","popupOpened","popupClosed","facetSearchElement","facetTop","facetBottom","bottom","dropdownTop","dropdownBottom","getAllFacetInstancesFromElement","DROPDOWN_HEADER_LABEL_DEFAULT_VALUE","totalCount","show","221","222","btn","ariaLabel","action","DynamicFacetValueShowMoreLessButton","223","rendererKlass","start","end","endInclusive","state","numberOfResults","displayValue","renderer","FacetValueState","selected","idle","equals","arg","toLowerCase","Globalize","format","resultCount","formattedCount","isRange","basicAnalyticsFacetState","rangeFacetState","analyticsValue","valuePosition","facetRangeStart","facetRangeEnd","facetRangeEndInclusive","rangeFacetMeta","logSelectActionToAnalytics","dynamicFacetSelect","dynamicFacetDeselect","analyticsFacetMeta","DynamicFacetValue","290","childrenFacets","DynamicFacetManager","resetContainer","prependContainer","initEvents","containerElement","remove","handleAfterComponentsInitialization","allDynamicFacets","dynamicFacet","children","enabledFacets","query","facetOptions","freezeFacetOrder","callOnUpdateOnChildrenFacets","enableReorder","compareFacets","sortFacetsWithCompareOption","sortFacetsWithResponseOrder","reorderFacetsInDom","respectMaximumExpandedFacetsThreshold","onUpdate","facetsResponse","facetsInResponse","getChildFacetWithId","facetsNotInResponse","without","sort","fragment","maximumNumberOfExpandedFacets","collapsableFacets","uncollapsableFacets","facetsLeftToExpandCounter","39","getRegexToUseForFacetSearch","ignoreAccent","RegExp","StringUtils","stringToRegex","returnValue","tryToGetTranslatedCaption","getValuesToUseForSearchInFacet","original","ret","regex","facetSearchIgnoreAccents","chain","pairs","pair","test","match","QueryUtils","isStratusAgnosticField","FileTypes","getFileTypeCaptions","key","range","month","DateUtils","monthToString","substr","buildFacetSearchPattern","escapeRegexCharacter","join","needAnotherFacetSearch","currentSearchLength","newSearchLength","oldSearchLength","desiredSearchLength","addNoStateCssClassToFacetValues","container","getSelected","noStates","noState","found","getFileType","caption","getObjectType","isMonthFieldValue","parseInt","asInt","isNaN","462","defaultTemplate","defaultRoledTemplates","instantiateRoleToString","role","roledTemplate","templates","instantiateToString","instantiateRoleToElement","instantiateToElement","tmpl","Template","layout","getFallbackTemplate","hasTemplateWithRole","TemplateList","TableTemplate","463","_super","object","div","createElement","innerHTML","DefaultRecommendationTemplate","464","buildResults","res","resultsPromises","buildResult","elem","idx","resultCurrentlyBeingRendered","pluck","sortBy","setStateObjectOnQueryResult","setSearchInterfaceObjectOnQueryResult","createHtmlElement","bindResultToElement","autoCreateComponentsInsideResult","initResult","verifyChildren","automaticallyCreateComponentsInsideResult","resultTemplate","wrapInDiv","checkCondition","currentLayout","TemplateToHtml","465","hiddenElements","querySelectorAll","tabIndex","removeEventListener","focusInEvent","focusOutEvent","showHiddenElements","enabled","addEventListener","onFocusIn","onFocusOut","hideAllExcept","removeAttribute","hideElement","getAttribute","setAttribute","hideSiblings","allowedElement","parentElement","elementToHide","getFocusableSibling","previous","elements","focusableElements","currentIndex","indexOf","focusSibling","sibling","focus","focusFirstElement","elementIsBefore","oldElement","newElement","compareDocumentPosition","Node","DOCUMENT_POSITION_PRECEDING","onLosingFocus","Defer","defer","focusIsAllowed","contains","elementIsInPage","relatedTarget","target","FocusTrap","466","resolveQueryResult","getComponentRef","quickview","resolveTermsToHighlight","currentQueryResult","termsToHighlight","resolvePhrasesToHighlight","phrasesToHighlight","termsToHighlightAreDefined","keys","exportAllHelpersGlobally","scope","TemplateHelpers","getHelpers","helper","name","CoreHelpers","registerFieldHelper","javascriptEncode","executeShorten","strAndHoles","StringAndHoles","shortenString","highlights","HighlightUtils","highlightString","holes","registerTemplateHelper","executeShortenPath","shortenPath","executeShortenUri","shortenUri","executeHighlight","executeHighlightStreamText","StreamHighlightUtils","highlightStreamText","opts","mergedOptions","executeHighlightStreamHTML","highlightStreamHTML","numberValue","Number","isString","htmlEncode","dateToString","convertFromJsonDateIfNeeded","timeToString","dateTimeToString","defaultOptions","includeTimeIfThisWeek","optionsToUse","extend","CurrencyUtils","currencyToString","isMilliseconds","TimeSpan","getHHMMSS","companyDomain","me","lengthLimit","truncateName","isObject","listOfAddresses","EmailUtils","splitSemicolonSeparatedListOfEmailAddresses","emailAddressesToHyperlinks","isArray","siblings","href","AnchorUtils","buildAnchor","src","srcTemplate","ImageUtils","buildImage","buildStringTemplateFromResult","alt","height","endpoint","hasThumbnail","buildImageFromResult","SearchEndpoint","endpoints","icon","createIcon","outerHTML","templatesToLoad","once","defaultTmpl","atLeastOneWasLoaded","toLoad","obj","omit","condition","getHelper","byteMeasure","size","precision","base","Math","floor","pow","TemplateCache","getTemplate","encodeCarriageReturn","getDeviceName","497","rootOptions","hasIcon","iconSVG","iconClassName","button","trim","SVGDom","addClassToSVGInContainer","shouldDisplay","toggle","DynamicFacetHeaderButton","504","request","buildBaseRequestForQuery","getFilterFacetCount","filterField","isFoldingEnabled","isUndefined","DynamicFacetRequestBuilder","505","506","createTitle","createWaitAnimation","createClearButton","clearButton","createCollapseToggle","collapseToggle","DynamicFacetHeaderCollapseToggle","toggleButtons","ariaHidden","waitAnimation","SVGIcons","icons","loading","visible","clearTimeout","showLoadingTimeout","setTimeout","showLoadingDelay","507","FacetSortCriteria","508","wrapperClassName","clearOnBlur","throttlingDelay","isRequestCancelled","throttledRequest","throttle","triggerRequest","leading","trailing","uniqueId","createAndAppendInput","createAndAppendWaitAnimation","input","ComboboxInput","waitAnimationElement","toggleWaitAnimation","ComboboxValues","clearValues","clearInput","cancelRequest","cancel","onInputChange","isEmptyString","requestValues","resetScroll","onInputBlur","mouseIsOverValue","isRenderingNewValues","updateAccessibilityAttributes","updateAriaLive","hasValues","ariaLive","updateText","scrollable","areMoreValuesAvailable","onScrollEndReached","saveFocusedValue","requestMoreValues","restoreFocusedValue","callback","response","renderFromResponse","Combobox","509","510","selectAction","checkbox","Checkbox","selectAriaLabel","getElement","labelSuffix","isSelected","DynamicFacetValueCheckbox","511","creatorKlass","list","valueCreator","facetValues","getDefaultValues","isIdle","findWhere","allFacetValues","displayedValues","foundValue","newFacetValue","createFromValue","buildShowLess","buildShowMore","hasIdleValues","appendShowMoreLess","shouldEnableShowLess","appendSelectedCollapsedValues","selectedDisplayValues","escape","empty","renderedElement","512","freezeCurrentValues","preventAutoSelection","requestBuilder","fieldName","resetFlagsDuringQuery","numberOfValuesToRequest","areValuesIncorrectlyAffectedByDependsOn","hasDependentFacets","dependentFacetsHaveSelectedValues","currentValues","facetRequests","buildFacetRequest","build","preventAutoSelect","isFieldExpanded","getLastQuery","previousFacetRequestIndex","getEndpoint","max","513","dom","dataValue","toggleSelectedClass","renderCheckbox","addFocusAndBlurEventListeners","valueCheckbox","checkboxButton","DynamicFacetValueRenderer","522","523","524","525","currentMode","trace","ResponsiveDefaultResultTemplate","lastResults","getLastResults","getSmallScreenWidth","526","resultContainer","resultContainerElement","detachComponentsInside","classToAdd","isEmpty","hideChildren","child","getResultElements","ResultContainer","527","needToBeRemoved","toRemove","times","ResultListCardRenderer","528","shouldDisplayHeader","shouldDisplayFooter","renderRoledTemplate","frag","ResultListTableRenderer","529","530","componentName","closeButtonLabel","shouldHide","classList","add","DEFAULT_CSS_CLASS_NAME","hidden","ensureCloseButton","ensureFocusTrap","hideDropdown","removeCloseButton","removeFocusTrap","closeButton","mainClear","focusTrap","531","562","563","collapseButton","arrowUp","expandButton","arrowDown","564","combobox","inputOptions","usePlaceholder","triggerOnChangeAsYouType","isRequired","textInput","inputElement","addEventListeners","addAccessibilityAttributes","TextInput","inputInstance","getValue","placeholderText","handleFocusOut","handleKeyboardDirection","handleKeyboardEnterEscape","listboxId","activeDescendant","expanded","event","newTarget","which","KEYBOARD","DOWN_ARROW","preventDefault","focusNextValue","UP_ARROW","focusPreviousValue","HOME","focusFirstValue","END","focusLastValue","ENTER","selectActiveValue","ESCAPE","stopPropagation","565","ariaLabelledby","isScrollable","onScroll","createValuesFromResponse","renderNoValuesFound","renderValues","elementWrapper","tabindex","highlightCurrentQueryInSearchResults","searchResult","highlightValueClassName","querySelector","noValuesFoundElement","onValueClick","setKeyboardActiveValue","targetElement","targetId","onSelectValue","keyboardActiveValue","resetKeyboardActiveValue","activateFocusOnValue","deactivateFocusOnValue","clientHeight","scrollHeight","maxHeight","maxDropdownHeight","firstValue","lastValue","nextOrFirstValue","previousOrLastValue","nextValueIndex","previousValueIndex","lastValueIndex","focusedValueId","566","575","576","createAndAppendTitle","activeFacetValues","breadcrumbFacetValues","collapsedFacetValues","createAndAppendBreadcrumbValues","createAndAppendCollapsedBreadcrumbs","titleElement","createAndAppendBreadcrumbValue","listContainer","valueElement","clearElement","valueSelectAction","logActionToAnalytics","breadcrumbFacet","collapsedElement","577","578","facetSearchController","FacetSearchController","terms","fetchMoreResults","getDisplayValue","rawValue","count","DynamicFacetSearchValueRenderer","579","pageCount","numberOfValuesMultiplier","getMonthsValueCaptions","monthsValueCaptions","addTypesCaptionsIfNecessary","isFileType","isObjectType","isMonth","optionalLeadingWildcard","ignoreValues","captions","searchContext","580","581","69","82","enableResponsiveMode","deprecated","87","elementClassId","reachedTheEndOfResults","disableLayoutChange","successiveScrollCount","showOrHideElementsDependingOnState","newQuery","handleNewQuery","handleDuringQuery","ResultListEvents","changeLayout","handleChangeLayout","handlePageChanged","handleScrollOfResultList","CHANGE_ONE","QUERY_STATE_ATTRIBUTES","FIRST","initResultContainer","initWaitAnimationContainer","waitAnimationContainer","setupTemplatesVersusLayouts","ResultLayoutEvents","populateResultLayout","layouts","setupRenderer","makeElementFocusable","ensureHasId","getDefaultTemplate","template","loadTemplatesFromCache","Coveo","DefaultResultTemplate","pageTemplateNames","getResultListTemplateNames","compact","templateName","getAutoSelectedFieldsToInclude","getFields","concat","getMinimalFieldsToInclude","unique","layoutClassToAdd","triggerNewResultDisplayed","triggerNewResultsDisplayed","templateToHtml","displayMoreResults","isLargerOrEqualsThan","isCurrentlyFetchingMoreResults","hasPotentiallyMoreResultsToDisplay","enableInfiniteScrollWaitingAnimation","showWaitingAnimationForInfiniteScrolling","fetchAndRenderMoreResults","templateToHtmlArgs","getDisplayedResults","getDisplayedResultsElements","resultLayoutSelectors","resultLayoutSelector","enableLayouts","otherLayoutsStillActive","otherResultLists","otherResultList","disableLayouts","item","newResultDisplayed","newResultsDisplayed","fetchingMoreResults","fetchMore","pagerScrolling","renderNewResults","resetStateAfterFetchingMoreResults","_b","hideWaitingAnimationForInfiniteScrolling","MAX_AMOUNT_OF_SUCESSIVE_REQUESTS","cancelFetchingMoreResultsIfNeeded","showWaitingAnimation","hideWaitingAnimation","mobileScrollContainer","scrollToTopIfEnabled","isScrollingOfResultListAlmostAtTheBottom","infiniteScrollPageSize","allResultLists","fieldsToInclude","addFieldsToInclude","autoSelectFieldsToInclude","otherFields","flatten","addRequiredFields","includeRequiredFields","InitializationPlaceholder","withVisibleRootElement","withPlaceholderForResultList","isWindow","Window","isScrollAtBottomForWindowElement","isScrollAtBottomForHtmlElement","win","Win","windowHeight","scrollY","Doc","elementHeight","hasQuery","hasResults","showIfQuery","showIfNoQuery","showIfResults","showIfNoResults","DomUtils","getBasicLoadingAnimation","spinner","detach","getLoadingSpinner","previousSpinnerContainer","previousSpinner","spinnerContainer","spinners","containers","elemType","initResultContainerAddToDom","initParameters","originalOptionsObject","automaticallyCreateComponentsInside","alias","TemplateComponentOptions","buildTemplateOption","findParentScrolling","buildSelectorOption","buildFieldsOption","includeInResults"],"mappings":"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","file":"DynamicFacet.min__56ae39b439f98c73a62b.js","sourcesContent":["webpackJsonpCoveo__temporary([2,17,84],{\n\n/***/ 111:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Component_1 = __webpack_require__(7);\nvar ResultList_1 = __webpack_require__(87);\nvar Dom_1 = __webpack_require__(1);\nvar underscore_1 = __webpack_require__(0);\nvar Logger_1 = __webpack_require__(9);\nvar ResultListUtils = /** @class */ (function () {\n    function ResultListUtils() {\n    }\n    ResultListUtils.hideIfInfiniteScrollEnabled = function (cmp) {\n        var infiniteScrollEnabled = ResultListUtils.isInfiniteScrollEnabled(cmp.searchInterface.element);\n        if (infiniteScrollEnabled) {\n            cmp.disable();\n            Dom_1.$$(cmp.element).hide();\n            ResultListUtils.warnIfComponentNotNeeded(cmp);\n        }\n        else {\n            cmp.enable();\n            Dom_1.$$(cmp.element).unhide();\n        }\n    };\n    ResultListUtils.isInfiniteScrollEnabled = function (root) {\n        var resultList = ResultListUtils.getActiveResultList(root);\n        return resultList ? !!resultList.options.enableInfiniteScroll : false;\n    };\n    ResultListUtils.scrollToTop = function (root) {\n        var resultList = ResultListUtils.getActiveResultList(root);\n        if (!resultList) {\n            new Logger_1.Logger(this).warn('No active ResultList, scrolling to the top of the Window');\n            return window.scrollTo(0, 0);\n        }\n        var searchInterfacePosition = resultList.searchInterface.element.getBoundingClientRect().top;\n        if (searchInterfacePosition > 0) {\n            return;\n        }\n        var scrollContainer = resultList.options.infiniteScrollContainer;\n        if (typeof scrollContainer.scrollTo === 'function') {\n            scrollContainer.scrollTo(0, window.pageYOffset + searchInterfacePosition);\n        }\n        else {\n            scrollContainer.scrollTop = 0;\n        }\n    };\n    ResultListUtils.getActiveResultList = function (root) {\n        var resultLists = ResultListUtils.getResultLists(root);\n        return underscore_1.find(resultLists, function (resultList) { return !resultList.disabled; });\n    };\n    ResultListUtils.getResultLists = function (root) {\n        return Dom_1.$$(root)\n            .findAll(\".\" + ResultListUtils.cssClass())\n            .map(function (el) { return Component_1.Component.get(el, ResultList_1.ResultList); });\n    };\n    ResultListUtils.cssClass = function () {\n        return Component_1.Component.computeCssClassName(ResultList_1.ResultList);\n    };\n    ResultListUtils.warnIfComponentNotNeeded = function (cmp) {\n        var root = cmp.searchInterface.root;\n        var allListsUseInfiniteScroll = ResultListUtils.allResultListsUseInfiniteScroll(root);\n        allListsUseInfiniteScroll && ResultListUtils.notNeededComponentWarning(cmp);\n    };\n    ResultListUtils.allResultListsUseInfiniteScroll = function (root) {\n        var listsWithInfiniteScrollDisabled = ResultListUtils.getResultLists(root).filter(function (resultList) { return !resultList.options.enableInfiniteScroll; });\n        return listsWithInfiniteScrollDisabled.length === 0;\n    };\n    ResultListUtils.notNeededComponentWarning = function (cmp) {\n        var cmpCssClass = Component_1.Component.computeCssClassNameForType(cmp.type);\n        var message = \"The \" + cmpCssClass + \" component is not needed because all \" + ResultListUtils.cssClass() + \" components have enableInfiniteScroll set to 'true'.\\n    For the best performance, remove the \" + cmpCssClass + \" component from your search page.\";\n        new Logger_1.Logger(cmp).warn(message);\n    };\n    return ResultListUtils;\n}());\nexports.ResultListUtils = ResultListUtils;\n\n\n/***/ }),\n\n/***/ 126:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResponsiveDropdownContent_1 = __webpack_require__(88);\nvar ResponsiveComponentsUtils = /** @class */ (function () {\n    function ResponsiveComponentsUtils() {\n    }\n    ResponsiveComponentsUtils.shouldDrawFacetSlider = function (root, facetSliderElement) {\n        return ResponsiveDropdownContent_1.ResponsiveDropdownContent.isTargetInsideOpenedDropdown(facetSliderElement) || !this.isSmallFacetActivated(root);\n    };\n    ResponsiveComponentsUtils.isSmallTabsActivated = function (root) {\n        return root.hasClass(this.smallTabsClassName);\n    };\n    ResponsiveComponentsUtils.isSmallFacetActivated = function (root) {\n        return root.hasClass(this.smallFacetClassName);\n    };\n    ResponsiveComponentsUtils.isSmallRecommendationActivated = function (root) {\n        return root.hasClass(this.smallRecommendationClassName);\n    };\n    ResponsiveComponentsUtils.activateSmallTabs = function (root) {\n        root.addClass(this.smallTabsClassName);\n    };\n    ResponsiveComponentsUtils.deactivateSmallTabs = function (root) {\n        root.removeClass(this.smallTabsClassName);\n    };\n    ResponsiveComponentsUtils.activateSmallFacet = function (root) {\n        root.addClass(this.smallFacetClassName);\n    };\n    ResponsiveComponentsUtils.deactivateSmallFacet = function (root) {\n        root.removeClass(this.smallFacetClassName);\n    };\n    ResponsiveComponentsUtils.activateSmallRecommendation = function (root) {\n        root.addClass(this.smallRecommendationClassName);\n    };\n    ResponsiveComponentsUtils.deactivateSmallRecommendation = function (root) {\n        root.removeClass(this.smallRecommendationClassName);\n    };\n    ResponsiveComponentsUtils.smallTabsClassName = 'coveo-small-tabs';\n    ResponsiveComponentsUtils.smallFacetClassName = 'coveo-small-facets';\n    ResponsiveComponentsUtils.smallRecommendationClassName = 'coveo-small-recommendation';\n    return ResponsiveComponentsUtils;\n}());\nexports.ResponsiveComponentsUtils = ResponsiveComponentsUtils;\n\n\n/***/ }),\n\n/***/ 137:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(221);\nvar underscore_1 = __webpack_require__(0);\nvar Dom_1 = __webpack_require__(1);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Initialization_1 = __webpack_require__(2);\nvar ResponsiveFacetOptions_1 = __webpack_require__(82);\nvar ResponsiveDynamicFacets_1 = __webpack_require__(575);\nvar DynamicFacetBreadcrumbs_1 = __webpack_require__(576);\nvar DynamicFacetHeader_1 = __webpack_require__(506);\nvar DynamicFacetValues_1 = __webpack_require__(511);\nvar QueryEvents_1 = __webpack_require__(11);\nvar QueryStateModel_1 = __webpack_require__(13);\nvar DynamicFacetQueryController_1 = __webpack_require__(512);\nvar Utils_1 = __webpack_require__(4);\nvar Model_1 = __webpack_require__(18);\nvar Assert_1 = __webpack_require__(5);\nvar FacetSortCriteria_1 = __webpack_require__(507);\nvar Strings_1 = __webpack_require__(6);\nvar DeviceUtils_1 = __webpack_require__(24);\nvar BreadcrumbEvents_1 = __webpack_require__(34);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar DynamicFacetSearch_1 = __webpack_require__(578);\nvar ResultListUtils_1 = __webpack_require__(111);\nvar FacetRequest_1 = __webpack_require__(180);\nvar DependsOnManager_1 = __webpack_require__(173);\nvar DynamicFacetValueCreator_1 = __webpack_require__(581);\nvar Logger_1 = __webpack_require__(9);\nvar FacetUtils_1 = __webpack_require__(39);\n/**\n * The `DynamicFacet` component displays a *facet* of the results for the current query. A facet is a list of values for a\n * certain field occurring in the results, ordered using a configurable criteria (e.g., number of occurrences).\n *\n * The list of values is obtained using an array of [`FacetRequest`]{@link IFacetRequest} operations performed at the same time\n * as the main query.\n *\n * The `DynamicFacet` component allows the end-user to drill down inside a result set by restricting the result to certain\n * field values.\n *\n * This facet is more easy to use than the original [`Facet`]{@link Facet} component. It implements additional Coveo Machine Learning (Coveo ML) features\n * such as dynamic navigation experience (DNE).\n *\n * @notSupportedIn salesforcefree\n * @availablesince [May 2019 Release (v2.6063)](https://docs.coveo.com/en/2909/)\n */\nvar DynamicFacet = /** @class */ (function (_super) {\n    __extends(DynamicFacet, _super);\n    /**\n     * Creates a new `DynamicFacet` instance.\n     *\n     * @param element The element from which to instantiate the component.\n     * @param options The component options.\n     * @param bindings The component bindings. Automatically resolved by default.\n     */\n    function DynamicFacet(element, options, bindings, classId) {\n        if (classId === void 0) { classId = DynamicFacet.ID; }\n        var _this = _super.call(this, element, classId, bindings) || this;\n        _this.element = element;\n        _this.listenToQueryStateChange = true;\n        _this.moreValuesAvailable = false;\n        _this.isDynamicFacet = true;\n        _this.isFieldValueCompatible = true;\n        _this.handleQueryStateChangedIncluded = function (querySelectedValues) {\n            var currentSelectedValues = _this.values.selectedValues;\n            var validQuerySelectedValues = querySelectedValues.filter(function (value) { return _this.values.get(value); });\n            var valuesToSelect = underscore_1.difference(validQuerySelectedValues, currentSelectedValues);\n            var valuesToDeselect = underscore_1.difference(currentSelectedValues, validQuerySelectedValues);\n            if (Utils_1.Utils.isNonEmptyArray(valuesToSelect)) {\n                _this.selectMultipleValues(valuesToSelect);\n            }\n            if (Utils_1.Utils.isNonEmptyArray(valuesToDeselect)) {\n                _this.deselectMultipleValues(valuesToDeselect);\n            }\n        };\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, DynamicFacet, options);\n        _this.initDynamicFacetQueryController();\n        _this.initDependsOnManager();\n        _this.initQueryEvents();\n        _this.initQueryStateEvents();\n        _this.initBreadCrumbEvents();\n        _this.initComponentStateEvents();\n        _this.initValues();\n        _this.verifyCollapsingConfiguration();\n        _this.isCollapsed = _this.options.enableCollapse && _this.options.collapsedByDefault;\n        ResponsiveDynamicFacets_1.ResponsiveDynamicFacets.init(_this.root, _this, _this.options);\n        return _this;\n    }\n    Object.defineProperty(DynamicFacet.prototype, \"fieldName\", {\n        get: function () {\n            return this.options.field.slice(1);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacet.prototype, \"facetType\", {\n        get: function () {\n            return FacetRequest_1.FacetType.specific;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Selects a single value in this facet.\n     *\n     * Does **not** trigger a query automatically.\n     * Does **not** update the visual of the facet until a query is performed.\n     *\n     * @param value The name of the facet value to select.\n     */\n    DynamicFacet.prototype.selectValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.selectMultipleValues([value]);\n    };\n    /**\n     * Selects multiple values in this facet.\n     *\n     * Does **not** trigger a query automatically.\n     * Does **not** update the visual of the facet until a query is performed.\n     *\n     * @param values The names of the facet values to select.\n     */\n    DynamicFacet.prototype.selectMultipleValues = function (values) {\n        var _this = this;\n        Assert_1.Assert.exists(values);\n        this.ensureDom();\n        this.logger.info('Selecting facet value(s)', values);\n        values.forEach(function (value) {\n            _this.values.get(value).select();\n        });\n        this.updateQueryStateModel();\n    };\n    /**\n     * Deselects a single value in this facet.\n     *\n     * Does **not** trigger a query automatically.\n     * Does **not** update the visual of the facet until a query is performed.\n     *\n     * @param values The name of the facet value to deselect.\n     */\n    DynamicFacet.prototype.deselectValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.deselectMultipleValues([value]);\n    };\n    /**\n     * Determines whether the specified value is selected in the facet.\n     * @param value The name of the facet value to verify.\n     */\n    DynamicFacet.prototype.hasSelectedValue = function (value) {\n        return this.values.hasSelectedValue(value);\n    };\n    /**\n     * Deselects multiple values in this facet.\n     *\n     * Does **not** trigger a query automatically.\n     * Does **not** update the visual of the facet until a query is performed.\n     *\n     * @param values The names of the facet values to deselect.\n     */\n    DynamicFacet.prototype.deselectMultipleValues = function (values) {\n        var _this = this;\n        Assert_1.Assert.exists(values);\n        this.ensureDom();\n        this.logger.info('Deselecting facet value(s)', values);\n        values.forEach(function (value) {\n            _this.values.get(value).deselect();\n        });\n        this.updateQueryStateModel();\n    };\n    /**\n     * Toggles the selection state of a single value in this facet.\n     *\n     * Does **not** trigger a query automatically.\n     *\n     * @param values The name of the facet value to toggle.\n     */\n    DynamicFacet.prototype.toggleSelectValue = function (value) {\n        Assert_1.Assert.exists(value);\n        this.ensureDom();\n        var facetValue = this.values.get(value);\n        facetValue.toggleSelect();\n        this.logger.info('Toggle select facet value', facetValue);\n        this.updateQueryStateModel();\n    };\n    /**\n     * Returns the configured caption for a desired facet value.\n     *\n     * @param value The string facet value whose caption the method should return.\n     */\n    DynamicFacet.prototype.getCaptionForStringValue = function (value) {\n        return FacetUtils_1.FacetUtils.getDisplayValueFromValueCaption(value, this.options.field, this.options.valueCaption);\n    };\n    /**\n     * Requests additional values.\n     *\n     * Automatically triggers an isolated query.\n     * @param additionalNumberOfValues The number of additional values to request. Minimum value is 1. Defaults to the [numberOfValues]{@link DynamicFacet.options.numberOfValues} option value.\n     */\n    DynamicFacet.prototype.showMoreValues = function (additionalNumberOfValues) {\n        var _this = this;\n        if (additionalNumberOfValues === void 0) { additionalNumberOfValues = this.options.numberOfValues; }\n        this.ensureDom();\n        this.logger.info('Show more values');\n        this.dynamicFacetQueryController.increaseNumberOfValuesToRequest(additionalNumberOfValues);\n        this.triggerNewIsolatedQuery(function () { return _this.logAnalyticsFacetShowMoreLess(AnalyticsActionListMeta_1.analyticsActionCauseList.dynamicFacetShowMore); });\n    };\n    /**\n     * Reduces the number of displayed facet values down to [numberOfValues]{@link DynamicFacet.options.numberOfValues}.\n     *\n     * Automatically triggers an isolated query.\n     */\n    DynamicFacet.prototype.showLessValues = function () {\n        var _this = this;\n        this.ensureDom();\n        this.logger.info('Show less values');\n        this.dynamicFacetQueryController.resetNumberOfValuesToRequest();\n        this.triggerNewIsolatedQuery(function () { return _this.logAnalyticsFacetShowMoreLess(AnalyticsActionListMeta_1.analyticsActionCauseList.dynamicFacetShowLess); });\n    };\n    /**\n     * Deselects all values in this facet.\n     *\n     * Does **not** trigger a query automatically.\n     * Updates the visual of the facet.\n     *\n     */\n    DynamicFacet.prototype.reset = function () {\n        this.ensureDom();\n        if (this.values.hasActiveValues) {\n            this.logger.info('Deselect all values');\n            this.values.clearAll();\n            this.values.render();\n        }\n        this.enablePreventAutoSelectionFlag();\n        this.updateAppearance();\n        this.updateQueryStateModel();\n    };\n    /**\n     * Collapses or expands the facet depending on it's current state.\n     */\n    DynamicFacet.prototype.toggleCollapse = function () {\n        this.isCollapsed ? this.expand() : this.collapse();\n    };\n    /**\n     * Expands the facet, displaying all of its currently fetched values.\n     */\n    DynamicFacet.prototype.expand = function () {\n        if (!this.options.enableCollapse) {\n            return this.logger.warn(\"Calling expand() won't do anything on a facet that has the option \\\"enableCollapse\\\" set to \\\"false\\\"\");\n        }\n        if (!this.isCollapsed) {\n            return;\n        }\n        this.ensureDom();\n        this.logger.info('Expand facet values');\n        this.isCollapsed = false;\n        this.updateAppearance();\n    };\n    /**\n     * Collapses the facet, displaying only its currently selected values.\n     */\n    DynamicFacet.prototype.collapse = function () {\n        if (!this.options.enableCollapse) {\n            return this.logger.warn(\"Calling collapse() won't do anything on a facet that has the option \\\"enableCollapse\\\" set to \\\"false\\\"\");\n        }\n        if (this.isCollapsed) {\n            return;\n        }\n        this.ensureDom();\n        this.logger.info('Collapse facet values');\n        this.isCollapsed = true;\n        this.updateAppearance();\n    };\n    /**\n     * Sets a flag indicating whether the facet values should be returned in their current order.\n     *\n     * Setting the flag to `true` helps ensuring that the values do not move around while the end-user is interacting with them.\n     *\n     * The flag is automatically set back to `false` after a query is built.\n     */\n    DynamicFacet.prototype.enableFreezeCurrentValuesFlag = function () {\n        this.dynamicFacetQueryController.enableFreezeCurrentValuesFlag();\n    };\n    /**\n     * For this method to work, the component has to be the child of a [DynamicFacetManager]{@link DynamicFacetManager} component.\n     *\n     * Sets a flag indicating whether the facets should be returned in their current order.\n     *\n     * Setting the flag to `true` helps ensuring that the facets do not move around while the end-user is interacting with them.\n     *\n     * The flag is automatically set back to `false` after a query is built.\n     */\n    DynamicFacet.prototype.enableFreezeFacetOrderFlag = function () {\n        this.dynamicFacetQueryController.enableFreezeFacetOrderFlag();\n    };\n    DynamicFacet.prototype.enablePreventAutoSelectionFlag = function () {\n        this.dynamicFacetQueryController.enablePreventAutoSelectionFlag();\n    };\n    DynamicFacet.prototype.scrollToTop = function () {\n        if (this.options.enableScrollToTop) {\n            ResultListUtils_1.ResultListUtils.scrollToTop(this.root);\n        }\n    };\n    Object.defineProperty(DynamicFacet.prototype, \"analyticsFacetState\", {\n        get: function () {\n            return this.values.activeValues.map(function (facetValue) { return facetValue.analyticsFacetState; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacet.prototype, \"basicAnalyticsFacetState\", {\n        get: function () {\n            return {\n                field: this.options.field.toString(),\n                id: this.options.id,\n                title: this.options.title,\n                facetType: this.facetType,\n                facetPosition: this.position\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacet.prototype, \"basicAnalyticsFacetMeta\", {\n        get: function () {\n            return {\n                facetField: this.options.field.toString(),\n                facetId: this.options.id,\n                facetTitle: this.options.title\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacet.prototype.logAnalyticsEvent = function (actionCause, facetMeta) {\n        this.usageAnalytics.logSearchEvent(actionCause, facetMeta);\n    };\n    DynamicFacet.prototype.putStateIntoQueryBuilder = function (queryBuilder) {\n        Assert_1.Assert.exists(queryBuilder);\n        this.dynamicFacetQueryController.putFacetIntoQueryBuilder(queryBuilder);\n    };\n    DynamicFacet.prototype.putStateIntoAnalytics = function () {\n        var pendingEvent = this.usageAnalytics.getPendingSearchEvent();\n        pendingEvent && pendingEvent.addFacetState(this.analyticsFacetState);\n    };\n    DynamicFacet.prototype.isCurrentlyDisplayed = function () {\n        return Dom_1.$$(this.element).isVisible();\n    };\n    Object.defineProperty(DynamicFacet.prototype, \"hasActiveValues\", {\n        get: function () {\n            return this.values.hasActiveValues;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacet.prototype.initQueryEvents = function () {\n        var _this = this;\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.duringQuery, function () { return _this.ensureDom(); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.doneBuildingQuery, function (data) { return _this.handleDoneBuildingQuery(data); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.deferredQuerySuccess, function (data) { return _this.handleQuerySuccess(data.results); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.queryError, function () { return _this.onNoValues(); });\n    };\n    DynamicFacet.prototype.initQueryStateEvents = function () {\n        this.includedAttributeId = QueryStateModel_1.QueryStateModel.getFacetId(this.options.id);\n        this.queryStateModel.registerNewAttribute(this.includedAttributeId, []);\n        this.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE, undefined, this.handleQueryStateChanged);\n    };\n    DynamicFacet.prototype.initBreadCrumbEvents = function () {\n        var _this = this;\n        if (this.options.includeInBreadcrumb) {\n            this.bind.onRootElement(BreadcrumbEvents_1.BreadcrumbEvents.populateBreadcrumb, function (args) {\n                return _this.handlePopulateBreadcrumb(args);\n            });\n            this.bind.onRootElement(BreadcrumbEvents_1.BreadcrumbEvents.clearBreadcrumb, function () { return _this.reset(); });\n        }\n    };\n    DynamicFacet.prototype.initValues = function () {\n        this.values = new DynamicFacetValues_1.DynamicFacetValues(this, DynamicFacetValueCreator_1.DynamicFacetValueCreator);\n    };\n    DynamicFacet.prototype.initComponentStateEvents = function () {\n        var componentStateId = QueryStateModel_1.QueryStateModel.getFacetId(this.options.id);\n        this.componentStateModel.registerComponent(componentStateId, this);\n    };\n    DynamicFacet.prototype.initDynamicFacetQueryController = function () {\n        this.dynamicFacetQueryController = new DynamicFacetQueryController_1.DynamicFacetQueryController(this);\n    };\n    DynamicFacet.prototype.handleDoneBuildingQuery = function (data) {\n        // If there is a DynamicFacetManager, it will take care of adding the facet's state\n        if (this.dynamicFacetManager) {\n            return;\n        }\n        Assert_1.Assert.exists(data);\n        Assert_1.Assert.exists(data.queryBuilder);\n        this.putStateIntoQueryBuilder(data.queryBuilder);\n        this.putStateIntoAnalytics();\n    };\n    DynamicFacet.prototype.handleQuerySuccess = function (results) {\n        // If there is a DynamicFacetManager, it will take care of handling the results\n        if (this.dynamicFacetManager) {\n            return;\n        }\n        if (Utils_1.Utils.isNullOrUndefined(results.facets)) {\n            return this.notImplementedError();\n        }\n        this.handleQueryResults(results);\n    };\n    DynamicFacet.prototype.handleQueryResults = function (results) {\n        var index = underscore_1.findIndex(results.facets, { facetId: this.options.id });\n        var facetResponse = index !== -1 ? results.facets[index] : null;\n        this.position = facetResponse ? index + 1 : undefined;\n        facetResponse ? this.onNewValues(facetResponse) : this.onNoValues();\n        this.header.hideLoading();\n        this.updateQueryStateModel();\n        this.values.render();\n        this.updateAppearance();\n    };\n    DynamicFacet.prototype.onNewValues = function (facetResponse) {\n        this.moreValuesAvailable = facetResponse.moreValuesAvailable;\n        this.values.createFromResponse(facetResponse);\n    };\n    DynamicFacet.prototype.onNoValues = function () {\n        this.moreValuesAvailable = false;\n        this.values.resetValues();\n    };\n    DynamicFacet.prototype.handleQueryStateChanged = function (data) {\n        if (!this.listenToQueryStateChange) {\n            return;\n        }\n        var querySelectedValues = data.attributes[this.includedAttributeId];\n        if (!querySelectedValues) {\n            return;\n        }\n        this.handleQueryStateChangedIncluded(querySelectedValues);\n    };\n    DynamicFacet.prototype.handlePopulateBreadcrumb = function (args) {\n        Assert_1.Assert.exists(args);\n        if (!this.values.hasActiveValues) {\n            return;\n        }\n        var breadcrumbs = new DynamicFacetBreadcrumbs_1.DynamicFacetBreadcrumbs(this);\n        args.breadcrumbs.push({ element: breadcrumbs.element });\n    };\n    DynamicFacet.prototype.initDependsOnManager = function () {\n        var _this = this;\n        var facetInfo = {\n            reset: function () { return _this.reset(); },\n            ref: this\n        };\n        this.dependsOnManager = new DependsOnManager_1.DependsOnManager(facetInfo);\n    };\n    DynamicFacet.prototype.createDom = function () {\n        this.createAndAppendContent();\n        this.updateAppearance();\n    };\n    DynamicFacet.prototype.createAndAppendContent = function () {\n        this.createAndAppendHeader();\n        this.createAndAppendSearch();\n        this.createAndAppendValues();\n    };\n    DynamicFacet.prototype.createAndAppendHeader = function () {\n        var _this = this;\n        this.header = new DynamicFacetHeader_1.DynamicFacetHeader({\n            title: this.options.title,\n            enableCollapse: this.options.enableCollapse,\n            clear: function () { return _this.clear(); },\n            toggleCollapse: function () { return _this.toggleCollapse(); },\n            collapse: function () { return _this.collapse(); },\n            expand: function () { return _this.expand(); }\n        });\n        this.element.appendChild(this.header.element);\n    };\n    DynamicFacet.prototype.createAndAppendSearch = function () {\n        if (this.options.enableFacetSearch === false) {\n            return;\n        }\n        this.search = new DynamicFacetSearch_1.DynamicFacetSearch(this);\n        this.element.appendChild(this.search.element);\n    };\n    DynamicFacet.prototype.createAndAppendValues = function () {\n        this.element.appendChild(this.values.render());\n    };\n    DynamicFacet.prototype.updateQueryStateModel = function () {\n        this.listenToQueryStateChange = false;\n        this.queryStateModel.set(this.includedAttributeId, this.values.selectedValues);\n        this.listenToQueryStateChange = true;\n    };\n    DynamicFacet.prototype.updateAppearance = function () {\n        this.header.toggleClear(this.values.hasSelectedValues);\n        this.header.toggleCollapse(this.isCollapsed);\n        this.toggleSearchDisplay();\n        Dom_1.$$(this.element).toggleClass('coveo-dynamic-facet-collapsed', this.isCollapsed);\n        Dom_1.$$(this.element).toggleClass('coveo-active', this.values.hasSelectedValues);\n        Dom_1.$$(this.element).toggleClass('coveo-hidden', !this.values.hasDisplayedValues);\n    };\n    DynamicFacet.prototype.toggleSearchDisplay = function () {\n        if (this.options.enableFacetSearch === false) {\n            return;\n        }\n        if (this.isCollapsed) {\n            return Dom_1.$$(this.search.element).toggleClass('coveo-hidden', true);\n        }\n        Dom_1.$$(this.search.element).toggleClass('coveo-hidden', !this.options.enableFacetSearch && !this.moreValuesAvailable);\n    };\n    DynamicFacet.prototype.triggerNewQuery = function (beforeExecuteQuery) {\n        this.beforeSendingQuery();\n        var options = beforeExecuteQuery ? { beforeExecuteQuery: beforeExecuteQuery } : { ignoreWarningSearchEvent: true };\n        this.queryController.executeQuery(options);\n    };\n    DynamicFacet.prototype.triggerNewIsolatedQuery = function (beforeExecuteQuery) {\n        return __awaiter(this, void 0, void 0, function () {\n            var results, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.beforeSendingQuery();\n                        beforeExecuteQuery && beforeExecuteQuery();\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.dynamicFacetQueryController.getQueryResults()];\n                    case 2:\n                        results = _a.sent();\n                        this.handleQueryResults(results);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        this.header.hideLoading();\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    DynamicFacet.prototype.beforeSendingQuery = function () {\n        this.header.showLoading();\n    };\n    DynamicFacet.prototype.notImplementedError = function () {\n        this.logger.error('DynamicFacets are not supported by your current search endpoint. Disabling this component.');\n        this.disable();\n        this.updateAppearance();\n    };\n    DynamicFacet.prototype.verifyCollapsingConfiguration = function () {\n        if (this.options.collapsedByDefault && !this.options.enableCollapse) {\n            this.logger.warn('The \"collapsedByDefault\" option is \"true\" while the \"enableCollapse\" is \"false\"');\n        }\n    };\n    DynamicFacet.prototype.logAnalyticsFacetShowMoreLess = function (cause) {\n        this.usageAnalytics.logCustomEvent(cause, this.basicAnalyticsFacetMeta, this.element);\n    };\n    DynamicFacet.prototype.clear = function () {\n        var _this = this;\n        this.reset();\n        this.enableFreezeFacetOrderFlag();\n        this.scrollToTop();\n        this.triggerNewQuery(function () { return _this.logClearAllToAnalytics(); });\n    };\n    DynamicFacet.prototype.logClearAllToAnalytics = function () {\n        this.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.dynamicFacetClearAll, this.basicAnalyticsFacetMeta);\n    };\n    DynamicFacet.ID = 'DynamicFacet';\n    DynamicFacet.doExport = function () { return GlobalExports_1.exportGlobally({ DynamicFacet: DynamicFacet }); };\n    /**\n     * The options for the DynamicFacet\n     * @componentOptions\n     */\n    DynamicFacet.options = __assign({}, ResponsiveFacetOptions_1.ResponsiveFacetOptions, { \n        /**\n         * The unique identifier for this facet.\n         *\n         * Among other things, this is used to record and read the facet\n         * state in the URL fragment identifier (see the\n         * [`enableHistory`]{@link SearchInterface.options.enableHistory} `SearchInterface`\n         * option).\n         *\n         * **Tip:** When several facets in a given search interface are based on\n         * the same field, ensure that each of those facets has a distinct `id`.\n         *\n         * If specified, must contain between 1 and 60 characters.\n         * Only alphanumeric (A-Za-z0-9), underscore (_), and hyphen (-) characters are kept; other characters are automatically removed.\n         *\n         * Defaults to the [`field`]{@link DynamicFacet.options.field} option value.\n         *\n         * @examples author-facet\n         */\n        id: ComponentOptions_1.ComponentOptions.buildStringOption({\n            postProcessing: function (value, options) {\n                if (value === void 0) { value = ''; }\n                var maxCharLength = 60;\n                var sanitizedValue = value.replace(/[^A-Za-z0-9-_@]+/g, '');\n                if (Utils_1.Utils.isNonEmptyString(sanitizedValue)) {\n                    return sanitizedValue.slice(0, maxCharLength - 1);\n                }\n                return options.field.slice(0, maxCharLength - 1);\n            },\n            section: 'CommonOptions'\n        }), \n        /**\n         * The title to display for this facet.\n         *\n         * Defaults to the localized string for `NoTitle`.\n         *\n         * @examples Author\n         */\n        title: ComponentOptions_1.ComponentOptions.buildLocalizedStringOption({\n            localizedString: function () { return Strings_1.l('NoTitle'); },\n            section: 'CommonOptions',\n            priority: 10\n        }), \n        /**\n         * The name of the field on which to base this facet.\n         *\n         * Must be prefixed by `@`, and must reference an existing field whose\n         * **Facet** option is enabled.\n         *\n         * @externaldocs [Add or Edit Fields](https://docs.coveo.com/en/1982/)\n         * @examples @author\n         */\n        field: ComponentOptions_1.ComponentOptions.buildFieldOption({ required: true, section: 'CommonOptions' }), \n        /**\n         * The sort criterion to use for this facet.\n         *\n         * See [`FacetSortCriteria`]{@link FacetSortCriteria} for the list and\n         * description of allowed values.\n         *\n         * By default, the following behavior applies:\n         *\n         * - If the requested [`numberOfValues`]{@link DynamicFacet.options.numberOfValues}\n         * is greater than or equal to the currently displayed number of values,\n         * the [`alphanumeric`]{@link FacetSortCriteria.alphanumeric} criterion is\n         * used.\n         * - If the requested `numberOfValues` is less than the currently displayed\n         * number of values and the facet is not currently expanded, the [`score`]{@link FacetSortCriteria.score}\n         * criterion is used.\n         * - Otherwise, the `alphanumeric` criterion is used.\n         *\n         * @examples score\n         */\n        sortCriteria: ComponentOptions_1.ComponentOptions.buildStringOption({\n            postProcessing: function (value) {\n                if (!value) {\n                    return undefined;\n                }\n                if (FacetSortCriteria_1.isFacetSortCriteria(value)) {\n                    return value;\n                }\n                new Logger_1.Logger(value).warn('sortCriteria is not of the the allowed values: \"score\", \"alphanumeric\", \"occurrences\"');\n                return undefined;\n            },\n            section: 'Sorting'\n        }), \n        /**\n         * The number of values to request for this facet.\n         *\n         * Also determines the default maximum number of additional values to request each time this facet is expanded,\n         * and the maximum number of values to display when this facet is collapsed (see the [`enableCollapse`]{@link DynamicFacet.options.enableCollapse} option).\n         */\n        numberOfValues: ComponentOptions_1.ComponentOptions.buildNumberOption({ min: 0, defaultValue: 8, section: 'CommonOptions' }), \n        /**\n         * Whether to allow the end-user to expand and collapse this facet.\n         */\n        enableCollapse: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'CommonOptions' }), \n        /**\n         * Whether to scroll back to the top of the page whenever the end-user interacts with the facet.\n         */\n        enableScrollToTop: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'CommonOptions' }), \n        /**\n         * Whether to enable the **Show more** and **Show less** buttons in the facet.\n         *\n         * **Note:** The [`DynamicFacetRange`]{@link DynamicFacetRange} component does not support this option.\n         */\n        enableMoreLess: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'CommonOptions' }), \n        /**\n         * Whether to allow the end-user to search the facet values.\n         *\n         * **Note:** The [`DynamicFacetRange`]{@link DynamicFacetRange} component does not support this option.\n         *\n         * By default, the following behavior applies:\n         *\n         * - Enabled when more facet values are available.\n         * - Disabled when all available facet values are already displayed.\n         */\n        enableFacetSearch: ComponentOptions_1.ComponentOptions.buildBooleanOption({ section: 'Filtering' }), \n        /**\n         * Whether to prepend facet search queries with a wildcard.\n         *\n         * **Note:** The [`DynamicFacetRange`]{@link DynamicFacetRange} component does not support this option.\n         */\n        useLeadingWildcardInFacetSearch: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            defaultValue: true,\n            section: 'Filtering',\n            depend: 'enableFacetSearch'\n        }), \n        /**\n         * Whether this facet should be collapsed by default.\n         */\n        collapsedByDefault: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'CommonOptions', depend: 'enableCollapse' }), \n        /**\n         * Whether to notify the [`Breadcrumb`]{@link Breadcrumb} component when toggling values in the facet.\n         *\n         * See also the [`numberOfValuesInBreadcrumb`]{@link DynamicFacet.options.numberOfValuesInBreadcrumb} option.\n         */\n        includeInBreadcrumb: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'CommonOptions' }), \n        /**\n         * The maximum number of selected values the [`Breadcrumb`]{@link Breadcrumb} component can display before outputting a **N more...** link for the facet.\n         */\n        numberOfValuesInBreadcrumb: ComponentOptions_1.ComponentOptions.buildNumberOption({\n            defaultFunction: function () { return (DeviceUtils_1.DeviceUtils.isMobileDevice() ? 3 : 5); },\n            min: 0,\n            depend: 'includeInBreadcrumb',\n            section: 'CommonOptions'\n        }), \n        /**\n         * A mapping of facet values to their desired captions.\n         *\n         * **Note:** The [`DynamicFacetRange`]{@link DynamicFacetRange} component does not support this option.\n         *\n         * @externaldocs [Normalizing Facet Value Captions](https://docs.coveo.com/368/).\n         * @examples { \"smith_alice\": \"Alice Smith\"\\, \"jones_bob_r\": \"Bob R. Jones\" }\n         */\n        valueCaption: ComponentOptions_1.ComponentOptions.buildJsonOption({ defaultValue: {} }), \n        /**\n         * The [`id`]{@link DynamicFacet.options.id} of another facet in which at least one value must be selected in order for the dependent facet to be visible.\n         *\n         * By default, the facet does not depend on any other facet to be displayed.\n         *\n         * @examples document-type-facet\n         *\n         * @availablesince [December 2019 Release (v2.7610)](https://docs.coveo.com/en/3142/)\n         */\n        dependsOn: ComponentOptions_1.ComponentOptions.buildStringOption({ section: 'CommonOptions' }), \n        /**\n         * A function that verifies whether the current state of the `dependsOn` facet allows the dependent facet to be displayed.\n         *\n         * If specified, the function receives a reference to the resolved `dependsOn` facet component instance as an argument, and must return a boolean.\n         * The function's argument should typically be treated as read-only.\n         *\n         * By default, the dependent facet is displayed whenever one or more values are selected in its `dependsOn` facet.\n         *\n         * @externaldocs [Defining Dependent Facets](https://docs.coveo.com/3210/)\n         *\n         * @availablesince [April 2020 Release (v2.8864)](https://docs.coveo.com/en/3231/)\n         */\n        dependsOnCondition: ComponentOptions_1.ComponentOptions.buildCustomOption(function () {\n            return null;\n        }, { depend: 'dependsOn', section: 'CommonOptions' }), \n        /**\n         * The number of items to scan for facet values.\n         *\n         * Setting this option to a higher value may enhance the accuracy of facet value counts at the cost of slower query performance.\n         *\n         * @availablesince [January 2020 Release (v2.7968)](https://docs.coveo.com/en/3163/)\n         */\n        injectionDepth: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 1000, min: 0 }), \n        /**\n         * Whether to exclude folded result parents when estimating result counts for facet values.\n         *\n         * See also the [`Folding`]{@link Folding} and [`FoldingForThread`]{@link FoldingForThread} components.\n         *\n         * **Default:** `false` if folded results are requested; `true` otherwise.\n         *\n         * @availablesince [March 2020 Release (v2.8521)](https://docs.coveo.com/en/3203/)\n         */\n        filterFacetCount: ComponentOptions_1.ComponentOptions.buildBooleanOption({ section: 'Filtering' }) });\n    return DynamicFacet;\n}(Component_1.Component));\nexports.DynamicFacet = DynamicFacet;\nInitialization_1.Initialization.registerAutoCreateComponent(DynamicFacet);\nDynamicFacet.doExport();\n\n\n/***/ }),\n\n/***/ 173:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar underscore_1 = __webpack_require__(0);\nvar Core_1 = __webpack_require__(20);\nvar Model_1 = __webpack_require__(18);\nvar ComponentsTypes_1 = __webpack_require__(45);\nvar Dom_1 = __webpack_require__(1);\nvar InitializationEvents_1 = __webpack_require__(17);\nvar DependsOnManager = /** @class */ (function () {\n    function DependsOnManager(facet) {\n        var _this = this;\n        this.facet = facet;\n        this.facet.ref.bind.onRootElement(Core_1.QueryEvents.buildingQuery, function () { return _this.handleBuildingQuery(); });\n        if (this.getDependsOn(this.facet.ref)) {\n            this.facet.ref.bind.onRootElement(InitializationEvents_1.InitializationEvents.afterComponentsInitialization, function () { return _this.setupDependentFacet(); });\n        }\n    }\n    DependsOnManager.prototype.setupDependentFacet = function () {\n        var _this = this;\n        Dom_1.$$(this.facet.ref.element).addClass('coveo-hidden');\n        this.parentFacetRef = this.getParentFacet(this.facet.ref);\n        if (this.parentFacetRef) {\n            this.facet.ref.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE, undefined, function () { return _this.resetIfConditionUnfullfiled(); });\n        }\n    };\n    DependsOnManager.prototype.resetIfConditionUnfullfiled = function () {\n        var condition = this.getDependsOnCondition(this.facet.ref);\n        if (!condition(this.parentFacetRef)) {\n            this.facet.reset();\n        }\n    };\n    DependsOnManager.prototype.getId = function (component) {\n        var id = component.options.id;\n        return id ? \"\" + id : null;\n    };\n    DependsOnManager.prototype.getDependsOn = function (component) {\n        var dependsOn = component.options.dependsOn;\n        return dependsOn ? \"\" + dependsOn : null;\n    };\n    DependsOnManager.prototype.getDependsOnCondition = function (component) {\n        var _this = this;\n        var conditionOption = component.options.dependsOnCondition;\n        return conditionOption && underscore_1.isFunction(conditionOption) ? conditionOption : function () { return _this.parentHasSelectedValues(component); };\n    };\n    DependsOnManager.prototype.parentHasSelectedValues = function (component) {\n        var parent = this.getParentFacet(component);\n        return parent && this.valuesExistForFacetWithId(this.getId(parent));\n    };\n    DependsOnManager.prototype.valuesExistForFacetWithId = function (facetId) {\n        var values = this.facet.ref.queryStateModel.get(Core_1.QueryStateModel.getFacetId(facetId));\n        return !!values && !!values.length;\n    };\n    Object.defineProperty(DependsOnManager.prototype, \"allFacetsInInterface\", {\n        get: function () {\n            return ComponentsTypes_1.ComponentsTypes.getAllFacetsFromSearchInterface(this.facet.ref.searchInterface);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DependsOnManager.prototype.getParentFacet = function (component) {\n        var _this = this;\n        var parent = this.allFacetsInInterface.filter(function (potentialParentFacet) { return _this.getId(potentialParentFacet) === _this.getDependsOn(component); });\n        if (!parent.length) {\n            component.logger.warn('DependsOn reference does not exist', this.getDependsOn(this.facet.ref));\n            return null;\n        }\n        return parent[0];\n    };\n    Object.defineProperty(DependsOnManager.prototype, \"dependentFacets\", {\n        get: function () {\n            var _this = this;\n            return this.allFacetsInInterface.filter(function (potentialDependentFacet) { return _this.getId(_this.facet.ref) === _this.getDependsOn(potentialDependentFacet); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DependsOnManager.prototype.handleBuildingQuery = function () {\n        var _this = this;\n        this.dependentFacets.forEach(function (dependentFacet) {\n            var condition = _this.getDependsOnCondition(dependentFacet);\n            if (condition(_this.facet.ref)) {\n                Dom_1.$$(dependentFacet.element).removeClass('coveo-hidden');\n                return dependentFacet.enable();\n            }\n            dependentFacet.disable();\n            Dom_1.$$(dependentFacet.element).addClass('coveo-hidden');\n        });\n    };\n    Object.defineProperty(DependsOnManager.prototype, \"hasDependentFacets\", {\n        get: function () {\n            return !!this.dependentFacets.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DependsOnManager.prototype, \"dependentFacetsHaveSelectedValues\", {\n        get: function () {\n            var _this = this;\n            return this.dependentFacets.some(function (dependentFacet) { return _this.valuesExistForFacetWithId(_this.getId(dependentFacet)); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return DependsOnManager;\n}());\nexports.DependsOnManager = DependsOnManager;\n\n\n/***/ }),\n\n/***/ 175:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Core_1 = __webpack_require__(20);\nvar Initialization_1 = __webpack_require__(2);\n/**\n * This component lets you customize the mobile responsive behavior of facets in your search interface.\n *\n * **Notes:**\n * - You can include this component anywhere under the root element of your search interface.\n * - You should only include this component once in your search interface.\n * - If you do not include this component in your search interface, facets will still have a default mobile responsive behavior.\n */\nvar FacetsMobileMode = /** @class */ (function (_super) {\n    __extends(FacetsMobileMode, _super);\n    function FacetsMobileMode(element, options, bindings) {\n        var _this = _super.call(this, element, FacetsMobileMode.ID, bindings) || this;\n        _this.element = element;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, FacetsMobileMode, options);\n        if (_this.options.preventScrolling) {\n            var scrollContainer = _this.options.scrollContainer || _this.searchInterface.element;\n            _this.options.scrollContainer = ComponentOptions_1.ComponentOptions.findParentScrollLockable(scrollContainer);\n        }\n        return _this;\n    }\n    FacetsMobileMode.ID = 'FacetsMobileMode';\n    /**\n     * @componentOptions\n     */\n    FacetsMobileMode.options = {\n        /**\n         * The screen width (in number of pixels) at which facets should enter mobile responsive mode and be collapsed under a single button.\n         *\n         * **Default:** `800`\n         */\n        breakpoint: ComponentOptions_1.ComponentOptions.buildNumberOption(),\n        /**\n         * Whether to display the facets in a modal instead of a pop-up when the end user expands them in mobile responsive mode.\n         */\n        isModal: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\n        /**\n         * Whether to display an overlay behind the facets when the end user expands them in mobile responsive mode.\n         *\n         * By default, the following behavior applies:\n         * - `true` when [isModal]{@link FacetsMobileMode.options.isModal} is `false`\n         * - `false` when [isModal]{@link FacetsMobileMode.options.isModal} is `true`\n         */\n        displayOverlayWhileOpen: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            postProcessing: function (value, options) { return (Core_1.Utils.isNullOrUndefined(value) ? !options.isModal : value); }\n        }),\n        /**\n         * Whether to disable vertical scrolling on the specified or resolved [`scrollContainer`]{@link FacetsMobileMode.options.scrollContainer} while facets are expanded in mobile responsive mode.\n         *\n         * By default, the following behavior applies:\n         * - `true` when [isModal]{@link FacetsMobileMode.options.isModal} is `true`\n         * - `false` when [isModal]{@link FacetsMobileMode.options.isModal} is `false`\n         */\n        preventScrolling: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            postProcessing: function (value, options) { return (Core_1.Utils.isNullOrUndefined(value) ? options.isModal : value); }\n        }),\n        /**\n         * The HTML element whose vertical scrolling should be locked while facets are expanded in mobile responsive mode.\n         *\n         * By default, the component tries to detect and use the first ancestor element whose CSS `overflow-y` attribute is set to `scroll`, starting from the `FacetsMobileMode`'s element itself. If no such element is found, the `document.body` element is used.\n         *\n         * Since this heuristic is not perfect, we strongly recommend that you manually set this option by explicitly specifying the desired CSS selector.\n         *\n         * **Example:** `data-scroll-container-selector='#someCssSelector'`\n         */\n        scrollContainer: ComponentOptions_1.ComponentOptions.buildChildHtmlElementOption({ depend: 'preventScrolling' })\n    };\n    FacetsMobileMode.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            FacetsMobileMode: FacetsMobileMode\n        });\n    };\n    return FacetsMobileMode;\n}(Component_1.Component));\nexports.FacetsMobileMode = FacetsMobileMode;\nInitialization_1.Initialization.registerAutoCreateComponent(FacetsMobileMode);\n\n\n/***/ }),\n\n/***/ 180:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The allowed values for the [`facetType`]{@link IFacetRequest.facetType} property of a [facet request]{@link IFacetRequest}.\n */\nvar FacetType;\n(function (FacetType) {\n    /**\n     * Request facet values representing specific values.\n     */\n    FacetType[\"specific\"] = \"specific\";\n    /**\n     * Request facet values representing ranges of numbers.\n     */\n    FacetType[\"numericalRange\"] = \"numericalRange\";\n    /**\n     * Request facet values representing ranges of dates.\n     */\n    FacetType[\"dateRange\"] = \"dateRange\";\n    /**\n     * Request facet values representing a hierarchy.\n     */\n    FacetType[\"hierarchical\"] = \"hierarchical\";\n})(FacetType = exports.FacetType || (exports.FacetType = {}));\n\n\n/***/ }),\n\n/***/ 211:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Component_1 = __webpack_require__(7);\nvar _ = __webpack_require__(0);\nvar ResultListRenderer = /** @class */ (function () {\n    function ResultListRenderer(resultListOptions, autoCreateComponentsFn) {\n        this.resultListOptions = resultListOptions;\n        this.autoCreateComponentsFn = autoCreateComponentsFn;\n    }\n    ResultListRenderer.prototype.renderResults = function (resultElements, append, resultDisplayedCallback) {\n        var _this = this;\n        if (append === void 0) { append = false; }\n        return Promise.all([this.getStartFragment(resultElements, append), this.getEndFragment(resultElements, append)]).then(function (_a) {\n            var startFrag = _a[0], endFrag = _a[1];\n            var resultsFragment = document.createDocumentFragment();\n            if (startFrag) {\n                resultsFragment.appendChild(startFrag);\n            }\n            _.each(resultElements, function (resultElement) {\n                resultsFragment.appendChild(resultElement);\n                resultDisplayedCallback(Component_1.Component.getResult(resultElement), resultElement);\n            });\n            if (endFrag) {\n                resultsFragment.appendChild(endFrag);\n            }\n            _this.resultListOptions.resultsContainer.appendChild(resultsFragment);\n        });\n    };\n    ResultListRenderer.prototype.getStartFragment = function (resultElements, append) {\n        return Promise.resolve(document.createDocumentFragment());\n    };\n    ResultListRenderer.prototype.getEndFragment = function (resultElements, append) {\n        return Promise.resolve(document.createDocumentFragment());\n    };\n    return ResultListRenderer;\n}());\nexports.ResultListRenderer = ResultListRenderer;\n\n\n/***/ }),\n\n/***/ 212:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(529);\nvar QueryEvents_1 = __webpack_require__(11);\nvar Logger_1 = __webpack_require__(9);\nvar Strings_1 = __webpack_require__(6);\nvar Dom_1 = __webpack_require__(1);\nvar Utils_1 = __webpack_require__(4);\nvar Component_1 = __webpack_require__(7);\nvar SearchInterface_1 = __webpack_require__(19);\nvar ResponsiveComponents_1 = __webpack_require__(52);\nvar ResponsiveComponentsManager_1 = __webpack_require__(60);\nvar ResponsiveComponentsUtils_1 = __webpack_require__(126);\nvar ResponsiveDropdown_1 = __webpack_require__(117);\nvar ResponsiveDropdownContent_1 = __webpack_require__(88);\nvar ResponsiveDropdownHeader_1 = __webpack_require__(131);\nvar underscore_1 = __webpack_require__(0);\nvar ComponentsTypes_1 = __webpack_require__(45);\nvar ResponsiveDropdownModalContent_1 = __webpack_require__(530);\nvar FacetsMobileMode_1 = __webpack_require__(175);\nvar FacetsMobileModeEvents_1 = __webpack_require__(531);\nvar ResponsiveFacetColumn = /** @class */ (function () {\n    function ResponsiveFacetColumn(coveoRoot, ID, options, responsiveDropdown) {\n        this.coveoRoot = coveoRoot;\n        this.ID = ID;\n        this.componentsInFacetColumn = [];\n        this.preservePositionOriginalValues = [];\n        this.searchInterface = Component_1.Component.get(this.coveoRoot.el, SearchInterface_1.SearchInterface, false);\n        this.dropdownHeaderLabel = this.getDropdownHeaderLabel();\n        this.dropdown = this.buildDropdown(responsiveDropdown);\n        this.bindDropdownContentEvents();\n        this.bindFacetsMobileModeEvents();\n        this.registerOnCloseHandler();\n        this.registerQueryEvents();\n        this.initializeBreakpoint(options.responsiveBreakpoint);\n    }\n    ResponsiveFacetColumn.init = function (responsiveComponentConstructor, root, component, options, ID) {\n        var column = this.findColumn(root);\n        if (!column) {\n            return;\n        }\n        ResponsiveComponentsManager_1.ResponsiveComponentsManager.register(ResponsiveFacetColumn, Dom_1.$$(root), 'ResponsiveFacetColumn', component, options);\n        ResponsiveComponentsManager_1.ResponsiveComponentsManager.register(responsiveComponentConstructor, Dom_1.$$(root), ID, component, options);\n    };\n    ResponsiveFacetColumn.findColumn = function (root) {\n        var column = Dom_1.$$(root).find('.coveo-facet-column');\n        if (!column) {\n            var logger = new Logger_1.Logger('ResponsiveFacets');\n            logger.info('No element with class coveo-facet-column. Responsive facets cannot be enabled');\n        }\n        return column;\n    };\n    Object.defineProperty(ResponsiveFacetColumn.prototype, \"facetsMobileModeComponent\", {\n        get: function () {\n            return this.searchInterface ? this.searchInterface.getComponents(FacetsMobileMode_1.FacetsMobileMode.ID)[0] : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResponsiveFacetColumn.prototype, \"facetsMobileModeOptions\", {\n        get: function () {\n            var facetsMobileModeComponent = this.facetsMobileModeComponent;\n            if (!facetsMobileModeComponent) {\n                return {\n                    isModal: false,\n                    preventScrolling: false,\n                    displayOverlayWhileOpen: true\n                };\n            }\n            return facetsMobileModeComponent.options;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResponsiveFacetColumn.prototype.registerComponent = function (accept) {\n        this.componentsInFacetColumn.push(accept);\n        this.preservePositionOriginalValues.push(accept.options.preservePosition);\n        return true;\n    };\n    ResponsiveFacetColumn.prototype.needDropdownWrapper = function () {\n        return this.needSmallMode();\n    };\n    ResponsiveFacetColumn.prototype.handleResizeEvent = function () {\n        if (this.needSmallMode() && !ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.isSmallFacetActivated(this.coveoRoot)) {\n            this.changeToSmallMode();\n        }\n        else if (!this.needSmallMode() && ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.isSmallFacetActivated(this.coveoRoot)) {\n            this.changeToLargeMode();\n        }\n        if (this.dropdown.isOpened) {\n            this.dropdown.dropdownContent.positionDropdown();\n        }\n    };\n    ResponsiveFacetColumn.prototype.dismissFacetSearches = function () {\n        underscore_1.each(this.componentsInFacetColumn, function (component) {\n            if (component.facetSearch && component.facetSearch.currentlyDisplayedResults) {\n                component.facetSearch.dismissSearchResults();\n            }\n        });\n    };\n    ResponsiveFacetColumn.prototype.needSmallMode = function () {\n        if (!this.searchInterface) {\n            return (this.coveoRoot.width() <=\n                (Utils_1.Utils.isNullOrUndefined(this.breakpoint) ? new ResponsiveComponents_1.ResponsiveComponents().getMediumScreenWidth() : this.breakpoint));\n        }\n        switch (this.searchInterface.responsiveComponents.getResponsiveMode()) {\n            case 'small':\n            case 'medium':\n                return true;\n            case 'auto':\n                return (this.coveoRoot.width() <=\n                    (Utils_1.Utils.isNullOrUndefined(this.breakpoint) ? this.searchInterface.responsiveComponents.getMediumScreenWidth() : this.breakpoint));\n            default:\n                return false;\n        }\n    };\n    ResponsiveFacetColumn.prototype.changeToSmallMode = function () {\n        this.dropdown.close();\n        this.disableFacetPreservePosition();\n        Dom_1.$$(this.coveoRoot.find(\".\" + ResponsiveComponentsManager_1.ResponsiveComponentsManager.DROPDOWN_HEADER_WRAPPER_CSS_CLASS)).append(this.dropdown.dropdownHeader.element.el);\n        ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.activateSmallFacet(this.coveoRoot);\n    };\n    ResponsiveFacetColumn.prototype.changeToLargeMode = function () {\n        this.restoreFacetPreservePositionValue();\n        this.dropdown.cleanUp();\n        ResponsiveComponentsUtils_1.ResponsiveComponentsUtils.deactivateSmallFacet(this.coveoRoot);\n    };\n    ResponsiveFacetColumn.prototype.buildDropdown = function (responsiveDropdown) {\n        var dropdownContent = this.buildDropdownContent();\n        var dropdownHeader = this.buildDropdownHeader();\n        var dropdown = responsiveDropdown ? responsiveDropdown : new ResponsiveDropdown_1.ResponsiveDropdown(dropdownContent, dropdownHeader, this.coveoRoot);\n        if (!this.facetsMobileModeOptions.displayOverlayWhileOpen) {\n            dropdown.disablePopupBackground();\n        }\n        if (this.facetsMobileModeOptions.preventScrolling) {\n            dropdown.enableScrollLocking(this.facetsMobileModeOptions.scrollContainer);\n        }\n        return dropdown;\n    };\n    ResponsiveFacetColumn.prototype.buildDropdownContent = function () {\n        var _this = this;\n        var dropdownContentElement = Dom_1.$$(this.coveoRoot.find('.coveo-facet-column'));\n        var filterByContainer = Dom_1.$$('div', { className: 'coveo-facet-header-filter-by-container', style: 'display: none' });\n        var filterBy = Dom_1.$$('div', { className: 'coveo-facet-header-filter-by' });\n        filterBy.text(Strings_1.l('Filter by:'));\n        filterByContainer.append(filterBy.el);\n        dropdownContentElement.prepend(filterByContainer.el);\n        if (this.facetsMobileModeOptions.isModal) {\n            return new ResponsiveDropdownModalContent_1.ResponsiveDropdownModalContent('facet', dropdownContentElement, Strings_1.l('CloseFiltersDropdown'), function () { return _this.dropdown.close(); });\n        }\n        return new ResponsiveDropdownContent_1.ResponsiveDropdownContent('facet', dropdownContentElement, this.coveoRoot, ResponsiveFacetColumn.DROPDOWN_MIN_WIDTH, ResponsiveFacetColumn.DROPDOWN_WIDTH_RATIO);\n    };\n    ResponsiveFacetColumn.prototype.buildDropdownHeader = function () {\n        var dropdownHeaderElement = Dom_1.$$('a');\n        var content = Dom_1.$$('p');\n        content.text(this.dropdownHeaderLabel);\n        dropdownHeaderElement.el.appendChild(content.el);\n        var dropdownHeader = new ResponsiveDropdownHeader_1.ResponsiveDropdownHeader('facet', dropdownHeaderElement);\n        return dropdownHeader;\n    };\n    ResponsiveFacetColumn.prototype.initializeBreakpoint = function (defaultBreakpoint) {\n        var facetsMobileModeBreakpoint = this.facetsMobileModeOptions.breakpoint;\n        this.breakpoint = Utils_1.Utils.isNullOrUndefined(facetsMobileModeBreakpoint) ? defaultBreakpoint : facetsMobileModeBreakpoint;\n    };\n    ResponsiveFacetColumn.prototype.registerOnCloseHandler = function () {\n        this.dropdown.registerOnCloseHandler(this.dismissFacetSearches, this);\n    };\n    ResponsiveFacetColumn.prototype.registerQueryEvents = function () {\n        var _this = this;\n        this.coveoRoot.on(QueryEvents_1.QueryEvents.noResults, function () { return _this.handleNoResults(); });\n        this.coveoRoot.on(QueryEvents_1.QueryEvents.querySuccess, function (e, data) { return _this.handleQuerySuccess(data); });\n        this.coveoRoot.on(QueryEvents_1.QueryEvents.queryError, function () { return _this.handleQueryError(); });\n    };\n    ResponsiveFacetColumn.prototype.bindDropdownContentEvents = function () {\n        var _this = this;\n        this.dropdown.dropdownContent.element.on('scroll', underscore_1.debounce(function () {\n            underscore_1.each(_this.componentsInFacetColumn, function (component) {\n                var facetSearch = component.facetSearch;\n                if (facetSearch && facetSearch.currentlyDisplayedResults && !_this.isFacetSearchScrolledIntoView(facetSearch.search)) {\n                    component.facetSearch.positionSearchResults(_this.dropdown.dropdownContent.element.el);\n                }\n                else if (facetSearch && component.facetSearch.currentlyDisplayedResults) {\n                    component.facetSearch.positionSearchResults();\n                }\n            });\n        }, ResponsiveFacetColumn.DEBOUNCE_SCROLL_WAIT));\n    };\n    ResponsiveFacetColumn.prototype.bindFacetsMobileModeEvents = function () {\n        var facetsMobileModeComponent = this.facetsMobileModeComponent;\n        if (facetsMobileModeComponent) {\n            this.dropdown.registerOnOpenHandler(function () { return Dom_1.$$(facetsMobileModeComponent.element).trigger(FacetsMobileModeEvents_1.FacetsMobileModeEvents.popupOpened); }, facetsMobileModeComponent);\n            this.dropdown.registerOnCloseHandler(function () { return Dom_1.$$(facetsMobileModeComponent.element).trigger(FacetsMobileModeEvents_1.FacetsMobileModeEvents.popupClosed); }, facetsMobileModeComponent);\n        }\n    };\n    ResponsiveFacetColumn.prototype.restoreFacetPreservePositionValue = function () {\n        var _this = this;\n        underscore_1.each(this.componentsInFacetColumn, function (component, index) {\n            if (component.options) {\n                component.options.preservePosition = _this.preservePositionOriginalValues[index];\n            }\n        });\n    };\n    ResponsiveFacetColumn.prototype.disableFacetPreservePosition = function () {\n        underscore_1.each(this.componentsInFacetColumn, function (component) {\n            if (component.options) {\n                component.options.preservePosition = false;\n            }\n        });\n    };\n    ResponsiveFacetColumn.prototype.isFacetSearchScrolledIntoView = function (facetSearchElement) {\n        var facetTop = facetSearchElement.getBoundingClientRect().top;\n        var facetBottom = facetSearchElement.getBoundingClientRect().bottom;\n        var dropdownTop = this.dropdown.dropdownContent.element.el.getBoundingClientRect().top;\n        var dropdownBottom = this.dropdown.dropdownContent.element.el.getBoundingClientRect().bottom;\n        dropdownTop = dropdownTop >= 0 ? dropdownTop : 0;\n        return facetTop >= dropdownTop && facetBottom <= dropdownBottom;\n    };\n    ResponsiveFacetColumn.prototype.getDropdownHeaderLabel = function () {\n        var dropdownHeaderLabel;\n        ComponentsTypes_1.ComponentsTypes.getAllFacetInstancesFromElement(this.coveoRoot.find('.coveo-facet-column')).forEach(function (facet) {\n            var options = facet.options;\n            if (!dropdownHeaderLabel && options.dropdownHeaderLabel) {\n                dropdownHeaderLabel = options.dropdownHeaderLabel;\n            }\n        });\n        if (!dropdownHeaderLabel) {\n            dropdownHeaderLabel = Strings_1.l(ResponsiveFacetColumn.DROPDOWN_HEADER_LABEL_DEFAULT_VALUE);\n        }\n        return dropdownHeaderLabel;\n    };\n    ResponsiveFacetColumn.prototype.handleNoResults = function () {\n        this.dropdown.dropdownHeader.hide();\n    };\n    ResponsiveFacetColumn.prototype.handleQueryError = function () {\n        this.dropdown.dropdownHeader.hide();\n    };\n    ResponsiveFacetColumn.prototype.handleQuerySuccess = function (data) {\n        if (data.results.totalCount === 0) {\n            this.dropdown.dropdownHeader.hide();\n        }\n        else {\n            this.dropdown.dropdownHeader.show();\n        }\n    };\n    ResponsiveFacetColumn.DEBOUNCE_SCROLL_WAIT = 250;\n    ResponsiveFacetColumn.DROPDOWN_MIN_WIDTH = 280;\n    ResponsiveFacetColumn.DROPDOWN_WIDTH_RATIO = 0.35; // Used to set the width relative to the coveo root.\n    ResponsiveFacetColumn.DROPDOWN_HEADER_LABEL_DEFAULT_VALUE = 'Filters';\n    return ResponsiveFacetColumn;\n}());\nexports.ResponsiveFacetColumn = ResponsiveFacetColumn;\n\n\n/***/ }),\n\n/***/ 221:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 222:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar DynamicFacetValueShowMoreLessButton = /** @class */ (function () {\n    function DynamicFacetValueShowMoreLessButton(options) {\n        var btn = Dom_1.$$('button', {\n            className: options.className,\n            ariaLabel: options.ariaLabel,\n            type: 'button'\n        }, options.label);\n        this.element = Dom_1.$$('li', null, btn).el;\n        btn.on('click', function () { return options.action(); });\n    }\n    return DynamicFacetValueShowMoreLessButton;\n}());\nexports.DynamicFacetValueShowMoreLessButton = DynamicFacetValueShowMoreLessButton;\n\n\n/***/ }),\n\n/***/ 223:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Globalize = __webpack_require__(23);\nvar FacetValueState_1 = __webpack_require__(69);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Strings_1 = __webpack_require__(6);\nvar FacetRequest_1 = __webpack_require__(180);\nvar DynamicFacetValue = /** @class */ (function () {\n    function DynamicFacetValue(facetValue, facet, rendererKlass) {\n        this.facet = facet;\n        this.element = null;\n        this.value = facetValue.value;\n        this.start = facetValue.start;\n        this.end = facetValue.end;\n        this.endInclusive = facetValue.endInclusive;\n        this.state = facetValue.state;\n        this.numberOfResults = facetValue.numberOfResults;\n        this.position = facetValue.position;\n        this.displayValue = facetValue.displayValue;\n        this.renderer = new rendererKlass(this, facet);\n    }\n    Object.defineProperty(DynamicFacetValue.prototype, \"isSelected\", {\n        get: function () {\n            return this.state === FacetValueState_1.FacetValueState.selected;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValue.prototype, \"isIdle\", {\n        get: function () {\n            return this.state === FacetValueState_1.FacetValueState.idle;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacetValue.prototype.toggleSelect = function () {\n        this.state === FacetValueState_1.FacetValueState.selected ? this.deselect() : this.select();\n    };\n    DynamicFacetValue.prototype.select = function () {\n        this.state = FacetValueState_1.FacetValueState.selected;\n    };\n    DynamicFacetValue.prototype.deselect = function () {\n        this.state = FacetValueState_1.FacetValueState.idle;\n    };\n    DynamicFacetValue.prototype.equals = function (arg) {\n        var value = typeof arg === 'string' ? arg : arg.value;\n        return value.toLowerCase() === this.value.toLowerCase();\n    };\n    Object.defineProperty(DynamicFacetValue.prototype, \"formattedCount\", {\n        get: function () {\n            return Globalize.format(this.numberOfResults, 'n0');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValue.prototype, \"selectAriaLabel\", {\n        get: function () {\n            var resultCount = Strings_1.l('ResultCount', this.formattedCount, this.numberOfResults);\n            return \"\" + Strings_1.l('IncludeValueWithResultCount', this.displayValue, resultCount);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValue.prototype, \"isRange\", {\n        get: function () {\n            return this.facet.facetType !== FacetRequest_1.FacetType.specific;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValue.prototype, \"analyticsValue\", {\n        get: function () {\n            return this.isRange ? this.start + \"..\" + this.end : this.value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValue.prototype, \"rangeFacetState\", {\n        get: function () {\n            if (!this.isRange) {\n                return null;\n            }\n            return {\n                start: \"\" + this.start,\n                end: \"\" + this.end,\n                endInclusive: this.endInclusive\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValue.prototype, \"analyticsFacetState\", {\n        get: function () {\n            return __assign({}, this.facet.basicAnalyticsFacetState, this.rangeFacetState, { value: this.analyticsValue, valuePosition: this.position, displayValue: this.displayValue, state: this.state });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValue.prototype, \"rangeFacetMeta\", {\n        get: function () {\n            if (!this.isRange) {\n                return null;\n            }\n            return {\n                facetRangeStart: \"\" + this.start,\n                facetRangeEnd: \"\" + this.end,\n                facetRangeEndInclusive: this.endInclusive\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValue.prototype, \"analyticsFacetMeta\", {\n        get: function () {\n            return __assign({}, this.facet.basicAnalyticsFacetMeta, this.rangeFacetMeta, { facetValue: this.analyticsValue });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacetValue.prototype.logSelectActionToAnalytics = function () {\n        var action = this.state === FacetValueState_1.FacetValueState.selected ? AnalyticsActionListMeta_1.analyticsActionCauseList.dynamicFacetSelect : AnalyticsActionListMeta_1.analyticsActionCauseList.dynamicFacetDeselect;\n        this.facet.logAnalyticsEvent(action, this.analyticsFacetMeta);\n    };\n    DynamicFacetValue.prototype.render = function () {\n        this.element = this.renderer.render();\n        return this.element;\n    };\n    Object.defineProperty(DynamicFacetValue.prototype, \"renderedElement\", {\n        get: function () {\n            if (this.element) {\n                return this.element;\n            }\n            return this.render();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return DynamicFacetValue;\n}());\nexports.DynamicFacetValue = DynamicFacetValue;\n\n\n/***/ }),\n\n/***/ 290:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Component_1 = __webpack_require__(7);\nvar InitializationEvents_1 = __webpack_require__(17);\nvar QueryEvents_1 = __webpack_require__(11);\nvar GlobalExports_1 = __webpack_require__(3);\nvar underscore_1 = __webpack_require__(0);\nvar Dom_1 = __webpack_require__(1);\nvar Utils_1 = __webpack_require__(4);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Assert_1 = __webpack_require__(5);\nvar Initialization_1 = __webpack_require__(2);\nvar ComponentsTypes_1 = __webpack_require__(45);\n/**\n * The `DynamicFacetManager` component is meant to be a parent for multiple [DynamicFacet]{@link DynamicFacet} & [DynamicFacetRange]{@link DynamicFacetRange} components.\n * This component allows controlling a set of [`DynamicFacet`]{@link DynamicFacet} and [`DynamicFacetRange`]{@link DynamicFacetRange} as a group.\n *\n * @externaldocs [Using Dynamic Facets](https://docs.coveo.com/en/2917/).\n * @availablesince [May 2019 Release (v2.6063)](https://docs.coveo.com/en/2909/)\n */\nvar DynamicFacetManager = /** @class */ (function (_super) {\n    __extends(DynamicFacetManager, _super);\n    /**\n     * Creates a new `DynamicFacetManager` instance.\n     *\n     * @param element The element from which to instantiate the component.\n     * @param options The component options.\n     * @param bindings The component bindings. Automatically resolved by default.\n     */\n    function DynamicFacetManager(element, options) {\n        var _this = _super.call(this, element, 'DynamicFacetManager') || this;\n        _this.options = options;\n        _this.childrenFacets = [];\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, DynamicFacetManager, options);\n        _this.resetContainer();\n        _this.prependContainer();\n        _this.initEvents();\n        return _this;\n    }\n    Object.defineProperty(DynamicFacetManager.prototype, \"enabledFacets\", {\n        get: function () {\n            return this.childrenFacets.filter(function (facet) { return !facet.disabled; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetManager.prototype, \"displayedFacets\", {\n        get: function () {\n            return this.childrenFacets.filter(function (facet) { return facet.isCurrentlyDisplayed(); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacetManager.prototype.resetContainer = function () {\n        this.containerElement && Dom_1.$$(this.containerElement).remove();\n        this.containerElement = Dom_1.$$('div', { className: 'coveo-dynamic-facet-manager-container' }).el;\n    };\n    DynamicFacetManager.prototype.prependContainer = function () {\n        Dom_1.$$(this.element).prepend(this.containerElement);\n    };\n    DynamicFacetManager.prototype.initEvents = function () {\n        var _this = this;\n        this.bind.onRootElement(InitializationEvents_1.InitializationEvents.afterComponentsInitialization, function () { return _this.handleAfterComponentsInitialization(); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.doneBuildingQuery, function (data) { return _this.handleDoneBuildingQuery(data); });\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.deferredQuerySuccess, function (data) { return _this.handleQuerySuccess(data); });\n    };\n    DynamicFacetManager.prototype.isDynamicFacet = function (component) {\n        return !!component.isDynamicFacet;\n    };\n    Object.defineProperty(DynamicFacetManager.prototype, \"allDynamicFacets\", {\n        get: function () {\n            var allFacetsInComponent = ComponentsTypes_1.ComponentsTypes.getAllFacetInstancesFromElement(this.element);\n            return allFacetsInComponent.filter(this.isDynamicFacet);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacetManager.prototype.handleAfterComponentsInitialization = function () {\n        var _this = this;\n        this.childrenFacets = this.allDynamicFacets;\n        this.childrenFacets.forEach(function (dynamicFacet) {\n            dynamicFacet.dynamicFacetManager = _this;\n            _this.containerElement.appendChild(dynamicFacet.element);\n        });\n        if (this.element.children.length > 1) {\n            this.logger.warn(\"DynamicFacetManager contains incompatible elements. Those elements may be moved in the DOM.\\n        To prevent this warning, move those elements outside of the DynamicFacetManager.\");\n        }\n        if (!this.childrenFacets.length) {\n            this.disable();\n        }\n    };\n    DynamicFacetManager.prototype.handleDoneBuildingQuery = function (data) {\n        Assert_1.Assert.exists(data);\n        Assert_1.Assert.exists(data.queryBuilder);\n        this.enabledFacets.forEach(function (dynamicFacet) {\n            dynamicFacet.putStateIntoQueryBuilder(data.queryBuilder);\n            dynamicFacet.putStateIntoAnalytics();\n        });\n    };\n    DynamicFacetManager.prototype.handleQuerySuccess = function (data) {\n        if (Utils_1.Utils.isNullOrUndefined(data.results.facets)) {\n            return this.notImplementedError();\n        }\n        this.enabledFacets.forEach(function (dynamicFacet) {\n            dynamicFacet.handleQueryResults(data.results);\n        });\n        var wasFacetOrderFrozen = data.query.facetOptions && data.query.facetOptions.freezeFacetOrder;\n        if (wasFacetOrderFrozen) {\n            return this.callOnUpdateOnChildrenFacets();\n        }\n        if (this.options.enableReorder) {\n            this.options.compareFacets ? this.sortFacetsWithCompareOption() : this.sortFacetsWithResponseOrder(data.results.facets);\n            this.reorderFacetsInDom();\n        }\n        this.respectMaximumExpandedFacetsThreshold();\n        this.callOnUpdateOnChildrenFacets();\n    };\n    DynamicFacetManager.prototype.callOnUpdateOnChildrenFacets = function () {\n        var _this = this;\n        if (!this.options.onUpdate) {\n            return;\n        }\n        this.childrenFacets.forEach(function (dynamicFacet, index) { return _this.options.onUpdate(dynamicFacet, index); });\n    };\n    DynamicFacetManager.prototype.sortFacetsWithResponseOrder = function (facetsResponse) {\n        var _this = this;\n        var facetsInResponse = facetsResponse.map(function (_a) {\n            var facetId = _a.facetId;\n            return _this.getChildFacetWithId(facetId);\n        }).filter(Utils_1.Utils.exists);\n        var facetsNotInResponse = underscore_1.without.apply(void 0, [this.childrenFacets].concat(facetsInResponse));\n        this.childrenFacets = facetsInResponse.concat(facetsNotInResponse);\n    };\n    DynamicFacetManager.prototype.sortFacetsWithCompareOption = function () {\n        this.childrenFacets = this.childrenFacets.sort(this.options.compareFacets);\n    };\n    DynamicFacetManager.prototype.reorderFacetsInDom = function () {\n        this.resetContainer();\n        var fragment = document.createDocumentFragment();\n        this.childrenFacets.forEach(function (dynamicFacet) { return fragment.appendChild(dynamicFacet.element); });\n        this.containerElement.appendChild(fragment);\n        this.prependContainer();\n    };\n    DynamicFacetManager.prototype.respectMaximumExpandedFacetsThreshold = function () {\n        if (this.options.maximumNumberOfExpandedFacets === -1) {\n            return;\n        }\n        var _a = underscore_1.partition(this.displayedFacets, function (facet) { return facet.options.enableCollapse; }), collapsableFacets = _a[0], uncollapsableFacets = _a[1];\n        var facetsLeftToExpandCounter = this.options.maximumNumberOfExpandedFacets - uncollapsableFacets.length;\n        collapsableFacets.forEach(function (dynamicFacet) {\n            if (facetsLeftToExpandCounter < 1) {\n                return dynamicFacet.collapse();\n            }\n            if (dynamicFacet.options.collapsedByDefault) {\n                dynamicFacet.logger.info('The facet has its \"collapsedByDefault\" option set to \"true\", which prevents the DynamicFacetManager from expanding it.', 'While this configuration may be legitimate, it partially defeats the purpose of the dynamic navigation experience feature.', 'For more information, see https://docs.coveo.com/en/2917/.');\n                return dynamicFacet.collapse();\n            }\n            facetsLeftToExpandCounter--;\n            dynamicFacet.expand();\n        });\n    };\n    DynamicFacetManager.prototype.getChildFacetWithId = function (id) {\n        return underscore_1.find(this.childrenFacets, function (facet) { return facet.options.id === id; });\n    };\n    DynamicFacetManager.prototype.notImplementedError = function () {\n        this.logger.error('DynamicFacetManager is not supported by your current search endpoint. Disabling this component.');\n        this.disable();\n    };\n    DynamicFacetManager.prototype.isCurrentlyDisplayed = function () {\n        return !!underscore_1.find(this.childrenFacets, function (facet) { return facet.isCurrentlyDisplayed(); });\n    };\n    DynamicFacetManager.ID = 'DynamicFacetManager';\n    DynamicFacetManager.doExport = function () { return GlobalExports_1.exportGlobally({ DynamicFacetManager: DynamicFacetManager }); };\n    /**\n     * The options for the DynamicFacetManager\n     * @componentOptions\n     */\n    DynamicFacetManager.options = {\n        /**\n         * Whether to allow the reordering of facets based on Coveo ML and index ranking scores.\n         *\n         * **Default:** `true`\n         */\n        enableReorder: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'Filtering' }),\n        /**\n         * A function to execute whenever facets are updated in the query response @externaldocs [Defining Custom Dynamic Facet Behaviors](https://docs.coveo.com/en/2917/javascript-search-framework/using-dynamic-facets#defining-custom-dynamic-facet-behaviors).\n         *\n         * **Note:**\n         * > You cannot set this option directly in the component markup as an HTML attribute. You must either set it in the\n         * > [`init`]{@link init} call of your search interface (see\n         * > [Passing Component Options in the init Call](https://developers.coveo.com/x/PoGfAQ#Components-PassingComponentOptionsintheinitCall)),\n         * > or before the `init` call, using the `options` top-level function (see\n         * > [Passing Component Options Before the init Call](https://developers.coveo.com/x/PoGfAQ#Components-PassingComponentOptionsBeforetheinitCall)).\n         */\n        onUpdate: ComponentOptions_1.ComponentOptions.buildCustomOption(function () {\n            return null;\n        }),\n        /**\n         * A custom sort function to execute on facets on every successful query response @externaldocs [Using Custom Dynamic Facet Sort Functions](https://docs.coveo.com/en/2917/javascript-search-framework/using-dynamic-facets#using-custom-dynamic-facet-sort-functions).\n         *\n         * **Note:**\n         * > If specified, the function must implement the JavaScript compareFunction (see [Array.prototype.sort](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort).\n         * > You cannot set this option directly in the component markup as an HTML attribute. You must either set it in the\n         * > [`init`]{@link init} call of your search interface (see\n         * > [Passing Component Options in the init Call](https://developers.coveo.com/x/PoGfAQ#Components-PassingComponentOptionsintheinitCall)),\n         * > or before the `init` call, using the `options` top-level function (see\n         * > [Passing Component Options Before the init Call](https://developers.coveo.com/x/PoGfAQ#Components-PassingComponentOptionsBeforetheinitCall)).\n         */\n        compareFacets: ComponentOptions_1.ComponentOptions.buildCustomOption(function () {\n            return null;\n        }),\n        /**\n         * The maximum number of expanded facets inside the manager.\n         * Remaining facets are collapsed.\n         *\n         * **Note:**\n         * Prioritizes facets with active values, and then prioritizes first facets.\n         * If the number of facets with active values exceeds the value of the `maximumNumberOfExpandedFacets` option, it overrides the option.\n         *\n         * Using the value `-1` disables the feature and keeps all facets expanded.\n         *\n         * @availablesince [September 2019 Release (v2.7023)](https://docs.coveo.com/en/2990/)\n         */\n        maximumNumberOfExpandedFacets: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 4, min: -1 })\n    };\n    return DynamicFacetManager;\n}(Component_1.Component));\nexports.DynamicFacetManager = DynamicFacetManager;\nInitialization_1.Initialization.registerAutoCreateComponent(DynamicFacetManager);\nDynamicFacetManager.doExport();\n\n\n/***/ }),\n\n/***/ 39:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/// <reference path='Facet.ts' />\nvar StringUtils_1 = __webpack_require__(22);\nvar QueryUtils_1 = __webpack_require__(21);\nvar FileTypes_1 = __webpack_require__(113);\nvar DateUtils_1 = __webpack_require__(32);\nvar Utils_1 = __webpack_require__(4);\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\nvar Strings_1 = __webpack_require__(6);\nvar FacetUtils = /** @class */ (function () {\n    function FacetUtils() {\n    }\n    FacetUtils.getRegexToUseForFacetSearch = function (value, ignoreAccent) {\n        return new RegExp(StringUtils_1.StringUtils.stringToRegex(value, ignoreAccent), 'i');\n    };\n    FacetUtils.getDisplayValueFromValueCaption = function (value, field, valueCaption) {\n        var returnValue = this.tryToGetTranslatedCaption(field, value);\n        return valueCaption[value] || returnValue;\n    };\n    FacetUtils.getValuesToUseForSearchInFacet = function (original, facet) {\n        var ret = [original];\n        var regex = this.getRegexToUseForFacetSearch(original, facet.options.facetSearchIgnoreAccents);\n        if (facet.options.valueCaption) {\n            _.chain(facet.options.valueCaption)\n                .pairs()\n                .filter(function (pair) {\n                return regex.test(pair[1]);\n            })\n                .each(function (match) {\n                ret.push(match[0]);\n            });\n            if (QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@objecttype') ||\n                QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@filetype')) {\n                _.each(FileTypes_1.FileTypes.getFileTypeCaptions(), function (value, key) {\n                    if (!(key in facet.options.valueCaption) && regex.test(value)) {\n                        ret.push(key);\n                    }\n                });\n            }\n        }\n        else if (QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@objecttype') ||\n            QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@filetype')) {\n            _.each(_.filter(_.pairs(FileTypes_1.FileTypes.getFileTypeCaptions()), function (pair) {\n                return regex.test(pair[1]);\n            }), function (match) {\n                ret.push(match[0]);\n            });\n        }\n        else if (QueryUtils_1.QueryUtils.isStratusAgnosticField(facet.options.field, '@month')) {\n            _.each(_.range(1, 13), function (month) {\n                if (regex.test(DateUtils_1.DateUtils.monthToString(month - 1))) {\n                    ret.push(('0' + month.toString()).substr(-2));\n                }\n            });\n        }\n        return ret;\n    };\n    FacetUtils.buildFacetSearchPattern = function (values) {\n        values = _.map(values, function (value) {\n            return Utils_1.Utils.escapeRegexCharacter(value);\n        });\n        values[0] = '.*' + values[0] + '.*';\n        return values.join('|');\n    };\n    FacetUtils.needAnotherFacetSearch = function (currentSearchLength, newSearchLength, oldSearchLength, desiredSearchLength) {\n        // Something was removed (currentSearch < newSearch)\n        // && we might want to display more facet search result(currentSearch < desiredSearch)\n        // && the new query returned more stuff than the old one so there's still more results(currentSearchLength > oldLength)\n        return currentSearchLength < newSearchLength && currentSearchLength < desiredSearchLength && currentSearchLength > oldSearchLength;\n    };\n    FacetUtils.addNoStateCssClassToFacetValues = function (facet, container) {\n        // This takes care of adding the correct css class on each facet value checkbox (empty white box) if at least one value is selected in that facet\n        if (facet.values.getSelected().length != 0) {\n            var noStates = Dom_1.$$(container).findAll('li:not(.coveo-selected)');\n            _.each(noStates, function (noState) {\n                Dom_1.$$(noState).addClass('coveo-no-state');\n            });\n        }\n    };\n    FacetUtils.tryToGetTranslatedCaption = function (field, value) {\n        var found;\n        if (QueryUtils_1.QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@filetype')) {\n            found = FileTypes_1.FileTypes.getFileType(value).caption;\n        }\n        else if (QueryUtils_1.QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@objecttype')) {\n            found = FileTypes_1.FileTypes.getObjectType(value).caption;\n        }\n        else if (FacetUtils.isMonthFieldValue(field, value)) {\n            var month = parseInt(value, 10);\n            found = DateUtils_1.DateUtils.monthToString(month - 1);\n        }\n        else {\n            found = Strings_1.l(value);\n        }\n        return found != undefined && Utils_1.Utils.isNonEmptyString(found) ? found : value;\n    };\n    FacetUtils.isMonthFieldValue = function (field, value) {\n        if (!QueryUtils_1.QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@month')) {\n            return false;\n        }\n        var asInt = parseInt(value, 10);\n        if (isNaN(asInt)) {\n            return false;\n        }\n        if (asInt < 1 || asInt > 12) {\n            return false;\n        }\n        return true;\n    };\n    return FacetUtils;\n}());\nexports.FacetUtils = FacetUtils;\n\n\n/***/ }),\n\n/***/ 462:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Template_1 = __webpack_require__(27);\nvar TemplateList_1 = __webpack_require__(90);\nvar _ = __webpack_require__(0);\nvar TableTemplate = /** @class */ (function (_super) {\n    __extends(TableTemplate, _super);\n    function TableTemplate() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.defaultTemplate = \"<td><a class=\\\"CoveoResultLink\\\"></a></td>\\n                             <td><span class=\\\"CoveoExcerpt\\\"></span></td>\\n                             <td><span class=\\\"CoveoFieldValue\\\" data-field=\\\"@date\\\" data-helper=\\\"date\\\"></span></td>\";\n        _this.defaultRoledTemplates = {\n            'table-header': \"<th style=\\\"width: 40%\\\">Link</th>\\n                     <th>Excerpt</th>\\n                     <th style=\\\"width: 20%\\\"\\n                         class=\\\"CoveoSort coveo-table-header-sort\\\"\\n                         data-sort-criteria=\\\"date ascending,date descending\\\"\\n                         data-display-unselected-icon=\\\"false\\\">Date</th>\",\n            'table-footer': \"<th>Link</th>\\n                     <th>Excerpt</th>\\n                     <th>Date</th>\"\n        };\n        return _this;\n    }\n    TableTemplate.prototype.instantiateRoleToString = function (role) {\n        var roledTemplate = _.find(this.templates, function (t) { return t.role === role; });\n        if (roledTemplate) {\n            return roledTemplate.instantiateToString(undefined, {});\n        }\n        else {\n            return this.defaultRoledTemplates[role];\n        }\n    };\n    TableTemplate.prototype.instantiateRoleToElement = function (role) {\n        var _this = this;\n        var roledTemplate = _.find(this.templates, function (t) { return t.role === role; });\n        if (roledTemplate) {\n            return roledTemplate.instantiateToElement(undefined, {});\n        }\n        else {\n            var tmpl = new Template_1.Template(function () { return _this.defaultRoledTemplates[role]; });\n            tmpl.layout = 'table';\n            return tmpl.instantiateToElement(undefined);\n        }\n    };\n    TableTemplate.prototype.getFallbackTemplate = function () {\n        var _this = this;\n        return new Template_1.Template(function () { return _this.defaultTemplate; });\n    };\n    TableTemplate.prototype.hasTemplateWithRole = function (role) {\n        return _.find(this.templates, function (t) { return t.role === role; });\n    };\n    return TableTemplate;\n}(TemplateList_1.TemplateList));\nexports.TableTemplate = TableTemplate;\n\n\n/***/ }),\n\n/***/ 463:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Template_1 = __webpack_require__(27);\nvar DefaultRecommendationTemplate = /** @class */ (function (_super) {\n    __extends(DefaultRecommendationTemplate, _super);\n    function DefaultRecommendationTemplate() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DefaultRecommendationTemplate.prototype.instantiateToString = function (object) {\n        var template = \"<div class=\\\"coveo-result-frame\\\">\\n        <div class=\\\"coveo-result-row\\\">\\n          <div class=\\\"coveo-result-cell\\\" style=\\\"width:40px;text-align:center;vertical-align:middle;\\\">\\n            <span class=\\\"CoveoIcon\\\" data-small=\\\"true\\\" data-with-label=\\\"false\\\">\\n            </span>\\n          </div>\\n          <div class=\\\"coveo-result-cell\\\" style=\\\"padding:0 0 3px 5px;vertical-align:middle\\\">\\n            <div class=\\\"coveo-result-row\\\">\\n              <div class=\\\"coveo-result-cell\\\" style=\\\"font-size:10pt;\\\">\\n                <a class=\\\"CoveoResultLink\\\" style=\\\"display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis\\\">\\n                </a>\\n              </div>\\n            </div>\\n          </div>\\n        </div>\\n      </div>\";\n        return template;\n    };\n    DefaultRecommendationTemplate.prototype.instantiateToElement = function (object) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var div = document.createElement('div');\n            div.innerHTML = _this.instantiateToString(object);\n            resolve(div);\n        });\n    };\n    return DefaultRecommendationTemplate;\n}(Template_1.Template));\nexports.DefaultRecommendationTemplate = DefaultRecommendationTemplate;\n\n\n/***/ }),\n\n/***/ 464:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Core_1 = __webpack_require__(20);\nvar ResultList_1 = __webpack_require__(87);\nvar underscore_1 = __webpack_require__(0);\nvar Dom_1 = __webpack_require__(1);\nvar Logger_1 = __webpack_require__(9);\nvar TemplateToHtml = /** @class */ (function () {\n    function TemplateToHtml(args) {\n        this.args = args;\n    }\n    TemplateToHtml.prototype.buildResults = function (results, layout, currentlyDisplayedResults) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            var res, resultsPromises;\n            return __generator(this, function (_a) {\n                res = [];\n                resultsPromises = underscore_1.map(results.results, function (result, index) {\n                    return _this.buildResult(result, layout, currentlyDisplayedResults).then(function (resultElement) {\n                        if (resultElement != null) {\n                            res.push({ elem: resultElement, idx: index });\n                        }\n                        ResultList_1.ResultList.resultCurrentlyBeingRendered = null;\n                        return resultElement;\n                    });\n                });\n                // We need to sort by the original index order, because in lazy loading mode, it's possible that results does not gets rendered\n                // in the correct order returned by the index, depending on the time it takes to load all the results component for a given result template\n                return [2 /*return*/, Promise.all(resultsPromises).then(function () {\n                        return underscore_1.pluck(underscore_1.sortBy(res, 'idx'), 'elem');\n                    })];\n            });\n        });\n    };\n    TemplateToHtml.prototype.buildResult = function (result, layout, currentlyDisplayedResults) {\n        return __awaiter(this, void 0, void 0, function () {\n            var resultElement;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        Core_1.Assert.exists(result);\n                        Core_1.QueryUtils.setStateObjectOnQueryResult(this.args.queryStateModel.get(), result);\n                        Core_1.QueryUtils.setSearchInterfaceObjectOnQueryResult(this.args.searchInterface, result);\n                        ResultList_1.ResultList.resultCurrentlyBeingRendered = result;\n                        return [4 /*yield*/, this.createHtmlElement(result, layout)];\n                    case 1:\n                        resultElement = _a.sent();\n                        if (resultElement != null) {\n                            Core_1.Component.bindResultToElement(resultElement, result);\n                        }\n                        currentlyDisplayedResults.push(result);\n                        return [4 /*yield*/, this.autoCreateComponentsInsideResult(resultElement, result).initResult];\n                    case 2:\n                        _a.sent();\n                        this.verifyChildren(resultElement);\n                        return [2 /*return*/, resultElement];\n                }\n            });\n        });\n    };\n    TemplateToHtml.prototype.autoCreateComponentsInsideResult = function (element, result) {\n        Core_1.Assert.exists(element);\n        return Core_1.Initialization.automaticallyCreateComponentsInsideResult(element, result);\n    };\n    TemplateToHtml.prototype.createHtmlElement = function (result, layout) {\n        return this.args.resultTemplate.instantiateToElement(result, {\n            wrapInDiv: true,\n            checkCondition: true,\n            currentLayout: layout,\n            responsiveComponents: this.args.searchInterface.responsiveComponents\n        });\n    };\n    TemplateToHtml.prototype.verifyChildren = function (element) {\n        var containsResultLink = !!Dom_1.$$(element).find('.CoveoResultLink');\n        if (containsResultLink) {\n            return;\n        }\n        var msg = \"Result does not contain a \\\"CoveoResultLink\\\" component, please verify the result template\";\n        new Logger_1.Logger(element).warn(msg, this.args.resultTemplate);\n    };\n    return TemplateToHtml;\n}());\nexports.TemplateToHtml = TemplateToHtml;\n\n\n/***/ }),\n\n/***/ 465:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Defer_1 = __webpack_require__(31);\nvar underscore_1 = __webpack_require__(0);\nvar Dom_1 = __webpack_require__(1);\nvar FocusTrap = /** @class */ (function () {\n    function FocusTrap(container) {\n        this.container = container;\n        this.hiddenElements = [];\n        this.enable();\n    }\n    Object.defineProperty(FocusTrap.prototype, \"focusableElements\", {\n        get: function () {\n            return underscore_1.sortBy(this.container.querySelectorAll('[tabindex]'), function (element) { return element.tabIndex; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FocusTrap.prototype.disable = function () {\n        document.removeEventListener('focusin', this.focusInEvent);\n        document.removeEventListener('focusout', this.focusOutEvent);\n        this.showHiddenElements();\n        this.enabled = false;\n    };\n    FocusTrap.prototype.enable = function () {\n        var _this = this;\n        document.addEventListener('focusin', (this.focusInEvent = function (e) { return _this.onFocusIn(e); }));\n        document.addEventListener('focusout', (this.focusOutEvent = function (e) { return _this.onFocusOut(e); }));\n        this.hideAllExcept(this.container);\n        this.enabled = true;\n    };\n    FocusTrap.prototype.showHiddenElements = function () {\n        while (this.hiddenElements.length) {\n            this.hiddenElements.pop().removeAttribute('aria-hidden');\n        }\n    };\n    FocusTrap.prototype.hideElement = function (element) {\n        if (element.getAttribute('aria-hidden')) {\n            return;\n        }\n        this.hiddenElements.push(element);\n        element.setAttribute('aria-hidden', \"\" + true);\n    };\n    FocusTrap.prototype.hideSiblings = function (allowedElement) {\n        var _this = this;\n        var parent = allowedElement.parentElement;\n        if (parent) {\n            underscore_1.without(Dom_1.$$(parent).children(), allowedElement).forEach(function (elementToHide) {\n                _this.hideElement(elementToHide);\n            });\n        }\n    };\n    FocusTrap.prototype.hideAllExcept = function (allowedElement) {\n        this.hideSiblings(allowedElement);\n        var parent = allowedElement.parentElement;\n        if (parent && parent !== document.body) {\n            this.hideAllExcept(parent);\n        }\n    };\n    FocusTrap.prototype.getFocusableSibling = function (element, previous) {\n        if (previous === void 0) { previous = false; }\n        var elements = this.focusableElements;\n        var currentIndex = elements.indexOf(element);\n        if (currentIndex === -1) {\n            return null;\n        }\n        return elements[(currentIndex + (previous ? -1 : 1) + elements.length) % elements.length];\n    };\n    FocusTrap.prototype.focusSibling = function (element, previous) {\n        if (previous === void 0) { previous = false; }\n        var sibling = this.getFocusableSibling(element, previous);\n        if (sibling) {\n            sibling.focus();\n        }\n    };\n    FocusTrap.prototype.focusFirstElement = function () {\n        var elements = this.focusableElements;\n        if (elements.length) {\n            elements[0].focus();\n        }\n    };\n    FocusTrap.prototype.elementIsBefore = function (oldElement, newElement) {\n        if (!newElement) {\n            return false;\n        }\n        return oldElement.compareDocumentPosition(newElement) === Node.DOCUMENT_POSITION_PRECEDING;\n    };\n    FocusTrap.prototype.onLosingFocus = function (oldElement, newElement) {\n        var _this = this;\n        Defer_1.Defer.defer(function () {\n            if (!_this.enabled) {\n                return;\n            }\n            _this.enabled = false;\n            if (oldElement && _this.focusIsAllowed(oldElement)) {\n                _this.focusSibling(oldElement, _this.elementIsBefore(oldElement, newElement));\n            }\n            else {\n                _this.focusFirstElement();\n            }\n            _this.enabled = true;\n        });\n    };\n    FocusTrap.prototype.focusIsAllowed = function (element) {\n        return this.container.contains(element);\n    };\n    FocusTrap.prototype.elementIsInPage = function (element) {\n        return element && element !== document.body.parentElement;\n    };\n    FocusTrap.prototype.onFocusIn = function (e) {\n        if (!this.enabled) {\n            return;\n        }\n        var oldElement = e.relatedTarget;\n        var handledByFocusOut = this.elementIsInPage(oldElement);\n        if (handledByFocusOut) {\n            return;\n        }\n        var newElement = e.target;\n        if (!this.elementIsInPage(newElement)) {\n            return;\n        }\n        if (!this.focusIsAllowed(newElement)) {\n            this.onLosingFocus(null, newElement);\n        }\n    };\n    FocusTrap.prototype.onFocusOut = function (e) {\n        if (!this.enabled) {\n            return;\n        }\n        var newElement = e.relatedTarget;\n        if (!this.elementIsInPage(newElement)) {\n            return;\n        }\n        if (!newElement || !this.focusIsAllowed(newElement)) {\n            this.onLosingFocus(e.target, newElement);\n        }\n    };\n    return FocusTrap;\n}());\nexports.FocusTrap = FocusTrap;\n\n\n/***/ }),\n\n/***/ 466:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TemplateHelpers_1 = __webpack_require__(115);\nvar HighlightUtils_1 = __webpack_require__(68);\nvar DateUtils_1 = __webpack_require__(32);\nvar CurrencyUtils_1 = __webpack_require__(130);\nvar HtmlUtils_1 = __webpack_require__(179);\nvar Utils_1 = __webpack_require__(4);\nvar StringUtils_1 = __webpack_require__(22);\nvar TimeSpanUtils_1 = __webpack_require__(70);\nvar EmailUtils_1 = __webpack_require__(178);\nvar QueryUtils_1 = __webpack_require__(21);\nvar DeviceUtils_1 = __webpack_require__(24);\nvar Dom_1 = __webpack_require__(1);\nvar SearchEndpoint_1 = __webpack_require__(50);\nvar StreamHighlightUtils_1 = __webpack_require__(114);\nvar FacetUtils_1 = __webpack_require__(39);\nvar Globalize = __webpack_require__(23);\nvar _ = __webpack_require__(0);\nvar Component_1 = __webpack_require__(7);\nvar TemplateCache_1 = __webpack_require__(66);\nvar CoreHelpers = /** @class */ (function () {\n    function CoreHelpers() {\n    }\n    /**\n     * For backward compatibility reason, the \"global\" template helper should be available under the\n     * coveo namespace.\n     * @param scope\n     */\n    CoreHelpers.exportAllHelpersGlobally = function (scope) {\n        _.each(TemplateHelpers_1.TemplateHelpers.getHelpers(), function (helper, name) {\n            if (scope[name] == undefined) {\n                scope[name] = helper;\n            }\n        });\n    };\n    return CoreHelpers;\n}());\nexports.CoreHelpers = CoreHelpers;\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('javascriptEncode', function (value) {\n    return Utils_1.Utils.exists(value) ? StringUtils_1.StringUtils.javascriptEncode(value) : undefined;\n});\nvar executeShorten = function (content, options) {\n    var strAndHoles = HighlightUtils_1.StringAndHoles.shortenString(content, options.length, '...');\n    if (Utils_1.Utils.exists(options.highlights)) {\n        return HighlightUtils_1.HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n    }\n    else {\n        return strAndHoles.value;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shorten', function (content, length, highlights, cssClass) {\n    return executeShorten(content, {\n        length: length,\n        highlights: highlights,\n        cssClass: cssClass\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shortenv2', function (content, options) {\n    return executeShorten(content, options);\n});\nvar executeShortenPath = function (content, options) {\n    var strAndHoles = HighlightUtils_1.StringAndHoles.shortenPath(content, options.length);\n    if (Utils_1.Utils.exists(options.highlights)) {\n        return HighlightUtils_1.HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n    }\n    else {\n        return strAndHoles.value;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shortenPath', function (content, length, highlights, cssClass) {\n    return executeShortenPath(content, {\n        length: length,\n        highlights: highlights,\n        cssClass: cssClass\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('shortenPathv2', function (content, options) {\n    return executeShortenPath(content, options);\n});\nvar executeShortenUri = function (content, options) {\n    var strAndHoles = HighlightUtils_1.StringAndHoles.shortenUri(content, options.length);\n    if (Utils_1.Utils.exists(options.highlights)) {\n        return HighlightUtils_1.HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n    }\n    else {\n        return strAndHoles.value;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shortenUri', function (content, length, highlights, cssClass) {\n    return executeShortenUri(content, {\n        length: length,\n        highlights: highlights,\n        cssClass: cssClass\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('shortenUriv2', function (content, options) {\n    return executeShortenUri(content, options);\n});\nvar executeHighlight = function (content, options) {\n    if (Utils_1.Utils.exists(content)) {\n        if (Utils_1.Utils.exists(options.highlights)) {\n            return HighlightUtils_1.HighlightUtils.highlightString(content, options.highlights, null, options.cssClass || 'highlight');\n        }\n        else {\n            return content;\n        }\n    }\n    else {\n        return undefined;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlight', function (content, highlights, cssClass) {\n    return executeHighlight(content, {\n        highlights: highlights,\n        cssClass: cssClass\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightv2', function (content, options) {\n    return executeHighlight(content, options);\n});\nvar executeHighlightStreamText = function (content, options) {\n    if (Utils_1.Utils.exists(content) && Utils_1.Utils.exists(options.termsToHighlight) && Utils_1.Utils.exists(options.phrasesToHighlight)) {\n        if (termsToHighlightAreDefined(options.termsToHighlight, options.phrasesToHighlight)) {\n            return StreamHighlightUtils_1.StreamHighlightUtils.highlightStreamText(content, options.termsToHighlight, options.phrasesToHighlight, options.opts);\n        }\n        else {\n            return content;\n        }\n    }\n    else {\n        return undefined;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightStreamText', function (content, termsToHighlight, phrasesToHighlight, opts) {\n    if (termsToHighlight === void 0) { termsToHighlight = resolveTermsToHighlight(); }\n    if (phrasesToHighlight === void 0) { phrasesToHighlight = resolvePhrasesToHighlight(); }\n    return executeHighlightStreamText(content, {\n        termsToHighlight: termsToHighlight,\n        phrasesToHighlight: phrasesToHighlight,\n        opts: opts\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightStreamTextv2', function (content, options) {\n    var mergedOptions = __assign({ termsToHighlight: resolveTermsToHighlight(), phrasesToHighlight: resolvePhrasesToHighlight() }, options);\n    return executeHighlightStreamText(content, mergedOptions);\n});\nvar executeHighlightStreamHTML = function (content, options) {\n    if (Utils_1.Utils.exists(content) && Utils_1.Utils.exists(options.termsToHighlight) && Utils_1.Utils.exists(options.phrasesToHighlight)) {\n        if (termsToHighlightAreDefined(options.termsToHighlight, options.phrasesToHighlight)) {\n            return StreamHighlightUtils_1.StreamHighlightUtils.highlightStreamHTML(content, options.termsToHighlight, options.phrasesToHighlight, options.opts);\n        }\n        else {\n            return content;\n        }\n    }\n    else {\n        return undefined;\n    }\n};\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightStreamHTML', function (content, termsToHighlight, phrasesToHighlight, opts) {\n    if (termsToHighlight === void 0) { termsToHighlight = resolveTermsToHighlight(); }\n    if (phrasesToHighlight === void 0) { phrasesToHighlight = resolvePhrasesToHighlight(); }\n    return executeHighlightStreamHTML(content, {\n        termsToHighlight: termsToHighlight,\n        phrasesToHighlight: phrasesToHighlight,\n        opts: opts\n    });\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('highlightStreamHTMLv2', function (content, options) {\n    var mergedOptions = __assign({ termsToHighlight: resolveTermsToHighlight(), phrasesToHighlight: resolvePhrasesToHighlight() }, options);\n    return executeHighlightStreamHTML(content, mergedOptions);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('number', function (value, options) {\n    if (!Utils_1.Utils.exists(value)) {\n        return undefined;\n    }\n    var numberValue = Number(value);\n    var format = _.isString(options) ? options : options && options.format;\n    if (!format) {\n        return StringUtils_1.StringUtils.htmlEncode(numberValue.toString());\n    }\n    return StringUtils_1.StringUtils.htmlEncode(Globalize.format(numberValue, format));\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('date', function (value, options) {\n    return DateUtils_1.DateUtils.dateToString(DateUtils_1.DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('time', function (value, options) {\n    return DateUtils_1.DateUtils.timeToString(DateUtils_1.DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('dateTime', function (value, options) {\n    return DateUtils_1.DateUtils.dateTimeToString(DateUtils_1.DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('emailDateTime', function (value, options) {\n    var defaultOptions = {};\n    defaultOptions.includeTimeIfThisWeek = true;\n    var optionsToUse = _.extend(options, defaultOptions);\n    return value ? DateUtils_1.DateUtils.dateTimeToString(DateUtils_1.DateUtils.convertFromJsonDateIfNeeded(value), optionsToUse) : undefined;\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('currency', function (value, options) {\n    return CurrencyUtils_1.CurrencyUtils.currencyToString(value, options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('timeSpan', function (value, options) {\n    if (options === void 0) { options = { isMilliseconds: false }; }\n    return new TimeSpanUtils_1.TimeSpan(value, options.isMilliseconds).getHHMMSS();\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('email', function (value) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    // support old arguments (value: any, companyDomain: string, me: string, lengthLimit = 2, truncateName = false)\n    var companyDomain;\n    var me;\n    var lengthLimit;\n    var truncateName;\n    if (_.isObject(args[0])) {\n        companyDomain = args[0]['companyDomain'];\n        me = args[0]['me'];\n        lengthLimit = args[0]['lengthLimit'];\n        truncateName = args[0]['truncateName'];\n    }\n    else {\n        companyDomain = args[0];\n        me = args[1];\n        lengthLimit = args[2];\n        truncateName = args[3];\n    }\n    if (lengthLimit == undefined) {\n        lengthLimit = 2;\n    }\n    if (truncateName == undefined) {\n        truncateName = false;\n    }\n    if (_.isString(value)) {\n        var listOfAddresses = EmailUtils_1.EmailUtils.splitSemicolonSeparatedListOfEmailAddresses(value);\n        return EmailUtils_1.EmailUtils.emailAddressesToHyperlinks(listOfAddresses, companyDomain, me, lengthLimit, truncateName);\n    }\n    else if (_.isArray(value)) {\n        return EmailUtils_1.EmailUtils.emailAddressesToHyperlinks(value, companyDomain, me, lengthLimit, truncateName);\n    }\n    else {\n        return undefined;\n    }\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('excessEmailToggle', function (target) {\n    Dom_1.$$(target).removeClass('coveo-active');\n    if (Dom_1.$$(target).hasClass('coveo-emails-excess-collapsed')) {\n        _.each(Dom_1.$$(target).siblings('.coveo-emails-excess-expanded'), function (sibling) {\n            Dom_1.$$(sibling).addClass('coveo-active');\n        });\n    }\n    else if (Dom_1.$$(target).hasClass('coveo-hide-expanded')) {\n        Dom_1.$$(target.parentElement).addClass('coveo-inactive');\n        _.each(Dom_1.$$(target.parentElement).siblings('.coveo-emails-excess-collapsed'), function (sibling) {\n            Dom_1.$$(sibling).addClass('coveo-active');\n        });\n    }\n    return undefined;\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('anchor', function (href, options) {\n    return HtmlUtils_1.AnchorUtils.buildAnchor(href, options);\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('image', function (src, options, result) {\n    if (result === void 0) { result = resolveQueryResult(); }\n    if (options && options.srcTemplate) {\n        return HtmlUtils_1.ImageUtils.buildImage(StringUtils_1.StringUtils.buildStringTemplateFromResult(options.srcTemplate, result), {\n            alt: options.alt,\n            height: options.height,\n            width: options.width\n        });\n    }\n    return HtmlUtils_1.ImageUtils.buildImage(src, options);\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('thumbnail', function (result, endpoint, options) {\n    if (result === void 0) { result = resolveQueryResult(); }\n    if (endpoint === void 0) { endpoint = 'default'; }\n    if (QueryUtils_1.QueryUtils.hasThumbnail(result)) {\n        return HtmlUtils_1.ImageUtils.buildImageFromResult(result, SearchEndpoint_1.SearchEndpoint.endpoints[endpoint], options);\n    }\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('fromFileTypeToIcon', function (result, options) {\n    if (result === void 0) { result = resolveQueryResult(); }\n    if (options === void 0) { options = {}; }\n    var icon = Component_1.Component.getComponentRef('Icon');\n    if (icon) {\n        return icon.createIcon(result, options).outerHTML;\n    }\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('attrEncode', function (value) {\n    return ('' + value) /* Forces the conversion to string. */\n        .replace(/&/g, '&amp;') /* This MUST be the 1st replacement. */\n        .replace(/'/g, '&apos;') /* The 4 other predefined entities, required. */\n        .replace(/'/g, '&quot;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('loadTemplates', function (templatesToLoad, once) {\n    if (once === void 0) { once = true; }\n    var ret = '';\n    var data = resolveQueryResult();\n    var atLeastOneWasLoaded = false;\n    var toLoad = templatesToLoad;\n    var defaultTmpl;\n    _.each(templatesToLoad, function (value, key, obj) {\n        if (value == 'default') {\n            defaultTmpl = key;\n        }\n    });\n    if (defaultTmpl != undefined) {\n        toLoad = _.omit(templatesToLoad, defaultTmpl);\n    }\n    _.each(toLoad, function (condition, id, obj) {\n        if (!atLeastOneWasLoaded || !once) {\n            atLeastOneWasLoaded = atLeastOneWasLoaded || condition;\n            ret += TemplateHelpers_1.TemplateHelpers.getHelper('loadTemplate')(id, condition, data);\n        }\n    });\n    if (!atLeastOneWasLoaded && defaultTmpl != undefined) {\n        ret += TemplateHelpers_1.TemplateHelpers.getHelper('loadTemplate')(defaultTmpl, true, data);\n    }\n    return ret;\n});\nvar byteMeasure = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB'];\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('size', function (value, options) {\n    var size = parseInt(value, 10);\n    var precision = options != null && options.precision != null ? options.precision : 2;\n    var base = options != null && options.base != null ? options.base : 0;\n    while (size > 1024 && base + 1 < byteMeasure.length) {\n        size /= 1024;\n        base++;\n    }\n    size = Math.floor(size * Math.pow(10, precision)) / Math.pow(10, precision);\n    return size + ' ' + byteMeasure[base];\n});\nTemplateHelpers_1.TemplateHelpers.registerFieldHelper('translatedCaption', function (value) {\n    return FacetUtils_1.FacetUtils.tryToGetTranslatedCaption('@filetype', value);\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('loadTemplate', function (id, condition, data) {\n    if (condition === void 0) { condition = true; }\n    if (Utils_1.Utils.isNullOrUndefined(data)) {\n        data = resolveQueryResult();\n    }\n    if (condition) {\n        return TemplateCache_1.TemplateCache.getTemplate(id).instantiateToString(data, {\n            checkCondition: false\n        });\n    }\n    return '';\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('encodeCarriageReturn', function (data) {\n    if (Utils_1.Utils.isNullOrUndefined(data)) {\n        return undefined;\n    }\n    else {\n        return StringUtils_1.StringUtils.encodeCarriageReturn(data);\n    }\n});\nTemplateHelpers_1.TemplateHelpers.registerTemplateHelper('isMobileDevice', function () {\n    return DeviceUtils_1.DeviceUtils.isMobileDevice() ? DeviceUtils_1.DeviceUtils.getDeviceName() : null;\n});\nfunction resolveQueryResult() {\n    var found;\n    var resultList = Component_1.Component.getComponentRef('ResultList');\n    if (resultList) {\n        found = resultList.resultCurrentlyBeingRendered;\n    }\n    if (!found) {\n        var quickview = Component_1.Component.getComponentRef('Quickview');\n        if (quickview) {\n            found = quickview.resultCurrentlyBeingRendered;\n        }\n    }\n    return found;\n}\nfunction resolveTermsToHighlight() {\n    var currentQueryResult = resolveQueryResult();\n    if (currentQueryResult) {\n        return currentQueryResult.termsToHighlight;\n    }\n}\nfunction resolvePhrasesToHighlight() {\n    var currentQueryResult = resolveQueryResult();\n    if (currentQueryResult) {\n        return currentQueryResult.phrasesToHighlight;\n    }\n}\nfunction termsToHighlightAreDefined(termsToHighlight, phrasesToHighlight) {\n    return Utils_1.Utils.isNonEmptyArray(_.keys(termsToHighlight)) || Utils_1.Utils.isNonEmptyArray(_.keys(phrasesToHighlight));\n}\n\n\n/***/ }),\n\n/***/ 497:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar SVGDom_1 = __webpack_require__(16);\nvar DynamicFacetHeaderButton = /** @class */ (function () {\n    function DynamicFacetHeaderButton(rootOptions) {\n        this.rootOptions = rootOptions;\n        this.create();\n    }\n    DynamicFacetHeaderButton.prototype.create = function () {\n        var hasIcon = this.rootOptions.iconSVG && this.rootOptions.iconClassName;\n        this.button = Dom_1.$$('button', {\n            className: (\"coveo-dynamic-facet-header-btn \" + (this.rootOptions.className || '')).trim(),\n            type: 'button'\n        }, hasIcon ? this.rootOptions.iconSVG : this.rootOptions.label);\n        this.rootOptions.action && this.button.on('click', this.rootOptions.action);\n        if (hasIcon) {\n            this.button.setAttribute('aria-label', this.rootOptions.label);\n            this.button.setAttribute('title', this.rootOptions.label);\n            SVGDom_1.SVGDom.addClassToSVGInContainer(this.button.el, this.rootOptions.iconClassName);\n        }\n        if (this.rootOptions.ariaLabel) {\n            this.button.setAttribute('aria-label', this.rootOptions.ariaLabel);\n        }\n        if (this.rootOptions.shouldDisplay !== undefined) {\n            this.toggle(this.rootOptions.shouldDisplay);\n        }\n        this.element = this.button.el;\n    };\n    DynamicFacetHeaderButton.prototype.toggle = function (shouldDisplay) {\n        this.button.toggle(shouldDisplay);\n    };\n    return DynamicFacetHeaderButton;\n}());\nexports.DynamicFacetHeaderButton = DynamicFacetHeaderButton;\n\n\n/***/ }),\n\n/***/ 504:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Utils_1 = __webpack_require__(4);\nvar DynamicFacetRequestBuilder = /** @class */ (function () {\n    function DynamicFacetRequestBuilder(request) {\n        this.request = request;\n    }\n    DynamicFacetRequestBuilder.prototype.buildBaseRequestForQuery = function (query) {\n        return __assign({}, this.request, { filterFacetCount: this.getFilterFacetCount(!!query.filterField) });\n    };\n    DynamicFacetRequestBuilder.prototype.getFilterFacetCount = function (isFoldingEnabled) {\n        if (Utils_1.Utils.isUndefined(this.request.filterFacetCount)) {\n            return !isFoldingEnabled;\n        }\n        return this.request.filterFacetCount;\n    };\n    return DynamicFacetRequestBuilder;\n}());\nexports.DynamicFacetRequestBuilder = DynamicFacetRequestBuilder;\n\n\n/***/ }),\n\n/***/ 505:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 506:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(562);\nvar Dom_1 = __webpack_require__(1);\nvar Strings_1 = __webpack_require__(6);\nvar SVGIcons_1 = __webpack_require__(12);\nvar SVGDom_1 = __webpack_require__(16);\nvar DynamicFacetHeaderButton_1 = __webpack_require__(497);\nvar DynamicFacetHeaderCollapseToggle_1 = __webpack_require__(563);\nvar DynamicFacetHeader = /** @class */ (function () {\n    function DynamicFacetHeader(options) {\n        this.options = options;\n        this.element = Dom_1.$$('div', { className: 'coveo-dynamic-facet-header' }).el;\n        this.title = this.createTitle();\n        Dom_1.$$(this.element).append(this.title.el);\n        Dom_1.$$(this.element).append(this.createWaitAnimation());\n        Dom_1.$$(this.element).append(this.createClearButton());\n        this.options.enableCollapse && this.enableCollapse();\n    }\n    DynamicFacetHeader.prototype.createClearButton = function () {\n        var _this = this;\n        this.clearButton = new DynamicFacetHeaderButton_1.DynamicFacetHeaderButton({\n            label: Strings_1.l('Clear'),\n            ariaLabel: Strings_1.l('Clear', this.options.title),\n            className: 'coveo-dynamic-facet-header-clear',\n            shouldDisplay: false,\n            action: function () { return _this.options.clear(); }\n        });\n        return this.clearButton.element;\n    };\n    DynamicFacetHeader.prototype.createCollapseToggle = function () {\n        this.collapseToggle = new DynamicFacetHeaderCollapseToggle_1.DynamicFacetHeaderCollapseToggle(this.options);\n        return this.collapseToggle.element;\n    };\n    DynamicFacetHeader.prototype.enableCollapse = function () {\n        var _this = this;\n        Dom_1.$$(this.element).append(this.createCollapseToggle());\n        Dom_1.$$(this.title).addClass('coveo-clickable');\n        Dom_1.$$(this.title).on('click', function () { return _this.options.toggleCollapse(); });\n    };\n    DynamicFacetHeader.prototype.toggleCollapse = function (isCollapsed) {\n        this.options.enableCollapse && this.collapseToggle.toggleButtons(isCollapsed);\n    };\n    DynamicFacetHeader.prototype.createTitle = function () {\n        return Dom_1.$$('h2', {\n            className: 'coveo-dynamic-facet-header-title',\n            ariaLabel: \"\" + Strings_1.l('FacetTitle', this.options.title)\n        }, Dom_1.$$('span', { ariaHidden: true, title: this.options.title }, this.options.title));\n    };\n    DynamicFacetHeader.prototype.createWaitAnimation = function () {\n        this.waitAnimation = Dom_1.$$('div', { className: 'coveo-dynamic-facet-header-wait-animation' }, SVGIcons_1.SVGIcons.icons.loading);\n        SVGDom_1.SVGDom.addClassToSVGInContainer(this.waitAnimation.el, 'coveo-dynamic-facet-header-wait-animation-svg');\n        this.waitAnimation.toggle(false);\n        return this.waitAnimation.el;\n    };\n    DynamicFacetHeader.prototype.toggleClear = function (visible) {\n        this.clearButton.toggle(visible);\n    };\n    DynamicFacetHeader.prototype.showLoading = function () {\n        var _this = this;\n        clearTimeout(this.showLoadingTimeout);\n        this.showLoadingTimeout = window.setTimeout(function () { return _this.waitAnimation.toggle(true); }, DynamicFacetHeader.showLoadingDelay);\n    };\n    DynamicFacetHeader.prototype.hideLoading = function () {\n        clearTimeout(this.showLoadingTimeout);\n        this.waitAnimation.toggle(false);\n    };\n    DynamicFacetHeader.showLoadingDelay = 2000;\n    return DynamicFacetHeader;\n}());\nexports.DynamicFacetHeader = DynamicFacetHeader;\n\n\n/***/ }),\n\n/***/ 507:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The allowed sort criteria for a Search API\n * [facet request]{@link IFacetRequest}.\n */\nvar FacetSortCriteria;\n(function (FacetSortCriteria) {\n    /**\n     * Sort facet values in descending score order.\n     *\n     * Facet value scores are based on number of occurrences and position in the\n     * ranked query result set.\n     *\n     * The Coveo Machine Learning dynamic navigation experience feature only\n     * works with this sort criterion.\n     */\n    FacetSortCriteria[\"score\"] = \"score\";\n    /**\n     * Sort facet values in ascending alphanumeric order.\n     */\n    FacetSortCriteria[\"alphanumeric\"] = \"alphanumeric\";\n    /**\n     * Sort facet values in descending number of occurrences.\n     */\n    FacetSortCriteria[\"occurrences\"] = \"occurrences\";\n})(FacetSortCriteria = exports.FacetSortCriteria || (exports.FacetSortCriteria = {}));\nfunction isFacetSortCriteria(sortCriteria) {\n    return !!FacetSortCriteria[sortCriteria];\n}\nexports.isFacetSortCriteria = isFacetSortCriteria;\n\n\n/***/ }),\n\n/***/ 508:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar ComboboxInput_1 = __webpack_require__(564);\nvar underscore_1 = __webpack_require__(0);\nvar SVGIcons_1 = __webpack_require__(12);\nvar SVGDom_1 = __webpack_require__(16);\nvar ComboboxValues_1 = __webpack_require__(565);\n__webpack_require__(566);\nvar Utils_1 = __webpack_require__(4);\nvar Strings_1 = __webpack_require__(6);\nvar Combobox = /** @class */ (function () {\n    function Combobox(options) {\n        this.options = options;\n        this.defaultOptions = {\n            wrapperClassName: '',\n            clearOnBlur: false\n        };\n        this.throttlingDelay = 600;\n        this.isRequestCancelled = false;\n        this.throttledRequest = underscore_1.throttle(this.triggerRequest, this.throttlingDelay, {\n            leading: true,\n            trailing: true\n        });\n        this.options = __assign({}, this.defaultOptions, this.options);\n        this.id = underscore_1.uniqueId('coveo-combobox-');\n        this.create();\n    }\n    Combobox.prototype.create = function () {\n        this.element = Dom_1.$$('div', { className: \"coveo-combobox-wrapper \" + this.options.wrapperClassName }).el;\n        this.createAndAppendInput();\n        this.createAndAppendWaitAnimation();\n        this.createAndAppendValues();\n    };\n    Combobox.prototype.createAndAppendInput = function () {\n        this.input = new ComboboxInput_1.ComboboxInput(this);\n        this.element.appendChild(this.input.element);\n    };\n    Combobox.prototype.createAndAppendWaitAnimation = function () {\n        this.waitAnimationElement = Dom_1.$$('div', { className: 'coveo-combobox-wait-animation' }, SVGIcons_1.SVGIcons.icons.loading).el;\n        SVGDom_1.SVGDom.addClassToSVGInContainer(this.waitAnimationElement, 'coveo-combobox-wait-animation-svg');\n        this.toggleWaitAnimation(false);\n        this.input.element.appendChild(this.waitAnimationElement);\n    };\n    Combobox.prototype.toggleWaitAnimation = function (show) {\n        Dom_1.$$(this.waitAnimationElement).toggle(show);\n    };\n    Combobox.prototype.createAndAppendValues = function () {\n        this.values = new ComboboxValues_1.ComboboxValues(this);\n        this.element.appendChild(this.values.element);\n    };\n    Combobox.prototype.clearAll = function () {\n        this.clearValues();\n        this.input.clearInput();\n    };\n    Combobox.prototype.clearValues = function () {\n        this.values.clearValues();\n        this.cancelRequest();\n    };\n    Combobox.prototype.cancelRequest = function () {\n        this.toggleWaitAnimation(false);\n        this.throttledRequest.cancel();\n        this.isRequestCancelled = true;\n    };\n    Combobox.prototype.onInputChange = function (value) {\n        var _this = this;\n        if (Utils_1.Utils.isEmptyString(value)) {\n            return this.clearValues();\n        }\n        this.throttledRequest(function () { return _this.options.requestValues(value); }, function () { return _this.values.resetScroll(); });\n    };\n    Combobox.prototype.onInputBlur = function () {\n        if (this.values.mouseIsOverValue) {\n            return;\n        }\n        if (this.values.isRenderingNewValues) {\n            return;\n        }\n        if (this.options.clearOnBlur) {\n            return this.clearAll();\n        }\n        this.clearValues();\n    };\n    Combobox.prototype.updateAccessibilityAttributes = function (attributes) {\n        this.input.updateAccessibilityAttributes(attributes);\n    };\n    Combobox.prototype.updateAriaLive = function () {\n        if (!this.values.hasValues()) {\n            this.options.ariaLive.updateText(Strings_1.l('NoValuesFound'));\n            return;\n        }\n        var text = Strings_1.l('ShowingResultsWithQuery', this.values.numberOfValues, this.input.value, this.values.numberOfValues);\n        if (this.options.scrollable && this.options.scrollable.areMoreValuesAvailable()) {\n            text = text + \" (\" + Strings_1.l('MoreValuesAvailable') + \")\";\n        }\n        this.options.ariaLive.updateText(text);\n    };\n    Combobox.prototype.onScrollEndReached = function () {\n        var _this = this;\n        this.values.saveFocusedValue();\n        this.options.scrollable &&\n            this.throttledRequest(function () { return _this.options.scrollable.requestMoreValues(); }, function () { return _this.values.restoreFocusedValue(); });\n    };\n    Combobox.prototype.triggerRequest = function (request, callback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var response;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.isRequestCancelled = false;\n                        this.toggleWaitAnimation(true);\n                        return [4 /*yield*/, request()];\n                    case 1:\n                        response = _a.sent();\n                        this.toggleWaitAnimation(false);\n                        if (!this.isRequestCancelled) {\n                            this.values.renderFromResponse(response);\n                            callback && callback();\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return Combobox;\n}());\nexports.Combobox = Combobox;\n\n\n/***/ }),\n\n/***/ 509:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 510:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Checkbox_1 = __webpack_require__(64);\nvar Dom_1 = __webpack_require__(1);\nvar DynamicFacetValueCheckbox = /** @class */ (function () {\n    function DynamicFacetValueCheckbox(facetValue, selectAction) {\n        if (selectAction === void 0) { selectAction = function () { }; }\n        this.facetValue = facetValue;\n        this.checkbox = new Checkbox_1.Checkbox(selectAction.bind(this), this.facetValue.displayValue, this.facetValue.selectAriaLabel, \"(\" + this.facetValue.formattedCount + \")\");\n        var label = Dom_1.$$(this.checkbox.getElement()).find('.coveo-checkbox-span-label');\n        var labelSuffix = Dom_1.$$(this.checkbox.getElement()).find('.coveo-checkbox-span-label-suffix');\n        if (label && labelSuffix) {\n            label.setAttribute('title', this.facetValue.displayValue);\n            label.setAttribute('aria-hidden', 'true');\n            labelSuffix.setAttribute('aria-hidden', 'true');\n        }\n        this.facetValue.isSelected && this.checkbox.select(false);\n        this.element = this.checkbox.getElement();\n    }\n    return DynamicFacetValueCheckbox;\n}());\nexports.DynamicFacetValueCheckbox = DynamicFacetValueCheckbox;\n\n\n/***/ }),\n\n/***/ 511:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(577);\nvar Dom_1 = __webpack_require__(1);\nvar underscore_1 = __webpack_require__(0);\nvar FacetValueState_1 = __webpack_require__(69);\nvar Strings_1 = __webpack_require__(6);\nvar DynamicFacetValueMoreLessButton_1 = __webpack_require__(222);\nvar DynamicFacetValues = /** @class */ (function () {\n    function DynamicFacetValues(facet, creatorKlass) {\n        this.facet = facet;\n        this.list = Dom_1.$$('ul', { className: 'coveo-dynamic-facet-values' }).el;\n        this.valueCreator = new creatorKlass(this.facet);\n        this.resetValues();\n    }\n    DynamicFacetValues.prototype.createFromResponse = function (response) {\n        var _this = this;\n        this.facetValues = response.values.map(function (facetValue, index) { return _this.valueCreator.createFromResponse(facetValue, index); });\n    };\n    DynamicFacetValues.prototype.resetValues = function () {\n        this.facetValues = this.valueCreator.getDefaultValues();\n    };\n    Object.defineProperty(DynamicFacetValues.prototype, \"allFacetValues\", {\n        get: function () {\n            return this.facetValues;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"allValues\", {\n        get: function () {\n            return this.facetValues.map(function (facetValue) { return facetValue.value; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"selectedValues\", {\n        get: function () {\n            return this.facetValues.filter(function (value) { return value.isSelected; }).map(function (_a) {\n                var value = _a.value;\n                return value;\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"selectedDisplayValues\", {\n        get: function () {\n            return this.facetValues.filter(function (value) { return value.isSelected; }).map(function (_a) {\n                var displayValue = _a.displayValue;\n                return displayValue;\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"activeValues\", {\n        get: function () {\n            return this.facetValues.filter(function (value) { return !value.isIdle; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"displayedValues\", {\n        get: function () {\n            return this.facetValues.filter(function (value) { return !value.isIdle || value.numberOfResults > 0; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"hasSelectedValues\", {\n        get: function () {\n            return !!underscore_1.findWhere(this.facetValues, { state: FacetValueState_1.FacetValueState.selected });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"hasActiveValues\", {\n        get: function () {\n            return !!this.activeValues.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"hasIdleValues\", {\n        get: function () {\n            return !!underscore_1.findWhere(this.facetValues, { state: FacetValueState_1.FacetValueState.idle });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacetValues.prototype.clearAll = function () {\n        this.facetValues.forEach(function (value) { return value.deselect(); });\n    };\n    Object.defineProperty(DynamicFacetValues.prototype, \"hasValues\", {\n        get: function () {\n            return !!this.allFacetValues.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetValues.prototype, \"hasDisplayedValues\", {\n        get: function () {\n            return !!this.displayedValues.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacetValues.prototype.hasSelectedValue = function (arg) {\n        var value = typeof arg === 'string' ? arg : arg.value;\n        var foundValue = underscore_1.find(this.facetValues, function (facetValue) { return facetValue.equals(value); });\n        return foundValue && foundValue.isSelected;\n    };\n    DynamicFacetValues.prototype.get = function (arg) {\n        var value = typeof arg === 'string' ? arg : arg.value;\n        var facetValue = underscore_1.find(this.facetValues, function (facetValue) { return facetValue.equals(value); });\n        if (facetValue) {\n            return facetValue;\n        }\n        var newFacetValue = this.valueCreator.createFromValue(value);\n        if (!newFacetValue) {\n            return null;\n        }\n        this.facetValues.push(newFacetValue);\n        return newFacetValue;\n    };\n    DynamicFacetValues.prototype.buildShowLess = function () {\n        var _this = this;\n        var showLess = new DynamicFacetValueMoreLessButton_1.DynamicFacetValueShowMoreLessButton({\n            className: 'coveo-dynamic-facet-show-less',\n            ariaLabel: Strings_1.l('ShowLessFacetResults', this.facet.options.title),\n            label: Strings_1.l('ShowLess'),\n            action: function () {\n                _this.facet.enableFreezeFacetOrderFlag();\n                _this.facet.showLessValues();\n            }\n        });\n        return showLess.element;\n    };\n    DynamicFacetValues.prototype.buildShowMore = function () {\n        var _this = this;\n        var showMore = new DynamicFacetValueMoreLessButton_1.DynamicFacetValueShowMoreLessButton({\n            className: 'coveo-dynamic-facet-show-more',\n            ariaLabel: Strings_1.l('ShowMoreFacetResults', this.facet.options.title),\n            label: Strings_1.l('ShowMore'),\n            action: function () {\n                _this.facet.enableFreezeFacetOrderFlag();\n                _this.facet.showMoreValues();\n            }\n        });\n        return showMore.element;\n    };\n    Object.defineProperty(DynamicFacetValues.prototype, \"shouldEnableShowLess\", {\n        get: function () {\n            var hasMoreValuesThenDefault = this.facetValues.length > this.facet.options.numberOfValues;\n            return hasMoreValuesThenDefault && this.hasIdleValues;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DynamicFacetValues.prototype.appendShowMoreLess = function (fragment) {\n        if (!this.facet.options.enableMoreLess) {\n            return;\n        }\n        if (this.shouldEnableShowLess) {\n            fragment.appendChild(this.buildShowLess());\n        }\n        if (this.facet.moreValuesAvailable) {\n            fragment.appendChild(this.buildShowMore());\n        }\n    };\n    DynamicFacetValues.prototype.appendSelectedCollapsedValues = function (fragment) {\n        if (!this.hasSelectedValues) {\n            return;\n        }\n        var selectedValues = this.selectedDisplayValues.join(', ');\n        fragment.appendChild(Dom_1.$$('li', {\n            className: 'coveo-dynamic-facet-collapsed-values',\n            ariaLabel: Strings_1.l('CurrentSelections') + \": \" + selectedValues\n        }, underscore_1.escape(selectedValues)).el);\n    };\n    DynamicFacetValues.prototype.render = function () {\n        var fragment = document.createDocumentFragment();\n        Dom_1.$$(this.list).empty();\n        this.displayedValues.forEach(function (facetValue) {\n            fragment.appendChild(facetValue.renderedElement);\n        });\n        this.appendShowMoreLess(fragment);\n        this.appendSelectedCollapsedValues(fragment);\n        this.list.appendChild(fragment);\n        return this.list;\n    };\n    return DynamicFacetValues;\n}());\nexports.DynamicFacetValues = DynamicFacetValues;\n\n\n/***/ }),\n\n/***/ 512:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Assert_1 = __webpack_require__(5);\nvar QueryEvents_1 = __webpack_require__(11);\nvar underscore_1 = __webpack_require__(0);\nvar DynamicFacetRequestBuilder_1 = __webpack_require__(504);\nvar DynamicFacetQueryController = /** @class */ (function () {\n    function DynamicFacetQueryController(facet) {\n        this.facet = facet;\n        this.freezeCurrentValues = false;\n        this.freezeFacetOrder = false;\n        this.preventAutoSelection = false;\n        this.requestBuilder = new DynamicFacetRequestBuilder_1.DynamicFacetRequestBuilder({\n            facetId: this.facet.options.id,\n            field: this.facet.fieldName,\n            type: this.facet.facetType,\n            sortCriteria: this.facet.options.sortCriteria,\n            injectionDepth: this.facet.options.injectionDepth,\n            filterFacetCount: this.facet.options.filterFacetCount\n        });\n        this.resetNumberOfValuesToRequest();\n        this.resetFlagsDuringQuery();\n    }\n    DynamicFacetQueryController.prototype.resetFlagsDuringQuery = function () {\n        var _this = this;\n        this.facet.bind.onRootElement(QueryEvents_1.QueryEvents.duringQuery, function () {\n            _this.freezeCurrentValues = false;\n            _this.freezeFacetOrder = false;\n            _this.preventAutoSelection = false;\n        });\n    };\n    DynamicFacetQueryController.prototype.increaseNumberOfValuesToRequest = function (additionalNumberOfValues) {\n        this.numberOfValuesToRequest += additionalNumberOfValues;\n    };\n    DynamicFacetQueryController.prototype.resetNumberOfValuesToRequest = function () {\n        this.numberOfValuesToRequest = this.facet.options.numberOfValues;\n    };\n    DynamicFacetQueryController.prototype.enablePreventAutoSelectionFlag = function () {\n        this.preventAutoSelection = true;\n    };\n    DynamicFacetQueryController.prototype.enableFreezeCurrentValuesFlag = function () {\n        if (this.areValuesIncorrectlyAffectedByDependsOn) {\n            return;\n        }\n        this.freezeCurrentValues = true;\n    };\n    DynamicFacetQueryController.prototype.enableFreezeFacetOrderFlag = function () {\n        this.freezeFacetOrder = true;\n    };\n    Object.defineProperty(DynamicFacetQueryController.prototype, \"areValuesIncorrectlyAffectedByDependsOn\", {\n        get: function () {\n            if (!this.facet.dependsOnManager.hasDependentFacets) {\n                return false;\n            }\n            if (this.facet.dependsOnManager.dependentFacetsHaveSelectedValues) {\n                return false;\n            }\n            return this.currentValues.length < this.numberOfValuesToRequest;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Build the facets request for the DynamicFacet, and insert it in the query builder\n     * @param queryBuilder\n     */\n    DynamicFacetQueryController.prototype.putFacetIntoQueryBuilder = function (queryBuilder) {\n        Assert_1.Assert.exists(queryBuilder);\n        queryBuilder.facetRequests.push(this.buildFacetRequest(queryBuilder.build()));\n        if (this.freezeFacetOrder) {\n            queryBuilder.facetOptions.freezeFacetOrder = true;\n        }\n    };\n    DynamicFacetQueryController.prototype.buildFacetRequest = function (query) {\n        return __assign({}, this.requestBuilder.buildBaseRequestForQuery(query), { currentValues: this.currentValues, numberOfValues: this.numberOfValues, freezeCurrentValues: this.freezeCurrentValues, preventAutoSelect: this.preventAutoSelection, isFieldExpanded: this.numberOfValuesToRequest > this.facet.options.numberOfValues });\n    };\n    DynamicFacetQueryController.prototype.getQueryResults = function () {\n        var query = this.facet.queryController.getLastQuery();\n        // Specifying a numberOfResults of 0 will not log the query as a full fledged query in the API\n        // it will also alleviate the load on the index\n        query.numberOfResults = 0;\n        var previousFacetRequestIndex = underscore_1.findIndex(query.facets, { facetId: this.facet.options.id });\n        if (previousFacetRequestIndex !== -1) {\n            query.facets[previousFacetRequestIndex] = this.buildFacetRequest(query);\n        }\n        else if (query.facets) {\n            query.facets.push(this.buildFacetRequest(query));\n        }\n        else {\n            query.facets = [this.buildFacetRequest(query)];\n        }\n        return this.facet.queryController.getEndpoint().search(query);\n    };\n    Object.defineProperty(DynamicFacetQueryController.prototype, \"currentValues\", {\n        get: function () {\n            return this.facet.values.allFacetValues.map(function (_a) {\n                var value = _a.value, state = _a.state;\n                return ({\n                    value: value,\n                    state: state\n                });\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DynamicFacetQueryController.prototype, \"numberOfValues\", {\n        get: function () {\n            if (this.freezeCurrentValues) {\n                return this.currentValues.length;\n            }\n            return Math.max(this.numberOfValuesToRequest, this.facet.values.activeValues.length);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return DynamicFacetQueryController;\n}());\nexports.DynamicFacetQueryController = DynamicFacetQueryController;\n\n\n/***/ }),\n\n/***/ 513:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar DynamicFacetValueCheckbox_1 = __webpack_require__(510);\nvar DynamicFacetValueRenderer = /** @class */ (function () {\n    function DynamicFacetValueRenderer(facetValue, facet) {\n        this.facetValue = facetValue;\n        this.facet = facet;\n    }\n    DynamicFacetValueRenderer.prototype.render = function () {\n        this.dom = Dom_1.$$('li', {\n            className: 'coveo-dynamic-facet-value',\n            dataValue: this.facetValue.value\n        });\n        this.toggleSelectedClass();\n        this.renderCheckbox();\n        this.addFocusAndBlurEventListeners();\n        return this.dom.el;\n    };\n    DynamicFacetValueRenderer.prototype.toggleSelectedClass = function () {\n        this.dom.toggleClass('coveo-selected', this.facetValue.isSelected);\n    };\n    DynamicFacetValueRenderer.prototype.renderCheckbox = function () {\n        this.valueCheckbox = new DynamicFacetValueCheckbox_1.DynamicFacetValueCheckbox(this.facetValue, this.selectAction.bind(this));\n        this.dom.append(this.valueCheckbox.element);\n    };\n    DynamicFacetValueRenderer.prototype.addFocusAndBlurEventListeners = function () {\n        var _this = this;\n        var checkboxButton = Dom_1.$$(this.valueCheckbox.element).find('button');\n        Dom_1.$$(checkboxButton).on('focusin', function () { return _this.onFocusIn(); });\n        Dom_1.$$(checkboxButton).on('focusout', function () { return _this.onFocusOut(); });\n    };\n    DynamicFacetValueRenderer.prototype.onFocusIn = function () {\n        this.dom.addClass('coveo-focused');\n    };\n    DynamicFacetValueRenderer.prototype.onFocusOut = function () {\n        this.dom.removeClass('coveo-focused');\n    };\n    DynamicFacetValueRenderer.prototype.selectAction = function () {\n        var _this = this;\n        this.facet.toggleSelectValue(this.facetValue.value);\n        this.toggleSelectedClass();\n        this.facet.enableFreezeCurrentValuesFlag();\n        this.facet.enableFreezeFacetOrderFlag();\n        this.facet.enablePreventAutoSelectionFlag();\n        this.facet.scrollToTop();\n        this.facet.triggerNewQuery(function () { return _this.facetValue.logSelectActionToAnalytics(); });\n    };\n    return DynamicFacetValueRenderer;\n}());\nexports.DynamicFacetValueRenderer = DynamicFacetValueRenderer;\n\n\n/***/ }),\n\n/***/ 522:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 523:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 524:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 525:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResponsiveComponentsManager_1 = __webpack_require__(60);\nvar SearchInterface_1 = __webpack_require__(19);\nvar ResultList_1 = __webpack_require__(87);\nvar Dom_1 = __webpack_require__(1);\nvar Component_1 = __webpack_require__(7);\nvar Logger_1 = __webpack_require__(9);\nvar ResponsiveDefaultResultTemplate = /** @class */ (function () {\n    function ResponsiveDefaultResultTemplate(coveoRoot, ID, options, responsiveDropdown) {\n        this.coveoRoot = coveoRoot;\n        this.ID = ID;\n        this.searchInterface = Component_1.Component.get(this.coveoRoot.el, SearchInterface_1.SearchInterface, false);\n        this.currentMode = 'large';\n    }\n    ResponsiveDefaultResultTemplate.init = function (root, component, options) {\n        if (!Dom_1.$$(root).find(\".\" + Component_1.Component.computeCssClassName(ResultList_1.ResultList))) {\n            var logger = new Logger_1.Logger('ResponsiveDefaultResultTemplate');\n            logger.trace('No ResultLayout component found : Cannot instantiate ResponsiveResultLayout');\n            return;\n        }\n        ResponsiveComponentsManager_1.ResponsiveComponentsManager.register(ResponsiveDefaultResultTemplate, Dom_1.$$(root), ResultList_1.ResultList.ID, component, options);\n    };\n    ResponsiveDefaultResultTemplate.prototype.registerComponent = function (accept) {\n        if (accept instanceof ResultList_1.ResultList) {\n            this.resultList = accept;\n            return true;\n        }\n        return false;\n    };\n    ResponsiveDefaultResultTemplate.prototype.handleResizeEvent = function () {\n        var _this = this;\n        var lastResults = this.resultList.queryController.getLastResults();\n        if (this.needSmallMode()) {\n            Dom_1.$$(this.resultList.options.resultsContainer).addClass('coveo-card-layout-container');\n            Dom_1.$$(this.resultList.options.resultsContainer).removeClass(\"coveo-list-layout-container\");\n            if (this.currentMode != 'small') {\n                if (lastResults) {\n                    this.resultList.buildResults(lastResults).then(function (elements) {\n                        _this.resultList.renderResults(elements);\n                    });\n                }\n                this.currentMode = 'small';\n            }\n        }\n        else {\n            Dom_1.$$(this.resultList.options.resultsContainer).removeClass('coveo-card-layout-container');\n            Dom_1.$$(this.resultList.options.resultsContainer).addClass(\"coveo-list-layout-container\");\n            if (this.currentMode != 'large') {\n                if (lastResults) {\n                    this.resultList.buildResults(lastResults).then(function (elements) {\n                        _this.resultList.renderResults(elements);\n                    });\n                }\n                this.currentMode = 'large';\n            }\n        }\n    };\n    ResponsiveDefaultResultTemplate.prototype.needSmallMode = function () {\n        return this.coveoRoot.width() <= this.searchInterface.responsiveComponents.getSmallScreenWidth();\n    };\n    return ResponsiveDefaultResultTemplate;\n}());\nexports.ResponsiveDefaultResultTemplate = ResponsiveDefaultResultTemplate;\n\n\n/***/ }),\n\n/***/ 526:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar ResultContainer = /** @class */ (function () {\n    function ResultContainer(resultContainer, searchInterface) {\n        this.searchInterface = searchInterface;\n        this.resultContainerElement = Dom_1.$$(resultContainer);\n    }\n    ResultContainer.prototype.empty = function () {\n        this.searchInterface.detachComponentsInside(this.resultContainerElement.el);\n        Dom_1.$$(this.resultContainerElement).empty();\n    };\n    ResultContainer.prototype.addClass = function (classToAdd) {\n        this.resultContainerElement.addClass(classToAdd);\n    };\n    ResultContainer.prototype.isEmpty = function () {\n        return this.resultContainerElement.isEmpty();\n    };\n    ResultContainer.prototype.hideChildren = function () {\n        this.resultContainerElement.children().forEach(function (child) { return Dom_1.$$(child).hide(); });\n    };\n    ResultContainer.prototype.getResultElements = function () {\n        return this.resultContainerElement.findAll('.CoveoResult');\n    };\n    Object.defineProperty(ResultContainer.prototype, \"el\", {\n        get: function () {\n            return this.resultContainerElement.el;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResultContainer.resultCurrentlyBeingRendered = null;\n    return ResultContainer;\n}());\nexports.ResultContainer = ResultContainer;\n\n\n/***/ }),\n\n/***/ 527:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResultListRenderer_1 = __webpack_require__(211);\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\nvar ResultListCardRenderer = /** @class */ (function (_super) {\n    __extends(ResultListCardRenderer, _super);\n    function ResultListCardRenderer() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ResultListCardRenderer.prototype.getEndFragment = function (resultElements) {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (!_.isEmpty(resultElements)) {\n                // with infinite scrolling, we want the additional results to append at the end of the previous query.\n                // For this, we need to remove the padding.\n                if (_this.resultListOptions.enableInfiniteScroll) {\n                    var needToBeRemoved = Dom_1.$$(_this.resultListOptions.resultsContainer).findAll('.coveo-card-layout-padding');\n                    _.each(needToBeRemoved, function (toRemove) { return Dom_1.$$(toRemove).remove(); });\n                }\n                // Used to prevent last card from spanning the grid's whole width\n                var emptyCards_1 = document.createDocumentFragment();\n                _.times(3, function () { return emptyCards_1.appendChild(Dom_1.$$('div', { className: 'coveo-card-layout coveo-card-layout-padding' }).el); });\n                resolve(emptyCards_1);\n            }\n            resolve(null);\n        });\n    };\n    return ResultListCardRenderer;\n}(ResultListRenderer_1.ResultListRenderer));\nexports.ResultListCardRenderer = ResultListCardRenderer;\n\n\n/***/ }),\n\n/***/ 528:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResultListRenderer_1 = __webpack_require__(211);\nvar TableTemplate_1 = __webpack_require__(462);\nvar Dom_1 = __webpack_require__(1);\nvar _ = __webpack_require__(0);\nvar ResultListTableRenderer = /** @class */ (function (_super) {\n    __extends(ResultListTableRenderer, _super);\n    function ResultListTableRenderer(resultListOptions, autoCreateComponentsFn) {\n        var _this = _super.call(this, resultListOptions, autoCreateComponentsFn) || this;\n        _this.resultListOptions = resultListOptions;\n        _this.autoCreateComponentsFn = autoCreateComponentsFn;\n        _this.shouldDisplayHeader = true;\n        _this.shouldDisplayFooter = false;\n        if (_this.resultListOptions.resultTemplate instanceof TableTemplate_1.TableTemplate) {\n            if (_this.resultListOptions.resultTemplate.hasTemplateWithRole('table-footer')) {\n                _this.shouldDisplayFooter = true;\n            }\n            // If custom templates are defined but no header template, do not display it.\n            if (_this.resultListOptions.resultTemplate.templates.length !== 0 &&\n                !_this.resultListOptions.resultTemplate.hasTemplateWithRole('table-header')) {\n                _this.shouldDisplayHeader = false;\n            }\n        }\n        return _this;\n    }\n    ResultListTableRenderer.prototype.getStartFragment = function (resultElements, append) {\n        if (!append && !_.isEmpty(resultElements) && this.shouldDisplayHeader) {\n            return this.renderRoledTemplate('table-header');\n        }\n    };\n    ResultListTableRenderer.prototype.getEndFragment = function (resultElements, append) {\n        if (!append && !_.isEmpty(resultElements) && this.shouldDisplayFooter) {\n            return this.renderRoledTemplate('table-footer');\n        }\n    };\n    ResultListTableRenderer.prototype.renderRoledTemplate = function (role) {\n        return __awaiter(this, void 0, void 0, function () {\n            var elem, frag;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.resultListOptions.resultTemplate.instantiateRoleToElement(role)];\n                    case 1:\n                        elem = _a.sent();\n                        Dom_1.$$(elem).addClass(\"coveo-result-list-\" + role);\n                        this.autoCreateComponentsFn(elem, undefined);\n                        frag = document.createDocumentFragment();\n                        frag.appendChild(elem);\n                        return [2 /*return*/, frag];\n                }\n            });\n        });\n    };\n    return ResultListTableRenderer;\n}(ResultListRenderer_1.ResultListRenderer));\nexports.ResultListTableRenderer = ResultListTableRenderer;\n\n\n/***/ }),\n\n/***/ 529:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 530:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResponsiveDropdownContent_1 = __webpack_require__(88);\nvar Core_1 = __webpack_require__(20);\nvar SVGIcons_1 = __webpack_require__(12);\nvar FocusTrap_1 = __webpack_require__(465);\nvar ResponsiveDropdownModalContent = /** @class */ (function () {\n    function ResponsiveDropdownModalContent(componentName, element, closeButtonLabel, close) {\n        this.componentName = componentName;\n        this.element = element;\n        this.closeButtonLabel = closeButtonLabel;\n        this.close = close;\n        this.className = \"coveo-\" + this.componentName + \"-dropdown-modal-content\";\n    }\n    Object.defineProperty(ResponsiveDropdownModalContent.prototype, \"hidden\", {\n        set: function (shouldHide) {\n            this.element.toggleClass('coveo-hidden', shouldHide);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResponsiveDropdownModalContent.prototype.positionDropdown = function () {\n        this.element.el.classList.add(this.className, ResponsiveDropdownContent_1.ResponsiveDropdownContent.DEFAULT_CSS_CLASS_NAME);\n        this.element.setAttribute('role', 'group');\n        this.element.setAttribute('aria-label', Core_1.l('FiltersDropdown'));\n        this.hidden = false;\n        this.ensureCloseButton();\n        this.ensureFocusTrap();\n    };\n    ResponsiveDropdownModalContent.prototype.hideDropdown = function () {\n        this.element.el.classList.remove(this.className, ResponsiveDropdownContent_1.ResponsiveDropdownContent.DEFAULT_CSS_CLASS_NAME);\n        this.element.setAttribute('role', null);\n        this.element.setAttribute('aria-label', null);\n        this.hidden = true;\n        this.removeCloseButton();\n        this.removeFocusTrap();\n    };\n    ResponsiveDropdownModalContent.prototype.cleanUp = function () {\n        this.hidden = false;\n    };\n    ResponsiveDropdownModalContent.prototype.ensureCloseButton = function () {\n        var _this = this;\n        if (!this.closeButton) {\n            this.closeButton = Core_1.$$('button', {\n                className: 'coveo-facet-modal-close-button',\n                ariaLabel: this.closeButtonLabel\n            }, SVGIcons_1.SVGIcons.icons.mainClear);\n            this.closeButton.on('click', function () { return _this.close(); });\n            this.element.prepend(this.closeButton.el);\n        }\n    };\n    ResponsiveDropdownModalContent.prototype.ensureFocusTrap = function () {\n        if (!this.focusTrap) {\n            this.focusTrap = new FocusTrap_1.FocusTrap(this.element.el);\n        }\n    };\n    ResponsiveDropdownModalContent.prototype.removeCloseButton = function () {\n        if (this.closeButton) {\n            this.closeButton.remove();\n            this.closeButton = null;\n        }\n    };\n    ResponsiveDropdownModalContent.prototype.removeFocusTrap = function () {\n        if (this.focusTrap) {\n            this.focusTrap.disable();\n            this.focusTrap = null;\n        }\n    };\n    return ResponsiveDropdownModalContent;\n}());\nexports.ResponsiveDropdownModalContent = ResponsiveDropdownModalContent;\n\n\n/***/ }),\n\n/***/ 531:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The names of the events that can be triggered by the [FacetsMobileMode]{@link FacetsMobileMode} component.\n */\nvar FacetsMobileModeEvents = /** @class */ (function () {\n    function FacetsMobileModeEvents() {\n    }\n    /**\n     * The name of the event that gets triggered when the facets pop-up (or modal) is opened in mobile mode.\n     */\n    FacetsMobileModeEvents.popupOpened = 'popupOpened';\n    /**\n     * The name of the event that gets triggered when the facets pop-up (or modal) is closed in mobile mode.\n     */\n    FacetsMobileModeEvents.popupClosed = 'popupClosed';\n    return FacetsMobileModeEvents;\n}());\nexports.FacetsMobileModeEvents = FacetsMobileModeEvents;\n\n\n/***/ }),\n\n/***/ 562:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 563:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Strings_1 = __webpack_require__(6);\nvar SVGIcons_1 = __webpack_require__(12);\nvar Dom_1 = __webpack_require__(1);\nvar DynamicFacetHeaderButton_1 = __webpack_require__(497);\nvar DynamicFacetHeaderCollapseToggle = /** @class */ (function () {\n    function DynamicFacetHeaderCollapseToggle(options) {\n        this.options = options;\n        this.create();\n    }\n    DynamicFacetHeaderCollapseToggle.prototype.create = function () {\n        var _this = this;\n        var parent = Dom_1.$$('div');\n        this.collapseButton = new DynamicFacetHeaderButton_1.DynamicFacetHeaderButton({\n            label: Strings_1.l('CollapseFacet', this.options.title),\n            iconSVG: SVGIcons_1.SVGIcons.icons.arrowUp,\n            iconClassName: 'coveo-dynamic-facet-collapse-toggle-svg',\n            className: 'coveo-dynamic-facet-header-collapse',\n            shouldDisplay: true,\n            action: function () {\n                _this.options.collapse();\n                _this.expandButton.element.focus();\n            }\n        });\n        this.expandButton = new DynamicFacetHeaderButton_1.DynamicFacetHeaderButton({\n            label: Strings_1.l('ExpandFacet', this.options.title),\n            iconSVG: SVGIcons_1.SVGIcons.icons.arrowDown,\n            iconClassName: 'coveo-dynamic-facet-collapse-toggle-svg',\n            className: 'coveo-dynamic-facet-header-expand',\n            shouldDisplay: false,\n            action: function () {\n                _this.options.expand();\n                _this.collapseButton.element.focus();\n            }\n        });\n        parent.append(this.collapseButton.element);\n        parent.append(this.expandButton.element);\n        this.element = parent.el;\n    };\n    DynamicFacetHeaderCollapseToggle.prototype.toggleButtons = function (isCollapsed) {\n        this.collapseButton.toggle(!isCollapsed);\n        this.expandButton.toggle(isCollapsed);\n    };\n    return DynamicFacetHeaderCollapseToggle;\n}());\nexports.DynamicFacetHeaderCollapseToggle = DynamicFacetHeaderCollapseToggle;\n\n\n/***/ }),\n\n/***/ 564:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TextInput_1 = __webpack_require__(54);\nvar Dom_1 = __webpack_require__(1);\nvar KeyboardUtils_1 = __webpack_require__(25);\nvar Utils_1 = __webpack_require__(4);\nvar ComboboxInput = /** @class */ (function () {\n    function ComboboxInput(combobox) {\n        this.combobox = combobox;\n        this.inputOptions = {\n            usePlaceholder: true,\n            className: 'coveo-combobox-input',\n            triggerOnChangeAsYouType: true,\n            isRequired: false,\n            icon: 'search'\n        };\n        this.create();\n        this.element = this.textInput.getElement();\n        this.inputElement = Dom_1.$$(this.element).find('input');\n        this.addEventListeners();\n        this.addAccessibilityAttributes();\n    }\n    Object.defineProperty(ComboboxInput.prototype, \"value\", {\n        get: function () {\n            return this.inputElement.value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ComboboxInput.prototype.create = function () {\n        var _this = this;\n        this.textInput = new TextInput_1.TextInput(function (inputInstance) { return _this.combobox.onInputChange(inputInstance.getValue()); }, this.combobox.options.placeholderText, this.inputOptions);\n    };\n    ComboboxInput.prototype.addEventListeners = function () {\n        var _this = this;\n        if (!this.combobox.options.clearOnBlur) {\n            this.inputElement.addEventListener('focus', function () { return _this.combobox.onInputChange(_this.textInput.getValue()); });\n        }\n        this.combobox.element.addEventListener('focusout', function (e) { return _this.handleFocusOut(e); });\n        this.combobox.element.addEventListener('keydown', function (e) { return _this.handleKeyboardDirection(e); });\n        this.combobox.element.addEventListener('keyup', function (e) { return _this.handleKeyboardEnterEscape(e); });\n    };\n    ComboboxInput.prototype.addAccessibilityAttributes = function () {\n        var listboxId = this.combobox.id + \"-listbox\";\n        this.inputElement.setAttribute('role', 'combobox');\n        this.inputElement.setAttribute('aria-owns', listboxId);\n        this.inputElement.setAttribute('aria-haspopup', 'listbox');\n        this.inputElement.setAttribute('aria-autocomplete', 'list');\n        this.inputElement.setAttribute('id', this.combobox.id + \"-input\");\n        this.inputElement.setAttribute('aria-label', this.combobox.options.label);\n        this.updateAccessibilityAttributes({\n            activeDescendant: '',\n            expanded: false\n        });\n    };\n    ComboboxInput.prototype.updateAccessibilityAttributes = function (attributes) {\n        this.inputElement.setAttribute('aria-expanded', attributes.expanded ? 'true' : 'false');\n        Utils_1.Utils.isEmptyString(attributes.activeDescendant)\n            ? this.inputElement.removeAttribute('aria-activedescendant')\n            : this.inputElement.setAttribute('aria-activedescendant', attributes.activeDescendant);\n    };\n    ComboboxInput.prototype.clearInput = function () {\n        this.textInput.reset();\n    };\n    ComboboxInput.prototype.handleFocusOut = function (event) {\n        var newTarget = event.relatedTarget;\n        var focusInsideCombobox = this.combobox.element.contains(newTarget);\n        if (focusInsideCombobox) {\n            return;\n        }\n        var comboboxValuesHovered = Dom_1.$$(this.combobox.element).find('.coveo-combobox-values:hover');\n        if (comboboxValuesHovered) {\n            this.inputElement.focus();\n            return;\n        }\n        this.combobox.onInputBlur();\n    };\n    ComboboxInput.prototype.handleKeyboardDirection = function (event) {\n        switch (event.which) {\n            case KeyboardUtils_1.KEYBOARD.DOWN_ARROW:\n                event.preventDefault();\n                this.combobox.values.focusNextValue();\n                break;\n            case KeyboardUtils_1.KEYBOARD.UP_ARROW:\n                event.preventDefault();\n                this.combobox.values.focusPreviousValue();\n                break;\n            case KeyboardUtils_1.KEYBOARD.HOME:\n                event.preventDefault();\n                this.combobox.values.focusFirstValue();\n                break;\n            case KeyboardUtils_1.KEYBOARD.END:\n                event.preventDefault();\n                this.combobox.values.focusLastValue();\n                break;\n        }\n    };\n    ComboboxInput.prototype.handleKeyboardEnterEscape = function (event) {\n        switch (event.which) {\n            case KeyboardUtils_1.KEYBOARD.ENTER:\n                this.combobox.values.selectActiveValue();\n                break;\n            case KeyboardUtils_1.KEYBOARD.ESCAPE:\n                if (Utils_1.Utils.isNonEmptyString(this.textInput.getValue())) {\n                    event.stopPropagation();\n                }\n                this.combobox.clearAll();\n                break;\n        }\n    };\n    return ComboboxInput;\n}());\nexports.ComboboxInput = ComboboxInput;\n\n\n/***/ }),\n\n/***/ 565:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar underscore_1 = __webpack_require__(0);\nvar Strings_1 = __webpack_require__(6);\nvar underscore_2 = __webpack_require__(0);\nvar ComboboxValues = /** @class */ (function () {\n    function ComboboxValues(combobox) {\n        var _this = this;\n        this.combobox = combobox;\n        this.mouseIsOverValue = false;\n        this.isRenderingNewValues = false;\n        this.values = [];\n        this.element = Dom_1.$$('ul', {\n            id: this.combobox.id + \"-listbox\",\n            role: 'listbox',\n            className: 'coveo-combobox-values',\n            ariaLabelledby: this.combobox.id + \"-input\"\n        }).el;\n        Dom_1.$$(this.element).hide();\n        this.isScrollable = !!this.combobox.options.scrollable;\n        this.isScrollable && this.element.addEventListener('scroll', function () { return _this.onScroll(); });\n    }\n    ComboboxValues.prototype.renderFromResponse = function (response) {\n        this.isRenderingNewValues = true;\n        this.clearValues();\n        this.values = this.combobox.options.createValuesFromResponse(response);\n        this.render();\n        this.combobox.updateAriaLive();\n        this.isRenderingNewValues = false;\n    };\n    ComboboxValues.prototype.render = function () {\n        Dom_1.$$(this.element).show();\n        if (!this.hasValues()) {\n            return this.renderNoValuesFound();\n        }\n        this.renderValues();\n        this.addEventListeners();\n        this.updateAccessibilityAttributes();\n    };\n    ComboboxValues.prototype.renderValues = function () {\n        var _this = this;\n        var fragment = document.createDocumentFragment();\n        this.values.forEach(function (value, index) {\n            var elementWrapper = Dom_1.$$('li', { id: _this.combobox.id + \"-value-\" + index, className: 'coveo-combobox-value', role: 'option', tabindex: 0 }, value.element).el;\n            _this.highlightCurrentQueryInSearchResults(value.element);\n            value.element = elementWrapper;\n            fragment.appendChild(value.element);\n        });\n        this.element.appendChild(fragment);\n    };\n    ComboboxValues.prototype.highlightCurrentQueryInSearchResults = function (searchResult) {\n        if (this.combobox.options.highlightValueClassName) {\n            var regex = new RegExp('(' + this.combobox.element.querySelector('input').value + ')', 'ig');\n            var result = Dom_1.$$(searchResult).hasClass(this.combobox.options.highlightValueClassName)\n                ? searchResult\n                : Dom_1.$$(searchResult).find(\".\" + this.combobox.options.highlightValueClassName);\n            if (result) {\n                var text = underscore_2.escape(Dom_1.$$(result).text());\n                result.innerHTML = text.replace(regex, '<span class=\"coveo-highlight\">$1</span>');\n            }\n        }\n    };\n    ComboboxValues.prototype.hasValues = function () {\n        return !!this.numberOfValues;\n    };\n    Object.defineProperty(ComboboxValues.prototype, \"numberOfValues\", {\n        get: function () {\n            return this.values.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ComboboxValues.prototype.renderNoValuesFound = function () {\n        var noValuesFoundElement = Dom_1.$$('li', {\n            role: 'option',\n            className: 'coveo-combobox-value-not-found'\n        }, Strings_1.l('NoValuesFound')).el;\n        this.element.appendChild(noValuesFoundElement);\n    };\n    ComboboxValues.prototype.addEventListeners = function () {\n        var _this = this;\n        this.values.forEach(function (value) {\n            Dom_1.$$(value.element).on('mouseenter', function () { return (_this.mouseIsOverValue = true); });\n            Dom_1.$$(value.element).on('mouseleave', function () { return (_this.mouseIsOverValue = false); });\n            Dom_1.$$(value.element).on('click', function (e) { return _this.onValueClick(e); });\n            Dom_1.$$(value.element).on('focus', function () { return _this.setKeyboardActiveValue(value); });\n        });\n    };\n    ComboboxValues.prototype.onValueClick = function (e) {\n        var target = e.target;\n        var targetElement = Dom_1.$$(target).hasClass('coveo-combobox-value') ? target : Dom_1.$$(target).parent('coveo-combobox-value');\n        if (!targetElement) {\n            return;\n        }\n        var targetId = targetElement.getAttribute('id');\n        var value = underscore_1.find(this.values, function (_a) {\n            var element = _a.element;\n            return element.getAttribute('id') === targetId;\n        });\n        value && this.combobox.options.onSelectValue(value);\n        this.combobox.clearAll();\n    };\n    ComboboxValues.prototype.updateAccessibilityAttributes = function () {\n        var activeDescendant = this.keyboardActiveValue ? this.keyboardActiveValue.element.getAttribute('id') : '';\n        this.combobox.updateAccessibilityAttributes({\n            activeDescendant: activeDescendant,\n            expanded: this.hasValues()\n        });\n    };\n    ComboboxValues.prototype.clearValues = function () {\n        this.mouseIsOverValue = false;\n        this.resetKeyboardActiveValue();\n        Dom_1.$$(this.element).empty();\n        Dom_1.$$(this.element).hide();\n        this.values = [];\n        this.updateAccessibilityAttributes();\n    };\n    ComboboxValues.prototype.setKeyboardActiveValue = function (value) {\n        this.resetKeyboardActiveValue();\n        this.keyboardActiveValue = value;\n        this.activateFocusOnValue(this.keyboardActiveValue);\n        this.updateAccessibilityAttributes();\n    };\n    ComboboxValues.prototype.resetKeyboardActiveValue = function () {\n        if (!this.keyboardActiveValue) {\n            return;\n        }\n        this.deactivateFocusOnValue(this.keyboardActiveValue);\n        this.keyboardActiveValue = null;\n    };\n    ComboboxValues.prototype.activateFocusOnValue = function (_a) {\n        var element = _a.element;\n        Dom_1.$$(element).addClass('coveo-focused');\n        element.setAttribute('aria-selected', 'true');\n    };\n    ComboboxValues.prototype.deactivateFocusOnValue = function (_a) {\n        var element = _a.element;\n        Dom_1.$$(element).removeClass('coveo-focused');\n        element.setAttribute('aria-selected', 'false');\n    };\n    ComboboxValues.prototype.selectActiveValue = function () {\n        if (!this.keyboardActiveValue) {\n            return;\n        }\n        this.combobox.options.onSelectValue(this.keyboardActiveValue);\n        this.combobox.clearAll();\n    };\n    ComboboxValues.prototype.onScroll = function () {\n        var scrollEndReached = this.element.scrollTop + this.element.clientHeight >= this.element.scrollHeight;\n        if (scrollEndReached && this.combobox.options.scrollable.areMoreValuesAvailable()) {\n            this.combobox.onScrollEndReached();\n        }\n    };\n    ComboboxValues.prototype.resetScroll = function () {\n        if (!this.isScrollable) {\n            return;\n        }\n        this.element.style.maxHeight = this.combobox.options.scrollable.maxDropdownHeight + \"px\";\n        this.element.scrollTop = 0;\n    };\n    ComboboxValues.prototype.focusFirstValue = function () {\n        if (!this.hasValues()) {\n            return;\n        }\n        this.firstValue.element.focus();\n    };\n    ComboboxValues.prototype.focusLastValue = function () {\n        if (!this.hasValues()) {\n            return;\n        }\n        this.lastValue.element.focus();\n    };\n    ComboboxValues.prototype.focusNextValue = function () {\n        if (!this.hasValues()) {\n            return;\n        }\n        var nextActiveValue = this.nextOrFirstValue;\n        nextActiveValue.element.focus();\n    };\n    ComboboxValues.prototype.focusPreviousValue = function () {\n        if (!this.hasValues()) {\n            return;\n        }\n        var previousActiveValue = this.previousOrLastValue;\n        previousActiveValue.element.focus();\n    };\n    Object.defineProperty(ComboboxValues.prototype, \"nextOrFirstValue\", {\n        get: function () {\n            if (!this.keyboardActiveValue) {\n                return this.firstValue;\n            }\n            var nextValueIndex = (this.values.indexOf(this.keyboardActiveValue) + 1) % this.numberOfValues;\n            return this.values[nextValueIndex];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ComboboxValues.prototype, \"firstValue\", {\n        get: function () {\n            return this.values[0];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ComboboxValues.prototype, \"previousOrLastValue\", {\n        get: function () {\n            if (!this.keyboardActiveValue) {\n                return this.lastValue;\n            }\n            var previousValueIndex = this.values.indexOf(this.keyboardActiveValue) - 1;\n            return previousValueIndex >= 0 ? this.values[previousValueIndex] : this.values[this.numberOfValues - 1];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ComboboxValues.prototype, \"lastValue\", {\n        get: function () {\n            var lastValueIndex = this.numberOfValues - 1;\n            return this.values[lastValueIndex];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ComboboxValues.prototype.saveFocusedValue = function () {\n        if (!this.keyboardActiveValue) {\n            this.focusedValueId = null;\n            return;\n        }\n        this.focusedValueId = this.keyboardActiveValue.element.id;\n    };\n    ComboboxValues.prototype.restoreFocusedValue = function () {\n        if (!this.focusedValueId) {\n            return;\n        }\n        var element = Dom_1.$$(this.element).find(\"#\" + this.focusedValueId);\n        element.focus();\n        this.focusedValueId = null;\n    };\n    return ComboboxValues;\n}());\nexports.ComboboxValues = ComboboxValues;\n\n\n/***/ }),\n\n/***/ 566:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 575:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ResponsiveFacetColumn_1 = __webpack_require__(212);\nvar DynamicFacet_1 = __webpack_require__(137);\nvar ResponsiveDynamicFacets = /** @class */ (function (_super) {\n    __extends(ResponsiveDynamicFacets, _super);\n    function ResponsiveDynamicFacets() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ResponsiveDynamicFacets.init = function (root, component, options) {\n        ResponsiveFacetColumn_1.ResponsiveFacetColumn.init(ResponsiveDynamicFacets, root, component, options, DynamicFacet_1.DynamicFacet.ID);\n    };\n    return ResponsiveDynamicFacets;\n}(ResponsiveFacetColumn_1.ResponsiveFacetColumn));\nexports.ResponsiveDynamicFacets = ResponsiveDynamicFacets;\n\n\n/***/ }),\n\n/***/ 576:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(505);\nvar Dom_1 = __webpack_require__(1);\nvar Strings_1 = __webpack_require__(6);\nvar SVGIcons_1 = __webpack_require__(12);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar underscore_1 = __webpack_require__(0);\nvar DynamicFacetBreadcrumbs = /** @class */ (function () {\n    function DynamicFacetBreadcrumbs(facet) {\n        this.facet = facet;\n        this.create();\n    }\n    DynamicFacetBreadcrumbs.prototype.create = function () {\n        this.element = Dom_1.$$('ul', { className: 'coveo-dynamic-facet-breadcrumb coveo-breadcrumb-item' }).el;\n        this.createAndAppendTitle();\n        var activeFacetValues = this.facet.values.activeValues;\n        var breadcrumbFacetValues = activeFacetValues.slice(0, this.facet.options.numberOfValuesInBreadcrumb);\n        var collapsedFacetValues = activeFacetValues.slice(this.facet.options.numberOfValuesInBreadcrumb);\n        this.createAndAppendBreadcrumbValues(breadcrumbFacetValues);\n        if (collapsedFacetValues.length) {\n            this.createAndAppendCollapsedBreadcrumbs(collapsedFacetValues);\n        }\n    };\n    DynamicFacetBreadcrumbs.prototype.createAndAppendTitle = function () {\n        var titleElement = Dom_1.$$('h3', { className: 'coveo-dynamic-facet-breadcrumb-title' }, this.facet.options.title + \":\").el;\n        this.element.appendChild(titleElement);\n    };\n    DynamicFacetBreadcrumbs.prototype.createAndAppendBreadcrumbValues = function (facetValues) {\n        var _this = this;\n        facetValues.forEach(function (facetValue) { return _this.createAndAppendBreadcrumbValue(facetValue); });\n    };\n    DynamicFacetBreadcrumbs.prototype.createAndAppendBreadcrumbValue = function (facetValue) {\n        var _this = this;\n        var listContainer = Dom_1.$$('li', { className: 'coveo-dynamic-facet-breadcrumb-value-list-item' }).el;\n        var valueElement = Dom_1.$$('button', {\n            className: 'coveo-dynamic-facet-breadcrumb-value',\n            ariaLabel: Strings_1.l('RemoveFilterOn', facetValue.displayValue)\n        }, underscore_1.escape(facetValue.displayValue)).el;\n        var clearElement = Dom_1.$$('span', { className: 'coveo-dynamic-facet-breadcrumb-value-clear' }, SVGIcons_1.SVGIcons.icons.mainClear).el;\n        valueElement.appendChild(clearElement);\n        Dom_1.$$(valueElement).on('click', function () { return _this.valueSelectAction(facetValue); });\n        listContainer.appendChild(valueElement);\n        this.element.appendChild(listContainer);\n    };\n    DynamicFacetBreadcrumbs.prototype.valueSelectAction = function (facetValue) {\n        var _this = this;\n        this.facet.deselectValue(facetValue.value);\n        this.facet.enablePreventAutoSelectionFlag();\n        this.facet.triggerNewQuery(function () { return _this.logActionToAnalytics(); });\n    };\n    DynamicFacetBreadcrumbs.prototype.logActionToAnalytics = function () {\n        this.facet.logAnalyticsEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.breadcrumbFacet, this.facet.basicAnalyticsFacetMeta);\n    };\n    DynamicFacetBreadcrumbs.prototype.createAndAppendCollapsedBreadcrumbs = function (facetValues) {\n        var _this = this;\n        var label = Strings_1.l('NMore', \"\" + facetValues.length);\n        var title = facetValues.map(function (_a) {\n            var value = _a.value;\n            return value;\n        }).join('\\n');\n        var collapsedElement = Dom_1.$$('button', {\n            className: 'coveo-dynamic-facet-breadcrumb-collapse',\n            title: title\n        }, label).el;\n        Dom_1.$$(collapsedElement).on('click', function () {\n            Dom_1.$$(collapsedElement).remove();\n            _this.createAndAppendBreadcrumbValues(facetValues);\n        });\n        this.element.appendChild(collapsedElement);\n    };\n    return DynamicFacetBreadcrumbs;\n}());\nexports.DynamicFacetBreadcrumbs = DynamicFacetBreadcrumbs;\n\n\n/***/ }),\n\n/***/ 577:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 578:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Combobox_1 = __webpack_require__(508);\nvar Strings_1 = __webpack_require__(6);\nvar FacetSearchController_1 = __webpack_require__(579);\nvar DynamicFacetValue_1 = __webpack_require__(223);\nvar FacetValueState_1 = __webpack_require__(69);\nvar DynamicFacetSearchValueRenderer_1 = __webpack_require__(580);\n__webpack_require__(509);\nvar FacetUtils_1 = __webpack_require__(39);\nvar DynamicFacetSearch = /** @class */ (function () {\n    function DynamicFacetSearch(facet) {\n        var _this = this;\n        this.facet = facet;\n        this.facetSearchController = new FacetSearchController_1.FacetSearchController(this.facet);\n        this.combobox = new Combobox_1.Combobox({\n            label: Strings_1.l('SearchFacetResults', this.facet.options.title),\n            ariaLive: this.facet.searchInterface.ariaLive,\n            requestValues: function (terms) { return _this.facetSearchController.search(terms); },\n            createValuesFromResponse: function (response) { return _this.createValuesFromResponse(response); },\n            onSelectValue: this.onSelectValue,\n            placeholderText: Strings_1.l('Search'),\n            wrapperClassName: 'coveo-dynamic-facet-search',\n            clearOnBlur: true,\n            scrollable: {\n                requestMoreValues: function () { return _this.facetSearchController.fetchMoreResults(); },\n                areMoreValuesAvailable: function () { return _this.facetSearchController.moreValuesAvailable; },\n                maxDropdownHeight: 250\n            },\n            highlightValueClassName: 'coveo-checkbox-span-label'\n        });\n        this.element = this.combobox.element;\n    }\n    DynamicFacetSearch.prototype.getDisplayValue = function (value) {\n        return FacetUtils_1.FacetUtils.getDisplayValueFromValueCaption(value, this.facet.options.field, this.facet.options.valueCaption);\n    };\n    DynamicFacetSearch.prototype.createValuesFromResponse = function (response) {\n        var _this = this;\n        return response.values.map(function (value, index) {\n            var facetValue = new DynamicFacetValue_1.DynamicFacetValue({\n                value: value.rawValue,\n                // TODO: remove when https://coveord.atlassian.net/browse/SEARCHAPI-4958 is fixed\n                displayValue: _this.getDisplayValue(value.displayValue),\n                numberOfResults: value.count,\n                state: FacetValueState_1.FacetValueState.idle,\n                position: index + 1\n            }, _this.facet, DynamicFacetSearchValueRenderer_1.DynamicFacetSearchValueRenderer);\n            return {\n                value: facetValue,\n                element: facetValue.renderedElement\n            };\n        });\n    };\n    DynamicFacetSearch.prototype.onSelectValue = function (_a) {\n        var value = _a.value;\n        value.renderer.selectAction();\n    };\n    return DynamicFacetSearch;\n}());\nexports.DynamicFacetSearch = DynamicFacetSearch;\n\n\n/***/ }),\n\n/***/ 579:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FileTypes_1 = __webpack_require__(113);\nvar QueryUtils_1 = __webpack_require__(21);\nvar DateUtils_1 = __webpack_require__(32);\nvar FacetSearchController = /** @class */ (function () {\n    function FacetSearchController(facet) {\n        this.facet = facet;\n        this.terms = '';\n        this.pageCount = 1;\n        this.numberOfValuesMultiplier = 3;\n        this.moreValuesAvailable = true;\n    }\n    FacetSearchController.prototype.getMonthsValueCaptions = function () {\n        var monthsValueCaptions = {};\n        for (var month = 1; month <= 12; month++) {\n            var key = (\"0\" + month).substr(-2);\n            monthsValueCaptions[key] = DateUtils_1.DateUtils.monthToString(month - 1);\n        }\n        return monthsValueCaptions;\n    };\n    FacetSearchController.prototype.addTypesCaptionsIfNecessary = function () {\n        var field = this.facet.options.field.toLowerCase();\n        var isFileType = QueryUtils_1.QueryUtils.isStratusAgnosticField(field, '@filetype');\n        var isObjectType = QueryUtils_1.QueryUtils.isStratusAgnosticField(field, '@objecttype');\n        var isMonth = QueryUtils_1.QueryUtils.isStratusAgnosticField(field, '@month');\n        if (isFileType || isObjectType) {\n            return FileTypes_1.FileTypes.getFileTypeCaptions();\n        }\n        if (isMonth) {\n            return this.getMonthsValueCaptions();\n        }\n        return {};\n    };\n    Object.defineProperty(FacetSearchController.prototype, \"captions\", {\n        get: function () {\n            return __assign({}, this.addTypesCaptionsIfNecessary(), this.facet.options.valueCaption);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetSearchController.prototype, \"numberOfValues\", {\n        get: function () {\n            return this.facet.options.numberOfValues * this.numberOfValuesMultiplier * this.pageCount;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FacetSearchController.prototype, \"request\", {\n        get: function () {\n            var optionalLeadingWildcard = this.facet.options.useLeadingWildcardInFacetSearch ? '*' : '';\n            return {\n                field: this.facet.fieldName,\n                numberOfValues: this.numberOfValues,\n                ignoreValues: this.facet.values.activeValues.map(function (value) { return value.value; }),\n                captions: this.captions,\n                searchContext: this.facet.queryController.getLastQuery(),\n                query: \"\" + optionalLeadingWildcard + this.terms + \"*\"\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FacetSearchController.prototype.triggerRequest = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var response;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.facet.queryController.getEndpoint().facetSearch(this.request)];\n                    case 1:\n                        response = _a.sent();\n                        this.moreValuesAvailable = response.moreValuesAvailable;\n                        return [2 /*return*/, response];\n                }\n            });\n        });\n    };\n    FacetSearchController.prototype.search = function (terms) {\n        this.terms = terms;\n        this.pageCount = 1;\n        return this.triggerRequest();\n    };\n    FacetSearchController.prototype.fetchMoreResults = function () {\n        this.pageCount++;\n        return this.triggerRequest();\n    };\n    return FacetSearchController;\n}());\nexports.FacetSearchController = FacetSearchController;\n\n\n/***/ }),\n\n/***/ 580:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar DynamicFacetValueCheckbox_1 = __webpack_require__(510);\nvar DynamicFacetSearchValueRenderer = /** @class */ (function () {\n    function DynamicFacetSearchValueRenderer(facetValue, facet) {\n        this.facetValue = facetValue;\n        this.facet = facet;\n    }\n    DynamicFacetSearchValueRenderer.prototype.render = function () {\n        this.dom = Dom_1.$$('div', {\n            className: 'coveo-dynamic-facet-value',\n            dataValue: this.facetValue.value\n        });\n        this.renderCheckbox();\n        return this.dom.el;\n    };\n    DynamicFacetSearchValueRenderer.prototype.renderCheckbox = function () {\n        this.valueCheckbox = new DynamicFacetValueCheckbox_1.DynamicFacetValueCheckbox(this.facetValue);\n        Dom_1.$$(this.valueCheckbox.element).find('button').setAttribute('tabindex', '-1');\n        this.dom.append(this.valueCheckbox.element);\n    };\n    DynamicFacetSearchValueRenderer.prototype.selectAction = function () {\n        var _this = this;\n        this.facet.enableFreezeFacetOrderFlag();\n        this.facet.toggleSelectValue(this.facetValue.value);\n        this.facetValue.select();\n        this.facet.scrollToTop();\n        this.facet.triggerNewQuery(function () { return _this.facetValue.logSelectActionToAnalytics(); });\n    };\n    return DynamicFacetSearchValueRenderer;\n}());\nexports.DynamicFacetSearchValueRenderer = DynamicFacetSearchValueRenderer;\n\n\n/***/ }),\n\n/***/ 581:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar FacetUtils_1 = __webpack_require__(39);\nvar DynamicFacetValue_1 = __webpack_require__(223);\nvar FacetValueState_1 = __webpack_require__(69);\nvar DynamicFacetValueRenderer_1 = __webpack_require__(513);\nvar DynamicFacetValueCreator = /** @class */ (function () {\n    function DynamicFacetValueCreator(facet) {\n        this.facet = facet;\n    }\n    DynamicFacetValueCreator.prototype.getDisplayValue = function (value) {\n        return FacetUtils_1.FacetUtils.getDisplayValueFromValueCaption(value, this.facet.options.field, this.facet.options.valueCaption);\n    };\n    DynamicFacetValueCreator.prototype.getDefaultValues = function () {\n        return [];\n    };\n    DynamicFacetValueCreator.prototype.createFromResponse = function (facetValue, index) {\n        return new DynamicFacetValue_1.DynamicFacetValue({\n            value: facetValue.value,\n            displayValue: this.getDisplayValue(facetValue.value),\n            numberOfResults: facetValue.numberOfResults,\n            state: facetValue.state,\n            position: index + 1\n        }, this.facet, DynamicFacetValueRenderer_1.DynamicFacetValueRenderer);\n    };\n    DynamicFacetValueCreator.prototype.createFromValue = function (value) {\n        var position = this.facet.values.allFacetValues.length + 1;\n        var state = FacetValueState_1.FacetValueState.idle;\n        var displayValue = this.getDisplayValue(value);\n        return new DynamicFacetValue_1.DynamicFacetValue({ value: value, displayValue: displayValue, state: state, numberOfResults: 0, position: position }, this.facet, DynamicFacetValueRenderer_1.DynamicFacetValueRenderer);\n    };\n    return DynamicFacetValueCreator;\n}());\nexports.DynamicFacetValueCreator = DynamicFacetValueCreator;\n\n\n/***/ }),\n\n/***/ 69:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The allowed states of a facet value in a Search API facet\n * [request]{@link IFacetRequestValue.state} or\n * [response]{@link IFacetResponseValue.state}.\n */\nvar FacetValueState;\n(function (FacetValueState) {\n    /**\n     * The facet value is not currently selected or excluded in the search\n     * interface.\n     */\n    FacetValueState[\"idle\"] = \"idle\";\n    /**\n     * The facet value is currently selected in the search interface.\n     */\n    FacetValueState[\"selected\"] = \"selected\";\n})(FacetValueState = exports.FacetValueState || (exports.FacetValueState = {}));\n\n\n/***/ }),\n\n/***/ 82:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ComponentOptions_1 = __webpack_require__(8);\n/**\n * ResponsiveFacets options\n */\nexports.ResponsiveFacetOptions = {\n    /**\n     * Specifies whether to enable *responsive mode* for facets. Setting this options to `false` on any `Facet`, or\n     * [`FacetSlider`]{@link FacetSlider} component in a search interface disables responsive mode for all other facets\n     * in the search interface.\n     *\n     * Responsive mode displays all facets under a single dropdown button whenever the width of the HTML element which\n     * the search interface is bound to reaches or falls behind a certain threshold (see\n     * {@link SearchInterface.responsiveComponents}).\n     *\n     * See also the [`dropdownHeaderLabel`]{@link Facet.options.dropdownHeaderLabel} option.\n     *\n     * Default value is `true`.\n     */\n    enableResponsiveMode: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'ResponsiveOptions' }),\n    responsiveBreakpoint: ComponentOptions_1.ComponentOptions.buildNumberOption({\n        deprecated: 'This option is exposed for legacy reasons. It is not recommended to use this option. Instead, use `SearchInterface.options.responsiveMediumBreakpoint` options exposed on the `SearchInterface`.'\n    }),\n    /**\n     * If the [`enableResponsiveMode`]{@link Facet.options.enableResponsiveMode} option is `true` for all facets and\n     * {@link FacetSlider.options.enableResponsiveMode} is also `true` for all sliders, specifies the label of the\n     * dropdown button that allows to display the facets when in responsive mode.\n     *\n     * If more than one `Facet` or {@link FacetSlider} component in the search interface specifies a value for this\n     * option, the framework uses the first occurrence of the option.\n     *\n     * Default value is `Filters`.\n     */\n    dropdownHeaderLabel: ComponentOptions_1.ComponentOptions.buildLocalizedStringOption({ section: 'ResponsiveOptions' })\n};\n\n\n/***/ }),\n\n/***/ 87:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(522);\n__webpack_require__(523);\n__webpack_require__(524);\nvar underscore_1 = __webpack_require__(0);\nvar QueryEvents_1 = __webpack_require__(11);\nvar ResultLayoutEvents_1 = __webpack_require__(129);\nvar ResultListEvents_1 = __webpack_require__(29);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Assert_1 = __webpack_require__(5);\nvar Defer_1 = __webpack_require__(31);\nvar Model_1 = __webpack_require__(18);\nvar QueryStateModel_1 = __webpack_require__(13);\nvar DeviceUtils_1 = __webpack_require__(24);\nvar Dom_1 = __webpack_require__(1);\nvar DomUtils_1 = __webpack_require__(91);\nvar Utils_1 = __webpack_require__(4);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Initialization_1 = __webpack_require__(2);\nvar InitializationPlaceholder_1 = __webpack_require__(177);\nvar TemplateComponentOptions_1 = __webpack_require__(61);\nvar ResponsiveDefaultResultTemplate_1 = __webpack_require__(525);\nvar CoreHelpers_1 = __webpack_require__(466);\nvar DefaultRecommendationTemplate_1 = __webpack_require__(463);\nvar DefaultResultTemplate_1 = __webpack_require__(116);\nvar TableTemplate_1 = __webpack_require__(462);\nvar TemplateCache_1 = __webpack_require__(66);\nvar TemplateList_1 = __webpack_require__(90);\nvar ResultContainer_1 = __webpack_require__(526);\nvar ResultListCardRenderer_1 = __webpack_require__(527);\nvar ResultListRenderer_1 = __webpack_require__(211);\nvar ResultListTableRenderer_1 = __webpack_require__(528);\nvar ResultListUtils_1 = __webpack_require__(111);\nvar TemplateToHtml_1 = __webpack_require__(464);\nCoreHelpers_1.CoreHelpers.exportAllHelpersGlobally(window['Coveo']);\n/**\n * The `ResultList` component is responsible for displaying query results by applying one or several result templates\n * (see [Result Templates](https://docs.coveo.com/en/413/)).\n *\n * It is possible to include multiple `ResultList` components along with a single `ResultLayout`\n * component in a search page to provide different result layouts (see\n * [Result Layouts](https://docs.coveo.com/en/360/)).\n *\n * This component supports infinite scrolling (see the\n * [`enableInfiniteScroll`]{@link ResultList.options.enableInfiniteScroll} option).\n */\nvar ResultList = /** @class */ (function (_super) {\n    __extends(ResultList, _super);\n    /**\n     * Creates a new `ResultList` component. Binds various event related to queries (e.g., on querySuccess ->\n     * renderResults). Binds scroll event if the [`enableInfiniteScroll`]{@link ResultList.options.enableInfiniteScroll}\n     * option is `true`.\n     * @param element The HTMLElement on which to instantiate the component.\n     * @param options The options for the `ResultList` component.\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\n     * automatically resolved (with a slower execution time).\n     * @param elementClassId The class that this component should instantiate. Components that extend the base ResultList\n     * use this. Default value is `CoveoResultList`.\n     */\n    function ResultList(element, options, bindings, elementClassId) {\n        if (elementClassId === void 0) { elementClassId = ResultList.ID; }\n        var _this = _super.call(this, element, elementClassId, bindings) || this;\n        _this.element = element;\n        _this.options = options;\n        _this.bindings = bindings;\n        _this.currentlyDisplayedResults = [];\n        _this.reachedTheEndOfResults = false;\n        _this.disableLayoutChange = false;\n        // This variable serves to block some setup where the framework fails to correctly identify the \"real\" scrolling container.\n        // Since it's not technically feasible to correctly identify the scrolling container in every possible scenario without some very complex logic, we instead try to add some kind of mechanism to\n        // block runaway requests where UI will keep asking more results in the index, eventually bringing the browser to it's knee.\n        // Those successive request are needed in \"displayMoreResults\" to ensure we fill the scrolling container correctly.\n        // Since the container is not identified correctly, it is never \"full\", so we keep asking for more.\n        // It is reset every time the user actually scroll the container manually.\n        _this.successiveScrollCount = 0;\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, ResultList, options);\n        Assert_1.Assert.exists(element);\n        Assert_1.Assert.exists(_this.options);\n        Assert_1.Assert.exists(_this.options.resultTemplate);\n        Assert_1.Assert.exists(_this.options.infiniteScrollContainer);\n        _this.showOrHideElementsDependingOnState(false, false);\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.newQuery, function (args) { return _this.handleNewQuery(); });\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) {\n            return _this.handleBuildingQuery(args);\n        });\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.querySuccess, function (args) {\n            return _this.handleQuerySuccess(args);\n        });\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.duringQuery, function (args) { return _this.handleDuringQuery(); });\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.queryError, function (args) { return _this.handleQueryError(); });\n        Dom_1.$$(_this.root).on(ResultListEvents_1.ResultListEvents.changeLayout, function (e, args) { return _this.handleChangeLayout(args); });\n        if (_this.options.enableInfiniteScroll) {\n            _this.handlePageChanged();\n            _this.bind.on(_this.options.infiniteScrollContainer, 'scroll', function (e) {\n                _this.successiveScrollCount = 0;\n                _this.handleScrollOfResultList();\n            });\n        }\n        _this.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE_ONE, QueryStateModel_1.QUERY_STATE_ATTRIBUTES.FIRST, function () { return _this.handlePageChanged(); });\n        _this.resultContainer = _this.initResultContainer();\n        Assert_1.Assert.exists(_this.options.resultsContainer);\n        _this.initWaitAnimationContainer();\n        Assert_1.Assert.exists(_this.options.waitAnimationContainer);\n        _this.setupTemplatesVersusLayouts();\n        Dom_1.$$(_this.root).on(ResultLayoutEvents_1.ResultLayoutEvents.populateResultLayout, function (e, args) {\n            return args.layouts.push(_this.options.layout);\n        });\n        _this.setupRenderer();\n        _this.makeElementFocusable();\n        _this.ensureHasId();\n        return _this;\n    }\n    ResultList.getDefaultTemplate = function (e) {\n        var template = ResultList.loadTemplatesFromCache();\n        if (template != null) {\n            return template;\n        }\n        var component = Component_1.Component.get(e);\n        if (Coveo['Recommendation'] && component.searchInterface instanceof Coveo['Recommendation']) {\n            return new DefaultRecommendationTemplate_1.DefaultRecommendationTemplate();\n        }\n        return new DefaultResultTemplate_1.DefaultResultTemplate();\n    };\n    ResultList.loadTemplatesFromCache = function () {\n        var pageTemplateNames = TemplateCache_1.TemplateCache.getResultListTemplateNames();\n        if (pageTemplateNames.length > 0) {\n            return new TemplateList_1.TemplateList(underscore_1.compact(underscore_1.map(pageTemplateNames, function (templateName) { return TemplateCache_1.TemplateCache.getTemplate(templateName); })));\n        }\n        return null;\n    };\n    /**\n     * Get the fields needed to be automatically included in the query for this result list.\n     * @returns {string[]}\n     */\n    ResultList.prototype.getAutoSelectedFieldsToInclude = function () {\n        return underscore_1.chain(this.options.resultTemplate.getFields()).concat(this.getMinimalFieldsToInclude()).compact().unique().value();\n    };\n    ResultList.prototype.setupTemplatesVersusLayouts = function () {\n        var _this = this;\n        var layoutClassToAdd = \"coveo-\" + this.options.layout + \"-layout-container\";\n        this.resultContainer.addClass(layoutClassToAdd);\n        if (this.options.layout === 'table') {\n            this.options.resultTemplate = new TableTemplate_1.TableTemplate(this.options.resultTemplate.templates || []);\n        }\n        // A TemplateList is the scenario where the result template are directly embedded inside the ResultList\n        // This is the typical scenario when a page gets created by the interface editor, for example.\n        // In that case, we try to stick closely that what is actually configured inside the page, and do no \"special magic\".\n        // Stick to the \"hardcoded\" configuration present in the page.\n        // We only add the correct layout options if it has not been set manually.\n        if (this.options.resultTemplate instanceof TemplateList_1.TemplateList) {\n            underscore_1.each(this.options.resultTemplate.templates, function (tmpl) {\n                if (!tmpl.layout) {\n                    tmpl.layout = _this.options.layout;\n                }\n            });\n        }\n        else if (this.options.resultTemplate instanceof DefaultResultTemplate_1.DefaultResultTemplate && this.options.layout == 'list') {\n            ResponsiveDefaultResultTemplate_1.ResponsiveDefaultResultTemplate.init(this.root, this, {});\n        }\n    };\n    /**\n     * Empties the current result list content and appends the given array of HTMLElement.\n     *\n     * Can append to existing elements in the result list, or replace them.\n     *\n     * Triggers the `newResultsDisplayed` and `newResultDisplayed` events.\n     * @param resultsElement\n     * @param append\n     */\n    ResultList.prototype.renderResults = function (resultElements, append) {\n        var _this = this;\n        if (append === void 0) { append = false; }\n        if (!append) {\n            this.resultContainer.empty();\n        }\n        return this.renderer\n            .renderResults(resultElements, append, this.triggerNewResultDisplayed.bind(this))\n            .then(function () { return _this.triggerNewResultsDisplayed(); });\n    };\n    /**\n     * Builds and returns an array of HTMLElement with the given result set.\n     * @param results the result set to build an array of HTMLElement from.\n     */\n    ResultList.prototype.buildResults = function (results) {\n        var layout = this.options.layout;\n        return this.templateToHtml.buildResults(results, layout, this.currentlyDisplayedResults);\n    };\n    /**\n     * Builds and returns an HTMLElement for the given result.\n     * @param result the result to build an HTMLElement from.\n     * @returns {HTMLElement}\n     */\n    ResultList.prototype.buildResult = function (result) {\n        var layout = this.options.layout;\n        return this.templateToHtml.buildResult(result, layout, this.currentlyDisplayedResults);\n    };\n    /**\n     * Executes a query to fetch new results. After the query returns, renders the new results.\n     *\n     * Asserts that there are more results to display by verifying whether the last query has returned as many results as\n     * requested.\n     *\n     * Asserts that the `ResultList` is not currently fetching results.\n     * @param count The number of results to fetch and display.\n     */\n    ResultList.prototype.displayMoreResults = function (count) {\n        Assert_1.Assert.isLargerOrEqualsThan(1, count);\n        if (this.isCurrentlyFetchingMoreResults()) {\n            this.logger.warn(\"Ignoring request to display more results since we're already doing so\");\n            return;\n        }\n        if (!this.hasPotentiallyMoreResultsToDisplay()) {\n            this.logger.warn(\"Ignoring request to display more results since we know there aren't more to display\");\n            return;\n        }\n        if (this.options.enableInfiniteScrollWaitingAnimation) {\n            this.showWaitingAnimationForInfiniteScrolling();\n        }\n        return this.fetchAndRenderMoreResults(count);\n    };\n    Object.defineProperty(ResultList.prototype, \"templateToHtml\", {\n        get: function () {\n            var templateToHtmlArgs = {\n                resultTemplate: this.options.resultTemplate,\n                searchInterface: this.searchInterface,\n                queryStateModel: this.queryStateModel\n            };\n            return new TemplateToHtml_1.TemplateToHtml(templateToHtmlArgs);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Gets the list of currently displayed result.\n     * @returns {IQueryResult[]}\n     */\n    ResultList.prototype.getDisplayedResults = function () {\n        return this.currentlyDisplayedResults;\n    };\n    /**\n     * Gets the list of currently displayed result HTMLElement.\n     * @returns {HTMLElement[]}\n     */\n    ResultList.prototype.getDisplayedResultsElements = function () {\n        return this.resultContainer.getResultElements();\n    };\n    ResultList.prototype.enable = function () {\n        var _this = this;\n        _super.prototype.enable.call(this);\n        this.disableLayoutChange = false;\n        underscore_1.each(this.resultLayoutSelectors, function (resultLayoutSelector) {\n            resultLayoutSelector.enableLayouts([_this.options.layout]);\n        });\n        Dom_1.$$(this.element).removeClass('coveo-hidden');\n    };\n    ResultList.prototype.disable = function () {\n        var _this = this;\n        _super.prototype.disable.call(this);\n        var otherLayoutsStillActive = underscore_1.map(this.otherResultLists, function (otherResultList) { return otherResultList.options.layout; });\n        if (!underscore_1.contains(otherLayoutsStillActive, this.options.layout) && !this.disableLayoutChange) {\n            underscore_1.each(this.resultLayoutSelectors, function (resultLayoutSelector) {\n                resultLayoutSelector.disableLayouts([_this.options.layout]);\n            });\n        }\n        this.disableLayoutChange = false;\n        Dom_1.$$(this.element).addClass('coveo-hidden');\n    };\n    ResultList.prototype.autoCreateComponentsInsideResult = function (element, result) {\n        return this.templateToHtml.autoCreateComponentsInsideResult(element, result);\n    };\n    ResultList.prototype.triggerNewResultDisplayed = function (result, resultElement) {\n        var args = {\n            result: result,\n            item: resultElement\n        };\n        Dom_1.$$(this.element).trigger(ResultListEvents_1.ResultListEvents.newResultDisplayed, args);\n    };\n    ResultList.prototype.triggerNewResultsDisplayed = function () {\n        var args = {\n            isInfiniteScrollEnabled: this.options.enableInfiniteScroll\n        };\n        Dom_1.$$(this.element).trigger(ResultListEvents_1.ResultListEvents.newResultsDisplayed, args);\n    };\n    ResultList.prototype.fetchAndRenderMoreResults = function (count) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.fetchingMoreResults = this.queryController.fetchMore(count);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.fetchingMoreResults];\n                    case 2:\n                        data = _a.sent();\n                        Assert_1.Assert.exists(data);\n                        this.usageAnalytics.logCustomEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.pagerScrolling, {}, this.element);\n                        this.reachedTheEndOfResults = count > data.results.length;\n                        this.renderNewResults(data);\n                        this.resetStateAfterFetchingMoreResults();\n                        return [2 /*return*/, data];\n                    case 3:\n                        e_1 = _a.sent();\n                        this.resetStateAfterFetchingMoreResults();\n                        return [2 /*return*/, Promise.reject(e_1)];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ResultList.prototype.renderNewResults = function (data) {\n        return __awaiter(this, void 0, void 0, function () {\n            var elements, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.buildResults(data)];\n                    case 1:\n                        elements = _b.sent();\n                        this.renderResults(elements, true);\n                        (_a = this.currentlyDisplayedResults).push.apply(_a, data.results);\n                        this.triggerNewResultsDisplayed();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ResultList.prototype.resetStateAfterFetchingMoreResults = function () {\n        var _this = this;\n        this.hideWaitingAnimationForInfiniteScrolling();\n        this.fetchingMoreResults = undefined;\n        Defer_1.Defer.defer(function () {\n            _this.successiveScrollCount++;\n            if (_this.successiveScrollCount <= ResultList.MAX_AMOUNT_OF_SUCESSIVE_REQUESTS) {\n                _this.handleScrollOfResultList();\n            }\n            else {\n                _this.logger.info(\"Result list has triggered 5 consecutive queries to try and fill up the scrolling container, but it is still unable to do so.\\n          Try explicitly setting the 'data-infinite-scroll-container-selector' option on the result list. See: https://coveo.github.io/search-ui/components/resultlist.html#options.infinitescrollcontainer\");\n            }\n        });\n    };\n    ResultList.prototype.handleDuringQuery = function () {\n        this.logger.trace('Emptying the result container');\n        this.cancelFetchingMoreResultsIfNeeded();\n        this.showWaitingAnimation();\n        this.showOrHideElementsDependingOnState(false, false);\n    };\n    ResultList.prototype.handleQueryError = function () {\n        this.hideWaitingAnimation();\n        this.resultContainer.empty();\n        this.currentlyDisplayedResults = [];\n        this.reachedTheEndOfResults = true;\n    };\n    ResultList.prototype.handleQuerySuccess = function (data) {\n        var _this = this;\n        Assert_1.Assert.exists(data);\n        Assert_1.Assert.exists(data.results);\n        var results = data.results;\n        this.logger.trace('Received query results from new query', results);\n        this.hideWaitingAnimation();\n        ResultList.resultCurrentlyBeingRendered = undefined;\n        this.reachedTheEndOfResults = data.query.numberOfResults > data.results.results.length;\n        this.currentlyDisplayedResults = [];\n        this.buildResults(data.results).then(function (elements) { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.renderResults(elements)];\n                    case 1:\n                        _a.sent();\n                        this.showOrHideElementsDependingOnState(true, this.currentlyDisplayedResults.length != 0);\n                        if (DeviceUtils_1.DeviceUtils.isMobileDevice() && this.options.mobileScrollContainer != undefined) {\n                            this.options.mobileScrollContainer.scrollTop = 0;\n                        }\n                        if (this.options.enableInfiniteScroll && results.results.length == data.queryBuilder.numberOfResults) {\n                            // This will check right away if we need to add more results to make the scroll container full & scrolling.\n                            this.scrollToTopIfEnabled();\n                            this.handleScrollOfResultList();\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    };\n    ResultList.prototype.handleScrollOfResultList = function () {\n        if (this.isCurrentlyFetchingMoreResults() || !this.options.enableInfiniteScroll) {\n            return;\n        }\n        if (this.isScrollingOfResultListAlmostAtTheBottom() && this.hasPotentiallyMoreResultsToDisplay()) {\n            this.displayMoreResults(this.options.infiniteScrollPageSize);\n        }\n    };\n    ResultList.prototype.handlePageChanged = function () {\n        var _this = this;\n        this.bind.onRootElement(QueryEvents_1.QueryEvents.deferredQuerySuccess, function () {\n            setTimeout(function () {\n                _this.scrollToTopIfEnabled();\n            }, 0);\n        });\n    };\n    ResultList.prototype.scrollToTopIfEnabled = function () {\n        if (!this.options.enableScrollToTop) {\n            return;\n        }\n        ResultListUtils_1.ResultListUtils.scrollToTop(this.root);\n    };\n    ResultList.prototype.handleNewQuery = function () {\n        Dom_1.$$(this.element).removeClass('coveo-hidden');\n        ResultList.resultCurrentlyBeingRendered = undefined;\n    };\n    Object.defineProperty(ResultList.prototype, \"otherResultLists\", {\n        get: function () {\n            var allResultLists = this.searchInterface.getComponents(ResultList.ID);\n            return underscore_1.without(allResultLists, this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResultList.prototype, \"resultLayoutSelectors\", {\n        get: function () {\n            return this.searchInterface.getComponents('ResultLayoutSelector');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResultList.prototype.handleBuildingQuery = function (args) {\n        if (this.options.fieldsToInclude != null) {\n            // remove the @\n            args.queryBuilder.addFieldsToInclude(underscore_1.map(this.options.fieldsToInclude, function (field) { return field.substr(1); }));\n        }\n        if (this.options.autoSelectFieldsToInclude) {\n            var otherFields = underscore_1.flatten(underscore_1.map(this.otherResultLists, function (otherResultList) {\n                return otherResultList.getAutoSelectedFieldsToInclude();\n            }));\n            args.queryBuilder.addRequiredFields(underscore_1.unique(otherFields.concat(this.getAutoSelectedFieldsToInclude())));\n            args.queryBuilder.includeRequiredFields = true;\n        }\n    };\n    ResultList.prototype.handleChangeLayout = function (args) {\n        var _this = this;\n        if (args.layout === this.options.layout) {\n            this.disableLayoutChange = false;\n            this.enable();\n            this.options.resultTemplate.layout = this.options.layout;\n            if (args.results) {\n                // Prevent flickering when switching to a new layout that is empty\n                // add a temporary placeholder, the same that is used on initialization\n                if (this.resultContainer.isEmpty()) {\n                    new InitializationPlaceholder_1.InitializationPlaceholder(this.root).withVisibleRootElement().withPlaceholderForResultList();\n                }\n                Defer_1.Defer.defer(function () { return __awaiter(_this, void 0, void 0, function () {\n                    var elements;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0: return [4 /*yield*/, this.buildResults(args.results)];\n                            case 1:\n                                elements = _a.sent();\n                                this.renderResults(elements);\n                                this.showOrHideElementsDependingOnState(true, this.currentlyDisplayedResults.length !== 0);\n                                return [2 /*return*/];\n                        }\n                    });\n                }); });\n            }\n        }\n        else {\n            this.disableLayoutChange = true;\n            this.disable();\n            this.resultContainer.empty();\n        }\n    };\n    ResultList.prototype.isCurrentlyFetchingMoreResults = function () {\n        return Utils_1.Utils.exists(this.fetchingMoreResults);\n    };\n    ResultList.prototype.getMinimalFieldsToInclude = function () {\n        // these fields are needed for analytics click event\n        return ['author', 'language', 'urihash', 'objecttype', 'collection', 'source', 'language', 'permanentid'];\n    };\n    ResultList.prototype.isScrollingOfResultListAlmostAtTheBottom = function () {\n        // this is in a try catch because the unit test fail otherwise (Window does not exist for phantom js in the console)\n        var isWindow;\n        try {\n            isWindow = this.options.infiniteScrollContainer instanceof Window;\n        }\n        catch (e) {\n            isWindow = false;\n        }\n        return isWindow ? this.isScrollAtBottomForWindowElement() : this.isScrollAtBottomForHtmlElement();\n    };\n    ResultList.prototype.isScrollAtBottomForWindowElement = function () {\n        var win = new Dom_1.Win(window);\n        var windowHeight = win.height();\n        var scrollTop = win.scrollY();\n        var bodyHeight = new Dom_1.Doc(document).height();\n        return bodyHeight - (windowHeight + scrollTop) < windowHeight / 2;\n    };\n    ResultList.prototype.isScrollAtBottomForHtmlElement = function () {\n        var el = this.options.infiniteScrollContainer;\n        var elementHeight = el.clientHeight;\n        var scrollHeight = el.scrollHeight;\n        var bottomPosition = el.scrollTop + elementHeight;\n        return scrollHeight - bottomPosition < elementHeight / 2;\n    };\n    ResultList.prototype.hasPotentiallyMoreResultsToDisplay = function () {\n        return this.currentlyDisplayedResults.length > 0 && !this.reachedTheEndOfResults;\n    };\n    ResultList.prototype.cancelFetchingMoreResultsIfNeeded = function () {\n        if (this.isCurrentlyFetchingMoreResults()) {\n            this.logger.trace('Cancelling fetching more results');\n            Promise.reject(this.fetchingMoreResults);\n            this.fetchingMoreResults = undefined;\n        }\n    };\n    ResultList.prototype.showOrHideElementsDependingOnState = function (hasQuery, hasResults) {\n        var showIfQuery = Dom_1.$$(this.element).findAll('.coveo-show-if-query');\n        var showIfNoQuery = Dom_1.$$(this.element).findAll('.coveo-show-if-no-query');\n        var showIfResults = Dom_1.$$(this.element).findAll('.coveo-show-if-results');\n        var showIfNoResults = Dom_1.$$(this.element).findAll('.coveo-show-if-no-results');\n        underscore_1.each(showIfQuery, function (s) {\n            Dom_1.$$(s).toggle(hasQuery);\n        });\n        underscore_1.each(showIfNoQuery, function (s) {\n            Dom_1.$$(s).toggle(!hasQuery);\n        });\n        underscore_1.each(showIfResults, function (s) {\n            Dom_1.$$(s).toggle(hasQuery && hasResults);\n        });\n        underscore_1.each(showIfNoResults, function (s) {\n            Dom_1.$$(s).toggle(hasQuery && !hasResults);\n        });\n    };\n    Object.defineProperty(ResultList.prototype, \"waitAnimation\", {\n        get: function () {\n            return this.options.waitAnimation.toLowerCase();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResultList.prototype.showWaitingAnimation = function () {\n        switch (this.waitAnimation) {\n            case 'fade':\n                Dom_1.$$(this.options.waitAnimationContainer).addClass('coveo-fade-out');\n                break;\n            case 'spinner':\n                this.resultContainer.hideChildren();\n                if (Dom_1.$$(this.options.waitAnimationContainer).find('.coveo-wait-animation') == undefined) {\n                    this.options.waitAnimationContainer.appendChild(DomUtils_1.DomUtils.getBasicLoadingAnimation());\n                }\n                break;\n        }\n    };\n    ResultList.prototype.hideWaitingAnimation = function () {\n        switch (this.waitAnimation) {\n            case 'fade':\n                Dom_1.$$(this.options.waitAnimationContainer).removeClass('coveo-fade-out');\n                break;\n            case 'spinner':\n                var spinner = Dom_1.$$(this.options.waitAnimationContainer).find('.coveo-loading-spinner');\n                if (spinner) {\n                    Dom_1.$$(spinner).detach();\n                }\n                break;\n        }\n    };\n    ResultList.prototype.showWaitingAnimationForInfiniteScrolling = function () {\n        var spinner = DomUtils_1.DomUtils.getLoadingSpinner();\n        if (this.options.layout == 'card' && this.options.enableInfiniteScroll) {\n            var previousSpinnerContainer = Dom_1.$$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner-container');\n            underscore_1.each(previousSpinnerContainer, function (previousSpinner) { return Dom_1.$$(previousSpinner).remove(); });\n            var spinnerContainer = Dom_1.$$('div', {\n                className: 'coveo-loading-spinner-container'\n            });\n            spinnerContainer.append(spinner);\n            this.options.waitAnimationContainer.appendChild(spinnerContainer.el);\n        }\n        else {\n            this.options.waitAnimationContainer.appendChild(DomUtils_1.DomUtils.getLoadingSpinner());\n        }\n    };\n    ResultList.prototype.hideWaitingAnimationForInfiniteScrolling = function () {\n        var spinners = Dom_1.$$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner');\n        var containers = Dom_1.$$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner-container');\n        underscore_1.each(spinners, function (spinner) { return Dom_1.$$(spinner).remove(); });\n        underscore_1.each(containers, function (container) { return Dom_1.$$(container).remove(); });\n    };\n    ResultList.prototype.initResultContainer = function () {\n        if (!this.options.resultsContainer) {\n            var elemType = this.options.layout === 'table' ? 'table' : 'div';\n            this.options.resultsContainer = Dom_1.$$(elemType, { className: 'coveo-result-list-container' }).el;\n            this.initResultContainerAddToDom();\n        }\n        return new ResultContainer_1.ResultContainer(this.options.resultsContainer, this.searchInterface);\n    };\n    ResultList.prototype.initResultContainerAddToDom = function () {\n        this.element.appendChild(this.options.resultsContainer);\n    };\n    ResultList.prototype.initWaitAnimationContainer = function () {\n        if (!this.options.waitAnimationContainer) {\n            this.options.waitAnimationContainer = this.resultContainer.el;\n        }\n    };\n    ResultList.prototype.setupRenderer = function () {\n        var initParameters = {\n            options: this.searchInterface.options.originalOptionsObject,\n            bindings: this.bindings\n        };\n        var autoCreateComponentsFn = function (elem) { return Initialization_1.Initialization.automaticallyCreateComponentsInside(elem, initParameters); };\n        switch (this.options.layout) {\n            case 'card':\n                this.renderer = new ResultListCardRenderer_1.ResultListCardRenderer(this.options, autoCreateComponentsFn);\n                break;\n            case 'table':\n                this.renderer = new ResultListTableRenderer_1.ResultListTableRenderer(this.options, autoCreateComponentsFn);\n                break;\n            case 'list':\n            default:\n                this.renderer = new ResultListRenderer_1.ResultListRenderer(this.options, autoCreateComponentsFn);\n                break;\n        }\n    };\n    ResultList.prototype.makeElementFocusable = function () {\n        Dom_1.$$(this.element).setAttribute('tabindex', '-1');\n    };\n    ResultList.prototype.ensureHasId = function () {\n        var currentId = this.element.id;\n        if (currentId === '') {\n            this.element.id = underscore_1.uniqueId('coveo-result-list');\n        }\n    };\n    ResultList.ID = 'ResultList';\n    ResultList.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            ResultList: ResultList\n        });\n    };\n    /**\n     * The options for the ResultList\n     * @componentOptions\n     */\n    ResultList.options = {\n        /**\n         * The element inside which to insert the rendered result templates.\n         *\n         * Performing a new query clears the content of this element.\n         *\n         * You can change the container by specifying its selector (e.g.,\n         * `data-result-container-selector='#someCssSelector'`).\n         *\n         * If you specify no value for this option, a `div` element will be dynamically created and appended to the result\n         * list. This element will then be used as a result container.\n         */\n        resultsContainer: ComponentOptions_1.ComponentOptions.buildChildHtmlElementOption({ alias: 'resultContainerSelector' }),\n        resultTemplate: TemplateComponentOptions_1.TemplateComponentOptions.buildTemplateOption({ defaultFunction: ResultList.getDefaultTemplate }),\n        /**\n         * The type of animation to display while waiting for a query to return.\n         *\n         * The possible values are:\n         * - `fade`: Fades out the current list of results while the query is executing.\n         * - `spinner`: Shows a spinning animation while the query is executing.\n         * - `none`: Use no animation during queries.\n         *\n         * See also the [`waitAnimationContainer`]{@link ResultList.options.waitAnimationContainer} option.\n         *\n         * @examples spinner\n         */\n        waitAnimation: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: 'none' }),\n        /**\n         * The element inside which to display the [`waitAnimation`]{@link ResultList.options.waitAnimation}.\n         *\n         * You can change this by specifying a CSS selector (e.g.,\n         * `data-wait-animation-container-selector='#someCssSelector'`).\n         *\n         * Defaults to the value of the [`resultsContainer`]{@link ResultList.options.resultsContainer} option.\n         */\n        waitAnimationContainer: ComponentOptions_1.ComponentOptions.buildChildHtmlElementOption({\n            postProcessing: function (value, options) { return value || options.resultsContainer; }\n        }),\n        /**\n         * Whether to automatically retrieve an additional page of results and append it to the\n         * results that the `ResultList` is currently displaying when the user scrolls down to the bottom of the\n         * [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer}.\n         *\n         * See also the [`infiniteScrollPageSize`]{@link ResultList.options.infiniteScrollPageSize} and\n         * [`enableInfiniteScrollWaitingAnimation`]{@link ResultList.options.enableInfiniteScrollWaitingAnimation} options.\n         *\n         * It is important to specify the `infiniteScrollContainer` option manually if you want the scrolling element to be\n         * something else than the default `window` element. Otherwise, you might find yourself in a strange state where the\n         * framework rapidly triggers multiple successive query.\n         */\n        enableInfiniteScroll: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\n        /**\n         * The number of additional results to fetch when the user scrolls down to the bottom of the\n         * [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer}.\n         *\n         * @examples 5\n         */\n        infiniteScrollPageSize: ComponentOptions_1.ComponentOptions.buildNumberOption({\n            defaultValue: 10,\n            min: 1,\n            depend: 'enableInfiniteScroll'\n        }),\n        /**\n         * The element that triggers fetching additional results when the end user scrolls down to its bottom.\n         *\n         * You can change the container by specifying its selector (e.g.,\n         * `data-infinite-scroll-container-selector='#someCssSelector'`).\n         *\n         * By default, the framework uses the first vertically scrollable parent element it finds, starting from the\n         * `ResultList` element itself. A vertically scrollable element is an element whose CSS `overflow-y` attribute is\n         * `scroll`.\n         *\n         * This implies that if the framework can find no scrollable parent, it uses the `window` itself as a scrollable\n         * container.\n         *\n         * This heuristic is not perfect, for technical reasons. There are always some corner case CSS combination which the\n         * framework will not be able to correctly detect as 'scrollable'.\n         *\n         * It is highly recommended that you manually set this option if you wish something else than the `window` to be the\n         * scrollable element.\n         */\n        infiniteScrollContainer: ComponentOptions_1.ComponentOptions.buildChildHtmlElementOption({\n            depend: 'enableInfiniteScroll',\n            defaultFunction: function (element) { return ComponentOptions_1.ComponentOptions.findParentScrolling(element); }\n        }),\n        /**\n         * Whether to display the [`waitingAnimation`]{@link ResultList.options.waitAnimation} while fetching additional\n         * results.\n         */\n        enableInfiniteScrollWaitingAnimation: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            depend: 'enableInfiniteScroll',\n            defaultValue: true\n        }),\n        mobileScrollContainer: ComponentOptions_1.ComponentOptions.buildSelectorOption({\n            defaultFunction: function () { return document.querySelector('.coveo-results-column'); }\n        }),\n        /**\n         * Whether the `ResultList` should scan its result templates to discover which fields it must request to\n         * be able to render all results.\n         *\n         * Setting this option to `true` ensures that the Coveo Search API does not return fields that are unnecessary for\n         * the UI to function.\n         *\n         * **Notes:**\n         *\n         * - Many interfaces created with the JavaScript Search Interface Editor explicitly set this option to `true`.\n         * - You cannot set this option to `true` in the Coveo for Sitecore integration.\n         */\n        autoSelectFieldsToInclude: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\n        /**\n         * A list of fields to include in the query results.\n         *\n         * If you set the [`autoSelectFieldsToInclude`]{@link ResultList.options.autoSelectFieldsToInclude} option to\n         * `true`, the Coveo Search API returns the fields you specify for this option (if those fields are available) in\n         * addition to the fields which the `ResultList` automatically requests.\n         *\n         * Otherwise, the Coveo Search API only returns the fields you specify for this option (if those fields are\n         * available), unless you leave this option undefined, in which case the Coveo Search API returns all available\n         * fields.\n         */\n        fieldsToInclude: ComponentOptions_1.ComponentOptions.buildFieldsOption({ includeInResults: true }),\n        /**\n         * Specifies the layout to use when displaying results in this `ResultList` (see\n         * [Result Layouts](https://docs.coveo.com/en/360/)). Specifying a value for this option automatically\n         * populates a [`ResultLayout`]{@link ResultLayout} component with a switcher for the layout.\n         *\n         * For example, if there are two `ResultList` components in the page, one with its `layout` set to `list` and the\n         * other with the same option set to `card`, then the `ResultLayout` component will render two buttons respectively\n         * entitled **List** and **Card**.\n         *\n         * See the [`ValidLayout`]{@link ValidLayout} type for the list of possible values.\n         *\n         * @examples card\n         */\n        layout: ComponentOptions_1.ComponentOptions.buildStringOption({\n            defaultValue: 'list',\n            required: true\n        }),\n        /**\n         * Whether to scroll back to the top of the page when the end-user interacts with a facet.\n         *\n         * **Note:** Setting this option to `false` has no effect on dynamic facets. To disable this behavior on a `DynamicFacet` component, you must set its own [`enableScrollToTop`]{@link DynamicFacet.options.enableScrollToTop} option to `false`.\n         *\n         * @availablesince [July 2019 Release (v2.6459)](https://docs.coveo.com/en/2938/)\n         */\n        enableScrollToTop: ComponentOptions_1.ComponentOptions.buildBooleanOption({\n            defaultValue: true,\n            depend: 'enableInfiniteScroll'\n        })\n    };\n    ResultList.resultCurrentlyBeingRendered = null;\n    ResultList.MAX_AMOUNT_OF_SUCESSIVE_REQUESTS = 5;\n    return ResultList;\n}(Component_1.Component));\nexports.ResultList = ResultList;\nInitialization_1.Initialization.registerAutoCreateComponent(ResultList);\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// DynamicFacet.min__56ae39b439f98c73a62b.js","import { Component } from '../ui/Base/Component';\nimport { ResultList } from '../ui/ResultList/ResultList';\nimport { $$ } from './Dom';\nimport { find } from 'underscore';\nimport { Logger } from '../misc/Logger';\n\nexport class ResultListUtils {\n  public static hideIfInfiniteScrollEnabled(cmp: Component) {\n    const infiniteScrollEnabled = ResultListUtils.isInfiniteScrollEnabled(cmp.searchInterface.element);\n\n    if (infiniteScrollEnabled) {\n      cmp.disable();\n      $$(cmp.element).hide();\n      ResultListUtils.warnIfComponentNotNeeded(cmp);\n    } else {\n      cmp.enable();\n      $$(cmp.element).unhide();\n    }\n  }\n\n  public static isInfiniteScrollEnabled(root: HTMLElement) {\n    const resultList = ResultListUtils.getActiveResultList(root);\n    return resultList ? !!resultList.options.enableInfiniteScroll : false;\n  }\n\n  public static scrollToTop(root: HTMLElement) {\n    const resultList = ResultListUtils.getActiveResultList(root);\n    if (!resultList) {\n      new Logger(this).warn('No active ResultList, scrolling to the top of the Window');\n      return window.scrollTo(0, 0);\n    }\n\n    const searchInterfacePosition = resultList.searchInterface.element.getBoundingClientRect().top;\n    if (searchInterfacePosition > 0) {\n      return;\n    }\n\n    const scrollContainer = resultList.options.infiniteScrollContainer;\n\n    if (typeof scrollContainer.scrollTo === 'function') {\n      scrollContainer.scrollTo(0, window.pageYOffset + searchInterfacePosition);\n    } else {\n      (<HTMLElement>scrollContainer).scrollTop = 0;\n    }\n  }\n\n  private static getActiveResultList(root: HTMLElement) {\n    const resultLists = ResultListUtils.getResultLists(root);\n    return find(resultLists, resultList => !resultList.disabled);\n  }\n\n  private static getResultLists(root: HTMLElement) {\n    return $$(root)\n      .findAll(`.${ResultListUtils.cssClass()}`)\n      .map(el => <ResultList>Component.get(el, ResultList));\n  }\n\n  private static cssClass() {\n    return Component.computeCssClassName(ResultList);\n  }\n\n  private static warnIfComponentNotNeeded(cmp: Component) {\n    const root = cmp.searchInterface.root;\n    const allListsUseInfiniteScroll = ResultListUtils.allResultListsUseInfiniteScroll(root);\n\n    allListsUseInfiniteScroll && ResultListUtils.notNeededComponentWarning(cmp);\n  }\n\n  private static allResultListsUseInfiniteScroll(root: HTMLElement) {\n    const listsWithInfiniteScrollDisabled = ResultListUtils.getResultLists(root).filter(\n      resultList => !resultList.options.enableInfiniteScroll\n    );\n\n    return listsWithInfiniteScrollDisabled.length === 0;\n  }\n\n  private static notNeededComponentWarning(cmp: Component) {\n    const cmpCssClass = Component.computeCssClassNameForType(cmp.type);\n    const message = `The ${cmpCssClass} component is not needed because all ${ResultListUtils.cssClass()} components have enableInfiniteScroll set to 'true'.\n    For the best performance, remove the ${cmpCssClass} component from your search page.`;\n\n    new Logger(cmp).warn(message);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/ResultListUtils.ts","import { Dom } from '../../utils/Dom';\nimport { ResponsiveDropdownContent } from './ResponsiveDropdown/ResponsiveDropdownContent';\n\nexport class ResponsiveComponentsUtils {\n  private static smallTabsClassName: string = 'coveo-small-tabs';\n  private static smallFacetClassName: string = 'coveo-small-facets';\n  private static smallRecommendationClassName: string = 'coveo-small-recommendation';\n\n  static shouldDrawFacetSlider(root: Dom, facetSliderElement: Dom): boolean {\n    return ResponsiveDropdownContent.isTargetInsideOpenedDropdown(facetSliderElement) || !this.isSmallFacetActivated(root);\n  }\n\n  static isSmallTabsActivated(root: Dom): boolean {\n    return root.hasClass(this.smallTabsClassName);\n  }\n\n  static isSmallFacetActivated(root: Dom): boolean {\n    return root.hasClass(this.smallFacetClassName);\n  }\n\n  static isSmallRecommendationActivated(root: Dom): boolean {\n    return root.hasClass(this.smallRecommendationClassName);\n  }\n\n  static activateSmallTabs(root: Dom): void {\n    root.addClass(this.smallTabsClassName);\n  }\n\n  static deactivateSmallTabs(root: Dom): void {\n    root.removeClass(this.smallTabsClassName);\n  }\n\n  static activateSmallFacet(root: Dom): void {\n    root.addClass(this.smallFacetClassName);\n  }\n\n  static deactivateSmallFacet(root: Dom): void {\n    root.removeClass(this.smallFacetClassName);\n  }\n\n  static activateSmallRecommendation(root: Dom): void {\n    root.addClass(this.smallRecommendationClassName);\n  }\n\n  static deactivateSmallRecommendation(root: Dom): void {\n    root.removeClass(this.smallRecommendationClassName);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveComponentsUtils.ts","import 'styling/DynamicFacet/_DynamicFacet';\nimport { IDynamicFacet, IDynamicFacetOptions } from './IDynamicFacet';\nimport { difference, findIndex } from 'underscore';\nimport { $$ } from '../../utils/Dom';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { Initialization } from '../Base/Initialization';\nimport { ResponsiveFacetOptions } from '../ResponsiveComponents/ResponsiveFacetOptions';\nimport { ResponsiveDynamicFacets } from '../ResponsiveComponents/ResponsiveDynamicFacets';\nimport { DynamicFacetBreadcrumbs } from './DynamicFacetBreadcrumbs';\nimport { DynamicFacetHeader } from './DynamicFacetHeader/DynamicFacetHeader';\nimport { DynamicFacetValues } from './DynamicFacetValues/DynamicFacetValues';\nimport { QueryEvents, IQuerySuccessEventArgs, IDoneBuildingQueryEventArgs } from '../../events/QueryEvents';\nimport { QueryStateModel } from '../../models/QueryStateModel';\nimport { DynamicFacetQueryController } from '../../controllers/DynamicFacetQueryController';\nimport { Utils } from '../../utils/Utils';\nimport { MODEL_EVENTS, IAttributesChangedEventArg } from '../../models/Model';\nimport { Assert } from '../../misc/Assert';\nimport { IFacetResponse } from '../../rest/Facet/FacetResponse';\nimport { IStringMap } from '../../rest/GenericParam';\nimport { isFacetSortCriteria, FacetSortCriteria } from '../../rest/Facet/FacetSortCriteria';\nimport { l } from '../../strings/Strings';\nimport { DeviceUtils } from '../../utils/DeviceUtils';\nimport { BreadcrumbEvents, IPopulateBreadcrumbEventArgs } from '../../events/BreadcrumbEvents';\nimport { IAnalyticsActionCause, analyticsActionCauseList, IAnalyticsFacetMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { IAnalyticsFacetState } from '../Analytics/IAnalyticsFacetState';\nimport { IQueryOptions } from '../../controllers/QueryController';\nimport { DynamicFacetManager } from '../DynamicFacetManager/DynamicFacetManager';\nimport { QueryBuilder } from '../Base/QueryBuilder';\nimport { DynamicFacetSearch } from '../DynamicFacetSearch/DynamicFacetSearch';\nimport { ResultListUtils } from '../../utils/ResultListUtils';\nimport { IQueryResults } from '../../rest/QueryResults';\nimport { FacetType } from '../../rest/Facet/FacetRequest';\nimport { DependsOnManager, IDependentFacet, IDependentFacetCondition } from '../../utils/DependsOnManager';\nimport { DynamicFacetValueCreator } from './DynamicFacetValues/DynamicFacetValueCreator';\nimport { Logger } from '../../misc/Logger';\nimport { FacetUtils } from '../Facet/FacetUtils';\n\n/**\n * The `DynamicFacet` component displays a *facet* of the results for the current query. A facet is a list of values for a\n * certain field occurring in the results, ordered using a configurable criteria (e.g., number of occurrences).\n *\n * The list of values is obtained using an array of [`FacetRequest`]{@link IFacetRequest} operations performed at the same time\n * as the main query.\n *\n * The `DynamicFacet` component allows the end-user to drill down inside a result set by restricting the result to certain\n * field values.\n *\n * This facet is more easy to use than the original [`Facet`]{@link Facet} component. It implements additional Coveo Machine Learning (Coveo ML) features\n * such as dynamic navigation experience (DNE).\n *\n * @notSupportedIn salesforcefree\n * @availablesince [May 2019 Release (v2.6063)](https://docs.coveo.com/en/2909/)\n */\nexport class DynamicFacet extends Component implements IDynamicFacet {\n  static ID = 'DynamicFacet';\n  static doExport = () => exportGlobally({ DynamicFacet });\n\n  /**\n   * The options for the DynamicFacet\n   * @componentOptions\n   */\n  static options: IDynamicFacetOptions = {\n    ...ResponsiveFacetOptions,\n\n    /**\n     * The unique identifier for this facet.\n     *\n     * Among other things, this is used to record and read the facet\n     * state in the URL fragment identifier (see the\n     * [`enableHistory`]{@link SearchInterface.options.enableHistory} `SearchInterface`\n     * option).\n     *\n     * **Tip:** When several facets in a given search interface are based on\n     * the same field, ensure that each of those facets has a distinct `id`.\n     *\n     * If specified, must contain between 1 and 60 characters.\n     * Only alphanumeric (A-Za-z0-9), underscore (_), and hyphen (-) characters are kept; other characters are automatically removed.\n     *\n     * Defaults to the [`field`]{@link DynamicFacet.options.field} option value.\n     *\n     * @examples author-facet\n     */\n    id: ComponentOptions.buildStringOption({\n      postProcessing: (value = '', options: IDynamicFacetOptions) => {\n        const maxCharLength = 60;\n        const sanitizedValue = value.replace(/[^A-Za-z0-9-_@]+/g, '');\n        if (Utils.isNonEmptyString(sanitizedValue)) {\n          return sanitizedValue.slice(0, maxCharLength - 1);\n        }\n\n        return options.field.slice(0, maxCharLength - 1);\n      },\n      section: 'CommonOptions'\n    }),\n\n    /**\n     * The title to display for this facet.\n     *\n     * Defaults to the localized string for `NoTitle`.\n     *\n     * @examples Author\n     */\n    title: ComponentOptions.buildLocalizedStringOption({\n      localizedString: () => l('NoTitle'),\n      section: 'CommonOptions',\n      priority: 10\n    }),\n\n    /**\n     * The name of the field on which to base this facet.\n     *\n     * Must be prefixed by `@`, and must reference an existing field whose\n     * **Facet** option is enabled.\n     *\n     * @externaldocs [Add or Edit Fields](https://docs.coveo.com/en/1982/)\n     * @examples @author\n     */\n    field: ComponentOptions.buildFieldOption({ required: true, section: 'CommonOptions' }),\n\n    /**\n     * The sort criterion to use for this facet.\n     *\n     * See [`FacetSortCriteria`]{@link FacetSortCriteria} for the list and\n     * description of allowed values.\n     *\n     * By default, the following behavior applies:\n     *\n     * - If the requested [`numberOfValues`]{@link DynamicFacet.options.numberOfValues}\n     * is greater than or equal to the currently displayed number of values,\n     * the [`alphanumeric`]{@link FacetSortCriteria.alphanumeric} criterion is\n     * used.\n     * - If the requested `numberOfValues` is less than the currently displayed\n     * number of values and the facet is not currently expanded, the [`score`]{@link FacetSortCriteria.score}\n     * criterion is used.\n     * - Otherwise, the `alphanumeric` criterion is used.\n     *\n     * @examples score\n     */\n    sortCriteria: <FacetSortCriteria>ComponentOptions.buildStringOption({\n      postProcessing: value => {\n        if (!value) {\n          return undefined;\n        }\n\n        if (isFacetSortCriteria(value)) {\n          return value;\n        }\n\n        new Logger(value).warn('sortCriteria is not of the the allowed values: \"score\", \"alphanumeric\", \"occurrences\"');\n        return undefined;\n      },\n      section: 'Sorting'\n    }),\n\n    /**\n     * The number of values to request for this facet.\n     *\n     * Also determines the default maximum number of additional values to request each time this facet is expanded,\n     * and the maximum number of values to display when this facet is collapsed (see the [`enableCollapse`]{@link DynamicFacet.options.enableCollapse} option).\n     */\n    numberOfValues: ComponentOptions.buildNumberOption({ min: 0, defaultValue: 8, section: 'CommonOptions' }),\n\n    /**\n     * Whether to allow the end-user to expand and collapse this facet.\n     */\n    enableCollapse: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'CommonOptions' }),\n\n    /**\n     * Whether to scroll back to the top of the page whenever the end-user interacts with the facet.\n     */\n    enableScrollToTop: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'CommonOptions' }),\n\n    /**\n     * Whether to enable the **Show more** and **Show less** buttons in the facet.\n     *\n     * **Note:** The [`DynamicFacetRange`]{@link DynamicFacetRange} component does not support this option.\n     */\n    enableMoreLess: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'CommonOptions' }),\n\n    /**\n     * Whether to allow the end-user to search the facet values.\n     *\n     * **Note:** The [`DynamicFacetRange`]{@link DynamicFacetRange} component does not support this option.\n     *\n     * By default, the following behavior applies:\n     *\n     * - Enabled when more facet values are available.\n     * - Disabled when all available facet values are already displayed.\n     */\n    enableFacetSearch: ComponentOptions.buildBooleanOption({ section: 'Filtering' }),\n\n    /**\n     * Whether to prepend facet search queries with a wildcard.\n     *\n     * **Note:** The [`DynamicFacetRange`]{@link DynamicFacetRange} component does not support this option.\n     */\n    useLeadingWildcardInFacetSearch: ComponentOptions.buildBooleanOption({\n      defaultValue: true,\n      section: 'Filtering',\n      depend: 'enableFacetSearch'\n    }),\n\n    /**\n     * Whether this facet should be collapsed by default.\n     */\n    collapsedByDefault: ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'CommonOptions', depend: 'enableCollapse' }),\n\n    /**\n     * Whether to notify the [`Breadcrumb`]{@link Breadcrumb} component when toggling values in the facet.\n     *\n     * See also the [`numberOfValuesInBreadcrumb`]{@link DynamicFacet.options.numberOfValuesInBreadcrumb} option.\n     */\n    includeInBreadcrumb: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'CommonOptions' }),\n\n    /**\n     * The maximum number of selected values the [`Breadcrumb`]{@link Breadcrumb} component can display before outputting a **N more...** link for the facet.\n     */\n    numberOfValuesInBreadcrumb: ComponentOptions.buildNumberOption({\n      defaultFunction: () => (DeviceUtils.isMobileDevice() ? 3 : 5),\n      min: 0,\n      depend: 'includeInBreadcrumb',\n      section: 'CommonOptions'\n    }),\n\n    /**\n     * A mapping of facet values to their desired captions.\n     *\n     * **Note:** The [`DynamicFacetRange`]{@link DynamicFacetRange} component does not support this option.\n     *\n     * @externaldocs [Normalizing Facet Value Captions](https://docs.coveo.com/368/).\n     * @examples { \"smith_alice\": \"Alice Smith\"\\, \"jones_bob_r\": \"Bob R. Jones\" }\n     */\n    valueCaption: ComponentOptions.buildJsonOption<IStringMap<string>>({ defaultValue: {} }),\n\n    /**\n     * The [`id`]{@link DynamicFacet.options.id} of another facet in which at least one value must be selected in order for the dependent facet to be visible.\n     *\n     * By default, the facet does not depend on any other facet to be displayed.\n     *\n     * @examples document-type-facet\n     *\n     * @availablesince [December 2019 Release (v2.7610)](https://docs.coveo.com/en/3142/)\n     */\n    dependsOn: ComponentOptions.buildStringOption({ section: 'CommonOptions' }),\n\n    /**\n     * A function that verifies whether the current state of the `dependsOn` facet allows the dependent facet to be displayed.\n     *\n     * If specified, the function receives a reference to the resolved `dependsOn` facet component instance as an argument, and must return a boolean.\n     * The function's argument should typically be treated as read-only.\n     *\n     * By default, the dependent facet is displayed whenever one or more values are selected in its `dependsOn` facet.\n     *\n     * @externaldocs [Defining Dependent Facets](https://docs.coveo.com/3210/)\n     *\n     * @availablesince [April 2020 Release (v2.8864)](https://docs.coveo.com/en/3231/)\n     */\n    dependsOnCondition: ComponentOptions.buildCustomOption<IDependentFacetCondition>(\n      () => {\n        return null;\n      },\n      { depend: 'dependsOn', section: 'CommonOptions' }\n    ),\n\n    /**\n     * The number of items to scan for facet values.\n     *\n     * Setting this option to a higher value may enhance the accuracy of facet value counts at the cost of slower query performance.\n     *\n     * @availablesince [January 2020 Release (v2.7968)](https://docs.coveo.com/en/3163/)\n     */\n    injectionDepth: ComponentOptions.buildNumberOption({ defaultValue: 1000, min: 0 }),\n\n    /**\n     * Whether to exclude folded result parents when estimating result counts for facet values.\n     *\n     * See also the [`Folding`]{@link Folding} and [`FoldingForThread`]{@link FoldingForThread} components.\n     *\n     * **Default:** `false` if folded results are requested; `true` otherwise.\n     *\n     * @availablesince [March 2020 Release (v2.8521)](https://docs.coveo.com/en/3203/)\n     */\n    filterFacetCount: ComponentOptions.buildBooleanOption({ section: 'Filtering' })\n  };\n\n  private includedAttributeId: string;\n  private listenToQueryStateChange = true;\n  private search: DynamicFacetSearch;\n  public header: DynamicFacetHeader;\n\n  public options: IDynamicFacetOptions;\n  public dynamicFacetManager: DynamicFacetManager;\n  public dependsOnManager: DependsOnManager;\n  public dynamicFacetQueryController: DynamicFacetQueryController;\n  public values: DynamicFacetValues;\n  public position: number;\n  public moreValuesAvailable = false;\n  public isCollapsed: boolean;\n  public isDynamicFacet = true;\n  public isFieldValueCompatible = true;\n\n  /**\n   * Creates a new `DynamicFacet` instance.\n   *\n   * @param element The element from which to instantiate the component.\n   * @param options The component options.\n   * @param bindings The component bindings. Automatically resolved by default.\n   */\n  constructor(\n    public element: HTMLElement,\n    options?: IDynamicFacetOptions,\n    bindings?: IComponentBindings,\n    classId: string = DynamicFacet.ID\n  ) {\n    super(element, classId, bindings);\n    this.options = ComponentOptions.initComponentOptions(element, DynamicFacet, options);\n\n    this.initDynamicFacetQueryController();\n    this.initDependsOnManager();\n    this.initQueryEvents();\n    this.initQueryStateEvents();\n    this.initBreadCrumbEvents();\n    this.initComponentStateEvents();\n    this.initValues();\n    this.verifyCollapsingConfiguration();\n    this.isCollapsed = this.options.enableCollapse && this.options.collapsedByDefault;\n\n    ResponsiveDynamicFacets.init(this.root, this, this.options);\n  }\n\n  public get fieldName() {\n    return this.options.field.slice(1);\n  }\n\n  public get facetType() {\n    return FacetType.specific;\n  }\n\n  /**\n   * Selects a single value in this facet.\n   *\n   * Does **not** trigger a query automatically.\n   * Does **not** update the visual of the facet until a query is performed.\n   *\n   * @param value The name of the facet value to select.\n   */\n  public selectValue(value: string) {\n    Assert.exists(value);\n    this.selectMultipleValues([value]);\n  }\n\n  /**\n   * Selects multiple values in this facet.\n   *\n   * Does **not** trigger a query automatically.\n   * Does **not** update the visual of the facet until a query is performed.\n   *\n   * @param values The names of the facet values to select.\n   */\n  public selectMultipleValues(values: string[]) {\n    Assert.exists(values);\n    this.ensureDom();\n    this.logger.info('Selecting facet value(s)', values);\n    values.forEach(value => {\n      this.values.get(value).select();\n    });\n    this.updateQueryStateModel();\n  }\n\n  /**\n   * Deselects a single value in this facet.\n   *\n   * Does **not** trigger a query automatically.\n   * Does **not** update the visual of the facet until a query is performed.\n   *\n   * @param values The name of the facet value to deselect.\n   */\n  public deselectValue(value: string) {\n    Assert.exists(value);\n    this.deselectMultipleValues([value]);\n  }\n\n  /**\n   * Determines whether the specified value is selected in the facet.\n   * @param value The name of the facet value to verify.\n   */\n  public hasSelectedValue(value: string) {\n    return this.values.hasSelectedValue(value);\n  }\n\n  /**\n   * Deselects multiple values in this facet.\n   *\n   * Does **not** trigger a query automatically.\n   * Does **not** update the visual of the facet until a query is performed.\n   *\n   * @param values The names of the facet values to deselect.\n   */\n  public deselectMultipleValues(values: string[]) {\n    Assert.exists(values);\n    this.ensureDom();\n    this.logger.info('Deselecting facet value(s)', values);\n    values.forEach(value => {\n      this.values.get(value).deselect();\n    });\n    this.updateQueryStateModel();\n  }\n\n  /**\n   * Toggles the selection state of a single value in this facet.\n   *\n   * Does **not** trigger a query automatically.\n   *\n   * @param values The name of the facet value to toggle.\n   */\n  public toggleSelectValue(value: string) {\n    Assert.exists(value);\n    this.ensureDom();\n    const facetValue = this.values.get(value);\n    facetValue.toggleSelect();\n    this.logger.info('Toggle select facet value', facetValue);\n    this.updateQueryStateModel();\n  }\n\n  /**\n   * Returns the configured caption for a desired facet value.\n   *\n   * @param value The string facet value whose caption the method should return.\n   */\n  public getCaptionForStringValue(value: string) {\n    return FacetUtils.getDisplayValueFromValueCaption(value, this.options.field as string, this.options.valueCaption);\n  }\n\n  /**\n   * Requests additional values.\n   *\n   * Automatically triggers an isolated query.\n   * @param additionalNumberOfValues The number of additional values to request. Minimum value is 1. Defaults to the [numberOfValues]{@link DynamicFacet.options.numberOfValues} option value.\n   */\n  public showMoreValues(additionalNumberOfValues = this.options.numberOfValues) {\n    this.ensureDom();\n    this.logger.info('Show more values');\n    this.dynamicFacetQueryController.increaseNumberOfValuesToRequest(additionalNumberOfValues);\n    this.triggerNewIsolatedQuery(() => this.logAnalyticsFacetShowMoreLess(analyticsActionCauseList.dynamicFacetShowMore));\n  }\n\n  /**\n   * Reduces the number of displayed facet values down to [numberOfValues]{@link DynamicFacet.options.numberOfValues}.\n   *\n   * Automatically triggers an isolated query.\n   */\n  public showLessValues() {\n    this.ensureDom();\n    this.logger.info('Show less values');\n    this.dynamicFacetQueryController.resetNumberOfValuesToRequest();\n    this.triggerNewIsolatedQuery(() => this.logAnalyticsFacetShowMoreLess(analyticsActionCauseList.dynamicFacetShowLess));\n  }\n\n  /**\n   * Deselects all values in this facet.\n   *\n   * Does **not** trigger a query automatically.\n   * Updates the visual of the facet.\n   *\n   */\n  public reset() {\n    this.ensureDom();\n    if (this.values.hasActiveValues) {\n      this.logger.info('Deselect all values');\n      this.values.clearAll();\n      this.values.render();\n    }\n    this.enablePreventAutoSelectionFlag();\n    this.updateAppearance();\n    this.updateQueryStateModel();\n  }\n\n  /**\n   * Collapses or expands the facet depending on it's current state.\n   */\n  public toggleCollapse() {\n    this.isCollapsed ? this.expand() : this.collapse();\n  }\n\n  /**\n   * Expands the facet, displaying all of its currently fetched values.\n   */\n  public expand() {\n    if (!this.options.enableCollapse) {\n      return this.logger.warn(`Calling expand() won't do anything on a facet that has the option \"enableCollapse\" set to \"false\"`);\n    }\n    if (!this.isCollapsed) {\n      return;\n    }\n    this.ensureDom();\n    this.logger.info('Expand facet values');\n    this.isCollapsed = false;\n    this.updateAppearance();\n  }\n\n  /**\n   * Collapses the facet, displaying only its currently selected values.\n   */\n  public collapse() {\n    if (!this.options.enableCollapse) {\n      return this.logger.warn(`Calling collapse() won't do anything on a facet that has the option \"enableCollapse\" set to \"false\"`);\n    }\n    if (this.isCollapsed) {\n      return;\n    }\n    this.ensureDom();\n    this.logger.info('Collapse facet values');\n    this.isCollapsed = true;\n    this.updateAppearance();\n  }\n\n  /**\n   * Sets a flag indicating whether the facet values should be returned in their current order.\n   *\n   * Setting the flag to `true` helps ensuring that the values do not move around while the end-user is interacting with them.\n   *\n   * The flag is automatically set back to `false` after a query is built.\n   */\n  public enableFreezeCurrentValuesFlag() {\n    this.dynamicFacetQueryController.enableFreezeCurrentValuesFlag();\n  }\n\n  /**\n   * For this method to work, the component has to be the child of a [DynamicFacetManager]{@link DynamicFacetManager} component.\n   *\n   * Sets a flag indicating whether the facets should be returned in their current order.\n   *\n   * Setting the flag to `true` helps ensuring that the facets do not move around while the end-user is interacting with them.\n   *\n   * The flag is automatically set back to `false` after a query is built.\n   */\n  public enableFreezeFacetOrderFlag() {\n    this.dynamicFacetQueryController.enableFreezeFacetOrderFlag();\n  }\n\n  public enablePreventAutoSelectionFlag() {\n    this.dynamicFacetQueryController.enablePreventAutoSelectionFlag();\n  }\n\n  public scrollToTop() {\n    if (this.options.enableScrollToTop) {\n      ResultListUtils.scrollToTop(this.root);\n    }\n  }\n\n  public get analyticsFacetState(): IAnalyticsFacetState[] {\n    return this.values.activeValues.map(facetValue => facetValue.analyticsFacetState);\n  }\n\n  public get basicAnalyticsFacetState(): IAnalyticsFacetState {\n    return {\n      field: this.options.field.toString(),\n      id: this.options.id,\n      title: this.options.title,\n      facetType: this.facetType,\n      facetPosition: this.position\n    };\n  }\n\n  public get basicAnalyticsFacetMeta(): IAnalyticsFacetMeta {\n    return {\n      facetField: this.options.field.toString(),\n      facetId: this.options.id,\n      facetTitle: this.options.title\n    };\n  }\n\n  public logAnalyticsEvent(actionCause: IAnalyticsActionCause, facetMeta: IAnalyticsFacetMeta) {\n    this.usageAnalytics.logSearchEvent<IAnalyticsFacetMeta>(actionCause, facetMeta);\n  }\n\n  public putStateIntoQueryBuilder(queryBuilder: QueryBuilder) {\n    Assert.exists(queryBuilder);\n    this.dynamicFacetQueryController.putFacetIntoQueryBuilder(queryBuilder);\n  }\n\n  public putStateIntoAnalytics() {\n    const pendingEvent = this.usageAnalytics.getPendingSearchEvent();\n    pendingEvent && pendingEvent.addFacetState(this.analyticsFacetState);\n  }\n\n  public isCurrentlyDisplayed() {\n    return $$(this.element).isVisible();\n  }\n\n  public get hasActiveValues() {\n    return this.values.hasActiveValues;\n  }\n\n  private initQueryEvents() {\n    this.bind.onRootElement(QueryEvents.duringQuery, () => this.ensureDom());\n    this.bind.onRootElement(QueryEvents.doneBuildingQuery, (data: IDoneBuildingQueryEventArgs) => this.handleDoneBuildingQuery(data));\n    this.bind.onRootElement(QueryEvents.deferredQuerySuccess, (data: IQuerySuccessEventArgs) => this.handleQuerySuccess(data.results));\n    this.bind.onRootElement(QueryEvents.queryError, () => this.onNoValues());\n  }\n\n  private initQueryStateEvents() {\n    this.includedAttributeId = QueryStateModel.getFacetId(this.options.id);\n    this.queryStateModel.registerNewAttribute(this.includedAttributeId, []);\n    this.bind.onQueryState(MODEL_EVENTS.CHANGE, undefined, this.handleQueryStateChanged);\n  }\n\n  protected initBreadCrumbEvents() {\n    if (this.options.includeInBreadcrumb) {\n      this.bind.onRootElement(BreadcrumbEvents.populateBreadcrumb, (args: IPopulateBreadcrumbEventArgs) =>\n        this.handlePopulateBreadcrumb(args)\n      );\n      this.bind.onRootElement(BreadcrumbEvents.clearBreadcrumb, () => this.reset());\n    }\n  }\n\n  protected initValues() {\n    this.values = new DynamicFacetValues(this, DynamicFacetValueCreator);\n  }\n\n  private initComponentStateEvents() {\n    const componentStateId = QueryStateModel.getFacetId(this.options.id);\n    this.componentStateModel.registerComponent(componentStateId, this);\n  }\n\n  protected initDynamicFacetQueryController() {\n    this.dynamicFacetQueryController = new DynamicFacetQueryController(this);\n  }\n\n  private handleDoneBuildingQuery(data: IDoneBuildingQueryEventArgs) {\n    // If there is a DynamicFacetManager, it will take care of adding the facet's state\n    if (this.dynamicFacetManager) {\n      return;\n    }\n\n    Assert.exists(data);\n    Assert.exists(data.queryBuilder);\n    this.putStateIntoQueryBuilder(data.queryBuilder);\n    this.putStateIntoAnalytics();\n  }\n\n  private handleQuerySuccess(results: IQueryResults) {\n    // If there is a DynamicFacetManager, it will take care of handling the results\n    if (this.dynamicFacetManager) {\n      return;\n    }\n\n    if (Utils.isNullOrUndefined(results.facets)) {\n      return this.notImplementedError();\n    }\n\n    this.handleQueryResults(results);\n  }\n\n  public handleQueryResults(results: IQueryResults) {\n    const index = findIndex(results.facets, { facetId: this.options.id });\n    const facetResponse = index !== -1 ? results.facets[index] : null;\n\n    this.position = facetResponse ? index + 1 : undefined;\n    facetResponse ? this.onNewValues(facetResponse) : this.onNoValues();\n\n    this.header.hideLoading();\n    this.updateQueryStateModel();\n    this.values.render();\n    this.updateAppearance();\n  }\n\n  private onNewValues(facetResponse: IFacetResponse) {\n    this.moreValuesAvailable = facetResponse.moreValuesAvailable;\n    this.values.createFromResponse(facetResponse);\n  }\n\n  private onNoValues() {\n    this.moreValuesAvailable = false;\n    this.values.resetValues();\n  }\n\n  private handleQueryStateChanged(data: IAttributesChangedEventArg) {\n    if (!this.listenToQueryStateChange) {\n      return;\n    }\n\n    const querySelectedValues: string[] = data.attributes[this.includedAttributeId];\n    if (!querySelectedValues) {\n      return;\n    }\n\n    this.handleQueryStateChangedIncluded(querySelectedValues);\n  }\n\n  private handleQueryStateChangedIncluded = (querySelectedValues: string[]) => {\n    const currentSelectedValues = this.values.selectedValues;\n    const validQuerySelectedValues = querySelectedValues.filter(value => this.values.get(value));\n\n    const valuesToSelect = difference(validQuerySelectedValues, currentSelectedValues);\n    const valuesToDeselect = difference(currentSelectedValues, validQuerySelectedValues);\n\n    if (Utils.isNonEmptyArray(valuesToSelect)) {\n      this.selectMultipleValues(valuesToSelect);\n    }\n\n    if (Utils.isNonEmptyArray(valuesToDeselect)) {\n      this.deselectMultipleValues(valuesToDeselect);\n    }\n  };\n\n  private handlePopulateBreadcrumb(args: IPopulateBreadcrumbEventArgs) {\n    Assert.exists(args);\n\n    if (!this.values.hasActiveValues) {\n      return;\n    }\n\n    const breadcrumbs = new DynamicFacetBreadcrumbs(this);\n    args.breadcrumbs.push({ element: breadcrumbs.element });\n  }\n\n  private initDependsOnManager() {\n    const facetInfo: IDependentFacet = {\n      reset: () => this.reset(),\n      ref: this\n    };\n\n    this.dependsOnManager = new DependsOnManager(facetInfo);\n  }\n\n  public createDom() {\n    this.createAndAppendContent();\n    this.updateAppearance();\n  }\n\n  private createAndAppendContent() {\n    this.createAndAppendHeader();\n    this.createAndAppendSearch();\n    this.createAndAppendValues();\n  }\n\n  private createAndAppendHeader() {\n    this.header = new DynamicFacetHeader({\n      title: this.options.title,\n      enableCollapse: this.options.enableCollapse,\n      clear: () => this.clear(),\n      toggleCollapse: () => this.toggleCollapse(),\n      collapse: () => this.collapse(),\n      expand: () => this.expand()\n    });\n    this.element.appendChild(this.header.element);\n  }\n\n  private createAndAppendSearch() {\n    if (this.options.enableFacetSearch === false) {\n      return;\n    }\n\n    this.search = new DynamicFacetSearch(this);\n    this.element.appendChild(this.search.element);\n  }\n\n  private createAndAppendValues() {\n    this.element.appendChild(this.values.render());\n  }\n\n  private updateQueryStateModel() {\n    this.listenToQueryStateChange = false;\n    this.queryStateModel.set(this.includedAttributeId, this.values.selectedValues);\n    this.listenToQueryStateChange = true;\n  }\n\n  private updateAppearance() {\n    this.header.toggleClear(this.values.hasSelectedValues);\n    this.header.toggleCollapse(this.isCollapsed);\n    this.toggleSearchDisplay();\n    $$(this.element).toggleClass('coveo-dynamic-facet-collapsed', this.isCollapsed);\n    $$(this.element).toggleClass('coveo-active', this.values.hasSelectedValues);\n    $$(this.element).toggleClass('coveo-hidden', !this.values.hasDisplayedValues);\n  }\n\n  private toggleSearchDisplay() {\n    if (this.options.enableFacetSearch === false) {\n      return;\n    }\n\n    if (this.isCollapsed) {\n      return $$(this.search.element).toggleClass('coveo-hidden', true);\n    }\n\n    $$(this.search.element).toggleClass('coveo-hidden', !this.options.enableFacetSearch && !this.moreValuesAvailable);\n  }\n\n  public triggerNewQuery(beforeExecuteQuery?: () => void) {\n    this.beforeSendingQuery();\n\n    const options: IQueryOptions = beforeExecuteQuery ? { beforeExecuteQuery } : { ignoreWarningSearchEvent: true };\n\n    this.queryController.executeQuery(options);\n  }\n\n  public async triggerNewIsolatedQuery(beforeExecuteQuery?: () => void) {\n    this.beforeSendingQuery();\n    beforeExecuteQuery && beforeExecuteQuery();\n\n    try {\n      const results = await this.dynamicFacetQueryController.getQueryResults();\n      this.handleQueryResults(results);\n    } catch (e) {\n      this.header.hideLoading();\n    }\n  }\n\n  private beforeSendingQuery() {\n    this.header.showLoading();\n  }\n\n  private notImplementedError() {\n    this.logger.error('DynamicFacets are not supported by your current search endpoint. Disabling this component.');\n    this.disable();\n    this.updateAppearance();\n  }\n\n  private verifyCollapsingConfiguration() {\n    if (this.options.collapsedByDefault && !this.options.enableCollapse) {\n      this.logger.warn('The \"collapsedByDefault\" option is \"true\" while the \"enableCollapse\" is \"false\"');\n    }\n  }\n\n  private logAnalyticsFacetShowMoreLess(cause: IAnalyticsActionCause) {\n    this.usageAnalytics.logCustomEvent<IAnalyticsFacetMeta>(cause, this.basicAnalyticsFacetMeta, this.element);\n  }\n\n  private clear() {\n    this.reset();\n    this.enableFreezeFacetOrderFlag();\n    this.scrollToTop();\n    this.triggerNewQuery(() => this.logClearAllToAnalytics());\n  }\n\n  private logClearAllToAnalytics() {\n    this.logAnalyticsEvent(analyticsActionCauseList.dynamicFacetClearAll, this.basicAnalyticsFacetMeta);\n  }\n}\n\nInitialization.registerAutoCreateComponent(DynamicFacet);\nDynamicFacet.doExport();\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacet.ts","import { isFunction } from 'underscore';\nimport { QueryStateModel, QueryEvents, Component } from '../Core';\nimport { MODEL_EVENTS } from '../models/Model';\nimport { ComponentsTypes } from './ComponentsTypes';\nimport { $$ } from './Dom';\nimport { InitializationEvents } from '../events/InitializationEvents';\n\nexport interface IDependsOnCompatibleFacetOptions {\n  id?: string;\n  dependsOn?: string;\n  dependsOnCondition?: IDependentFacetCondition;\n}\n\nexport interface IDependsOnCompatibleFacet extends Component {\n  options: IDependsOnCompatibleFacetOptions;\n}\n\nexport interface IDependentFacet {\n  reset: () => void;\n  ref: IDependsOnCompatibleFacet;\n}\n\nexport interface IDependentFacetCondition {\n  (facet: IDependsOnCompatibleFacet): boolean;\n}\n\nexport class DependsOnManager {\n  private parentFacetRef: IDependsOnCompatibleFacet;\n\n  constructor(private facet: IDependentFacet) {\n    this.facet.ref.bind.onRootElement(QueryEvents.buildingQuery, () => this.handleBuildingQuery());\n\n    if (this.getDependsOn(this.facet.ref)) {\n      this.facet.ref.bind.onRootElement(InitializationEvents.afterComponentsInitialization, () => this.setupDependentFacet());\n    }\n  }\n\n  private setupDependentFacet() {\n    $$(this.facet.ref.element).addClass('coveo-hidden');\n    this.parentFacetRef = this.getParentFacet(this.facet.ref);\n\n    if (this.parentFacetRef) {\n      this.facet.ref.bind.onQueryState(MODEL_EVENTS.CHANGE, undefined, () => this.resetIfConditionUnfullfiled());\n    }\n  }\n\n  private resetIfConditionUnfullfiled() {\n    const condition = this.getDependsOnCondition(this.facet.ref);\n\n    if (!condition(this.parentFacetRef)) {\n      this.facet.reset();\n    }\n  }\n\n  private getId(component: IDependsOnCompatibleFacet) {\n    const id = component.options.id;\n    return id ? `${id}` : null;\n  }\n\n  private getDependsOn(component: IDependsOnCompatibleFacet) {\n    const dependsOn = component.options.dependsOn;\n    return dependsOn ? `${dependsOn}` : null;\n  }\n\n  private getDependsOnCondition(component: IDependsOnCompatibleFacet): IDependentFacetCondition {\n    const conditionOption = component.options.dependsOnCondition;\n    return conditionOption && isFunction(conditionOption) ? conditionOption : () => this.parentHasSelectedValues(component);\n  }\n\n  private parentHasSelectedValues(component: IDependsOnCompatibleFacet) {\n    const parent = this.getParentFacet(component);\n    return parent && this.valuesExistForFacetWithId(this.getId(parent));\n  }\n\n  private valuesExistForFacetWithId(facetId: string) {\n    const values = this.facet.ref.queryStateModel.get(QueryStateModel.getFacetId(facetId));\n    return !!values && !!values.length;\n  }\n\n  private get allFacetsInInterface() {\n    return ComponentsTypes.getAllFacetsFromSearchInterface(this.facet.ref.searchInterface) as IDependsOnCompatibleFacet[];\n  }\n\n  private getParentFacet(component: IDependsOnCompatibleFacet) {\n    const parent = this.allFacetsInInterface.filter(\n      potentialParentFacet => this.getId(potentialParentFacet) === this.getDependsOn(component)\n    );\n\n    if (!parent.length) {\n      component.logger.warn('DependsOn reference does not exist', this.getDependsOn(this.facet.ref));\n      return null;\n    }\n\n    return parent[0];\n  }\n\n  private get dependentFacets() {\n    return this.allFacetsInInterface.filter(\n      potentialDependentFacet => this.getId(this.facet.ref) === this.getDependsOn(potentialDependentFacet)\n    );\n  }\n\n  private handleBuildingQuery() {\n    this.dependentFacets.forEach(dependentFacet => {\n      const condition = this.getDependsOnCondition(dependentFacet);\n      if (condition(this.facet.ref)) {\n        $$(dependentFacet.element).removeClass('coveo-hidden');\n        return dependentFacet.enable();\n      }\n\n      dependentFacet.disable();\n      $$(dependentFacet.element).addClass('coveo-hidden');\n    });\n  }\n\n  public get hasDependentFacets() {\n    return !!this.dependentFacets.length;\n  }\n\n  public get dependentFacetsHaveSelectedValues() {\n    return this.dependentFacets.some(dependentFacet => this.valuesExistForFacetWithId(this.getId(dependentFacet)));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/DependsOnManager.ts","import { Component } from '../Base/Component';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Utils } from '../../Core';\nimport { Initialization } from '../Base/Initialization';\n\nexport interface IFacetsMobileModeOptions {\n  breakpoint?: number;\n  isModal?: boolean;\n  displayOverlayWhileOpen?: boolean;\n  preventScrolling?: boolean;\n  scrollContainer?: HTMLElement;\n}\n\n/**\n * This component lets you customize the mobile responsive behavior of facets in your search interface.\n *\n * **Notes:**\n * - You can include this component anywhere under the root element of your search interface.\n * - You should only include this component once in your search interface.\n * - If you do not include this component in your search interface, facets will still have a default mobile responsive behavior.\n */\nexport class FacetsMobileMode extends Component {\n  static ID = 'FacetsMobileMode';\n\n  /**\n   * @componentOptions\n   */\n  static options: IFacetsMobileModeOptions = {\n    /**\n     * The screen width (in number of pixels) at which facets should enter mobile responsive mode and be collapsed under a single button.\n     *\n     * **Default:** `800`\n     */\n    breakpoint: ComponentOptions.buildNumberOption(),\n    /**\n     * Whether to display the facets in a modal instead of a pop-up when the end user expands them in mobile responsive mode.\n     */\n    isModal: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n    /**\n     * Whether to display an overlay behind the facets when the end user expands them in mobile responsive mode.\n     *\n     * By default, the following behavior applies:\n     * - `true` when [isModal]{@link FacetsMobileMode.options.isModal} is `false`\n     * - `false` when [isModal]{@link FacetsMobileMode.options.isModal} is `true`\n     */\n    displayOverlayWhileOpen: ComponentOptions.buildBooleanOption({\n      postProcessing: (value, options: IFacetsMobileModeOptions) => (Utils.isNullOrUndefined(value) ? !options.isModal : value)\n    }),\n    /**\n     * Whether to disable vertical scrolling on the specified or resolved [`scrollContainer`]{@link FacetsMobileMode.options.scrollContainer} while facets are expanded in mobile responsive mode.\n     *\n     * By default, the following behavior applies:\n     * - `true` when [isModal]{@link FacetsMobileMode.options.isModal} is `true`\n     * - `false` when [isModal]{@link FacetsMobileMode.options.isModal} is `false`\n     */\n    preventScrolling: ComponentOptions.buildBooleanOption({\n      postProcessing: (value, options: IFacetsMobileModeOptions) => (Utils.isNullOrUndefined(value) ? options.isModal : value)\n    }),\n    /**\n     * The HTML element whose vertical scrolling should be locked while facets are expanded in mobile responsive mode.\n     *\n     * By default, the component tries to detect and use the first ancestor element whose CSS `overflow-y` attribute is set to `scroll`, starting from the `FacetsMobileMode`'s element itself. If no such element is found, the `document.body` element is used.\n     *\n     * Since this heuristic is not perfect, we strongly recommend that you manually set this option by explicitly specifying the desired CSS selector.\n     *\n     * **Example:** `data-scroll-container-selector='#someCssSelector'`\n     */\n    scrollContainer: ComponentOptions.buildChildHtmlElementOption({ depend: 'preventScrolling' })\n  };\n\n  static doExport = () => {\n    exportGlobally({\n      FacetsMobileMode: FacetsMobileMode\n    });\n  };\n\n  public options: IFacetsMobileModeOptions;\n\n  constructor(public element: HTMLElement, options?: IFacetsMobileModeOptions, bindings?: IComponentBindings) {\n    super(element, FacetsMobileMode.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, FacetsMobileMode, options);\n    if (this.options.preventScrolling) {\n      const scrollContainer = this.options.scrollContainer || this.searchInterface.element;\n      this.options.scrollContainer = ComponentOptions.findParentScrollLockable(scrollContainer);\n    }\n  }\n}\n\nInitialization.registerAutoCreateComponent(FacetsMobileMode);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/FacetsMobileMode/FacetsMobileMode.ts","import { FacetValueState } from './FacetValueState';\nimport { FacetSortCriteria } from './FacetSortCriteria';\nimport { IRangeValue } from '../RangeValue';\n\n/**\n * The allowed values for the [`facetType`]{@link IFacetRequest.facetType} property of a [facet request]{@link IFacetRequest}.\n */\nexport enum FacetType {\n  /**\n   * Request facet values representing specific values.\n   */\n  specific = 'specific',\n  /**\n   * Request facet values representing ranges of numbers.\n   */\n  numericalRange = 'numericalRange',\n  /**\n   * Request facet values representing ranges of dates.\n   */\n  dateRange = 'dateRange',\n  /**\n   * Request facet values representing a hierarchy.\n   */\n  hierarchical = 'hierarchical'\n}\n\n/**\n * A [`currentValues`]{@link IFacetRequest.currentValues} item in a Search API\n * [facet request]{@link IFacetRequest}.\n */\nexport interface IFacetRequestValue extends IRangeValue {\n  /**\n   * The current facet value state in the search interface.\n   *\n   * **Default (Search API):** `idle`\n   */\n  state: FacetValueState;\n  /**\n   * **Required (Search API).** The facet value name.\n   */\n  value?: string;\n  /**\n   * Whether to prevent Coveo ML from automatically selecting the facet value.\n   *\n   * **Default:** `false`\n   */\n  preventAutoSelect?: boolean;\n  /**\n   * Whether to retrieve the children of this category facet value. Can only be used on leaf values in the request (i.e., values with no current children).\n   *\n   * **Default:** `false`\n   */\n  retrieveChildren?: boolean;\n  /**\n   * If [retrieveChildren]{@link IFacetRequestValue.retrieveChildren} is true, the maximum number of children to retrieve for this leaf value.\n   *\n   * **Default (Search API):** `0`\n   */\n  retrieveCount?: number;\n  /**\n   * The children of this category facet value.\n   * Each child is a full-fledged category facet value that may in turn have its own children and so forth,\n   * up to a maximum depth of 50 levels\n   */\n  children?: IFacetRequestValue[];\n}\n\n/**\n * A Search API facet request.\n */\nexport interface IFacetRequest {\n  /**\n   * The unique identifier of the facet in the search interface.\n   *\n   * **Note:** Must match `^[A-Za-z0-9-_]{1,60}$`.\n   *\n   * **Example:** `author-1`\n   */\n  facetId: string;\n\n  /**\n   * **Required (Search API).** The name of the field on which to base the\n   * facet request.\n   *\n   * **Note:** Must reference an index field whose **Facet** option is enabled.\n   *\n   * **Example:** `author`\n   */\n  field: string;\n\n  /**\n   * The kind of values to request for the facet.\n   *\n   * **Default (Search API):** [`Specific`]{@link FacetType.Specific}\n   */\n  type?: FacetType;\n\n  /**\n   * The sort criterion to apply to the returned facet values.\n   *\n   * **Default behavior (Search API):**\n   * - When [`isFieldExpanded`]{@link IFacetRequest.isFieldExpanded} is `false`\n   * in the facet request, and\n   * [`moreValuesAvailable`]{@link IFacetResponse.moreValuesAvailable} is\n   * `true` in the corresponding [facet response]{@link IFacetResponse}, use\n   * `score`.\n   * - Otherwise, use `alphanumeric`.\n   */\n  sortCriteria?: FacetSortCriteria;\n\n  /**\n   * The maximum number of facet values to fetch.\n   *\n   * **Note:** If\n   * [`freezeCurrentValues`]{@link IFacetRequest.freezeCurrentValues} is\n   * `true`, `numberOfValues` must be equal to the\n   * [`currentValues`]{@link IFacetRequest.currentValues} array length.\n   *\n   * **Default (Search API):** `8`\n   */\n  numberOfValues?: number;\n\n  /**\n   * The maximum number of items to scan for facet values.\n   *\n   * **Note:** A high `injectionDepth` may negatively impact the facet request\n   * performance.\n   *\n   * **Default (Search API):** `1000`\n   */\n  injectionDepth?: number;\n\n  /**\n   * Whether to include the facet request's\n   * [`currentValues`]{@link IFacetRequest.currentValues} in the corresponding\n   * [facet response]{@link IFacetResponse}'s\n   * [`values`]{@link IFacetResponse.values} array.\n   *\n   * **Note:** Setting this to `true` is useful to ensure that the facet does\n   * not move around while the end-user is interacting with it in the search\n   * interface.\n   *\n   * **Default (Search API):** `false`\n   */\n  freezeCurrentValues?: boolean;\n\n  /**\n   * The values displayed by the facet in the search interface at the moment of\n   * the request.\n   *\n   * See [IFacetRequestValue]{@link IFacetRequestValue}.\n   *\n   * **Default (Search API):** `[]`\n   */\n  currentValues?: IFacetRequestValue[];\n\n  /**\n   * Whether the facet is expanded in the search interface at the moment of the\n   * request.\n   *\n   * **Default (Search API):** `false`\n   */\n  isFieldExpanded?: boolean;\n\n  /**\n   * Whether to automatically generate range values for the facet.\n   *\n   * **Notes:**\n   * - Setting this to `true` is only effective when [`type`]{@link IFacetRequest.type} is set to [`dateRange`]{@link FaceType.dateRange}\n   * or [`numericalRange`]{@link FacetType.numericalRange}, and the referenced [`field`]{@link IFacetRequest.field} is of a corresponding type (i.e., date or numeric).\n   * - Automatic range generation will fail if the referenced `field` is dynamically generated by a query function.\n   * - Enabling the **Use cache for numeric queries** option on the referenced `field` will speed up automatic range generation (see [Add or Edit Fields](https://docs.coveo.com/en/1982/)).\n   *\n   * **Default (Search API):** `false`\n   */\n  generateAutomaticRanges?: boolean;\n\n  /**\n   * The character to use to split field values into a hierarchical sequence.\n   *\n   * **Example:**\n   * For a multi-value field containing the following values: `c; c&gt;folder2; c&gt;folder2&gt;folder3;`\n   * The delimiting character is `&gt;`.\n   *\n   * **Default (Search API):** `;`\n   */\n  delimitingCharacter?: string;\n\n  /**\n   * Whether to exclude folded result parents when estimating result counts for facet values.\n   *\n   * **Default (Search API):** `true`\n   */\n  filterFacetCount?: boolean;\n\n  /**\n   * The base path shared by all values for a given hierarchical facet.\n   *\n   * **Default (Search API):** `[]`\n   */\n  basePath?: string[];\n\n  /**\n   * Whether to use the [`basePath`]{@link FacetRequest.basePath} as a filter for the results.\n   *\n   * **Note:** This parameter is ignored unless the facet [`type`]{@link FacetRequest.type} is `hierarchical`.\n   *\n   * **Default (Search API):** `true`\n   */\n  filterByBasePath?: boolean;\n\n  /**\n   * Whether to prevent Coveo ML from automatically selecting values from that facet.\n   *\n   * **Default:** `false`\n   */\n  preventAutoSelect?: boolean;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/rest/Facet/FacetRequest.ts","import { IQueryResult } from '../../rest/QueryResult';\nimport { Component } from '../Base/Component';\nimport { IResultListOptions } from './ResultListOptions';\nimport _ = require('underscore');\n\nexport class ResultListRenderer {\n  constructor(protected resultListOptions: IResultListOptions, protected autoCreateComponentsFn: Function) {}\n\n  renderResults(\n    resultElements: HTMLElement[],\n    append = false,\n    resultDisplayedCallback: (result: IQueryResult, resultElem: HTMLElement) => any\n  ) {\n    return Promise.all([this.getStartFragment(resultElements, append), this.getEndFragment(resultElements, append)]).then(\n      ([startFrag, endFrag]) => {\n        const resultsFragment = document.createDocumentFragment();\n        if (startFrag) {\n          resultsFragment.appendChild(startFrag);\n        }\n        _.each(resultElements, resultElement => {\n          resultsFragment.appendChild(resultElement);\n          resultDisplayedCallback(Component.getResult(resultElement), resultElement);\n        });\n        if (endFrag) {\n          resultsFragment.appendChild(endFrag);\n        }\n        this.resultListOptions.resultsContainer.appendChild(resultsFragment);\n      }\n    );\n  }\n\n  protected getStartFragment(resultElements: HTMLElement[], append: boolean): Promise<DocumentFragment> {\n    return Promise.resolve(document.createDocumentFragment());\n  }\n\n  protected getEndFragment(resultElements: HTMLElement[], append: boolean): Promise<DocumentFragment> {\n    return Promise.resolve(document.createDocumentFragment());\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultListRenderer.ts","import 'styling/_ResponsiveFacets';\nimport { IQuerySuccessEventArgs, QueryEvents } from '../../events/QueryEvents';\nimport { Logger } from '../../misc/Logger';\nimport { l } from '../../strings/Strings';\nimport { $$, Dom } from '../../utils/Dom';\nimport { Utils } from '../../utils/Utils';\nimport { Component } from '../Base/Component';\nimport { SearchInterface } from '../SearchInterface/SearchInterface';\nimport { ResponsiveComponents } from './ResponsiveComponents';\nimport { IResponsiveComponent, IResponsiveComponentOptions, ResponsiveComponentsManager } from './ResponsiveComponentsManager';\nimport { ResponsiveComponentsUtils } from './ResponsiveComponentsUtils';\nimport { ResponsiveDropdown } from './ResponsiveDropdown/ResponsiveDropdown';\nimport { ResponsiveDropdownContent, IResponsiveDropdownContent } from './ResponsiveDropdown/ResponsiveDropdownContent';\nimport { ResponsiveDropdownHeader } from './ResponsiveDropdown/ResponsiveDropdownHeader';\nimport { each, debounce } from 'underscore';\nimport { ComponentsTypes } from '../../utils/ComponentsTypes';\nimport { ResponsiveDropdownModalContent } from './ResponsiveDropdown/ResponsiveDropdownModalContent';\nimport { FacetsMobileMode, IFacetsMobileModeOptions } from '../FacetsMobileMode/FacetsMobileMode';\nimport { FacetsMobileModeEvents } from '../../events/FacetsMobileModeEvents';\n\nexport class ResponsiveFacetColumn implements IResponsiveComponent {\n  public static DEBOUNCE_SCROLL_WAIT = 250;\n\n  private static DROPDOWN_MIN_WIDTH: number = 280;\n  private static DROPDOWN_WIDTH_RATIO: number = 0.35; // Used to set the width relative to the coveo root.\n  private static DROPDOWN_HEADER_LABEL_DEFAULT_VALUE = 'Filters';\n\n  private searchInterface: SearchInterface;\n  private componentsInFacetColumn: any[] = [];\n  private preservePositionOriginalValues: boolean[] = [];\n  private breakpoint: number;\n  protected dropdown: ResponsiveDropdown;\n  private dropdownHeaderLabel: string;\n\n  public static init(responsiveComponentConstructor, root: HTMLElement, component, options: IResponsiveComponentOptions, ID: string) {\n    const column = this.findColumn(root);\n    if (!column) {\n      return;\n    }\n\n    ResponsiveComponentsManager.register(ResponsiveFacetColumn, $$(root), 'ResponsiveFacetColumn', component, options);\n    ResponsiveComponentsManager.register(responsiveComponentConstructor, $$(root), ID, component, options);\n  }\n\n  private static findColumn(root: HTMLElement) {\n    const column = $$(root).find('.coveo-facet-column');\n    if (!column) {\n      const logger = new Logger('ResponsiveFacets');\n      logger.info('No element with class coveo-facet-column. Responsive facets cannot be enabled');\n    }\n    return column;\n  }\n\n  constructor(public coveoRoot: Dom, public ID: string, options: IResponsiveComponentOptions, responsiveDropdown?: ResponsiveDropdown) {\n    this.searchInterface = <SearchInterface>Component.get(this.coveoRoot.el, SearchInterface, false);\n    this.dropdownHeaderLabel = this.getDropdownHeaderLabel();\n    this.dropdown = this.buildDropdown(responsiveDropdown);\n    this.bindDropdownContentEvents();\n    this.bindFacetsMobileModeEvents();\n    this.registerOnCloseHandler();\n    this.registerQueryEvents();\n    this.initializeBreakpoint(options.responsiveBreakpoint);\n  }\n\n  private get facetsMobileModeComponent() {\n    return this.searchInterface ? this.searchInterface.getComponents<FacetsMobileMode>(FacetsMobileMode.ID)[0] : null;\n  }\n\n  private get facetsMobileModeOptions(): IFacetsMobileModeOptions {\n    const facetsMobileModeComponent = this.facetsMobileModeComponent;\n    if (!facetsMobileModeComponent) {\n      return {\n        isModal: false,\n        preventScrolling: false,\n        displayOverlayWhileOpen: true\n      };\n    }\n    return facetsMobileModeComponent.options;\n  }\n\n  public registerComponent(accept: Component) {\n    this.componentsInFacetColumn.push(accept);\n    this.preservePositionOriginalValues.push(accept.options.preservePosition);\n    return true;\n  }\n\n  public needDropdownWrapper() {\n    return this.needSmallMode();\n  }\n\n  public handleResizeEvent() {\n    if (this.needSmallMode() && !ResponsiveComponentsUtils.isSmallFacetActivated(this.coveoRoot)) {\n      this.changeToSmallMode();\n    } else if (!this.needSmallMode() && ResponsiveComponentsUtils.isSmallFacetActivated(this.coveoRoot)) {\n      this.changeToLargeMode();\n    }\n    if (this.dropdown.isOpened) {\n      this.dropdown.dropdownContent.positionDropdown();\n    }\n  }\n\n  public dismissFacetSearches() {\n    each(this.componentsInFacetColumn, component => {\n      if (component.facetSearch && component.facetSearch.currentlyDisplayedResults) {\n        component.facetSearch.dismissSearchResults();\n      }\n    });\n  }\n\n  private needSmallMode(): boolean {\n    if (!this.searchInterface) {\n      return (\n        this.coveoRoot.width() <=\n        (Utils.isNullOrUndefined(this.breakpoint) ? new ResponsiveComponents().getMediumScreenWidth() : this.breakpoint)\n      );\n    }\n    switch (this.searchInterface.responsiveComponents.getResponsiveMode()) {\n      case 'small':\n      case 'medium':\n        return true;\n      case 'auto':\n        return (\n          this.coveoRoot.width() <=\n          (Utils.isNullOrUndefined(this.breakpoint) ? this.searchInterface.responsiveComponents.getMediumScreenWidth() : this.breakpoint)\n        );\n      default:\n        return false;\n    }\n  }\n\n  private changeToSmallMode() {\n    this.dropdown.close();\n    this.disableFacetPreservePosition();\n    $$(this.coveoRoot.find(`.${ResponsiveComponentsManager.DROPDOWN_HEADER_WRAPPER_CSS_CLASS}`)).append(\n      this.dropdown.dropdownHeader.element.el\n    );\n    ResponsiveComponentsUtils.activateSmallFacet(this.coveoRoot);\n  }\n\n  private changeToLargeMode() {\n    this.restoreFacetPreservePositionValue();\n    this.dropdown.cleanUp();\n    ResponsiveComponentsUtils.deactivateSmallFacet(this.coveoRoot);\n  }\n\n  private buildDropdown(responsiveDropdown?: ResponsiveDropdown) {\n    let dropdownContent = this.buildDropdownContent();\n    let dropdownHeader = this.buildDropdownHeader();\n    let dropdown = responsiveDropdown ? responsiveDropdown : new ResponsiveDropdown(dropdownContent, dropdownHeader, this.coveoRoot);\n    if (!this.facetsMobileModeOptions.displayOverlayWhileOpen) {\n      dropdown.disablePopupBackground();\n    }\n    if (this.facetsMobileModeOptions.preventScrolling) {\n      dropdown.enableScrollLocking(this.facetsMobileModeOptions.scrollContainer);\n    }\n    return dropdown;\n  }\n\n  private buildDropdownContent(): IResponsiveDropdownContent {\n    let dropdownContentElement = $$(this.coveoRoot.find('.coveo-facet-column'));\n    let filterByContainer = $$('div', { className: 'coveo-facet-header-filter-by-container', style: 'display: none' });\n    let filterBy = $$('div', { className: 'coveo-facet-header-filter-by' });\n    filterBy.text(l('Filter by:'));\n    filterByContainer.append(filterBy.el);\n    dropdownContentElement.prepend(filterByContainer.el);\n    if (this.facetsMobileModeOptions.isModal) {\n      return new ResponsiveDropdownModalContent('facet', dropdownContentElement, l('CloseFiltersDropdown'), () => this.dropdown.close());\n    }\n    return new ResponsiveDropdownContent(\n      'facet',\n      dropdownContentElement,\n      this.coveoRoot,\n      ResponsiveFacetColumn.DROPDOWN_MIN_WIDTH,\n      ResponsiveFacetColumn.DROPDOWN_WIDTH_RATIO\n    );\n  }\n\n  private buildDropdownHeader() {\n    let dropdownHeaderElement = $$('a');\n    let content = $$('p');\n    content.text(this.dropdownHeaderLabel);\n    dropdownHeaderElement.el.appendChild(content.el);\n    let dropdownHeader = new ResponsiveDropdownHeader('facet', dropdownHeaderElement);\n    return dropdownHeader;\n  }\n\n  private initializeBreakpoint(defaultBreakpoint: number) {\n    const facetsMobileModeBreakpoint = this.facetsMobileModeOptions.breakpoint;\n    this.breakpoint = Utils.isNullOrUndefined(facetsMobileModeBreakpoint) ? defaultBreakpoint : facetsMobileModeBreakpoint;\n  }\n\n  private registerOnCloseHandler() {\n    this.dropdown.registerOnCloseHandler(this.dismissFacetSearches, this);\n  }\n\n  private registerQueryEvents() {\n    this.coveoRoot.on(QueryEvents.noResults, () => this.handleNoResults());\n    this.coveoRoot.on(QueryEvents.querySuccess, (e: Event, data: IQuerySuccessEventArgs) => this.handleQuerySuccess(data));\n    this.coveoRoot.on(QueryEvents.queryError, () => this.handleQueryError());\n  }\n\n  private bindDropdownContentEvents() {\n    this.dropdown.dropdownContent.element.on(\n      'scroll',\n      debounce(() => {\n        each(this.componentsInFacetColumn, component => {\n          let facetSearch = component.facetSearch;\n          if (facetSearch && facetSearch.currentlyDisplayedResults && !this.isFacetSearchScrolledIntoView(facetSearch.search)) {\n            component.facetSearch.positionSearchResults(this.dropdown.dropdownContent.element.el);\n          } else if (facetSearch && component.facetSearch.currentlyDisplayedResults) {\n            component.facetSearch.positionSearchResults();\n          }\n        });\n      }, ResponsiveFacetColumn.DEBOUNCE_SCROLL_WAIT)\n    );\n  }\n\n  private bindFacetsMobileModeEvents() {\n    const facetsMobileModeComponent = this.facetsMobileModeComponent;\n    if (facetsMobileModeComponent) {\n      this.dropdown.registerOnOpenHandler(\n        () => $$(facetsMobileModeComponent.element).trigger(FacetsMobileModeEvents.popupOpened),\n        facetsMobileModeComponent\n      );\n      this.dropdown.registerOnCloseHandler(\n        () => $$(facetsMobileModeComponent.element).trigger(FacetsMobileModeEvents.popupClosed),\n        facetsMobileModeComponent\n      );\n    }\n  }\n\n  private restoreFacetPreservePositionValue() {\n    each(this.componentsInFacetColumn, (component, index) => {\n      if (component.options) {\n        component.options.preservePosition = this.preservePositionOriginalValues[index];\n      }\n    });\n  }\n\n  private disableFacetPreservePosition() {\n    each(this.componentsInFacetColumn, component => {\n      if (component.options) {\n        component.options.preservePosition = false;\n      }\n    });\n  }\n\n  private isFacetSearchScrolledIntoView(facetSearchElement: HTMLElement) {\n    let facetTop = facetSearchElement.getBoundingClientRect().top;\n    let facetBottom = facetSearchElement.getBoundingClientRect().bottom;\n    let dropdownTop = this.dropdown.dropdownContent.element.el.getBoundingClientRect().top;\n    let dropdownBottom = this.dropdown.dropdownContent.element.el.getBoundingClientRect().bottom;\n\n    dropdownTop = dropdownTop >= 0 ? dropdownTop : 0;\n\n    return facetTop >= dropdownTop && facetBottom <= dropdownBottom;\n  }\n\n  private getDropdownHeaderLabel() {\n    let dropdownHeaderLabel: string;\n    ComponentsTypes.getAllFacetInstancesFromElement(this.coveoRoot.find('.coveo-facet-column')).forEach(facet => {\n      const options = facet.options as IResponsiveComponentOptions;\n\n      if (!dropdownHeaderLabel && options.dropdownHeaderLabel) {\n        dropdownHeaderLabel = options.dropdownHeaderLabel;\n      }\n    });\n\n    if (!dropdownHeaderLabel) {\n      dropdownHeaderLabel = l(ResponsiveFacetColumn.DROPDOWN_HEADER_LABEL_DEFAULT_VALUE);\n    }\n\n    return dropdownHeaderLabel;\n  }\n\n  private handleNoResults() {\n    this.dropdown.dropdownHeader.hide();\n  }\n\n  private handleQueryError() {\n    this.dropdown.dropdownHeader.hide();\n  }\n\n  private handleQuerySuccess(data: IQuerySuccessEventArgs) {\n    if (data.results.totalCount === 0) {\n      this.dropdown.dropdownHeader.hide();\n    } else {\n      this.dropdown.dropdownHeader.show();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveFacetColumn.ts","import { $$ } from '../../../utils/Dom';\n\nexport interface IDynamicFacetValueMoreLessButtonOptions {\n  label: string;\n  ariaLabel: string;\n  className: string;\n  action: () => void;\n}\n\nexport class DynamicFacetValueShowMoreLessButton {\n  public element: HTMLElement;\n\n  constructor(options: IDynamicFacetValueMoreLessButtonOptions) {\n    const btn = $$(\n      'button',\n      {\n        className: options.className,\n        ariaLabel: options.ariaLabel,\n        type: 'button'\n      },\n      options.label\n    );\n\n    this.element = $$('li', null, btn).el;\n    btn.on('click', () => options.action());\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValueMoreLessButton.ts","import * as Globalize from 'globalize';\nimport { IDynamicFacet, IDynamicFacetValueProperties, IValueRenderer, IValueRendererKlass, IDynamicFacetValue } from '../IDynamicFacet';\nimport { FacetValueState } from '../../../rest/Facet/FacetValueState';\nimport { analyticsActionCauseList, IAnalyticsFacetMeta } from '../../Analytics/AnalyticsActionListMeta';\nimport { l } from '../../../strings/Strings';\nimport { RangeType } from '../../../rest/RangeValue';\nimport { FacetType } from '../../../rest/Facet/FacetRequest';\nimport { IAnalyticsFacetState } from '../../Analytics/IAnalyticsFacetState';\n\nexport class DynamicFacetValue implements IDynamicFacetValue {\n  public value: string;\n  public start: RangeType;\n  public end: RangeType;\n  public endInclusive: boolean;\n  public state: FacetValueState;\n  public numberOfResults: number;\n  public position: number;\n  public displayValue: string;\n  public renderer: IValueRenderer;\n  private element: HTMLElement = null;\n\n  constructor(facetValue: IDynamicFacetValueProperties, private facet: IDynamicFacet, rendererKlass: IValueRendererKlass) {\n    this.value = facetValue.value;\n    this.start = facetValue.start;\n    this.end = facetValue.end;\n    this.endInclusive = facetValue.endInclusive;\n    this.state = facetValue.state;\n    this.numberOfResults = facetValue.numberOfResults;\n    this.position = facetValue.position;\n    this.displayValue = facetValue.displayValue;\n    this.renderer = new rendererKlass(this, facet);\n  }\n\n  public get isSelected() {\n    return this.state === FacetValueState.selected;\n  }\n\n  public get isIdle() {\n    return this.state === FacetValueState.idle;\n  }\n\n  public toggleSelect() {\n    this.state === FacetValueState.selected ? this.deselect() : this.select();\n  }\n\n  public select() {\n    this.state = FacetValueState.selected;\n  }\n\n  public deselect() {\n    this.state = FacetValueState.idle;\n  }\n\n  public equals(arg: string | IDynamicFacetValue) {\n    const value = typeof arg === 'string' ? arg : arg.value;\n    return value.toLowerCase() === this.value.toLowerCase();\n  }\n\n  public get formattedCount(): string {\n    return Globalize.format(this.numberOfResults, 'n0');\n  }\n\n  public get selectAriaLabel() {\n    const resultCount = l('ResultCount', this.formattedCount, this.numberOfResults);\n\n    return `${l('IncludeValueWithResultCount', this.displayValue, resultCount)}`;\n  }\n\n  private get isRange() {\n    return this.facet.facetType !== FacetType.specific;\n  }\n\n  private get analyticsValue() {\n    return this.isRange ? `${this.start}..${this.end}` : this.value;\n  }\n\n  private get rangeFacetState() {\n    if (!this.isRange) {\n      return null;\n    }\n\n    return {\n      start: `${this.start}`,\n      end: `${this.end}`,\n      endInclusive: this.endInclusive\n    };\n  }\n\n  public get analyticsFacetState(): IAnalyticsFacetState {\n    return {\n      ...this.facet.basicAnalyticsFacetState,\n      ...this.rangeFacetState,\n      value: this.analyticsValue,\n      valuePosition: this.position,\n      displayValue: this.displayValue,\n      state: this.state\n    };\n  }\n\n  private get rangeFacetMeta() {\n    if (!this.isRange) {\n      return null;\n    }\n\n    return {\n      facetRangeStart: `${this.start}`,\n      facetRangeEnd: `${this.end}`,\n      facetRangeEndInclusive: this.endInclusive\n    };\n  }\n\n  public get analyticsFacetMeta(): IAnalyticsFacetMeta {\n    return {\n      ...this.facet.basicAnalyticsFacetMeta,\n      ...this.rangeFacetMeta,\n      facetValue: this.analyticsValue\n    };\n  }\n\n  public logSelectActionToAnalytics() {\n    const action =\n      this.state === FacetValueState.selected ? analyticsActionCauseList.dynamicFacetSelect : analyticsActionCauseList.dynamicFacetDeselect;\n\n    this.facet.logAnalyticsEvent(action, this.analyticsFacetMeta);\n  }\n\n  private render() {\n    this.element = this.renderer.render();\n    return this.element;\n  }\n\n  public get renderedElement() {\n    if (this.element) {\n      return this.element;\n    }\n\n    return this.render();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValue.ts","import { Component } from '../Base/Component';\nimport { InitializationEvents } from '../../events/InitializationEvents';\nimport { QueryEvents, IQuerySuccessEventArgs, IDoneBuildingQueryEventArgs } from '../../events/QueryEvents';\nimport { exportGlobally } from '../../GlobalExports';\nimport { find, without, partition } from 'underscore';\nimport { IFacetResponse } from '../../rest/Facet/FacetResponse';\nimport { $$ } from '../../utils/Dom';\nimport { Utils } from '../../utils/Utils';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { Assert } from '../../misc/Assert';\nimport { Initialization } from '../Base/Initialization';\nimport { ComponentsTypes } from '../../utils/ComponentsTypes';\nimport { QueryBuilder } from '../Base/QueryBuilder';\nimport { IAutoLayoutAdjustableInsideFacetColumn } from '../SearchInterface/FacetColumnAutoLayoutAdjustment';\nimport { IQueryResults } from '../../rest/QueryResults';\n\nexport interface IDynamicFacetManagerOptions {\n  enableReorder?: boolean;\n  onUpdate?: IDynamicFacetManagerOnUpdate;\n  compareFacets?: IDynamicFacetManagerCompareFacet;\n  maximumNumberOfExpandedFacets?: number;\n}\n\nexport interface IDynamicFacetManagerOnUpdate {\n  (facet: IDynamicManagerCompatibleFacet, index: number): void;\n}\n\nexport interface IDynamicFacetManagerCompareFacet {\n  (facetA: IDynamicManagerCompatibleFacet, facetB: IDynamicManagerCompatibleFacet): number;\n}\n\nexport interface IDynamicManagerCompatibleFacet extends Component, IAutoLayoutAdjustableInsideFacetColumn {\n  dynamicFacetManager: DynamicFacetManager;\n  hasActiveValues: boolean;\n  isDynamicFacet: boolean;\n\n  handleQueryResults(results: IQueryResults): void;\n  putStateIntoQueryBuilder(queryBuilder: QueryBuilder): void;\n  putStateIntoAnalytics(): void;\n  expand(): void;\n  collapse(): void;\n}\n\n/**\n * The `DynamicFacetManager` component is meant to be a parent for multiple [DynamicFacet]{@link DynamicFacet} & [DynamicFacetRange]{@link DynamicFacetRange} components.\n * This component allows controlling a set of [`DynamicFacet`]{@link DynamicFacet} and [`DynamicFacetRange`]{@link DynamicFacetRange} as a group.\n *\n * @externaldocs [Using Dynamic Facets](https://docs.coveo.com/en/2917/).\n * @availablesince [May 2019 Release (v2.6063)](https://docs.coveo.com/en/2909/)\n */\nexport class DynamicFacetManager extends Component {\n  static ID = 'DynamicFacetManager';\n  static doExport = () => exportGlobally({ DynamicFacetManager });\n\n  /**\n   * The options for the DynamicFacetManager\n   * @componentOptions\n   */\n  static options: IDynamicFacetManagerOptions = {\n    /**\n     * Whether to allow the reordering of facets based on Coveo ML and index ranking scores.\n     *\n     * **Default:** `true`\n     */\n    enableReorder: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'Filtering' }),\n    /**\n     * A function to execute whenever facets are updated in the query response @externaldocs [Defining Custom Dynamic Facet Behaviors](https://docs.coveo.com/en/2917/javascript-search-framework/using-dynamic-facets#defining-custom-dynamic-facet-behaviors).\n     *\n     * **Note:**\n     * > You cannot set this option directly in the component markup as an HTML attribute. You must either set it in the\n     * > [`init`]{@link init} call of your search interface (see\n     * > [Passing Component Options in the init Call](https://developers.coveo.com/x/PoGfAQ#Components-PassingComponentOptionsintheinitCall)),\n     * > or before the `init` call, using the `options` top-level function (see\n     * > [Passing Component Options Before the init Call](https://developers.coveo.com/x/PoGfAQ#Components-PassingComponentOptionsBeforetheinitCall)).\n     */\n    onUpdate: ComponentOptions.buildCustomOption<IDynamicFacetManagerOnUpdate>(() => {\n      return null;\n    }),\n    /**\n     * A custom sort function to execute on facets on every successful query response @externaldocs [Using Custom Dynamic Facet Sort Functions](https://docs.coveo.com/en/2917/javascript-search-framework/using-dynamic-facets#using-custom-dynamic-facet-sort-functions).\n     *\n     * **Note:**\n     * > If specified, the function must implement the JavaScript compareFunction (see [Array.prototype.sort](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort).\n     * > You cannot set this option directly in the component markup as an HTML attribute. You must either set it in the\n     * > [`init`]{@link init} call of your search interface (see\n     * > [Passing Component Options in the init Call](https://developers.coveo.com/x/PoGfAQ#Components-PassingComponentOptionsintheinitCall)),\n     * > or before the `init` call, using the `options` top-level function (see\n     * > [Passing Component Options Before the init Call](https://developers.coveo.com/x/PoGfAQ#Components-PassingComponentOptionsBeforetheinitCall)).\n     */\n    compareFacets: ComponentOptions.buildCustomOption<IDynamicFacetManagerCompareFacet>(() => {\n      return null;\n    }),\n    /**\n     * The maximum number of expanded facets inside the manager.\n     * Remaining facets are collapsed.\n     *\n     * **Note:**\n     * Prioritizes facets with active values, and then prioritizes first facets.\n     * If the number of facets with active values exceeds the value of the `maximumNumberOfExpandedFacets` option, it overrides the option.\n     *\n     * Using the value `-1` disables the feature and keeps all facets expanded.\n     *\n     * @availablesince [September 2019 Release (v2.7023)](https://docs.coveo.com/en/2990/)\n     */\n    maximumNumberOfExpandedFacets: ComponentOptions.buildNumberOption({ defaultValue: 4, min: -1 })\n  };\n\n  private childrenFacets: IDynamicManagerCompatibleFacet[] = [];\n  private containerElement: HTMLElement;\n\n  private get enabledFacets() {\n    return this.childrenFacets.filter(facet => !facet.disabled);\n  }\n\n  private get displayedFacets() {\n    return this.childrenFacets.filter(facet => facet.isCurrentlyDisplayed());\n  }\n\n  /**\n   * Creates a new `DynamicFacetManager` instance.\n   *\n   * @param element The element from which to instantiate the component.\n   * @param options The component options.\n   * @param bindings The component bindings. Automatically resolved by default.\n   */\n  constructor(element: HTMLElement, public options?: IDynamicFacetManagerOptions) {\n    super(element, 'DynamicFacetManager');\n    this.options = ComponentOptions.initComponentOptions(element, DynamicFacetManager, options);\n    this.resetContainer();\n    this.prependContainer();\n    this.initEvents();\n  }\n\n  private resetContainer() {\n    this.containerElement && $$(this.containerElement).remove();\n    this.containerElement = $$('div', { className: 'coveo-dynamic-facet-manager-container' }).el;\n  }\n\n  private prependContainer() {\n    $$(this.element).prepend(this.containerElement);\n  }\n\n  private initEvents() {\n    this.bind.onRootElement(InitializationEvents.afterComponentsInitialization, () => this.handleAfterComponentsInitialization());\n    this.bind.onRootElement(QueryEvents.doneBuildingQuery, (data: IDoneBuildingQueryEventArgs) => this.handleDoneBuildingQuery(data));\n    this.bind.onRootElement(QueryEvents.deferredQuerySuccess, (data: IQuerySuccessEventArgs) => this.handleQuerySuccess(data));\n  }\n\n  private isDynamicFacet(component: Component) {\n    return !!(component as IDynamicManagerCompatibleFacet).isDynamicFacet;\n  }\n\n  private get allDynamicFacets(): IDynamicManagerCompatibleFacet[] {\n    const allFacetsInComponent = ComponentsTypes.getAllFacetInstancesFromElement(this.element);\n    return <IDynamicManagerCompatibleFacet[]>allFacetsInComponent.filter(this.isDynamicFacet);\n  }\n\n  private handleAfterComponentsInitialization() {\n    this.childrenFacets = this.allDynamicFacets;\n    this.childrenFacets.forEach(dynamicFacet => {\n      dynamicFacet.dynamicFacetManager = this;\n      this.containerElement.appendChild(dynamicFacet.element);\n    });\n\n    if (this.element.children.length > 1) {\n      this.logger.warn(`DynamicFacetManager contains incompatible elements. Those elements may be moved in the DOM.\n        To prevent this warning, move those elements outside of the DynamicFacetManager.`);\n    }\n\n    if (!this.childrenFacets.length) {\n      this.disable();\n    }\n  }\n\n  private handleDoneBuildingQuery(data: IDoneBuildingQueryEventArgs) {\n    Assert.exists(data);\n    Assert.exists(data.queryBuilder);\n\n    this.enabledFacets.forEach(dynamicFacet => {\n      dynamicFacet.putStateIntoQueryBuilder(data.queryBuilder);\n      dynamicFacet.putStateIntoAnalytics();\n    });\n  }\n\n  private handleQuerySuccess(data: IQuerySuccessEventArgs) {\n    if (Utils.isNullOrUndefined(data.results.facets)) {\n      return this.notImplementedError();\n    }\n\n    this.enabledFacets.forEach(dynamicFacet => {\n      dynamicFacet.handleQueryResults(data.results);\n    });\n\n    const wasFacetOrderFrozen = data.query.facetOptions && data.query.facetOptions.freezeFacetOrder;\n    if (wasFacetOrderFrozen) {\n      return this.callOnUpdateOnChildrenFacets();\n    }\n\n    if (this.options.enableReorder) {\n      this.options.compareFacets ? this.sortFacetsWithCompareOption() : this.sortFacetsWithResponseOrder(data.results.facets);\n      this.reorderFacetsInDom();\n    }\n\n    this.respectMaximumExpandedFacetsThreshold();\n    this.callOnUpdateOnChildrenFacets();\n  }\n\n  private callOnUpdateOnChildrenFacets() {\n    if (!this.options.onUpdate) {\n      return;\n    }\n\n    this.childrenFacets.forEach((dynamicFacet, index) => this.options.onUpdate(dynamicFacet, index));\n  }\n\n  private sortFacetsWithResponseOrder(facetsResponse: IFacetResponse[]) {\n    const facetsInResponse = facetsResponse.map(({ facetId }) => this.getChildFacetWithId(facetId)).filter(Utils.exists);\n    const facetsNotInResponse = without(this.childrenFacets, ...facetsInResponse);\n\n    this.childrenFacets = [...facetsInResponse, ...facetsNotInResponse];\n  }\n\n  private sortFacetsWithCompareOption() {\n    this.childrenFacets = this.childrenFacets.sort(this.options.compareFacets);\n  }\n\n  private reorderFacetsInDom() {\n    this.resetContainer();\n    const fragment = document.createDocumentFragment();\n\n    this.childrenFacets.forEach(dynamicFacet => fragment.appendChild(dynamicFacet.element));\n\n    this.containerElement.appendChild(fragment);\n    this.prependContainer();\n  }\n\n  private respectMaximumExpandedFacetsThreshold() {\n    if (this.options.maximumNumberOfExpandedFacets === -1) {\n      return;\n    }\n\n    const [collapsableFacets, uncollapsableFacets] = partition(this.displayedFacets, facet => facet.options.enableCollapse);\n    let facetsLeftToExpandCounter = this.options.maximumNumberOfExpandedFacets - uncollapsableFacets.length;\n\n    collapsableFacets.forEach(dynamicFacet => {\n      if (facetsLeftToExpandCounter < 1) {\n        return dynamicFacet.collapse();\n      }\n\n      if (dynamicFacet.options.collapsedByDefault) {\n        dynamicFacet.logger.info(\n          'The facet has its \"collapsedByDefault\" option set to \"true\", which prevents the DynamicFacetManager from expanding it.',\n          'While this configuration may be legitimate, it partially defeats the purpose of the dynamic navigation experience feature.',\n          'For more information, see https://docs.coveo.com/en/2917/.'\n        );\n        return dynamicFacet.collapse();\n      }\n\n      facetsLeftToExpandCounter--;\n      dynamicFacet.expand();\n    });\n  }\n\n  private getChildFacetWithId(id: string) {\n    return find(this.childrenFacets, facet => facet.options.id === id);\n  }\n\n  private notImplementedError() {\n    this.logger.error('DynamicFacetManager is not supported by your current search endpoint. Disabling this component.');\n    this.disable();\n  }\n\n  public isCurrentlyDisplayed() {\n    return !!find(this.childrenFacets, facet => facet.isCurrentlyDisplayed());\n  }\n}\n\nInitialization.registerAutoCreateComponent(DynamicFacetManager);\nDynamicFacetManager.doExport();\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacetManager/DynamicFacetManager.ts","/// <reference path='Facet.ts' />\nimport { StringUtils } from '../../utils/StringUtils';\nimport { QueryUtils } from '../../utils/QueryUtils';\nimport { FileTypes } from '../Misc/FileTypes';\nimport { DateUtils } from '../../utils/DateUtils';\nimport { Utils } from '../../utils/Utils';\nimport { $$ } from '../../utils/Dom';\nimport * as _ from 'underscore';\nimport FacetModuleDefinition = require('./Facet');\nimport { l } from '../../strings/Strings';\n\nexport class FacetUtils {\n  static getRegexToUseForFacetSearch(value: string, ignoreAccent: boolean) {\n    return new RegExp(StringUtils.stringToRegex(value, ignoreAccent), 'i');\n  }\n\n  static getDisplayValueFromValueCaption(value: string, field: string, valueCaption: Record<string, string>) {\n    const returnValue = this.tryToGetTranslatedCaption(field, value);\n    return valueCaption[value] || returnValue;\n  }\n\n  static getValuesToUseForSearchInFacet(original: string, facet: FacetModuleDefinition.Facet): string[] {\n    let ret = [original];\n    let regex = this.getRegexToUseForFacetSearch(original, facet.options.facetSearchIgnoreAccents);\n    if (facet.options.valueCaption) {\n      _.chain(facet.options.valueCaption)\n        .pairs()\n        .filter(pair => {\n          return regex.test(pair[1]);\n        })\n        .each(match => {\n          ret.push(match[0]);\n        });\n      if (\n        QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@objecttype') ||\n        QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@filetype')\n      ) {\n        _.each(FileTypes.getFileTypeCaptions(), (value: string, key: string) => {\n          if (!(key in facet.options.valueCaption) && regex.test(value)) {\n            ret.push(key);\n          }\n        });\n      }\n    } else if (\n      QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@objecttype') ||\n      QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@filetype')\n    ) {\n      _.each(\n        _.filter(_.pairs(FileTypes.getFileTypeCaptions()), pair => {\n          return regex.test(pair[1]);\n        }),\n        match => {\n          ret.push(match[0]);\n        }\n      );\n    } else if (QueryUtils.isStratusAgnosticField(<string>facet.options.field, '@month')) {\n      _.each(_.range(1, 13), month => {\n        if (regex.test(DateUtils.monthToString(month - 1))) {\n          ret.push(('0' + month.toString()).substr(-2));\n        }\n      });\n    }\n    return ret;\n  }\n\n  static buildFacetSearchPattern(values: string[]) {\n    values = _.map(values, value => {\n      return Utils.escapeRegexCharacter(value);\n    });\n    values[0] = '.*' + values[0] + '.*';\n    return values.join('|');\n  }\n\n  static needAnotherFacetSearch(\n    currentSearchLength: number,\n    newSearchLength: number,\n    oldSearchLength: number,\n    desiredSearchLength: number\n  ) {\n    // Something was removed (currentSearch < newSearch)\n    // && we might want to display more facet search result(currentSearch < desiredSearch)\n    // && the new query returned more stuff than the old one so there's still more results(currentSearchLength > oldLength)\n    return currentSearchLength < newSearchLength && currentSearchLength < desiredSearchLength && currentSearchLength > oldSearchLength;\n  }\n\n  static addNoStateCssClassToFacetValues(facet: FacetModuleDefinition.Facet, container: HTMLElement) {\n    // This takes care of adding the correct css class on each facet value checkbox (empty white box) if at least one value is selected in that facet\n    if (facet.values.getSelected().length != 0) {\n      let noStates = $$(container).findAll('li:not(.coveo-selected)');\n      _.each(noStates, noState => {\n        $$(noState).addClass('coveo-no-state');\n      });\n    }\n  }\n\n  static tryToGetTranslatedCaption(field: string, value: string) {\n    let found: string;\n\n    if (QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@filetype')) {\n      found = FileTypes.getFileType(value).caption;\n    } else if (QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@objecttype')) {\n      found = FileTypes.getObjectType(value).caption;\n    } else if (FacetUtils.isMonthFieldValue(field, value)) {\n      const month = parseInt(value, 10);\n      found = DateUtils.monthToString(month - 1);\n    } else {\n      found = l(value);\n    }\n    return found != undefined && Utils.isNonEmptyString(found) ? found : value;\n  }\n\n  static isMonthFieldValue(field: string, value: string) {\n    if (!QueryUtils.isStratusAgnosticField(field.toLowerCase(), '@month')) {\n      return false;\n    }\n\n    const asInt = parseInt(value, 10);\n\n    if (isNaN(asInt)) {\n      return false;\n    }\n\n    if (asInt < 1 || asInt > 12) {\n      return false;\n    }\n\n    return true;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Facet/FacetUtils.ts","import { Template, TemplateRole } from './Template';\nimport { TemplateList } from './TemplateList';\nimport _ = require('underscore');\n\nexport class TableTemplate extends TemplateList {\n  instantiateRoleToString(role: TemplateRole) {\n    const roledTemplate = _.find(this.templates, t => t.role === role);\n    if (roledTemplate) {\n      return roledTemplate.instantiateToString(undefined, {});\n    } else {\n      return this.defaultRoledTemplates[role];\n    }\n  }\n  instantiateRoleToElement(role: TemplateRole) {\n    const roledTemplate = _.find(this.templates, t => t.role === role);\n    if (roledTemplate) {\n      return roledTemplate.instantiateToElement(undefined, {});\n    } else {\n      const tmpl = new Template(() => this.defaultRoledTemplates[role]);\n      tmpl.layout = 'table';\n      return tmpl.instantiateToElement(undefined);\n    }\n  }\n\n  private defaultTemplate = `<td><a class=\"CoveoResultLink\"></a></td>\n                             <td><span class=\"CoveoExcerpt\"></span></td>\n                             <td><span class=\"CoveoFieldValue\" data-field=\"@date\" data-helper=\"date\"></span></td>`;\n\n  private defaultRoledTemplates = {\n    'table-header': `<th style=\"width: 40%\">Link</th>\n                     <th>Excerpt</th>\n                     <th style=\"width: 20%\"\n                         class=\"CoveoSort coveo-table-header-sort\"\n                         data-sort-criteria=\"date ascending,date descending\"\n                         data-display-unselected-icon=\"false\">Date</th>`,\n    'table-footer': `<th>Link</th>\n                     <th>Excerpt</th>\n                     <th>Date</th>`\n  };\n\n  protected getFallbackTemplate(): Template {\n    return new Template(() => this.defaultTemplate);\n  }\n\n  hasTemplateWithRole(role: TemplateRole) {\n    return _.find(this.templates, t => t.role === role);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Templates/TableTemplate.ts","import { Template } from './Template';\nimport { IQueryResult } from '../../rest/QueryResult';\n\nexport class DefaultRecommendationTemplate extends Template {\n  instantiateToString(object?: IQueryResult): string {\n    var template = `<div class=\"coveo-result-frame\">\n        <div class=\"coveo-result-row\">\n          <div class=\"coveo-result-cell\" style=\"width:40px;text-align:center;vertical-align:middle;\">\n            <span class=\"CoveoIcon\" data-small=\"true\" data-with-label=\"false\">\n            </span>\n          </div>\n          <div class=\"coveo-result-cell\" style=\"padding:0 0 3px 5px;vertical-align:middle\">\n            <div class=\"coveo-result-row\">\n              <div class=\"coveo-result-cell\" style=\"font-size:10pt;\">\n                <a class=\"CoveoResultLink\" style=\"display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis\">\n                </a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>`;\n    return template;\n  }\n\n  instantiateToElement(object?: IQueryResult): Promise<HTMLElement> {\n    return new Promise((resolve, reject) => {\n      var div = document.createElement('div');\n      div.innerHTML = this.instantiateToString(object);\n      resolve(div);\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Templates/DefaultRecommendationTemplate.ts","import { IQueryResults } from '../../rest/QueryResults';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { Assert, QueryUtils, Component, Initialization, QueryStateModel } from '../../Core';\nimport { IInitResult } from '../Base/Initialization';\nimport { Template } from './Template';\nimport { SearchInterface } from '../../ui/SearchInterface/SearchInterface';\nimport { ResultList } from '../ResultList/ResultList';\nimport { RendererValidLayout } from '../ResultLayoutSelector/ValidLayout';\nimport { pluck, sortBy, map } from 'underscore';\nimport { $$ } from '../../utils/Dom';\nimport { Logger } from '../../misc/Logger';\n\nexport interface ITemplateToHtml {\n  resultTemplate: Template;\n  queryStateModel: QueryStateModel;\n  searchInterface: SearchInterface;\n}\n\nexport class TemplateToHtml {\n  constructor(public args: ITemplateToHtml) {}\n\n  public async buildResults(\n    results: IQueryResults,\n    layout: RendererValidLayout,\n    currentlyDisplayedResults: IQueryResult[]\n  ): Promise<HTMLElement[]> {\n    const res: { elem: HTMLElement; idx: number }[] = [];\n    const resultsPromises = map(results.results, (result: IQueryResult, index: number) => {\n      return this.buildResult(result, layout, currentlyDisplayedResults).then((resultElement: HTMLElement) => {\n        if (resultElement != null) {\n          res.push({ elem: resultElement, idx: index });\n        }\n        ResultList.resultCurrentlyBeingRendered = null;\n        return resultElement;\n      });\n    });\n\n    // We need to sort by the original index order, because in lazy loading mode, it's possible that results does not gets rendered\n    // in the correct order returned by the index, depending on the time it takes to load all the results component for a given result template\n    return Promise.all(resultsPromises).then(() => {\n      return pluck(sortBy(res, 'idx'), 'elem');\n    });\n  }\n\n  public async buildResult(\n    result: IQueryResult,\n    layout: RendererValidLayout,\n    currentlyDisplayedResults: IQueryResult[]\n  ): Promise<HTMLElement> {\n    Assert.exists(result);\n    QueryUtils.setStateObjectOnQueryResult(this.args.queryStateModel.get(), result);\n    QueryUtils.setSearchInterfaceObjectOnQueryResult(this.args.searchInterface, result);\n    ResultList.resultCurrentlyBeingRendered = result;\n    const resultElement = await this.createHtmlElement(result, layout);\n\n    if (resultElement != null) {\n      Component.bindResultToElement(resultElement, result);\n    }\n    currentlyDisplayedResults.push(result);\n\n    await this.autoCreateComponentsInsideResult(resultElement, result).initResult;\n\n    this.verifyChildren(resultElement);\n    return resultElement;\n  }\n\n  public autoCreateComponentsInsideResult(element: HTMLElement, result: IQueryResult): IInitResult {\n    Assert.exists(element);\n    return Initialization.automaticallyCreateComponentsInsideResult(element, result);\n  }\n\n  private createHtmlElement(result: IQueryResult, layout: RendererValidLayout) {\n    return this.args.resultTemplate.instantiateToElement(result, {\n      wrapInDiv: true,\n      checkCondition: true,\n      currentLayout: layout,\n      responsiveComponents: this.args.searchInterface.responsiveComponents\n    });\n  }\n\n  private verifyChildren(element: HTMLElement) {\n    const containsResultLink = !!$$(element).find('.CoveoResultLink');\n    if (containsResultLink) {\n      return;\n    }\n\n    const msg = `Result does not contain a \"CoveoResultLink\" component, please verify the result template`;\n    new Logger(element).warn(msg, this.args.resultTemplate);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Templates/TemplateToHtml.ts","import { Defer } from '../../misc/Defer';\nimport { sortBy, without } from 'underscore';\nimport { $$ } from '../../utils/Dom';\n\nexport class FocusTrap {\n  private focusInEvent: (e: FocusEvent) => void;\n  private focusOutEvent: (e: FocusEvent) => void;\n  private hiddenElements: HTMLElement[];\n  private enabled: boolean;\n\n  private get focusableElements(): HTMLElement[] {\n    return sortBy(this.container.querySelectorAll('[tabindex]'), element => element.tabIndex);\n  }\n\n  constructor(private container: HTMLElement) {\n    this.hiddenElements = [];\n    this.enable();\n  }\n\n  public disable() {\n    document.removeEventListener('focusin', this.focusInEvent);\n    document.removeEventListener('focusout', this.focusOutEvent);\n    this.showHiddenElements();\n    this.enabled = false;\n  }\n\n  private enable() {\n    document.addEventListener('focusin', (this.focusInEvent = e => this.onFocusIn(e)));\n    document.addEventListener('focusout', (this.focusOutEvent = e => this.onFocusOut(e)));\n    this.hideAllExcept(this.container);\n    this.enabled = true;\n  }\n\n  private showHiddenElements() {\n    while (this.hiddenElements.length) {\n      this.hiddenElements.pop().removeAttribute('aria-hidden');\n    }\n  }\n\n  private hideElement(element: HTMLElement) {\n    if (element.getAttribute('aria-hidden')) {\n      return;\n    }\n    this.hiddenElements.push(element);\n    element.setAttribute('aria-hidden', `${true}`);\n  }\n\n  private hideSiblings(allowedElement: HTMLElement) {\n    const parent = allowedElement.parentElement;\n    if (parent) {\n      without($$(parent).children(), allowedElement).forEach(elementToHide => {\n        this.hideElement(elementToHide);\n      });\n    }\n  }\n\n  private hideAllExcept(allowedElement: HTMLElement) {\n    this.hideSiblings(allowedElement);\n    const parent = allowedElement.parentElement;\n    if (parent && parent !== document.body) {\n      this.hideAllExcept(parent);\n    }\n  }\n\n  private getFocusableSibling(element: HTMLElement, previous = false) {\n    const elements = this.focusableElements;\n    const currentIndex = elements.indexOf(element);\n    if (currentIndex === -1) {\n      return null;\n    }\n    return elements[(currentIndex + (previous ? -1 : 1) + elements.length) % elements.length];\n  }\n\n  private focusSibling(element: HTMLElement, previous = false) {\n    const sibling = this.getFocusableSibling(element, previous);\n    if (sibling) {\n      sibling.focus();\n    }\n  }\n\n  private focusFirstElement() {\n    const elements = this.focusableElements;\n    if (elements.length) {\n      elements[0].focus();\n    }\n  }\n\n  private elementIsBefore(oldElement: HTMLElement, newElement: HTMLElement) {\n    if (!newElement) {\n      return false;\n    }\n    return oldElement.compareDocumentPosition(newElement) === Node.DOCUMENT_POSITION_PRECEDING;\n  }\n\n  private onLosingFocus(oldElement: HTMLElement, newElement: HTMLElement) {\n    Defer.defer(() => {\n      if (!this.enabled) {\n        return;\n      }\n      this.enabled = false;\n      if (oldElement && this.focusIsAllowed(oldElement)) {\n        this.focusSibling(oldElement, this.elementIsBefore(oldElement, newElement));\n      } else {\n        this.focusFirstElement();\n      }\n      this.enabled = true;\n    });\n  }\n\n  private focusIsAllowed(element: HTMLElement) {\n    return this.container.contains(element);\n  }\n\n  private elementIsInPage(element: HTMLElement) {\n    return element && element !== document.body.parentElement;\n  }\n\n  private onFocusIn(e: FocusEvent) {\n    if (!this.enabled) {\n      return;\n    }\n    const oldElement = e.relatedTarget as HTMLElement;\n    const handledByFocusOut = this.elementIsInPage(oldElement);\n    if (handledByFocusOut) {\n      return;\n    }\n    const newElement = e.target as HTMLElement;\n    if (!this.elementIsInPage(newElement)) {\n      return;\n    }\n    if (!this.focusIsAllowed(newElement)) {\n      this.onLosingFocus(null, newElement);\n    }\n  }\n\n  private onFocusOut(e: FocusEvent) {\n    if (!this.enabled) {\n      return;\n    }\n    const newElement = e.relatedTarget as HTMLElement;\n    if (!this.elementIsInPage(newElement)) {\n      return;\n    }\n    if (!newElement || !this.focusIsAllowed(newElement)) {\n      this.onLosingFocus(e.target as HTMLElement, newElement);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/FocusTrap/FocusTrap.ts","import { TemplateHelpers, ITemplateHelperFunction } from './TemplateHelpers';\nimport { IHighlight, IHighlightPhrase, IHighlightTerm } from '../../rest/Highlight';\nimport { HighlightUtils, StringAndHoles } from '../../utils/HighlightUtils';\nimport { IStreamHighlightOptions } from '../../utils/StreamHighlightUtils';\nimport { IDateToStringOptions, DateUtils } from '../../utils/DateUtils';\nimport { ICurrencyToStringOptions, CurrencyUtils } from '../../utils/CurrencyUtils';\nimport { IAnchorUtilsOptions, IImageUtilsOptions, AnchorUtils, ImageUtils } from '../../utils/HtmlUtils';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { Utils } from '../../utils/Utils';\nimport { StringUtils } from '../../utils/StringUtils';\nimport { TimeSpan, ITimeSpanUtilsOptions } from '../../utils/TimeSpanUtils';\nimport { EmailUtils } from '../../utils/EmailUtils';\nimport { QueryUtils } from '../../utils/QueryUtils';\nimport { DeviceUtils } from '../../utils/DeviceUtils';\nimport { $$ } from '../../utils/Dom';\nimport { SearchEndpoint } from '../../rest/SearchEndpoint';\nimport { StreamHighlightUtils } from '../../utils/StreamHighlightUtils';\nimport { FacetUtils } from '../Facet/FacetUtils';\nimport * as Globalize from 'globalize';\nimport { IStringMap } from '../../rest/GenericParam';\nimport * as _ from 'underscore';\nimport { Component } from '../Base/Component';\nimport { TemplateCache } from './TemplateCache';\nimport { INumberFormatOptions } from '../../utils/NumberUtils';\n\n/**\n * The core template helpers provided by default.\n *\n * **Examples:**\n *\n * **HTML**\n *\n * ```html\n * <div class=\"CoveoFieldValue\" data-field=\"@videoduration\" data-helper=\"timeSpan\" data-helper-options-is-milliseconds=\"false\"></div>\n * ```\n *\n * **Underscore**\n *\n * ```erb\n * <%= timeSpan(raw.videoduration, { isMilliseconds: false }) %>\n * ```\n */\nexport interface ICoreHelpers {\n  /**\n   * Shortens a string so that its length does not exceed a specific number of\n   * characters. An ellipsis is appended to the string if it exceeds the\n   * maximum length.\n   *\n   * - `content`: The string to shorten.\n   * - `length`: The maximum length of the resulting string.\n   * - `highlights`: Optional. If provided, the string will be highlighted\n   *   using this highlight information.\n   * - `cssClass`: Optional. When highlighting, the name of the CSS class to use.\n   */\n  shorten: (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => string;\n  /**\n   * Shortens a string using an algorithm suitable for file paths. The helper\n   * will insert an ellipsis in the string where text has been removed when\n   * the path exceeds the maximum length.\n   *\n   * - `content`: The path to shorten.\n   * - `length`: The maximum length of the resulting string.\n   * - `highlights`: Optional. If provided, the string will be highlighted using\n   *   this highlight information.\n   * - `cssClass`: Optional. When highlighting, the name of the CSS class to use.\n   */\n  shortenPath: (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => string;\n  /**\n   * Shortens a string using an algorithm suitable for URIs. The helper will\n   * insert an ellipsis in the string where text has been removed when the URI\n   * exceeds the maximum length.\n   *\n   * - `content`: The URI to shorten.\n   * - `length`: The maximum length of the resulting string.\n   * - `highlights`: Optional. If provided, the string will be highlighted\n   *   using this highlight information.\n   * - `cssClass`: Optional. When highlighting, the name of the CSS class to use.\n   */\n  shortenUri: (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => string;\n  /**\n   * Highlights a string using the provided highlight information.\n   *\n   * - `content`: The URI to shorten.\n   * - `highlights`: Optional. The highlight information to use.\n   * - `cssClass`: Optional. The name of the CSS class to use for highlighting.\n   */\n  highlight: (content: string, highlights?: IHighlight[], cssClass?: string) => string;\n  /**\n   * Highlights the provided terms in a given string.<br/>\n   * By default, the terms to highlight are the current query and the\n   * associated stemming words from the index.\n   * The only required parameter is the content, which specify the string that needs to be highlighted.\n   * The other parameters will normally be automatically resolved for you from the current result object.\n   *\n   * - `content`: The string content to highlight\n   * - `termsToHighlight`: The terms to highlight (see {@link IHighlightTerm})\n   * - `phraseToHighlight`: The phrases to highlight (see {@link IHighlightPhrase})\n   * - `options`: Optional. The options defined below as {@link IStreamHighlightOptions}\n   *\n   * **Note:**\n   * > `highlightStreamText` should only be used for very particular/specific use cases (e.g., augmenting the result template with additional information rather than the typical excerpt/title), and is not a proper replacement for actually having the correct title and excerpt on your results.\n   * >\n   * > Using incorrect result titles or excerpts on your search interface also causes relevancy to suffer greatly, as the index uses the title and excerpt to find relevant results. Consequently, end users are more likely to see results whose titles do not match their query.\n   * >\n   * > Moreover, the recommended method to implement simple title and/or excerpt highlighting is to simply use the {@link Excerpt} and {@link ResultLink} components.\n   */\n  highlightStreamText: (\n    content: string,\n    termsToHighlight: IHighlightTerm,\n    phrasesToHighlight: IHighlightPhrase,\n    options?: IStreamHighlightOptions\n  ) => string;\n  /**\n   * This helper operates exactly like the {@link highlightStreamText} helper, except\n   * that it should be used to highlight HTML content. The helper takes care\n   * of not highlighting the HTML markup.\n   *\n   * - `content`: The string content to highlight\n   * - `termsToHighlight`: The terms to highlight (see {@link IHighlightTerm})\n   * - `phraseToHighlight`: The phrases to highlight (see {@link IHighlightPhrase})\n   * - `options`: Optional. The options defined below as {@link IStreamHighlightOptions}\n   *\n   * **Note:**\n   * > `highlightStreamHTML` should only be used for very particular/specific use cases (e.g., augmenting the result template with additional information rather than the typical excerpt/title), and is not a proper replacement for actually having the correct title and excerpt on your results.\n   * >\n   * > Using incorrect result titles or excerpts on your search interface also causes relevancy to suffer greatly, as the index uses the title and excerpt to find relevant results. Consequently, end users are more likely to see results whose titles do not match their query.\n   * >\n   * > Moreover, the recommended method to implement simple title and/or excerpt highlighting is to simply use the {@link Excerpt} and {@link ResultLink} components.\n   */\n  highlightStreamHTML: (\n    content: string,\n    termsToHighlight: IHighlightTerm,\n    phrasesToHighlight: IHighlightPhrase,\n    options?: IStreamHighlightOptions\n  ) => string;\n  /**\n   * Formats a numeric value using the format string.\n   *\n   * - `content`: The numeric value to format.\n   * - `format` Optional. The string format to use. See the <a href=\"https://github.com/klaaspieter/jquery-global#numbers\" target=\"_blank\">Globalize</a> library for the list of available formats.\n   *\n   * When the helper is used in a [`FieldValue`]{@link FieldValue} component, this value is automatically retrieved from the specified [`field`]{@link FieldValue.options.field}.\n   *\n   * **Example:**\n   *\n   *  ```html\n   *  <div class=\"CoveoFieldValue\" data-field=\"@viewcount\" data-text-caption=\"Views\" data-helper=\"number\" data-helper-options-format=\"n0\"></div>\n   *  ```\n   */\n  number: (content: string, format: string | INumberFormatOptions) => string;\n  /**\n   * Formats a date value to a date-only string using the specified options.\n   *\n   * - `content`: The Date value to format.\n   * - `options`: Optional. The options to use (see {@link IDateToStringOptions}).\n   */\n  date: (content: any, options?: IDateToStringOptions) => string;\n  /**\n   * Formats a date value to a time-only string using the specified options.\n   *\n   * - `content`: The Date value to format.\n   * - `options`: Optional. The options to use (see {@link IDateToStringOptions}).\n   */\n  time: (content: any, options?: IDateToStringOptions) => string;\n  /**\n   * Formats a date value to a date and time string using the specified\n   * options.\n   *\n   * - `content`: The Date value to format.\n   * - `options`: Optional. The options to use (see {@link IDateToStringOptions}).\n   */\n  dateTime: (content: any, options?: IDateToStringOptions) => string;\n  /**\n   * Formats a currency value to a string using the specified options.\n   *\n   * - `content`: The number value to format.\n   * - `options`: Optional. The options to use (see {@link ICurrencyToStringOptions}).\n   */\n  currency: (content: any, options?: ICurrencyToStringOptions) => string;\n  /**\n   * Formats a date value to a date and time string using options suitable for\n   * email dates\n   *\n   * - `content`: The Date value to format.\n   * - `options`: Optional. The options to use (see {@link IDateToStringOptions}).\n   */\n  emailDateTime: (content: any, options?: IDateToStringOptions) => string;\n  /**\n   * Renders one or several email values in `mailto:` hyperlinks.\n   *\n   * - `value`: The string or array of strings that contains a list of semicolon-separated email\n   *   values. When multiple values are passed, each value is displayed in a\n   *   separate hyperlink.\n   * - `companyDomain`: Optional. The string that contains your own domain (e.g.:\n   *   coveo.com). When specified, this parameter allows email addresses\n   *   coming from your own domain to be displayed in a shortened format\n   *   (e.g.: Full Name), whereas email addresses coming from an external\n   *   domain will be displayed in an extended format (e.g.: Full Name\n   *   (domain.com)). If this parameter is not specified, then the shortened\n   *   format will automatically be used.\n   * - `me`: Optional. The string that contains the current username. If it is\n   *   specified, then the email address containing the current username will\n   *   be replaced by the localized string 'Me'.\n   * - `lengthLimit`: Optional. The number of email addresses that you want to display\n   *   before an ellipse is added (e.g.: 'From Joe, John and 5 others').<br/>\n   *   The default value is 2.\n   * - `truncateName`: Optional. When the username is available from the email address,\n   *   then you can specify if you want to truncate the full name. (e.g.:\n   *   'John S.' instead of 'John Smith').<br/>\n   *   The default value is `false`.\n   */\n  email: (value: string | string[], companyDomain?: string, me?: string, lengthLimit?: number, truncateName?: boolean) => string;\n  /**\n   * Formats a clickable HTML link (`<a>`).\n   *\n   * - `href`: The link URI\n   * - `options`: Optional. The options to use (see {@link IAnchorUtilsOptions})\n   */\n  anchor: (href: string, options?: IAnchorUtilsOptions) => string;\n  /**\n   * Formats an HTML image tag (`<img>`).\n   *\n   * - `src`: The image source URI\n   * - `options`: Optional. The options to use (see {@link IImageUtilsOptions})\n   */\n  image: (src: string, options?: IImageUtilsOptions) => string;\n  /**\n   * Formats an HTML image tag (`<img>`), and automatically uses the result\n   * object to query the REST API to get the thumbnail for this result. For\n   * example, this can be used to great effect when designing a template\n   * showing users or previews of files.\n   * - `result`: Optional. The current result object inside your template. In\n   *   underscore, it is referenced as `obj`. By default, the result\n   *   will be resolved automatically from your current template function (\n   *   Meaning the nearest result in the current call stack execution inside\n   *   your template)\n   * - `endpoint`: Optional. The name of the endpoint to use for your\n   *   thumbnail. Default is default.\n   * - `options`: Optional. The options to use (see {@link IImageUtilsOptions}).\n   */\n  thumbnail: (result?: IQueryResult, endpoint?: string, options?: IImageUtilsOptions) => string;\n  /**\n   * Generates an icon based on the file type of the current result. The icon\n   * will be contained inside a `<span>` element with the appropriate CSS\n   * class.\n   *\n   * - `result`: Optional. The current result object inside your template. In\n   *   underscore, it is referenced as `obj`. By default, the result\n   *   will be resolved automatically from your current template function (\n   *   Meaning the nearest result in the current call stack execution inside\n   *   your template)\n   * - `options`: Optional. The options to use (see {@link IIconOptions}).\n   */\n  fromFileTypeToIcon: (result?: IQueryResult, options?: any) => string;\n  /**\n   * Loads a partial template in the current template, by passing the ID of\n   * the template to load, the condition for which this template should be\n   * loaded, and the context object (the object that the loaded template will\n   * use as its data). By default, the context object will be the same as the\n   * template that called this helper function. So, for example, in a\n   * ResultList Component, the contextObject would, by default, be the Query\n   * Results.\n   *\n   * - `templateId`: The ID of the template to load.\n   * - `condition`: Optional. The boolean condition to determine if this template should\n   *   load for this result set. Most of the time this would be a condition of\n   *   the type if raw.somefield == 'something'.\n   * - `contextObject`: Optional. The object that should be used by the loaded template\n   *   as its contextObject.\n   */\n  loadTemplate: (templateId: string, condition?: boolean, contextObject?: any) => string;\n  /**\n   * Given a number, either in millisecond or second, convert to a HH:MM:SS format.\n   *\n   * **Examples**\n   *\n   * >`timeSpan(1, {isMilliseconds: false}) => '00:01'`\n   * >\n   * >`timeSpan(1000, {isMilliseconds: true}) => '00:01'`\n   *\n   * - `value`: The number to convert to a timespan\n   * - `options` : The options to use (see {@link ITimeSpanUtilsOptions})\n   */\n  timeSpan: (value: number, options: ITimeSpanUtilsOptions) => string;\n  /**\n   * Formats a number, which represents a file size in bytes, into a logical unit size.\n   *\n   * **Examples:**\n   *\n   * >`size(1024) => 1024 B`\n   * >\n   * >`size(1025) => 1 KB`\n   * >\n   * >`size(10240) => 10 KB`\n   *\n   * **Examples:**\n   *\n   * >**HTML**\n   * >\n   * > ```html\n   * > <div class=\"CoveoFieldValue\" data-field='@size' data-helper=\"size\" data-helper-options-base=\"1\"></div>\n   * > ```\n   *\n   * >**Underscore**\n   * >\n   * > ```erb\n   * > <%= size(raw.size, {base: 0, precision: 2}) %>\n   * > ```\n   *\n   * - `value`: The number to format\n   * - `options` : The options to use (see {@link ISizeOptions})\n   */\n  size: (value: number, options?: ISizeOptions) => string;\n  /**\n   * Given a filetype value, try to return a translated and human readable version.\n   *\n   * If the filetype is known and recognized by the framework, a translated value will be returned.\n   *\n   * **Examples**\n   *\n   * >`translatedCaption('doc') => Document`\n   * >\n   * >`translatedCaption('xls') => Spreadsheet Document`\n   *\n   * - `value`: The string value to translate\n   */\n  translatedCaption: (value: string) => string;\n  /**\n   * Replace all carriage return in a string by a &lt;br /&gt; tag\n   *\n   * - `value`: The string value to replace the carriage returns in.\n   */\n  encodeCarriageReturn: (value: string) => string;\n  /**\n   * Detect if the results is being rendered in a mobile device.\n   *\n   * If it's not a mobile device, the helper return null ;\n   *\n   * If it's a mobile device, return the type of device (Android, iPhone, iPad) etc.\n   */\n  isMobileDevice: () => string;\n}\n\n/**\n * Available options for the size templateHelpers.\n *\n * Example:\n * <div class=\"CoveoFieldValue\" data-helper=\"helperName\" data-helper-options-optionName=\"option-value\"></div>\n */\nexport interface ISizeOptions {\n  /**\n   * The base into which to format the value.\n   *\n   * Formula: value * 10^(3 * base)\n   *\n   * **Examples:**\n   * > **Base 0:**\n   * >\n   * > 1 => 1B\n   * >\n   * > 1000 => 1KB\n   *\n   * > **Base 1:**\n   * >\n   * > 1 => 1KB\n   * >\n   * > 1000 => 1MB\n   */\n  base?: number;\n  /**\n   * The precision to use to format the size (i.e., the number of digits to display after the decimal)\n   *\n   * **Examples:**\n   * > **Precision 0:**\n   * >\n   * > 1.0 => 1\n   * >\n   * > 1.85 => 1\n   *\n   * > **Precision 1:**\n   * >\n   * > 1.0 => 1.0\n   * >\n   * > 1.85 => 1.8\n   */\n\n  precision?: number;\n}\n\nexport interface IShortenOptions {\n  length: number;\n  highlights?: IHighlight[];\n  cssClass?: string;\n}\n\nexport interface IHighlightsOptions {\n  highlights: IHighlight[];\n  cssClass?: string;\n}\n\nexport interface IHelperStreamHighlightOptions {\n  termsToHighlight: IHighlightTerm;\n  phrasesToHighlight: IHighlightPhrase;\n  opts?: IStreamHighlightOptions;\n}\n\nexport class CoreHelpers {\n  public constructor() {}\n\n  /**\n   * For backward compatibility reason, the \"global\" template helper should be available under the\n   * coveo namespace.\n   * @param scope\n   */\n  public static exportAllHelpersGlobally(scope: IStringMap<any>) {\n    _.each(TemplateHelpers.getHelpers(), (helper: ITemplateHelperFunction, name: string) => {\n      if (scope[name] == undefined) {\n        scope[name] = helper;\n      }\n    });\n  }\n}\n\nTemplateHelpers.registerFieldHelper('javascriptEncode', (value: string) => {\n  return Utils.exists(value) ? StringUtils.javascriptEncode(value) : undefined;\n});\n\nconst executeShorten = (content: string, options: IShortenOptions) => {\n  const strAndHoles = StringAndHoles.shortenString(content, options.length, '...');\n  if (Utils.exists(options.highlights)) {\n    return HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n  } else {\n    return strAndHoles.value;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper('shorten', (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => {\n  return executeShorten(content, {\n    length,\n    highlights,\n    cssClass\n  });\n});\n\nTemplateHelpers.registerTemplateHelper('shortenv2', (content: string, options: IShortenOptions) => {\n  return executeShorten(content, options);\n});\n\nconst executeShortenPath = (content: string, options: IShortenOptions) => {\n  const strAndHoles = StringAndHoles.shortenPath(content, options.length);\n  if (Utils.exists(options.highlights)) {\n    return HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n  } else {\n    return strAndHoles.value;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper('shortenPath', (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => {\n  return executeShortenPath(content, {\n    length,\n    highlights,\n    cssClass\n  });\n});\n\nTemplateHelpers.registerFieldHelper('shortenPathv2', (content: string, options: IShortenOptions) => {\n  return executeShortenPath(content, options);\n});\n\nconst executeShortenUri = (content: string, options: IShortenOptions) => {\n  const strAndHoles = StringAndHoles.shortenUri(content, options.length);\n\n  if (Utils.exists(options.highlights)) {\n    return HighlightUtils.highlightString(strAndHoles.value, options.highlights, strAndHoles.holes, options.cssClass || 'highlight');\n  } else {\n    return strAndHoles.value;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper('shortenUri', (content: string, length: number, highlights?: IHighlight[], cssClass?: string) => {\n  return executeShortenUri(content, {\n    length,\n    highlights,\n    cssClass\n  });\n});\n\nTemplateHelpers.registerTemplateHelper('shortenUriv2', (content: string, options: IShortenOptions) => {\n  return executeShortenUri(content, options);\n});\n\nconst executeHighlight = (content: string, options: IHighlightsOptions) => {\n  if (Utils.exists(content)) {\n    if (Utils.exists(options.highlights)) {\n      return HighlightUtils.highlightString(content, options.highlights, null, options.cssClass || 'highlight');\n    } else {\n      return content;\n    }\n  } else {\n    return undefined;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper('highlight', (content: string, highlights: IHighlight[], cssClass?: string) => {\n  return executeHighlight(content, {\n    highlights,\n    cssClass\n  });\n});\n\nTemplateHelpers.registerTemplateHelper('highlightv2', (content: string, options: IHighlightsOptions) => {\n  return executeHighlight(content, options);\n});\n\nconst executeHighlightStreamText = (content: string, options: IHelperStreamHighlightOptions) => {\n  if (Utils.exists(content) && Utils.exists(options.termsToHighlight) && Utils.exists(options.phrasesToHighlight)) {\n    if (termsToHighlightAreDefined(options.termsToHighlight, options.phrasesToHighlight)) {\n      return StreamHighlightUtils.highlightStreamText(content, options.termsToHighlight, options.phrasesToHighlight, options.opts);\n    } else {\n      return content;\n    }\n  } else {\n    return undefined;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper(\n  'highlightStreamText',\n  (\n    content: string,\n    termsToHighlight = resolveTermsToHighlight(),\n    phrasesToHighlight = resolvePhrasesToHighlight(),\n    opts?: IStreamHighlightOptions\n  ) => {\n    return executeHighlightStreamText(content, {\n      termsToHighlight,\n      phrasesToHighlight,\n      opts\n    });\n  }\n);\n\nTemplateHelpers.registerTemplateHelper('highlightStreamTextv2', (content: string, options: IHelperStreamHighlightOptions) => {\n  const mergedOptions = {\n    termsToHighlight: resolveTermsToHighlight(),\n    phrasesToHighlight: resolvePhrasesToHighlight(),\n    ...options\n  };\n  return executeHighlightStreamText(content, mergedOptions);\n});\n\nconst executeHighlightStreamHTML = (content: string, options: IHelperStreamHighlightOptions) => {\n  if (Utils.exists(content) && Utils.exists(options.termsToHighlight) && Utils.exists(options.phrasesToHighlight)) {\n    if (termsToHighlightAreDefined(options.termsToHighlight, options.phrasesToHighlight)) {\n      return StreamHighlightUtils.highlightStreamHTML(content, options.termsToHighlight, options.phrasesToHighlight, options.opts);\n    } else {\n      return content;\n    }\n  } else {\n    return undefined;\n  }\n};\n\nTemplateHelpers.registerTemplateHelper(\n  'highlightStreamHTML',\n  (\n    content: string,\n    termsToHighlight = resolveTermsToHighlight(),\n    phrasesToHighlight = resolvePhrasesToHighlight(),\n    opts?: IStreamHighlightOptions\n  ) => {\n    return executeHighlightStreamHTML(content, {\n      termsToHighlight,\n      phrasesToHighlight,\n      opts\n    });\n  }\n);\n\nTemplateHelpers.registerTemplateHelper('highlightStreamHTMLv2', (content: string, options: IHelperStreamHighlightOptions) => {\n  const mergedOptions = {\n    termsToHighlight: resolveTermsToHighlight(),\n    phrasesToHighlight: resolvePhrasesToHighlight(),\n    ...options\n  };\n  return executeHighlightStreamHTML(content, mergedOptions);\n});\n\nTemplateHelpers.registerFieldHelper('number', (value: any, options?: INumberFormatOptions | string) => {\n  if (!Utils.exists(value)) {\n    return undefined;\n  }\n\n  const numberValue = Number(value);\n  const format = _.isString(options) ? options : options && options.format;\n  if (!format) {\n    return StringUtils.htmlEncode(numberValue.toString());\n  }\n\n  return StringUtils.htmlEncode(Globalize.format(numberValue, <string>format));\n});\n\nTemplateHelpers.registerFieldHelper('date', (value: any, options?: IDateToStringOptions) => {\n  return DateUtils.dateToString(DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\n\nTemplateHelpers.registerFieldHelper('time', (value: any, options?: IDateToStringOptions) => {\n  return DateUtils.timeToString(DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\n\nTemplateHelpers.registerFieldHelper('dateTime', (value: any, options?: IDateToStringOptions) => {\n  return DateUtils.dateTimeToString(DateUtils.convertFromJsonDateIfNeeded(value), options);\n});\n\nTemplateHelpers.registerFieldHelper('emailDateTime', (value: any, options?: IDateToStringOptions) => {\n  var defaultOptions = <IDateToStringOptions>{};\n  defaultOptions.includeTimeIfThisWeek = true;\n  var optionsToUse = <IDateToStringOptions>_.extend(options, defaultOptions);\n  return value ? DateUtils.dateTimeToString(DateUtils.convertFromJsonDateIfNeeded(value), optionsToUse) : undefined;\n});\n\nTemplateHelpers.registerFieldHelper('currency', (value: any, options?: ICurrencyToStringOptions) => {\n  return CurrencyUtils.currencyToString(value, options);\n});\n\nTemplateHelpers.registerFieldHelper('timeSpan', (value: any, options: ITimeSpanUtilsOptions = { isMilliseconds: false }) => {\n  return new TimeSpan(value, options.isMilliseconds).getHHMMSS();\n});\n\nTemplateHelpers.registerFieldHelper('email', (value: string | string[], ...args: any[]) => {\n  // support old arguments (value: any, companyDomain: string, me: string, lengthLimit = 2, truncateName = false)\n  var companyDomain: string;\n  var me: string;\n  var lengthLimit: number;\n  var truncateName: boolean;\n  if (_.isObject(args[0])) {\n    companyDomain = args[0]['companyDomain'];\n    me = args[0]['me'];\n    lengthLimit = args[0]['lengthLimit'];\n    truncateName = args[0]['truncateName'];\n  } else {\n    companyDomain = args[0];\n    me = args[1];\n    lengthLimit = args[2];\n    truncateName = args[3];\n  }\n  if (lengthLimit == undefined) {\n    lengthLimit = 2;\n  }\n  if (truncateName == undefined) {\n    truncateName = false;\n  }\n  if (_.isString(value)) {\n    var listOfAddresses = EmailUtils.splitSemicolonSeparatedListOfEmailAddresses(<string>value);\n    return EmailUtils.emailAddressesToHyperlinks(listOfAddresses, companyDomain, me, lengthLimit, truncateName);\n  } else if (_.isArray(value)) {\n    return EmailUtils.emailAddressesToHyperlinks(<string[]>value, companyDomain, me, lengthLimit, truncateName);\n  } else {\n    return undefined;\n  }\n});\n\nTemplateHelpers.registerTemplateHelper('excessEmailToggle', (target: HTMLElement) => {\n  $$(target).removeClass('coveo-active');\n  if ($$(target).hasClass('coveo-emails-excess-collapsed')) {\n    _.each($$(target).siblings('.coveo-emails-excess-expanded'), sibling => {\n      $$(sibling).addClass('coveo-active');\n    });\n  } else if ($$(target).hasClass('coveo-hide-expanded')) {\n    $$(target.parentElement).addClass('coveo-inactive');\n    _.each($$(target.parentElement).siblings('.coveo-emails-excess-collapsed'), sibling => {\n      $$(sibling).addClass('coveo-active');\n    });\n  }\n  return undefined;\n});\n\nTemplateHelpers.registerFieldHelper('anchor', (href: string, options?: IAnchorUtilsOptions) => {\n  return AnchorUtils.buildAnchor(href, options);\n});\n\nTemplateHelpers.registerFieldHelper('image', (src: string, options?: IImageUtilsOptions, result: IQueryResult = resolveQueryResult()) => {\n  if (options && options.srcTemplate) {\n    return ImageUtils.buildImage(StringUtils.buildStringTemplateFromResult(options.srcTemplate, result), {\n      alt: options.alt,\n      height: options.height,\n      width: options.width\n    });\n  }\n  return ImageUtils.buildImage(src, options);\n});\n\nTemplateHelpers.registerTemplateHelper(\n  'thumbnail',\n  (result: IQueryResult = resolveQueryResult(), endpoint: string = 'default', options?: IImageUtilsOptions) => {\n    if (QueryUtils.hasThumbnail(result)) {\n      return ImageUtils.buildImageFromResult(result, SearchEndpoint.endpoints[endpoint], options);\n    }\n  }\n);\n\nTemplateHelpers.registerTemplateHelper('fromFileTypeToIcon', (result: IQueryResult = resolveQueryResult(), options = {}) => {\n  let icon = Component.getComponentRef('Icon');\n  if (icon) {\n    return icon.createIcon(result, options).outerHTML;\n  }\n});\n\nTemplateHelpers.registerTemplateHelper('attrEncode', (value: string) => {\n  return ('' + value) /* Forces the conversion to string. */\n    .replace(/&/g, '&amp;') /* This MUST be the 1st replacement. */\n    .replace(/'/g, '&apos;') /* The 4 other predefined entities, required. */\n    .replace(/'/g, '&quot;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;');\n});\n\nTemplateHelpers.registerTemplateHelper('loadTemplates', (templatesToLoad: { [id: string]: any }, once = true) => {\n  var ret = '';\n  var data = resolveQueryResult();\n  var atLeastOneWasLoaded = false;\n  var toLoad = templatesToLoad;\n  var defaultTmpl;\n  _.each(templatesToLoad, (value, key?, obj?) => {\n    if (value == 'default') {\n      defaultTmpl = key;\n    }\n  });\n  if (defaultTmpl != undefined) {\n    toLoad = _.omit(templatesToLoad, defaultTmpl);\n  }\n  _.each(toLoad, (condition, id?, obj?) => {\n    if (!atLeastOneWasLoaded || !once) {\n      atLeastOneWasLoaded = atLeastOneWasLoaded || condition;\n      ret += TemplateHelpers.getHelper('loadTemplate')(id, condition, data);\n    }\n  });\n  if (!atLeastOneWasLoaded && defaultTmpl != undefined) {\n    ret += TemplateHelpers.getHelper('loadTemplate')(defaultTmpl, true, data);\n  }\n  return ret;\n});\n\nconst byteMeasure = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB'];\n\nTemplateHelpers.registerFieldHelper('size', (value: any, options?: ISizeOptions) => {\n  var size = parseInt(value, 10);\n  var precision = options != null && options.precision != null ? options.precision : 2;\n  var base = options != null && options.base != null ? options.base : 0;\n  while (size > 1024 && base + 1 < byteMeasure.length) {\n    size /= 1024;\n    base++;\n  }\n  size = Math.floor(size * Math.pow(10, precision)) / Math.pow(10, precision);\n  return size + ' ' + byteMeasure[base];\n});\n\nTemplateHelpers.registerFieldHelper('translatedCaption', (value: string) => {\n  return FacetUtils.tryToGetTranslatedCaption('@filetype', value);\n});\n\nTemplateHelpers.registerTemplateHelper('loadTemplate', (id: string, condition: boolean = true, data?: any) => {\n  if (Utils.isNullOrUndefined(data)) {\n    data = resolveQueryResult();\n  }\n  if (condition) {\n    return TemplateCache.getTemplate(id).instantiateToString(data, {\n      checkCondition: false\n    });\n  }\n  return '';\n});\n\nTemplateHelpers.registerTemplateHelper('encodeCarriageReturn', (data: string) => {\n  if (Utils.isNullOrUndefined(data)) {\n    return undefined;\n  } else {\n    return StringUtils.encodeCarriageReturn(data);\n  }\n});\n\nTemplateHelpers.registerTemplateHelper('isMobileDevice', () => {\n  return DeviceUtils.isMobileDevice() ? DeviceUtils.getDeviceName() : null;\n});\n\nfunction resolveQueryResult(): IQueryResult {\n  let found;\n  let resultList = Component.getComponentRef('ResultList');\n  if (resultList) {\n    found = resultList.resultCurrentlyBeingRendered;\n  }\n  if (!found) {\n    let quickview = Component.getComponentRef('Quickview');\n    if (quickview) {\n      found = quickview.resultCurrentlyBeingRendered;\n    }\n  }\n  return found;\n}\n\nfunction resolveTermsToHighlight(): IHighlightTerm {\n  let currentQueryResult = resolveQueryResult();\n  if (currentQueryResult) {\n    return currentQueryResult.termsToHighlight;\n  }\n}\n\nfunction resolvePhrasesToHighlight(): IHighlightPhrase {\n  let currentQueryResult = resolveQueryResult();\n  if (currentQueryResult) {\n    return currentQueryResult.phrasesToHighlight;\n  }\n}\n\nfunction termsToHighlightAreDefined(termsToHighlight, phrasesToHighlight) {\n  return Utils.isNonEmptyArray(_.keys(termsToHighlight)) || Utils.isNonEmptyArray(_.keys(phrasesToHighlight));\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Templates/CoreHelpers.ts","import { $$, Dom } from '../../../utils/Dom';\nimport { SVGDom } from '../../../utils/SVGDom';\n\nexport interface IDynamicFacetHeaderButtonOptions {\n  label: string;\n  ariaLabel?: string;\n  shouldDisplay?: boolean;\n  className?: string;\n  iconSVG?: string;\n  iconClassName?: string;\n  action?: () => void;\n}\n\nexport class DynamicFacetHeaderButton {\n  private button: Dom;\n  public element: HTMLElement;\n\n  constructor(private rootOptions: IDynamicFacetHeaderButtonOptions) {\n    this.create();\n  }\n\n  private create() {\n    const hasIcon = this.rootOptions.iconSVG && this.rootOptions.iconClassName;\n\n    this.button = $$(\n      'button',\n      {\n        className: `coveo-dynamic-facet-header-btn ${this.rootOptions.className || ''}`.trim(),\n        type: 'button'\n      },\n      hasIcon ? this.rootOptions.iconSVG : this.rootOptions.label\n    );\n\n    this.rootOptions.action && this.button.on('click', this.rootOptions.action);\n\n    if (hasIcon) {\n      this.button.setAttribute('aria-label', this.rootOptions.label);\n      this.button.setAttribute('title', this.rootOptions.label);\n      SVGDom.addClassToSVGInContainer(this.button.el, this.rootOptions.iconClassName);\n    }\n\n    if (this.rootOptions.ariaLabel) {\n      this.button.setAttribute('aria-label', this.rootOptions.ariaLabel);\n    }\n\n    if (this.rootOptions.shouldDisplay !== undefined) {\n      this.toggle(this.rootOptions.shouldDisplay);\n    }\n\n    this.element = this.button.el;\n  }\n\n  public toggle(shouldDisplay: boolean) {\n    this.button.toggle(shouldDisplay);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetHeader/DynamicFacetHeaderButton.ts","import { FacetType, IFacetRequest } from '../rest/Facet/FacetRequest';\nimport { FacetSortCriteria } from '../rest/Facet/FacetSortCriteria';\nimport { IQuery } from '../rest/Query';\nimport { Utils } from '../utils/Utils';\n\nexport interface IBasicFacetRequestParameters {\n  facetId: string;\n  field: string;\n  type: FacetType;\n  injectionDepth: number;\n  sortCriteria?: FacetSortCriteria;\n  delimitingCharacter?: string;\n  filterFacetCount?: boolean;\n}\n\nexport class DynamicFacetRequestBuilder {\n  constructor(private request: IFacetRequest) {}\n\n  public buildBaseRequestForQuery(query: IQuery): IFacetRequest {\n    return {\n      ...this.request,\n      filterFacetCount: this.getFilterFacetCount(!!query.filterField)\n    };\n  }\n\n  private getFilterFacetCount(isFoldingEnabled: boolean) {\n    if (Utils.isUndefined(this.request.filterFacetCount)) {\n      return !isFoldingEnabled;\n    }\n\n    return this.request.filterFacetCount;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/DynamicFacetRequestBuilder.ts","import 'styling/DynamicFacet/_DynamicFacetHeader';\nimport { $$, Dom } from '../../../utils/Dom';\nimport { l } from '../../../strings/Strings';\nimport { SVGIcons } from '../../../utils/SVGIcons';\nimport { SVGDom } from '../../../utils/SVGDom';\nimport { DynamicFacetHeaderButton } from './DynamicFacetHeaderButton';\nimport { DynamicFacetHeaderCollapseToggle } from './DynamicFacetHeaderCollapseToggle';\n\nexport interface IDynamicFacetHeaderOptions {\n  title: string;\n  enableCollapse: boolean;\n  toggleCollapse: () => void;\n  collapse: () => void;\n  expand: () => void;\n  clear: () => void;\n}\n\nexport class DynamicFacetHeader {\n  public static showLoadingDelay = 2000;\n  public element: HTMLElement;\n  private title: Dom;\n  private waitAnimation: Dom;\n  private clearButton: DynamicFacetHeaderButton;\n  private collapseToggle: DynamicFacetHeaderCollapseToggle;\n  private showLoadingTimeout: number;\n\n  constructor(public options: IDynamicFacetHeaderOptions) {\n    this.element = $$('div', { className: 'coveo-dynamic-facet-header' }).el;\n    this.title = this.createTitle();\n    $$(this.element).append(this.title.el);\n    $$(this.element).append(this.createWaitAnimation());\n    $$(this.element).append(this.createClearButton());\n    this.options.enableCollapse && this.enableCollapse();\n  }\n\n  private createClearButton() {\n    this.clearButton = new DynamicFacetHeaderButton({\n      label: l('Clear'),\n      ariaLabel: l('Clear', this.options.title),\n      className: 'coveo-dynamic-facet-header-clear',\n      shouldDisplay: false,\n      action: () => this.options.clear()\n    });\n\n    return this.clearButton.element;\n  }\n\n  private createCollapseToggle() {\n    this.collapseToggle = new DynamicFacetHeaderCollapseToggle(this.options);\n    return this.collapseToggle.element;\n  }\n\n  private enableCollapse() {\n    $$(this.element).append(this.createCollapseToggle());\n    $$(this.title).addClass('coveo-clickable');\n    $$(this.title).on('click', () => this.options.toggleCollapse());\n  }\n\n  public toggleCollapse(isCollapsed: boolean) {\n    this.options.enableCollapse && this.collapseToggle.toggleButtons(isCollapsed);\n  }\n\n  private createTitle() {\n    return $$(\n      'h2',\n      {\n        className: 'coveo-dynamic-facet-header-title',\n        ariaLabel: `${l('FacetTitle', this.options.title)}`\n      },\n      $$('span', { ariaHidden: true, title: this.options.title }, this.options.title)\n    );\n  }\n\n  private createWaitAnimation() {\n    this.waitAnimation = $$('div', { className: 'coveo-dynamic-facet-header-wait-animation' }, SVGIcons.icons.loading);\n    SVGDom.addClassToSVGInContainer(this.waitAnimation.el, 'coveo-dynamic-facet-header-wait-animation-svg');\n    this.waitAnimation.toggle(false);\n\n    return this.waitAnimation.el;\n  }\n\n  public toggleClear(visible: boolean) {\n    this.clearButton.toggle(visible);\n  }\n\n  public showLoading() {\n    clearTimeout(this.showLoadingTimeout);\n    this.showLoadingTimeout = window.setTimeout(() => this.waitAnimation.toggle(true), DynamicFacetHeader.showLoadingDelay);\n  }\n\n  public hideLoading() {\n    clearTimeout(this.showLoadingTimeout);\n    this.waitAnimation.toggle(false);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetHeader/DynamicFacetHeader.ts","/**\n * The allowed sort criteria for a Search API\n * [facet request]{@link IFacetRequest}.\n */\nexport enum FacetSortCriteria {\n  /**\n   * Sort facet values in descending score order.\n   *\n   * Facet value scores are based on number of occurrences and position in the\n   * ranked query result set.\n   *\n   * The Coveo Machine Learning dynamic navigation experience feature only\n   * works with this sort criterion.\n   */\n  score = 'score',\n  /**\n   * Sort facet values in ascending alphanumeric order.\n   */\n  alphanumeric = 'alphanumeric',\n  /**\n   * Sort facet values in descending number of occurrences.\n   */\n  occurrences = 'occurrences'\n}\n\nexport function isFacetSortCriteria(sortCriteria: string) {\n  return !!FacetSortCriteria[sortCriteria];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/rest/Facet/FacetSortCriteria.ts","import { $$ } from '../../utils/Dom';\nimport { ComboboxInput } from './ComboboxInput';\nimport { uniqueId, throttle } from 'underscore';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { SVGDom } from '../../utils/SVGDom';\nimport { ComboboxValues } from './ComboboxValues';\nimport 'styling/_Combobox';\nimport { Utils } from '../../utils/Utils';\nimport { l } from '../../strings/Strings';\nimport { IComboboxOptions, ICombobox, IComboboxAccessibilityAttributes } from './ICombobox';\n\nexport class Combobox implements ICombobox {\n  public element: HTMLElement;\n  public id: string;\n  public values: ComboboxValues;\n  private input: ComboboxInput;\n  private waitAnimationElement: HTMLElement;\n  private defaultOptions: Partial<IComboboxOptions> = {\n    wrapperClassName: '',\n    clearOnBlur: false\n  };\n  private throttlingDelay = 600;\n  private isRequestCancelled = false;\n\n  constructor(public options: IComboboxOptions) {\n    this.options = {\n      ...this.defaultOptions,\n      ...this.options\n    };\n\n    this.id = uniqueId('coveo-combobox-');\n    this.create();\n  }\n\n  private create() {\n    this.element = $$('div', { className: `coveo-combobox-wrapper ${this.options.wrapperClassName}` }).el;\n    this.createAndAppendInput();\n    this.createAndAppendWaitAnimation();\n    this.createAndAppendValues();\n  }\n\n  private createAndAppendInput() {\n    this.input = new ComboboxInput(this);\n    this.element.appendChild(this.input.element);\n  }\n\n  private createAndAppendWaitAnimation() {\n    this.waitAnimationElement = $$('div', { className: 'coveo-combobox-wait-animation' }, SVGIcons.icons.loading).el;\n    SVGDom.addClassToSVGInContainer(this.waitAnimationElement, 'coveo-combobox-wait-animation-svg');\n    this.toggleWaitAnimation(false);\n    this.input.element.appendChild(this.waitAnimationElement);\n  }\n\n  private toggleWaitAnimation(show: boolean) {\n    $$(this.waitAnimationElement).toggle(show);\n  }\n\n  private createAndAppendValues() {\n    this.values = new ComboboxValues(this);\n    this.element.appendChild(this.values.element);\n  }\n\n  public clearAll() {\n    this.clearValues();\n    this.input.clearInput();\n  }\n\n  private clearValues() {\n    this.values.clearValues();\n    this.cancelRequest();\n  }\n\n  private cancelRequest() {\n    this.toggleWaitAnimation(false);\n    this.throttledRequest.cancel();\n    this.isRequestCancelled = true;\n  }\n\n  public onInputChange(value: string) {\n    if (Utils.isEmptyString(value)) {\n      return this.clearValues();\n    }\n\n    this.throttledRequest(\n      () => this.options.requestValues(value),\n      () => this.values.resetScroll()\n    );\n  }\n\n  public onInputBlur() {\n    if (this.values.mouseIsOverValue) {\n      return;\n    }\n\n    if (this.values.isRenderingNewValues) {\n      return;\n    }\n\n    if (this.options.clearOnBlur) {\n      return this.clearAll();\n    }\n\n    this.clearValues();\n  }\n\n  public updateAccessibilityAttributes(attributes: IComboboxAccessibilityAttributes) {\n    this.input.updateAccessibilityAttributes(attributes);\n  }\n\n  public updateAriaLive() {\n    if (!this.values.hasValues()) {\n      this.options.ariaLive.updateText(l('NoValuesFound'));\n      return;\n    }\n\n    let text = l('ShowingResultsWithQuery', this.values.numberOfValues, this.input.value, this.values.numberOfValues);\n    if (this.options.scrollable && this.options.scrollable.areMoreValuesAvailable()) {\n      text = `${text} (${l('MoreValuesAvailable')})`;\n    }\n\n    this.options.ariaLive.updateText(text);\n  }\n\n  public onScrollEndReached() {\n    this.values.saveFocusedValue();\n    this.options.scrollable &&\n      this.throttledRequest(\n        () => this.options.scrollable.requestMoreValues(),\n        () => this.values.restoreFocusedValue()\n      );\n  }\n\n  private throttledRequest = throttle(this.triggerRequest, this.throttlingDelay, {\n    leading: true,\n    trailing: true\n  });\n\n  private async triggerRequest(request: () => Promise<any>, callback?: Function) {\n    this.isRequestCancelled = false;\n    this.toggleWaitAnimation(true);\n\n    const response = await request();\n    this.toggleWaitAnimation(false);\n\n    if (!this.isRequestCancelled) {\n      this.values.renderFromResponse(response);\n      callback && callback();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Combobox/Combobox.ts","import { Checkbox } from '../../FormWidgets/Checkbox';\nimport { DynamicFacetValue } from './DynamicFacetValue';\nimport { $$ } from '../../../utils/Dom';\n\nexport class DynamicFacetValueCheckbox {\n  private checkbox: Checkbox;\n  public element: HTMLElement;\n\n  constructor(private facetValue: DynamicFacetValue, selectAction = () => {}) {\n    this.checkbox = new Checkbox(\n      selectAction.bind(this),\n      this.facetValue.displayValue,\n      this.facetValue.selectAriaLabel,\n      `(${this.facetValue.formattedCount})`\n    );\n\n    const label = $$(this.checkbox.getElement()).find('.coveo-checkbox-span-label');\n    const labelSuffix = $$(this.checkbox.getElement()).find('.coveo-checkbox-span-label-suffix');\n\n    if (label && labelSuffix) {\n      label.setAttribute('title', this.facetValue.displayValue);\n      label.setAttribute('aria-hidden', 'true');\n      labelSuffix.setAttribute('aria-hidden', 'true');\n    }\n\n    this.facetValue.isSelected && this.checkbox.select(false);\n    this.element = this.checkbox.getElement();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValueCheckbox.ts","import 'styling/DynamicFacet/_DynamicFacetValues';\nimport { $$ } from '../../../utils/Dom';\nimport { findWhere, find, escape } from 'underscore';\nimport { DynamicFacetValue } from './DynamicFacetValue';\nimport { IFacetResponse } from '../../../rest/Facet/FacetResponse';\nimport { FacetValueState } from '../../../rest/Facet/FacetValueState';\nimport { l } from '../../../strings/Strings';\nimport { IDynamicFacet, IValueCreator, IDynamicFacetValue, IDynamicFacetValues } from '../IDynamicFacet';\nimport { DynamicFacetValueShowMoreLessButton } from './DynamicFacetValueMoreLessButton';\n\nexport interface IDynamicFacetValueCreatorKlass {\n  new (facet: IDynamicFacet): IValueCreator;\n}\n\nexport class DynamicFacetValues implements IDynamicFacetValues {\n  private facetValues: IDynamicFacetValue[];\n  private list = $$('ul', { className: 'coveo-dynamic-facet-values' }).el;\n  private valueCreator: IValueCreator;\n\n  constructor(private facet: IDynamicFacet, creatorKlass: IDynamicFacetValueCreatorKlass) {\n    this.valueCreator = new creatorKlass(this.facet);\n    this.resetValues();\n  }\n\n  public createFromResponse(response: IFacetResponse) {\n    this.facetValues = response.values.map((facetValue, index) => this.valueCreator.createFromResponse(facetValue, index));\n  }\n\n  public resetValues() {\n    this.facetValues = this.valueCreator.getDefaultValues();\n  }\n\n  public get allFacetValues() {\n    return this.facetValues;\n  }\n\n  public get allValues() {\n    return this.facetValues.map(facetValue => facetValue.value);\n  }\n\n  public get selectedValues() {\n    return this.facetValues.filter(value => value.isSelected).map(({ value }) => value);\n  }\n\n  private get selectedDisplayValues() {\n    return this.facetValues.filter(value => value.isSelected).map(({ displayValue }) => displayValue);\n  }\n\n  public get activeValues() {\n    return this.facetValues.filter(value => !value.isIdle);\n  }\n\n  private get displayedValues() {\n    return this.facetValues.filter(value => !value.isIdle || value.numberOfResults > 0);\n  }\n\n  public get hasSelectedValues() {\n    return !!findWhere(this.facetValues, { state: FacetValueState.selected });\n  }\n\n  public get hasActiveValues() {\n    return !!this.activeValues.length;\n  }\n\n  public get hasIdleValues() {\n    return !!findWhere(this.facetValues, { state: FacetValueState.idle });\n  }\n\n  public clearAll() {\n    this.facetValues.forEach(value => value.deselect());\n  }\n\n  public get hasValues() {\n    return !!this.allFacetValues.length;\n  }\n\n  public get hasDisplayedValues() {\n    return !!this.displayedValues.length;\n  }\n\n  public hasSelectedValue(arg: string | DynamicFacetValue) {\n    const value = typeof arg === 'string' ? arg : arg.value;\n    const foundValue = find(this.facetValues, facetValue => facetValue.equals(value));\n    return foundValue && foundValue.isSelected;\n  }\n\n  public get(arg: string | DynamicFacetValue) {\n    const value = typeof arg === 'string' ? arg : arg.value;\n    const facetValue = find(this.facetValues, facetValue => facetValue.equals(value));\n\n    if (facetValue) {\n      return facetValue;\n    }\n\n    const newFacetValue = this.valueCreator.createFromValue(value);\n    if (!newFacetValue) {\n      return null;\n    }\n\n    this.facetValues.push(newFacetValue);\n    return newFacetValue;\n  }\n\n  private buildShowLess() {\n    const showLess = new DynamicFacetValueShowMoreLessButton({\n      className: 'coveo-dynamic-facet-show-less',\n      ariaLabel: l('ShowLessFacetResults', this.facet.options.title),\n      label: l('ShowLess'),\n      action: () => {\n        this.facet.enableFreezeFacetOrderFlag();\n        this.facet.showLessValues();\n      }\n    });\n\n    return showLess.element;\n  }\n\n  private buildShowMore() {\n    const showMore = new DynamicFacetValueShowMoreLessButton({\n      className: 'coveo-dynamic-facet-show-more',\n      ariaLabel: l('ShowMoreFacetResults', this.facet.options.title),\n      label: l('ShowMore'),\n      action: () => {\n        this.facet.enableFreezeFacetOrderFlag();\n        this.facet.showMoreValues();\n      }\n    });\n\n    return showMore.element;\n  }\n\n  private get shouldEnableShowLess() {\n    const hasMoreValuesThenDefault = this.facetValues.length > this.facet.options.numberOfValues;\n\n    return hasMoreValuesThenDefault && this.hasIdleValues;\n  }\n\n  private appendShowMoreLess(fragment: DocumentFragment) {\n    if (!this.facet.options.enableMoreLess) {\n      return;\n    }\n\n    if (this.shouldEnableShowLess) {\n      fragment.appendChild(this.buildShowLess());\n    }\n\n    if (this.facet.moreValuesAvailable) {\n      fragment.appendChild(this.buildShowMore());\n    }\n  }\n\n  private appendSelectedCollapsedValues(fragment: DocumentFragment) {\n    if (!this.hasSelectedValues) {\n      return;\n    }\n\n    const selectedValues = this.selectedDisplayValues.join(', ');\n    fragment.appendChild(\n      $$(\n        'li',\n        {\n          className: 'coveo-dynamic-facet-collapsed-values',\n          ariaLabel: `${l('CurrentSelections')}: ${selectedValues}`\n        },\n        escape(selectedValues)\n      ).el\n    );\n  }\n\n  public render() {\n    const fragment = document.createDocumentFragment();\n    $$(this.list).empty();\n\n    this.displayedValues.forEach(facetValue => {\n      fragment.appendChild(facetValue.renderedElement);\n    });\n\n    this.appendShowMoreLess(fragment);\n\n    this.appendSelectedCollapsedValues(fragment);\n\n    this.list.appendChild(fragment);\n    return this.list;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValues.ts","import { QueryBuilder } from '../ui/Base/QueryBuilder';\nimport { Assert } from '../misc/Assert';\nimport { IFacetRequest, IFacetRequestValue } from '../rest/Facet/FacetRequest';\nimport { QueryEvents } from '../events/QueryEvents';\nimport { findIndex } from 'underscore';\nimport { IQueryResults } from '../rest/QueryResults';\nimport { IDynamicFacet } from '../ui/DynamicFacet/IDynamicFacet';\nimport { DynamicFacetRequestBuilder } from './DynamicFacetRequestBuilder';\nimport { IQuery } from '../rest/Query';\n\nexport class DynamicFacetQueryController {\n  protected requestBuilder: DynamicFacetRequestBuilder;\n  private numberOfValuesToRequest: number;\n  private freezeCurrentValues = false;\n  private freezeFacetOrder = false;\n  private preventAutoSelection = false;\n\n  constructor(protected facet: IDynamicFacet) {\n    this.requestBuilder = new DynamicFacetRequestBuilder({\n      facetId: this.facet.options.id,\n      field: this.facet.fieldName,\n      type: this.facet.facetType,\n      sortCriteria: this.facet.options.sortCriteria,\n      injectionDepth: this.facet.options.injectionDepth,\n      filterFacetCount: this.facet.options.filterFacetCount\n    });\n    this.resetNumberOfValuesToRequest();\n    this.resetFlagsDuringQuery();\n  }\n\n  private resetFlagsDuringQuery() {\n    this.facet.bind.onRootElement(QueryEvents.duringQuery, () => {\n      this.freezeCurrentValues = false;\n      this.freezeFacetOrder = false;\n      this.preventAutoSelection = false;\n    });\n  }\n\n  public increaseNumberOfValuesToRequest(additionalNumberOfValues: number) {\n    this.numberOfValuesToRequest += additionalNumberOfValues;\n  }\n\n  public resetNumberOfValuesToRequest() {\n    this.numberOfValuesToRequest = this.facet.options.numberOfValues;\n  }\n\n  public enablePreventAutoSelectionFlag() {\n    this.preventAutoSelection = true;\n  }\n\n  public enableFreezeCurrentValuesFlag() {\n    if (this.areValuesIncorrectlyAffectedByDependsOn) {\n      return;\n    }\n\n    this.freezeCurrentValues = true;\n  }\n\n  public enableFreezeFacetOrderFlag() {\n    this.freezeFacetOrder = true;\n  }\n\n  private get areValuesIncorrectlyAffectedByDependsOn() {\n    if (!this.facet.dependsOnManager.hasDependentFacets) {\n      return false;\n    }\n\n    if (this.facet.dependsOnManager.dependentFacetsHaveSelectedValues) {\n      return false;\n    }\n\n    return this.currentValues.length < this.numberOfValuesToRequest;\n  }\n\n  /**\n   * Build the facets request for the DynamicFacet, and insert it in the query builder\n   * @param queryBuilder\n   */\n  public putFacetIntoQueryBuilder(queryBuilder: QueryBuilder) {\n    Assert.exists(queryBuilder);\n\n    queryBuilder.facetRequests.push(this.buildFacetRequest(queryBuilder.build()));\n    if (this.freezeFacetOrder) {\n      queryBuilder.facetOptions.freezeFacetOrder = true;\n    }\n  }\n\n  public buildFacetRequest(query: IQuery): IFacetRequest {\n    return {\n      ...this.requestBuilder.buildBaseRequestForQuery(query),\n      currentValues: this.currentValues,\n      numberOfValues: this.numberOfValues,\n      freezeCurrentValues: this.freezeCurrentValues,\n      preventAutoSelect: this.preventAutoSelection,\n      isFieldExpanded: this.numberOfValuesToRequest > this.facet.options.numberOfValues\n    };\n  }\n\n  public getQueryResults(): Promise<IQueryResults> {\n    const query = this.facet.queryController.getLastQuery();\n    // Specifying a numberOfResults of 0 will not log the query as a full fledged query in the API\n    // it will also alleviate the load on the index\n    query.numberOfResults = 0;\n\n    const previousFacetRequestIndex = findIndex(query.facets, { facetId: this.facet.options.id });\n    if (previousFacetRequestIndex !== -1) {\n      query.facets[previousFacetRequestIndex] = this.buildFacetRequest(query);\n    } else if (query.facets) {\n      query.facets.push(this.buildFacetRequest(query));\n    } else {\n      query.facets = [this.buildFacetRequest(query)];\n    }\n\n    return this.facet.queryController.getEndpoint().search(query);\n  }\n\n  protected get currentValues(): IFacetRequestValue[] {\n    return this.facet.values.allFacetValues.map(({ value, state }) => ({\n      value,\n      state\n    }));\n  }\n\n  protected get numberOfValues() {\n    if (this.freezeCurrentValues) {\n      return this.currentValues.length;\n    }\n\n    return Math.max(this.numberOfValuesToRequest, this.facet.values.activeValues.length);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/DynamicFacetQueryController.ts","import { $$, Dom } from '../../../utils/Dom';\nimport { DynamicFacetValue } from './DynamicFacetValue';\nimport { DynamicFacetValueCheckbox } from './DynamicFacetValueCheckbox';\nimport { IDynamicFacet, IValueRenderer } from '../IDynamicFacet';\n\nexport class DynamicFacetValueRenderer implements IValueRenderer {\n  private dom: Dom;\n  private valueCheckbox: DynamicFacetValueCheckbox;\n\n  constructor(private facetValue: DynamicFacetValue, private facet: IDynamicFacet) {}\n\n  public render() {\n    this.dom = $$('li', {\n      className: 'coveo-dynamic-facet-value',\n      dataValue: this.facetValue.value\n    });\n\n    this.toggleSelectedClass();\n    this.renderCheckbox();\n    this.addFocusAndBlurEventListeners();\n\n    return this.dom.el;\n  }\n\n  private toggleSelectedClass() {\n    this.dom.toggleClass('coveo-selected', this.facetValue.isSelected);\n  }\n\n  private renderCheckbox() {\n    this.valueCheckbox = new DynamicFacetValueCheckbox(this.facetValue, this.selectAction.bind(this));\n    this.dom.append(this.valueCheckbox.element);\n  }\n\n  private addFocusAndBlurEventListeners() {\n    const checkboxButton = $$(this.valueCheckbox.element).find('button');\n    $$(checkboxButton).on('focusin', () => this.onFocusIn());\n    $$(checkboxButton).on('focusout', () => this.onFocusOut());\n  }\n\n  private onFocusIn() {\n    this.dom.addClass('coveo-focused');\n  }\n\n  private onFocusOut() {\n    this.dom.removeClass('coveo-focused');\n  }\n\n  private selectAction() {\n    this.facet.toggleSelectValue(this.facetValue.value);\n    this.toggleSelectedClass();\n    this.facet.enableFreezeCurrentValuesFlag();\n    this.facet.enableFreezeFacetOrderFlag();\n    this.facet.enablePreventAutoSelectionFlag();\n    this.facet.scrollToTop();\n    this.facet.triggerNewQuery(() => this.facetValue.logSelectActionToAnalytics());\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValueRenderer.ts","import { IResponsiveComponent, IResponsiveComponentOptions, ResponsiveComponentsManager } from './ResponsiveComponentsManager';\nimport { SearchInterface } from '../SearchInterface/SearchInterface';\nimport { ResultList } from '../ResultList/ResultList';\nimport { $$, Dom } from '../../utils/Dom';\nimport { Component } from '../Base/Component';\nimport { Logger } from '../../misc/Logger';\nimport { ResponsiveDropdown } from './ResponsiveDropdown/ResponsiveDropdown';\n\nexport class ResponsiveDefaultResultTemplate implements IResponsiveComponent {\n  private searchInterface: SearchInterface;\n  private resultList: ResultList;\n\n  private currentMode: string;\n\n  public static init(root: HTMLElement, component: ResultList, options: IResponsiveComponentOptions) {\n    if (!$$(root).find(`.${Component.computeCssClassName(ResultList)}`)) {\n      let logger = new Logger('ResponsiveDefaultResultTemplate');\n      logger.trace('No ResultLayout component found : Cannot instantiate ResponsiveResultLayout');\n      return;\n    }\n    ResponsiveComponentsManager.register(ResponsiveDefaultResultTemplate, $$(root), ResultList.ID, component, options);\n  }\n\n  constructor(public coveoRoot: Dom, public ID: string, options: IResponsiveComponentOptions, responsiveDropdown?: ResponsiveDropdown) {\n    this.searchInterface = <SearchInterface>Component.get(this.coveoRoot.el, SearchInterface, false);\n    this.currentMode = 'large';\n  }\n\n  public registerComponent(accept: ResultList) {\n    if (accept instanceof ResultList) {\n      this.resultList = accept;\n      return true;\n    }\n    return false;\n  }\n\n  public handleResizeEvent() {\n    let lastResults = this.resultList.queryController.getLastResults();\n    if (this.needSmallMode()) {\n      $$(this.resultList.options.resultsContainer).addClass('coveo-card-layout-container');\n      $$(this.resultList.options.resultsContainer).removeClass(`coveo-list-layout-container`);\n      if (this.currentMode != 'small') {\n        if (lastResults) {\n          this.resultList.buildResults(lastResults).then((elements: HTMLElement[]) => {\n            this.resultList.renderResults(elements);\n          });\n        }\n        this.currentMode = 'small';\n      }\n    } else {\n      $$(this.resultList.options.resultsContainer).removeClass('coveo-card-layout-container');\n      $$(this.resultList.options.resultsContainer).addClass(`coveo-list-layout-container`);\n      if (this.currentMode != 'large') {\n        if (lastResults) {\n          this.resultList.buildResults(lastResults).then((elements: HTMLElement[]) => {\n            this.resultList.renderResults(elements);\n          });\n        }\n        this.currentMode = 'large';\n      }\n    }\n  }\n\n  private needSmallMode(): boolean {\n    return this.coveoRoot.width() <= this.searchInterface.responsiveComponents.getSmallScreenWidth();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveDefaultResultTemplate.ts","import { IQueryResult } from '../../rest/QueryResult';\nimport { $$, Dom } from '../../utils/Dom';\nimport { Component } from '../Base/Component';\nimport { SearchInterface } from '../SearchInterface/SearchInterface';\n\nexport interface ResultToRender {\n  resultElement: HTMLElement;\n  componentsInside: Component[];\n}\n\nexport class ResultContainer {\n  public static resultCurrentlyBeingRendered: IQueryResult = null;\n\n  public resultContainerElement: Dom;\n\n  constructor(resultContainer: HTMLElement, private searchInterface: SearchInterface) {\n    this.resultContainerElement = $$(resultContainer);\n  }\n\n  public empty() {\n    this.searchInterface.detachComponentsInside(this.resultContainerElement.el);\n    $$(this.resultContainerElement).empty();\n  }\n\n  public addClass(classToAdd: string) {\n    this.resultContainerElement.addClass(classToAdd);\n  }\n\n  public isEmpty() {\n    return this.resultContainerElement.isEmpty();\n  }\n\n  public hideChildren() {\n    this.resultContainerElement.children().forEach(child => $$(child).hide());\n  }\n\n  public getResultElements() {\n    return this.resultContainerElement.findAll('.CoveoResult');\n  }\n\n  public get el() {\n    return this.resultContainerElement.el;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultContainer.ts","import { ResultListRenderer } from './ResultListRenderer';\nimport { $$ } from '../../utils/Dom';\nimport _ = require('underscore');\n\nexport class ResultListCardRenderer extends ResultListRenderer {\n  getEndFragment(resultElements: HTMLElement[]) {\n    return new Promise<DocumentFragment>(resolve => {\n      if (!_.isEmpty(resultElements)) {\n        // with infinite scrolling, we want the additional results to append at the end of the previous query.\n        // For this, we need to remove the padding.\n        if (this.resultListOptions.enableInfiniteScroll) {\n          const needToBeRemoved = $$(this.resultListOptions.resultsContainer).findAll('.coveo-card-layout-padding');\n          _.each(needToBeRemoved, toRemove => $$(toRemove).remove());\n        }\n        // Used to prevent last card from spanning the grid's whole width\n        const emptyCards = document.createDocumentFragment();\n        _.times(3, () => emptyCards.appendChild($$('div', { className: 'coveo-card-layout coveo-card-layout-padding' }).el));\n        resolve(emptyCards);\n      }\n      resolve(null);\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultListCardRenderer.ts","import { IResultListOptions } from './ResultListOptions';\nimport { ResultListRenderer } from './ResultListRenderer';\nimport { TemplateRole } from '../Templates/Template';\nimport { TableTemplate } from '../Templates/TableTemplate';\nimport { $$ } from '../../utils/Dom';\nimport _ = require('underscore');\n\nexport class ResultListTableRenderer extends ResultListRenderer {\n  private shouldDisplayHeader: boolean = true;\n  private shouldDisplayFooter: boolean = false;\n\n  constructor(protected resultListOptions: IResultListOptions, protected autoCreateComponentsFn: Function) {\n    super(resultListOptions, autoCreateComponentsFn);\n    if (this.resultListOptions.resultTemplate instanceof TableTemplate) {\n      if (this.resultListOptions.resultTemplate.hasTemplateWithRole('table-footer')) {\n        this.shouldDisplayFooter = true;\n      }\n      // If custom templates are defined but no header template, do not display it.\n      if (\n        this.resultListOptions.resultTemplate.templates.length !== 0 &&\n        !this.resultListOptions.resultTemplate.hasTemplateWithRole('table-header')\n      ) {\n        this.shouldDisplayHeader = false;\n      }\n    }\n  }\n\n  getStartFragment(resultElements: HTMLElement[], append: boolean): Promise<DocumentFragment> {\n    if (!append && !_.isEmpty(resultElements) && this.shouldDisplayHeader) {\n      return this.renderRoledTemplate('table-header');\n    }\n  }\n\n  getEndFragment(resultElements: HTMLElement[], append: boolean): Promise<DocumentFragment> {\n    if (!append && !_.isEmpty(resultElements) && this.shouldDisplayFooter) {\n      return this.renderRoledTemplate('table-footer');\n    }\n  }\n\n  private async renderRoledTemplate(role: TemplateRole) {\n    const elem = await (<TableTemplate>this.resultListOptions.resultTemplate).instantiateRoleToElement(role);\n    $$(elem).addClass(`coveo-result-list-${role}`);\n    this.autoCreateComponentsFn(elem, undefined);\n    const frag = document.createDocumentFragment();\n    frag.appendChild(elem);\n    return frag;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultListTableRenderer.ts","import { IResponsiveDropdownContent, ResponsiveDropdownContent } from './ResponsiveDropdownContent';\nimport { Dom, $$, l } from '../../../Core';\nimport { SVGIcons } from '../../../utils/SVGIcons';\nimport { FocusTrap } from '../../FocusTrap/FocusTrap';\n\nexport class ResponsiveDropdownModalContent implements IResponsiveDropdownContent {\n  private closeButton: Dom;\n  private className: string;\n  private focusTrap: FocusTrap;\n\n  constructor(private componentName: string, public element: Dom, private closeButtonLabel: string, private close: () => void) {\n    this.className = `coveo-${this.componentName}-dropdown-modal-content`;\n  }\n\n  private set hidden(shouldHide: boolean) {\n    this.element.toggleClass('coveo-hidden', shouldHide);\n  }\n\n  public positionDropdown() {\n    this.element.el.classList.add(this.className, ResponsiveDropdownContent.DEFAULT_CSS_CLASS_NAME);\n    this.element.setAttribute('role', 'group');\n    this.element.setAttribute('aria-label', l('FiltersDropdown'));\n    this.hidden = false;\n    this.ensureCloseButton();\n    this.ensureFocusTrap();\n  }\n\n  public hideDropdown() {\n    this.element.el.classList.remove(this.className, ResponsiveDropdownContent.DEFAULT_CSS_CLASS_NAME);\n    this.element.setAttribute('role', null);\n    this.element.setAttribute('aria-label', null);\n    this.hidden = true;\n    this.removeCloseButton();\n    this.removeFocusTrap();\n  }\n\n  public cleanUp() {\n    this.hidden = false;\n  }\n\n  private ensureCloseButton() {\n    if (!this.closeButton) {\n      this.closeButton = $$(\n        'button',\n        {\n          className: 'coveo-facet-modal-close-button',\n          ariaLabel: this.closeButtonLabel\n        },\n        SVGIcons.icons.mainClear\n      );\n      this.closeButton.on('click', () => this.close());\n      this.element.prepend(this.closeButton.el);\n    }\n  }\n\n  private ensureFocusTrap() {\n    if (!this.focusTrap) {\n      this.focusTrap = new FocusTrap(this.element.el);\n    }\n  }\n\n  private removeCloseButton() {\n    if (this.closeButton) {\n      this.closeButton.remove();\n      this.closeButton = null;\n    }\n  }\n\n  private removeFocusTrap() {\n    if (this.focusTrap) {\n      this.focusTrap.disable();\n      this.focusTrap = null;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveDropdown/ResponsiveDropdownModalContent.ts","/**\n * The names of the events that can be triggered by the [FacetsMobileMode]{@link FacetsMobileMode} component.\n */\nexport class FacetsMobileModeEvents {\n  /**\n   * The name of the event that gets triggered when the facets pop-up (or modal) is opened in mobile mode.\n   */\n  public static popupOpened = 'popupOpened';\n  /**\n   * The name of the event that gets triggered when the facets pop-up (or modal) is closed in mobile mode.\n   */\n  public static popupClosed = 'popupClosed';\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/events/FacetsMobileModeEvents.ts","import { l } from '../../../strings/Strings';\nimport { SVGIcons } from '../../../utils/SVGIcons';\nimport { $$ } from '../../../utils/Dom';\nimport { DynamicFacetHeaderButton } from './DynamicFacetHeaderButton';\nimport { IDynamicFacetHeaderOptions } from './DynamicFacetHeader';\n\nexport interface IDynamicFacetCollapseToggleOptions {\n  collapsed: boolean;\n}\n\nexport class DynamicFacetHeaderCollapseToggle {\n  public element: HTMLElement;\n  private collapseButton: DynamicFacetHeaderButton;\n  private expandButton: DynamicFacetHeaderButton;\n\n  constructor(private options: IDynamicFacetHeaderOptions) {\n    this.create();\n  }\n\n  private create() {\n    const parent = $$('div');\n\n    this.collapseButton = new DynamicFacetHeaderButton({\n      label: l('CollapseFacet', this.options.title),\n      iconSVG: SVGIcons.icons.arrowUp,\n      iconClassName: 'coveo-dynamic-facet-collapse-toggle-svg',\n      className: 'coveo-dynamic-facet-header-collapse',\n      shouldDisplay: true,\n      action: () => {\n        this.options.collapse();\n        this.expandButton.element.focus();\n      }\n    });\n    this.expandButton = new DynamicFacetHeaderButton({\n      label: l('ExpandFacet', this.options.title),\n      iconSVG: SVGIcons.icons.arrowDown,\n      iconClassName: 'coveo-dynamic-facet-collapse-toggle-svg',\n      className: 'coveo-dynamic-facet-header-expand',\n      shouldDisplay: false,\n      action: () => {\n        this.options.expand();\n        this.collapseButton.element.focus();\n      }\n    });\n\n    parent.append(this.collapseButton.element);\n    parent.append(this.expandButton.element);\n\n    this.element = parent.el;\n  }\n\n  public toggleButtons(isCollapsed: boolean) {\n    this.collapseButton.toggle(!isCollapsed);\n    this.expandButton.toggle(isCollapsed);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetHeader/DynamicFacetHeaderCollapseToggle.ts","import { TextInput, ITextInputOptions } from '../FormWidgets/TextInput';\nimport { $$ } from '../../utils/Dom';\nimport { KEYBOARD } from '../../utils/KeyboardUtils';\nimport { Utils } from '../../utils/Utils';\nimport { IComboboxAccessibilityAttributes, ICombobox } from './ICombobox';\n\nexport class ComboboxInput {\n  public element: HTMLElement;\n  private textInput: TextInput;\n  private inputElement: HTMLInputElement;\n  private inputOptions: ITextInputOptions = {\n    usePlaceholder: true,\n    className: 'coveo-combobox-input',\n    triggerOnChangeAsYouType: true,\n    isRequired: false,\n    icon: 'search'\n  };\n\n  constructor(private combobox: ICombobox) {\n    this.create();\n    this.element = this.textInput.getElement();\n    this.inputElement = $$(this.element).find('input') as HTMLInputElement;\n    this.addEventListeners();\n    this.addAccessibilityAttributes();\n  }\n\n  public get value() {\n    return this.inputElement.value;\n  }\n\n  private create() {\n    this.textInput = new TextInput(\n      (inputInstance: TextInput) => this.combobox.onInputChange(inputInstance.getValue()),\n      this.combobox.options.placeholderText,\n      this.inputOptions\n    );\n  }\n\n  private addEventListeners() {\n    if (!this.combobox.options.clearOnBlur) {\n      this.inputElement.addEventListener('focus', () => this.combobox.onInputChange(this.textInput.getValue()));\n    }\n    this.combobox.element.addEventListener('focusout', (e: FocusEvent) => this.handleFocusOut(e));\n    this.combobox.element.addEventListener('keydown', (e: KeyboardEvent) => this.handleKeyboardDirection(e));\n    this.combobox.element.addEventListener('keyup', (e: KeyboardEvent) => this.handleKeyboardEnterEscape(e));\n  }\n\n  private addAccessibilityAttributes() {\n    const listboxId = `${this.combobox.id}-listbox`;\n    this.inputElement.setAttribute('role', 'combobox');\n    this.inputElement.setAttribute('aria-owns', listboxId);\n    this.inputElement.setAttribute('aria-haspopup', 'listbox');\n    this.inputElement.setAttribute('aria-autocomplete', 'list');\n    this.inputElement.setAttribute('id', `${this.combobox.id}-input`);\n    this.inputElement.setAttribute('aria-label', this.combobox.options.label);\n\n    this.updateAccessibilityAttributes({\n      activeDescendant: '',\n      expanded: false\n    });\n  }\n\n  public updateAccessibilityAttributes(attributes: IComboboxAccessibilityAttributes) {\n    this.inputElement.setAttribute('aria-expanded', attributes.expanded ? 'true' : 'false');\n    Utils.isEmptyString(attributes.activeDescendant)\n      ? this.inputElement.removeAttribute('aria-activedescendant')\n      : this.inputElement.setAttribute('aria-activedescendant', attributes.activeDescendant);\n  }\n\n  public clearInput() {\n    this.textInput.reset();\n  }\n\n  private handleFocusOut(event: FocusEvent) {\n    const newTarget = event.relatedTarget as HTMLElement;\n    const focusInsideCombobox = this.combobox.element.contains(newTarget);\n    if (focusInsideCombobox) {\n      return;\n    }\n\n    const comboboxValuesHovered = $$(this.combobox.element).find('.coveo-combobox-values:hover');\n    if (comboboxValuesHovered) {\n      this.inputElement.focus();\n      return;\n    }\n\n    this.combobox.onInputBlur();\n  }\n\n  private handleKeyboardDirection(event: KeyboardEvent) {\n    switch (event.which) {\n      case KEYBOARD.DOWN_ARROW:\n        event.preventDefault();\n        this.combobox.values.focusNextValue();\n        break;\n      case KEYBOARD.UP_ARROW:\n        event.preventDefault();\n        this.combobox.values.focusPreviousValue();\n        break;\n      case KEYBOARD.HOME:\n        event.preventDefault();\n        this.combobox.values.focusFirstValue();\n        break;\n      case KEYBOARD.END:\n        event.preventDefault();\n        this.combobox.values.focusLastValue();\n        break;\n    }\n  }\n\n  private handleKeyboardEnterEscape(event: KeyboardEvent) {\n    switch (event.which) {\n      case KEYBOARD.ENTER:\n        this.combobox.values.selectActiveValue();\n        break;\n      case KEYBOARD.ESCAPE:\n        if (Utils.isNonEmptyString(this.textInput.getValue())) {\n          event.stopPropagation();\n        }\n        this.combobox.clearAll();\n        break;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Combobox/ComboboxInput.ts","import { ICombobox, IComboboxValues, IComboboxValue } from './ICombobox';\nimport { $$ } from '../../utils/Dom';\nimport { find } from 'underscore';\nimport { l } from '../../strings/Strings';\nimport { escape } from 'underscore';\n\nexport class ComboboxValues implements IComboboxValues {\n  public element: HTMLElement;\n  public mouseIsOverValue = false;\n  public isRenderingNewValues = false;\n  private values: IComboboxValue[] = [];\n  private keyboardActiveValue?: IComboboxValue;\n  private isScrollable: boolean;\n  private focusedValueId: string;\n\n  constructor(private combobox: ICombobox) {\n    this.element = $$('ul', {\n      id: `${this.combobox.id}-listbox`,\n      role: 'listbox',\n      className: 'coveo-combobox-values',\n      ariaLabelledby: `${this.combobox.id}-input`\n    }).el;\n    $$(this.element).hide();\n\n    this.isScrollable = !!this.combobox.options.scrollable;\n    this.isScrollable && this.element.addEventListener('scroll', () => this.onScroll());\n  }\n\n  public renderFromResponse(response: any) {\n    this.isRenderingNewValues = true;\n    this.clearValues();\n    this.values = this.combobox.options.createValuesFromResponse(response);\n    this.render();\n    this.combobox.updateAriaLive();\n    this.isRenderingNewValues = false;\n  }\n\n  private render() {\n    $$(this.element).show();\n\n    if (!this.hasValues()) {\n      return this.renderNoValuesFound();\n    }\n\n    this.renderValues();\n    this.addEventListeners();\n    this.updateAccessibilityAttributes();\n  }\n\n  private renderValues() {\n    const fragment = document.createDocumentFragment();\n    this.values.forEach((value, index) => {\n      const elementWrapper = $$(\n        'li',\n        { id: `${this.combobox.id}-value-${index}`, className: 'coveo-combobox-value', role: 'option', tabindex: 0 },\n        value.element\n      ).el;\n      this.highlightCurrentQueryInSearchResults(value.element);\n      value.element = elementWrapper;\n      fragment.appendChild(value.element);\n    });\n\n    this.element.appendChild(fragment);\n  }\n\n  private highlightCurrentQueryInSearchResults(searchResult: HTMLElement) {\n    if (this.combobox.options.highlightValueClassName) {\n      const regex = new RegExp('(' + this.combobox.element.querySelector('input').value + ')', 'ig');\n      const result = $$(searchResult).hasClass(this.combobox.options.highlightValueClassName)\n        ? searchResult\n        : $$(searchResult).find(`.${this.combobox.options.highlightValueClassName}`);\n      if (result) {\n        const text = escape($$(result).text());\n        result.innerHTML = text.replace(regex, '<span class=\"coveo-highlight\">$1</span>');\n      }\n    }\n  }\n\n  public hasValues() {\n    return !!this.numberOfValues;\n  }\n\n  public get numberOfValues() {\n    return this.values.length;\n  }\n\n  private renderNoValuesFound() {\n    const noValuesFoundElement = $$(\n      'li',\n      {\n        role: 'option',\n        className: 'coveo-combobox-value-not-found'\n      },\n      l('NoValuesFound')\n    ).el;\n\n    this.element.appendChild(noValuesFoundElement);\n  }\n\n  private addEventListeners() {\n    this.values.forEach(value => {\n      $$(value.element).on('mouseenter', () => (this.mouseIsOverValue = true));\n      $$(value.element).on('mouseleave', () => (this.mouseIsOverValue = false));\n      $$(value.element).on('click', (e: MouseEvent) => this.onValueClick(e));\n      $$(value.element).on('focus', () => this.setKeyboardActiveValue(value));\n    });\n  }\n\n  private onValueClick(e: MouseEvent) {\n    const target = <HTMLElement>e.target;\n    const targetElement = $$(target).hasClass('coveo-combobox-value') ? target : $$(target).parent('coveo-combobox-value');\n\n    if (!targetElement) {\n      return;\n    }\n\n    const targetId = targetElement.getAttribute('id');\n    const value = find(this.values, ({ element }) => element.getAttribute('id') === targetId);\n    value && this.combobox.options.onSelectValue(value);\n    this.combobox.clearAll();\n  }\n\n  private updateAccessibilityAttributes() {\n    const activeDescendant = this.keyboardActiveValue ? this.keyboardActiveValue.element.getAttribute('id') : '';\n\n    this.combobox.updateAccessibilityAttributes({\n      activeDescendant,\n      expanded: this.hasValues()\n    });\n  }\n\n  public clearValues() {\n    this.mouseIsOverValue = false;\n    this.resetKeyboardActiveValue();\n    $$(this.element).empty();\n    $$(this.element).hide();\n    this.values = [];\n    this.updateAccessibilityAttributes();\n  }\n\n  private setKeyboardActiveValue(value: IComboboxValue) {\n    this.resetKeyboardActiveValue();\n    this.keyboardActiveValue = value;\n    this.activateFocusOnValue(this.keyboardActiveValue);\n    this.updateAccessibilityAttributes();\n  }\n\n  private resetKeyboardActiveValue() {\n    if (!this.keyboardActiveValue) {\n      return;\n    }\n\n    this.deactivateFocusOnValue(this.keyboardActiveValue);\n    this.keyboardActiveValue = null;\n  }\n\n  private activateFocusOnValue({ element }: IComboboxValue) {\n    $$(element).addClass('coveo-focused');\n    element.setAttribute('aria-selected', 'true');\n  }\n\n  private deactivateFocusOnValue({ element }: IComboboxValue) {\n    $$(element).removeClass('coveo-focused');\n    element.setAttribute('aria-selected', 'false');\n  }\n\n  public selectActiveValue() {\n    if (!this.keyboardActiveValue) {\n      return;\n    }\n\n    this.combobox.options.onSelectValue(this.keyboardActiveValue);\n    this.combobox.clearAll();\n  }\n\n  private onScroll() {\n    const scrollEndReached = this.element.scrollTop + this.element.clientHeight >= this.element.scrollHeight;\n    if (scrollEndReached && this.combobox.options.scrollable.areMoreValuesAvailable()) {\n      this.combobox.onScrollEndReached();\n    }\n  }\n\n  public resetScroll() {\n    if (!this.isScrollable) {\n      return;\n    }\n    this.element.style.maxHeight = `${this.combobox.options.scrollable.maxDropdownHeight}px`;\n    this.element.scrollTop = 0;\n  }\n\n  public focusFirstValue() {\n    if (!this.hasValues()) {\n      return;\n    }\n\n    this.firstValue.element.focus();\n  }\n\n  public focusLastValue() {\n    if (!this.hasValues()) {\n      return;\n    }\n\n    this.lastValue.element.focus();\n  }\n\n  public focusNextValue() {\n    if (!this.hasValues()) {\n      return;\n    }\n\n    const nextActiveValue = this.nextOrFirstValue;\n    nextActiveValue.element.focus();\n  }\n\n  public focusPreviousValue() {\n    if (!this.hasValues()) {\n      return;\n    }\n\n    const previousActiveValue = this.previousOrLastValue;\n    previousActiveValue.element.focus();\n  }\n\n  private get nextOrFirstValue() {\n    if (!this.keyboardActiveValue) {\n      return this.firstValue;\n    }\n\n    const nextValueIndex = (this.values.indexOf(this.keyboardActiveValue) + 1) % this.numberOfValues;\n    return this.values[nextValueIndex];\n  }\n\n  private get firstValue() {\n    return this.values[0];\n  }\n\n  private get previousOrLastValue() {\n    if (!this.keyboardActiveValue) {\n      return this.lastValue;\n    }\n\n    const previousValueIndex = this.values.indexOf(this.keyboardActiveValue) - 1;\n    return previousValueIndex >= 0 ? this.values[previousValueIndex] : this.values[this.numberOfValues - 1];\n  }\n\n  private get lastValue() {\n    const lastValueIndex = this.numberOfValues - 1;\n    return this.values[lastValueIndex];\n  }\n\n  public saveFocusedValue() {\n    if (!this.keyboardActiveValue) {\n      this.focusedValueId = null;\n      return;\n    }\n\n    this.focusedValueId = this.keyboardActiveValue.element.id;\n  }\n\n  public restoreFocusedValue() {\n    if (!this.focusedValueId) {\n      return;\n    }\n\n    const element = $$(this.element).find(`#${this.focusedValueId}`);\n    element.focus();\n    this.focusedValueId = null;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Combobox/ComboboxValues.ts","import { ResponsiveFacetColumn } from './ResponsiveFacetColumn';\nimport { IResponsiveComponentOptions } from './ResponsiveComponentsManager';\nimport { DynamicFacet } from '../DynamicFacet/DynamicFacet';\n\nexport class ResponsiveDynamicFacets extends ResponsiveFacetColumn {\n  public static init(root: HTMLElement, component, options: IResponsiveComponentOptions) {\n    ResponsiveFacetColumn.init(ResponsiveDynamicFacets, root, component, options, DynamicFacet.ID);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveDynamicFacets.ts","import 'styling/DynamicFacet/_DynamicFacetBreadcrumbs';\nimport { $$ } from '../../utils/Dom';\nimport { l } from '../../strings/Strings';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\nimport { IDynamicFacet, IDynamicFacetValue } from './IDynamicFacet';\nimport { escape } from 'underscore';\n\nexport class DynamicFacetBreadcrumbs {\n  public element: HTMLElement;\n\n  constructor(private facet: IDynamicFacet) {\n    this.create();\n  }\n\n  private create() {\n    this.element = $$('ul', { className: 'coveo-dynamic-facet-breadcrumb coveo-breadcrumb-item' }).el;\n    this.createAndAppendTitle();\n\n    const activeFacetValues = this.facet.values.activeValues;\n    const breadcrumbFacetValues = activeFacetValues.slice(0, this.facet.options.numberOfValuesInBreadcrumb);\n    const collapsedFacetValues = activeFacetValues.slice(this.facet.options.numberOfValuesInBreadcrumb);\n\n    this.createAndAppendBreadcrumbValues(breadcrumbFacetValues);\n\n    if (collapsedFacetValues.length) {\n      this.createAndAppendCollapsedBreadcrumbs(collapsedFacetValues);\n    }\n  }\n\n  private createAndAppendTitle() {\n    const titleElement = $$('h3', { className: 'coveo-dynamic-facet-breadcrumb-title' }, `${this.facet.options.title}:`).el;\n    this.element.appendChild(titleElement);\n  }\n\n  private createAndAppendBreadcrumbValues(facetValues: IDynamicFacetValue[]) {\n    facetValues.forEach(facetValue => this.createAndAppendBreadcrumbValue(facetValue));\n  }\n\n  private createAndAppendBreadcrumbValue(facetValue: IDynamicFacetValue) {\n    const listContainer = $$('li', { className: 'coveo-dynamic-facet-breadcrumb-value-list-item' }).el;\n    const valueElement = $$(\n      'button',\n      {\n        className: 'coveo-dynamic-facet-breadcrumb-value',\n        ariaLabel: l('RemoveFilterOn', facetValue.displayValue)\n      },\n      escape(facetValue.displayValue)\n    ).el;\n    const clearElement = $$('span', { className: 'coveo-dynamic-facet-breadcrumb-value-clear' }, SVGIcons.icons.mainClear).el;\n    valueElement.appendChild(clearElement);\n\n    $$(valueElement).on('click', () => this.valueSelectAction(facetValue));\n    listContainer.appendChild(valueElement);\n    this.element.appendChild(listContainer);\n  }\n\n  private valueSelectAction(facetValue: IDynamicFacetValue) {\n    this.facet.deselectValue(facetValue.value);\n    this.facet.enablePreventAutoSelectionFlag();\n    this.facet.triggerNewQuery(() => this.logActionToAnalytics());\n  }\n\n  private logActionToAnalytics() {\n    this.facet.logAnalyticsEvent(analyticsActionCauseList.breadcrumbFacet, this.facet.basicAnalyticsFacetMeta);\n  }\n\n  private createAndAppendCollapsedBreadcrumbs(facetValues: IDynamicFacetValue[]) {\n    const label = l('NMore', `${facetValues.length}`);\n    const title = facetValues.map(({ value }) => value).join('\\n');\n    const collapsedElement = $$(\n      'button',\n      {\n        className: 'coveo-dynamic-facet-breadcrumb-collapse',\n        title\n      },\n      label\n    ).el;\n\n    $$(collapsedElement).on('click', () => {\n      $$(collapsedElement).remove();\n      this.createAndAppendBreadcrumbValues(facetValues);\n    });\n\n    this.element.appendChild(collapsedElement);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetBreadcrumbs.ts","import { Combobox } from '../Combobox/Combobox';\nimport { l } from '../../strings/Strings';\nimport { FacetSearchController } from '../../controllers/FacetSearchController';\nimport { IFacetSearchResponse } from '../../rest/Facet/FacetSearchResponse';\nimport { DynamicFacetValue } from '../DynamicFacet/DynamicFacetValues/DynamicFacetValue';\nimport { FacetValueState } from '../../rest/Facet/FacetValueState';\nimport { DynamicFacetSearchValueRenderer } from './DynamicFacetSearchValueRenderer';\nimport { IComboboxValue } from '../Combobox/ICombobox';\nimport 'styling/DynamicFacetSearch/_DynamicFacetSearch';\nimport { IDynamicFacet } from '../DynamicFacet/IDynamicFacet';\nimport { FacetUtils } from '../Facet/FacetUtils';\n\nexport class DynamicFacetSearch {\n  public element: HTMLElement;\n  private facetSearchController: FacetSearchController;\n  private combobox: Combobox;\n\n  constructor(private facet: IDynamicFacet) {\n    this.facetSearchController = new FacetSearchController(this.facet);\n\n    this.combobox = new Combobox({\n      label: l('SearchFacetResults', this.facet.options.title),\n      ariaLive: this.facet.searchInterface.ariaLive,\n      requestValues: terms => this.facetSearchController.search(terms),\n      createValuesFromResponse: (response: IFacetSearchResponse) => this.createValuesFromResponse(response),\n      onSelectValue: this.onSelectValue,\n      placeholderText: l('Search'),\n      wrapperClassName: 'coveo-dynamic-facet-search',\n      clearOnBlur: true,\n      scrollable: {\n        requestMoreValues: () => this.facetSearchController.fetchMoreResults(),\n        areMoreValuesAvailable: () => this.facetSearchController.moreValuesAvailable,\n        maxDropdownHeight: 250\n      },\n      highlightValueClassName: 'coveo-checkbox-span-label'\n    });\n\n    this.element = this.combobox.element;\n  }\n\n  private getDisplayValue(value: string) {\n    return FacetUtils.getDisplayValueFromValueCaption(value, this.facet.options.field as string, this.facet.options.valueCaption);\n  }\n\n  private createValuesFromResponse(response: IFacetSearchResponse): IComboboxValue[] {\n    return response.values.map((value, index) => {\n      const facetValue = new DynamicFacetValue(\n        {\n          value: value.rawValue,\n          // TODO: remove when https://coveord.atlassian.net/browse/SEARCHAPI-4958 is fixed\n          displayValue: this.getDisplayValue(value.displayValue),\n          numberOfResults: value.count,\n          state: FacetValueState.idle,\n          position: index + 1\n        },\n        this.facet,\n        DynamicFacetSearchValueRenderer\n      );\n      return {\n        value: facetValue,\n        element: facetValue.renderedElement\n      };\n    });\n  }\n\n  private onSelectValue({ value }: IComboboxValue) {\n    (<DynamicFacetSearchValueRenderer>value.renderer).selectAction();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacetSearch/DynamicFacetSearch.ts","import { IFacetSearchResponse } from '../rest/Facet/FacetSearchResponse';\nimport { FileTypes } from '../ui/Misc/FileTypes';\nimport { QueryUtils } from '../utils/QueryUtils';\nimport { DateUtils } from '../utils/DateUtils';\nimport { IDynamicFacet } from '../ui/DynamicFacet/IDynamicFacet';\nimport { IFacetSearchRequest } from '../rest/Facet/FacetSearchRequest';\n\nexport class FacetSearchController {\n  private terms = '';\n  private pageCount = 1;\n  private numberOfValuesMultiplier = 3;\n\n  public moreValuesAvailable = true;\n\n  constructor(private facet: IDynamicFacet) {}\n\n  private getMonthsValueCaptions() {\n    const monthsValueCaptions: Record<string, string> = {};\n    for (let month = 1; month <= 12; month++) {\n      const key = `0${month}`.substr(-2);\n      monthsValueCaptions[key] = DateUtils.monthToString(month - 1);\n    }\n\n    return monthsValueCaptions;\n  }\n\n  private addTypesCaptionsIfNecessary(): Record<string, string> {\n    const field = this.facet.options.field.toLowerCase();\n    const isFileType = QueryUtils.isStratusAgnosticField(field, '@filetype');\n    const isObjectType = QueryUtils.isStratusAgnosticField(field, '@objecttype');\n    const isMonth = QueryUtils.isStratusAgnosticField(field, '@month');\n\n    if (isFileType || isObjectType) {\n      return FileTypes.getFileTypeCaptions();\n    }\n\n    if (isMonth) {\n      return this.getMonthsValueCaptions();\n    }\n\n    return {};\n  }\n\n  private get captions(): Record<string, string> {\n    return {\n      ...this.addTypesCaptionsIfNecessary(),\n      ...this.facet.options.valueCaption\n    };\n  }\n\n  private get numberOfValues() {\n    return this.facet.options.numberOfValues * this.numberOfValuesMultiplier * this.pageCount;\n  }\n\n  private get request(): IFacetSearchRequest {\n    const optionalLeadingWildcard = this.facet.options.useLeadingWildcardInFacetSearch ? '*' : '';\n    return {\n      field: this.facet.fieldName,\n      numberOfValues: this.numberOfValues,\n      ignoreValues: this.facet.values.activeValues.map(value => value.value),\n      captions: this.captions,\n      searchContext: this.facet.queryController.getLastQuery(),\n      query: `${optionalLeadingWildcard}${this.terms}*`\n    };\n  }\n\n  private async triggerRequest() {\n    const response = await this.facet.queryController.getEndpoint().facetSearch(this.request);\n    this.moreValuesAvailable = response.moreValuesAvailable;\n    return response;\n  }\n\n  public search(terms: string): Promise<IFacetSearchResponse> {\n    this.terms = terms;\n    this.pageCount = 1;\n    return this.triggerRequest();\n  }\n\n  public fetchMoreResults(): Promise<IFacetSearchResponse> {\n    this.pageCount++;\n    return this.triggerRequest();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/controllers/FacetSearchController.ts","import { $$, Dom } from '../../utils/Dom';\nimport { DynamicFacetValue } from '../DynamicFacet/DynamicFacetValues/DynamicFacetValue';\nimport { DynamicFacetValueCheckbox } from '../DynamicFacet/DynamicFacetValues/DynamicFacetValueCheckbox';\nimport { IDynamicFacet, IValueRenderer } from '../DynamicFacet/IDynamicFacet';\n\nexport class DynamicFacetSearchValueRenderer implements IValueRenderer {\n  private dom: Dom;\n  private valueCheckbox: DynamicFacetValueCheckbox;\n\n  constructor(private facetValue: DynamicFacetValue, private facet: IDynamicFacet) {}\n\n  public render() {\n    this.dom = $$('div', {\n      className: 'coveo-dynamic-facet-value',\n      dataValue: this.facetValue.value\n    });\n\n    this.renderCheckbox();\n    return this.dom.el;\n  }\n\n  private renderCheckbox() {\n    this.valueCheckbox = new DynamicFacetValueCheckbox(this.facetValue);\n    $$(this.valueCheckbox.element).find('button').setAttribute('tabindex', '-1');\n\n    this.dom.append(this.valueCheckbox.element);\n  }\n\n  public selectAction() {\n    this.facet.enableFreezeFacetOrderFlag();\n    this.facet.toggleSelectValue(this.facetValue.value);\n    this.facetValue.select();\n    this.facet.scrollToTop();\n    this.facet.triggerNewQuery(() => this.facetValue.logSelectActionToAnalytics());\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacetSearch/DynamicFacetSearchValueRenderer.ts","import { FacetUtils } from '../../Facet/FacetUtils';\nimport { IDynamicFacet, IValueCreator } from '../IDynamicFacet';\nimport { DynamicFacetValue } from './DynamicFacetValue';\nimport { IFacetResponseValue } from '../../../rest/Facet/FacetResponse';\nimport { FacetValueState } from '../../../rest/Facet/FacetValueState';\nimport { DynamicFacetValueRenderer } from './DynamicFacetValueRenderer';\n\nexport class DynamicFacetValueCreator implements IValueCreator {\n  constructor(private facet: IDynamicFacet) {}\n\n  private getDisplayValue(value: string) {\n    return FacetUtils.getDisplayValueFromValueCaption(value, this.facet.options.field as string, this.facet.options.valueCaption);\n  }\n\n  public getDefaultValues() {\n    return [];\n  }\n\n  public createFromResponse(facetValue: IFacetResponseValue, index: number) {\n    return new DynamicFacetValue(\n      {\n        value: facetValue.value,\n        displayValue: this.getDisplayValue(facetValue.value),\n        numberOfResults: facetValue.numberOfResults,\n        state: facetValue.state,\n        position: index + 1\n      },\n      this.facet,\n      DynamicFacetValueRenderer\n    );\n  }\n\n  public createFromValue(value: string) {\n    const position = this.facet.values.allFacetValues.length + 1;\n    const state = FacetValueState.idle;\n    const displayValue = this.getDisplayValue(value);\n    return new DynamicFacetValue({ value, displayValue, state, numberOfResults: 0, position }, this.facet, DynamicFacetValueRenderer);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/DynamicFacet/DynamicFacetValues/DynamicFacetValueCreator.ts","/**\n * The allowed states of a facet value in a Search API facet\n * [request]{@link IFacetRequestValue.state} or\n * [response]{@link IFacetResponseValue.state}.\n */\nexport enum FacetValueState {\n  /**\n   * The facet value is not currently selected or excluded in the search\n   * interface.\n   */\n  idle = 'idle',\n  /**\n   * The facet value is currently selected in the search interface.\n   */\n  selected = 'selected'\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/rest/Facet/FacetValueState.ts","import { ComponentOptions } from '../Base/ComponentOptions';\n\n/**\n * ResponsiveFacets options\n */\nexport const ResponsiveFacetOptions = {\n  /**\n   * Specifies whether to enable *responsive mode* for facets. Setting this options to `false` on any `Facet`, or\n   * [`FacetSlider`]{@link FacetSlider} component in a search interface disables responsive mode for all other facets\n   * in the search interface.\n   *\n   * Responsive mode displays all facets under a single dropdown button whenever the width of the HTML element which\n   * the search interface is bound to reaches or falls behind a certain threshold (see\n   * {@link SearchInterface.responsiveComponents}).\n   *\n   * See also the [`dropdownHeaderLabel`]{@link Facet.options.dropdownHeaderLabel} option.\n   *\n   * Default value is `true`.\n   */\n  enableResponsiveMode: ComponentOptions.buildBooleanOption({ defaultValue: true, section: 'ResponsiveOptions' }),\n  responsiveBreakpoint: ComponentOptions.buildNumberOption({\n    deprecated:\n      'This option is exposed for legacy reasons. It is not recommended to use this option. Instead, use `SearchInterface.options.responsiveMediumBreakpoint` options exposed on the `SearchInterface`.'\n  }),\n  /**\n   * If the [`enableResponsiveMode`]{@link Facet.options.enableResponsiveMode} option is `true` for all facets and\n   * {@link FacetSlider.options.enableResponsiveMode} is also `true` for all sliders, specifies the label of the\n   * dropdown button that allows to display the facets when in responsive mode.\n   *\n   * If more than one `Facet` or {@link FacetSlider} component in the search interface specifies a value for this\n   * option, the framework uses the first occurrence of the option.\n   *\n   * Default value is `Filters`.\n   */\n  dropdownHeaderLabel: ComponentOptions.buildLocalizedStringOption({ section: 'ResponsiveOptions' })\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResponsiveComponents/ResponsiveFacetOptions.ts","import 'styling/_Result';\nimport 'styling/_ResultFrame';\nimport 'styling/_ResultList';\nimport { chain, compact, contains, each, flatten, map, unique, without, uniqueId } from 'underscore';\nimport {\n  IBuildingQueryEventArgs,\n  IDuringQueryEventArgs,\n  INewQueryEventArgs,\n  IQueryErrorEventArgs,\n  IQuerySuccessEventArgs,\n  QueryEvents\n} from '../../events/QueryEvents';\nimport { IResultLayoutPopulateArgs, ResultLayoutEvents } from '../../events/ResultLayoutEvents';\nimport {\n  IChangeLayoutEventArgs,\n  IDisplayedNewResultEventArgs,\n  IDisplayedNewResultsEventArgs,\n  ResultListEvents\n} from '../../events/ResultListEvents';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Assert } from '../../misc/Assert';\nimport { Defer } from '../../misc/Defer';\nimport { MODEL_EVENTS } from '../../models/Model';\nimport { QUERY_STATE_ATTRIBUTES } from '../../models/QueryStateModel';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { IQueryResults } from '../../rest/QueryResults';\nimport { DeviceUtils } from '../../utils/DeviceUtils';\nimport { $$, Doc, Win } from '../../utils/Dom';\nimport { DomUtils } from '../../utils/DomUtils';\nimport { Utils } from '../../utils/Utils';\nimport { analyticsActionCauseList, IAnalyticsNoMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IInitializationParameters, IInitResult, Initialization } from '../Base/Initialization';\nimport { InitializationPlaceholder } from '../Base/InitializationPlaceholder';\nimport { TemplateComponentOptions } from '../Base/TemplateComponentOptions';\nimport { ResponsiveDefaultResultTemplate } from '../ResponsiveComponents/ResponsiveDefaultResultTemplate';\nimport { ValidLayout, RendererValidLayout } from '../ResultLayoutSelector/ValidLayout';\nimport { CoreHelpers } from '../Templates/CoreHelpers';\nimport { DefaultRecommendationTemplate } from '../Templates/DefaultRecommendationTemplate';\nimport { DefaultResultTemplate } from '../Templates/DefaultResultTemplate';\nimport { TableTemplate } from '../Templates/TableTemplate';\nimport { Template } from '../Templates/Template';\nimport { TemplateCache } from '../Templates/TemplateCache';\nimport { TemplateList } from '../Templates/TemplateList';\nimport { ResultContainer } from './ResultContainer';\nimport { ResultListCardRenderer } from './ResultListCardRenderer';\nimport { ResultListRenderer } from './ResultListRenderer';\nimport { ResultListTableRenderer } from './ResultListTableRenderer';\nimport ResultLayoutSelectorModule = require('../ResultLayoutSelector/ResultLayoutSelector');\nimport { IResultListOptions } from './ResultListOptions';\nimport { ResultListUtils } from '../../utils/ResultListUtils';\nimport { TemplateToHtml, ITemplateToHtml } from '../Templates/TemplateToHtml';\n\nCoreHelpers.exportAllHelpersGlobally(window['Coveo']);\n\ntype WaitAnimation = 'fade' | 'spinner' | 'none';\n\n/**\n * The `ResultList` component is responsible for displaying query results by applying one or several result templates\n * (see [Result Templates](https://docs.coveo.com/en/413/)).\n *\n * It is possible to include multiple `ResultList` components along with a single `ResultLayout`\n * component in a search page to provide different result layouts (see\n * [Result Layouts](https://docs.coveo.com/en/360/)).\n *\n * This component supports infinite scrolling (see the\n * [`enableInfiniteScroll`]{@link ResultList.options.enableInfiniteScroll} option).\n */\nexport class ResultList extends Component {\n  private static getDefaultTemplate(e: HTMLElement): Template {\n    const template = ResultList.loadTemplatesFromCache();\n    if (template != null) {\n      return template;\n    }\n\n    const component = <ResultList>Component.get(e);\n    if (Coveo['Recommendation'] && component.searchInterface instanceof Coveo['Recommendation']) {\n      return new DefaultRecommendationTemplate();\n    }\n    return new DefaultResultTemplate();\n  }\n\n  private static loadTemplatesFromCache(): Template {\n    var pageTemplateNames = TemplateCache.getResultListTemplateNames();\n    if (pageTemplateNames.length > 0) {\n      return new TemplateList(compact(map(pageTemplateNames, templateName => TemplateCache.getTemplate(templateName))));\n    }\n\n    return null;\n  }\n\n  static ID = 'ResultList';\n\n  static doExport = () => {\n    exportGlobally({\n      ResultList: ResultList\n    });\n  };\n\n  /**\n   * The options for the ResultList\n   * @componentOptions\n   */\n  static options: IResultListOptions = {\n    /**\n     * The element inside which to insert the rendered result templates.\n     *\n     * Performing a new query clears the content of this element.\n     *\n     * You can change the container by specifying its selector (e.g.,\n     * `data-result-container-selector='#someCssSelector'`).\n     *\n     * If you specify no value for this option, a `div` element will be dynamically created and appended to the result\n     * list. This element will then be used as a result container.\n     */\n    resultsContainer: ComponentOptions.buildChildHtmlElementOption({ alias: 'resultContainerSelector' }),\n    resultTemplate: TemplateComponentOptions.buildTemplateOption({ defaultFunction: ResultList.getDefaultTemplate }),\n\n    /**\n     * The type of animation to display while waiting for a query to return.\n     *\n     * The possible values are:\n     * - `fade`: Fades out the current list of results while the query is executing.\n     * - `spinner`: Shows a spinning animation while the query is executing.\n     * - `none`: Use no animation during queries.\n     *\n     * See also the [`waitAnimationContainer`]{@link ResultList.options.waitAnimationContainer} option.\n     *\n     * @examples spinner\n     */\n    waitAnimation: ComponentOptions.buildStringOption<WaitAnimation>({ defaultValue: 'none' }),\n\n    /**\n     * The element inside which to display the [`waitAnimation`]{@link ResultList.options.waitAnimation}.\n     *\n     * You can change this by specifying a CSS selector (e.g.,\n     * `data-wait-animation-container-selector='#someCssSelector'`).\n     *\n     * Defaults to the value of the [`resultsContainer`]{@link ResultList.options.resultsContainer} option.\n     */\n    waitAnimationContainer: ComponentOptions.buildChildHtmlElementOption({\n      postProcessing: (value, options: IResultListOptions) => value || options.resultsContainer\n    }),\n\n    /**\n     * Whether to automatically retrieve an additional page of results and append it to the\n     * results that the `ResultList` is currently displaying when the user scrolls down to the bottom of the\n     * [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer}.\n     *\n     * See also the [`infiniteScrollPageSize`]{@link ResultList.options.infiniteScrollPageSize} and\n     * [`enableInfiniteScrollWaitingAnimation`]{@link ResultList.options.enableInfiniteScrollWaitingAnimation} options.\n     *\n     * It is important to specify the `infiniteScrollContainer` option manually if you want the scrolling element to be\n     * something else than the default `window` element. Otherwise, you might find yourself in a strange state where the\n     * framework rapidly triggers multiple successive query.\n     */\n    enableInfiniteScroll: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n\n    /**\n     * The number of additional results to fetch when the user scrolls down to the bottom of the\n     * [`infiniteScrollContainer`]{@link ResultList.options.infiniteScrollContainer}.\n     *\n     * @examples 5\n     */\n    infiniteScrollPageSize: ComponentOptions.buildNumberOption({\n      defaultValue: 10,\n      min: 1,\n      depend: 'enableInfiniteScroll'\n    }),\n\n    /**\n     * The element that triggers fetching additional results when the end user scrolls down to its bottom.\n     *\n     * You can change the container by specifying its selector (e.g.,\n     * `data-infinite-scroll-container-selector='#someCssSelector'`).\n     *\n     * By default, the framework uses the first vertically scrollable parent element it finds, starting from the\n     * `ResultList` element itself. A vertically scrollable element is an element whose CSS `overflow-y` attribute is\n     * `scroll`.\n     *\n     * This implies that if the framework can find no scrollable parent, it uses the `window` itself as a scrollable\n     * container.\n     *\n     * This heuristic is not perfect, for technical reasons. There are always some corner case CSS combination which the\n     * framework will not be able to correctly detect as 'scrollable'.\n     *\n     * It is highly recommended that you manually set this option if you wish something else than the `window` to be the\n     * scrollable element.\n     */\n    infiniteScrollContainer: ComponentOptions.buildChildHtmlElementOption({\n      depend: 'enableInfiniteScroll',\n      defaultFunction: element => ComponentOptions.findParentScrolling(element)\n    }),\n\n    /**\n     * Whether to display the [`waitingAnimation`]{@link ResultList.options.waitAnimation} while fetching additional\n     * results.\n     */\n    enableInfiniteScrollWaitingAnimation: ComponentOptions.buildBooleanOption({\n      depend: 'enableInfiniteScroll',\n      defaultValue: true\n    }),\n    mobileScrollContainer: ComponentOptions.buildSelectorOption({\n      defaultFunction: () => <HTMLElement>document.querySelector('.coveo-results-column')\n    }),\n\n    /**\n     * Whether the `ResultList` should scan its result templates to discover which fields it must request to\n     * be able to render all results.\n     *\n     * Setting this option to `true` ensures that the Coveo Search API does not return fields that are unnecessary for\n     * the UI to function.\n     *\n     * **Notes:**\n     *\n     * - Many interfaces created with the JavaScript Search Interface Editor explicitly set this option to `true`.\n     * - You cannot set this option to `true` in the Coveo for Sitecore integration.\n     */\n    autoSelectFieldsToInclude: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n\n    /**\n     * A list of fields to include in the query results.\n     *\n     * If you set the [`autoSelectFieldsToInclude`]{@link ResultList.options.autoSelectFieldsToInclude} option to\n     * `true`, the Coveo Search API returns the fields you specify for this option (if those fields are available) in\n     * addition to the fields which the `ResultList` automatically requests.\n     *\n     * Otherwise, the Coveo Search API only returns the fields you specify for this option (if those fields are\n     * available), unless you leave this option undefined, in which case the Coveo Search API returns all available\n     * fields.\n     */\n    fieldsToInclude: ComponentOptions.buildFieldsOption({ includeInResults: true }),\n\n    /**\n     * Specifies the layout to use when displaying results in this `ResultList` (see\n     * [Result Layouts](https://docs.coveo.com/en/360/)). Specifying a value for this option automatically\n     * populates a [`ResultLayout`]{@link ResultLayout} component with a switcher for the layout.\n     *\n     * For example, if there are two `ResultList` components in the page, one with its `layout` set to `list` and the\n     * other with the same option set to `card`, then the `ResultLayout` component will render two buttons respectively\n     * entitled **List** and **Card**.\n     *\n     * See the [`ValidLayout`]{@link ValidLayout} type for the list of possible values.\n     *\n     * @examples card\n     */\n    layout: ComponentOptions.buildStringOption<ValidLayout>({\n      defaultValue: 'list',\n      required: true\n    }),\n\n    /**\n     * Whether to scroll back to the top of the page when the end-user interacts with a facet.\n     *\n     * **Note:** Setting this option to `false` has no effect on dynamic facets. To disable this behavior on a `DynamicFacet` component, you must set its own [`enableScrollToTop`]{@link DynamicFacet.options.enableScrollToTop} option to `false`.\n     *\n     * @availablesince [July 2019 Release (v2.6459)](https://docs.coveo.com/en/2938/)\n     */\n    enableScrollToTop: ComponentOptions.buildBooleanOption({\n      defaultValue: true,\n      depend: 'enableInfiniteScroll'\n    })\n  };\n\n  public static resultCurrentlyBeingRendered: IQueryResult = null;\n  public currentlyDisplayedResults: IQueryResult[] = [];\n  private fetchingMoreResults: Promise<IQueryResults>;\n  private reachedTheEndOfResults = false;\n  private disableLayoutChange = false;\n  private renderer: ResultListRenderer;\n  private resultContainer: ResultContainer;\n\n  // This variable serves to block some setup where the framework fails to correctly identify the \"real\" scrolling container.\n  // Since it's not technically feasible to correctly identify the scrolling container in every possible scenario without some very complex logic, we instead try to add some kind of mechanism to\n  // block runaway requests where UI will keep asking more results in the index, eventually bringing the browser to it's knee.\n  // Those successive request are needed in \"displayMoreResults\" to ensure we fill the scrolling container correctly.\n  // Since the container is not identified correctly, it is never \"full\", so we keep asking for more.\n  // It is reset every time the user actually scroll the container manually.\n  private successiveScrollCount = 0;\n  private static MAX_AMOUNT_OF_SUCESSIVE_REQUESTS = 5;\n\n  /**\n   * Creates a new `ResultList` component. Binds various event related to queries (e.g., on querySuccess ->\n   * renderResults). Binds scroll event if the [`enableInfiniteScroll`]{@link ResultList.options.enableInfiniteScroll}\n   * option is `true`.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `ResultList` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   * @param elementClassId The class that this component should instantiate. Components that extend the base ResultList\n   * use this. Default value is `CoveoResultList`.\n   */\n  constructor(\n    public element: HTMLElement,\n    public options?: IResultListOptions,\n    public bindings?: IComponentBindings,\n    elementClassId: string = ResultList.ID\n  ) {\n    super(element, elementClassId, bindings);\n    this.options = ComponentOptions.initComponentOptions(element, ResultList, options);\n\n    Assert.exists(element);\n    Assert.exists(this.options);\n    Assert.exists(this.options.resultTemplate);\n    Assert.exists(this.options.infiniteScrollContainer);\n\n    this.showOrHideElementsDependingOnState(false, false);\n\n    this.bind.onRootElement<INewQueryEventArgs>(QueryEvents.newQuery, (args: INewQueryEventArgs) => this.handleNewQuery());\n    this.bind.onRootElement<IBuildingQueryEventArgs>(QueryEvents.buildingQuery, (args: IBuildingQueryEventArgs) =>\n      this.handleBuildingQuery(args)\n    );\n    this.bind.onRootElement<IQuerySuccessEventArgs>(QueryEvents.querySuccess, (args: IQuerySuccessEventArgs) =>\n      this.handleQuerySuccess(args)\n    );\n    this.bind.onRootElement<IDuringQueryEventArgs>(QueryEvents.duringQuery, (args: IDuringQueryEventArgs) => this.handleDuringQuery());\n    this.bind.onRootElement<IQueryErrorEventArgs>(QueryEvents.queryError, (args: IQueryErrorEventArgs) => this.handleQueryError());\n    $$(this.root).on(ResultListEvents.changeLayout, (e: Event, args: IChangeLayoutEventArgs) => this.handleChangeLayout(args));\n\n    if (this.options.enableInfiniteScroll) {\n      this.handlePageChanged();\n      this.bind.on(<HTMLElement>this.options.infiniteScrollContainer, 'scroll', (e: Event) => {\n        this.successiveScrollCount = 0;\n        this.handleScrollOfResultList();\n      });\n    }\n    this.bind.onQueryState(MODEL_EVENTS.CHANGE_ONE, QUERY_STATE_ATTRIBUTES.FIRST, () => this.handlePageChanged());\n\n    this.resultContainer = this.initResultContainer();\n    Assert.exists(this.options.resultsContainer);\n\n    this.initWaitAnimationContainer();\n    Assert.exists(this.options.waitAnimationContainer);\n\n    this.setupTemplatesVersusLayouts();\n    $$(this.root).on(ResultLayoutEvents.populateResultLayout, (e, args: IResultLayoutPopulateArgs) =>\n      args.layouts.push(this.options.layout)\n    );\n    this.setupRenderer();\n    this.makeElementFocusable();\n    this.ensureHasId();\n  }\n\n  /**\n   * Get the fields needed to be automatically included in the query for this result list.\n   * @returns {string[]}\n   */\n  public getAutoSelectedFieldsToInclude(): string[] {\n    return chain(this.options.resultTemplate.getFields()).concat(this.getMinimalFieldsToInclude()).compact().unique().value();\n  }\n\n  private setupTemplatesVersusLayouts() {\n    const layoutClassToAdd = `coveo-${this.options.layout}-layout-container`;\n    this.resultContainer.addClass(layoutClassToAdd);\n\n    if (this.options.layout === 'table') {\n      this.options.resultTemplate = new TableTemplate((<TemplateList>this.options.resultTemplate).templates || []);\n    }\n\n    // A TemplateList is the scenario where the result template are directly embedded inside the ResultList\n    // This is the typical scenario when a page gets created by the interface editor, for example.\n    // In that case, we try to stick closely that what is actually configured inside the page, and do no \"special magic\".\n    // Stick to the \"hardcoded\" configuration present in the page.\n    // We only add the correct layout options if it has not been set manually.\n    if (this.options.resultTemplate instanceof TemplateList) {\n      each((<TemplateList>this.options.resultTemplate).templates, (tmpl: Template) => {\n        if (!tmpl.layout) {\n          tmpl.layout = <ValidLayout>this.options.layout;\n        }\n      });\n    } else if (this.options.resultTemplate instanceof DefaultResultTemplate && this.options.layout == 'list') {\n      ResponsiveDefaultResultTemplate.init(this.root, this, {});\n    }\n  }\n\n  /**\n   * Empties the current result list content and appends the given array of HTMLElement.\n   *\n   * Can append to existing elements in the result list, or replace them.\n   *\n   * Triggers the `newResultsDisplayed` and `newResultDisplayed` events.\n   * @param resultsElement\n   * @param append\n   */\n  public renderResults(resultElements: HTMLElement[], append = false): Promise<void> {\n    if (!append) {\n      this.resultContainer.empty();\n    }\n\n    return this.renderer\n      .renderResults(resultElements, append, this.triggerNewResultDisplayed.bind(this))\n      .then(() => this.triggerNewResultsDisplayed());\n  }\n\n  /**\n   * Builds and returns an array of HTMLElement with the given result set.\n   * @param results the result set to build an array of HTMLElement from.\n   */\n  public buildResults(results: IQueryResults): Promise<HTMLElement[]> {\n    const layout = <RendererValidLayout>this.options.layout;\n    return this.templateToHtml.buildResults(results, layout, this.currentlyDisplayedResults);\n  }\n\n  /**\n   * Builds and returns an HTMLElement for the given result.\n   * @param result the result to build an HTMLElement from.\n   * @returns {HTMLElement}\n   */\n  public buildResult(result: IQueryResult): Promise<HTMLElement> {\n    const layout = <RendererValidLayout>this.options.layout;\n    return this.templateToHtml.buildResult(result, layout, this.currentlyDisplayedResults);\n  }\n\n  /**\n   * Executes a query to fetch new results. After the query returns, renders the new results.\n   *\n   * Asserts that there are more results to display by verifying whether the last query has returned as many results as\n   * requested.\n   *\n   * Asserts that the `ResultList` is not currently fetching results.\n   * @param count The number of results to fetch and display.\n   */\n  public displayMoreResults(count: number) {\n    Assert.isLargerOrEqualsThan(1, count);\n\n    if (this.isCurrentlyFetchingMoreResults()) {\n      this.logger.warn(\"Ignoring request to display more results since we're already doing so\");\n      return;\n    }\n    if (!this.hasPotentiallyMoreResultsToDisplay()) {\n      this.logger.warn(\"Ignoring request to display more results since we know there aren't more to display\");\n      return;\n    }\n\n    if (this.options.enableInfiniteScrollWaitingAnimation) {\n      this.showWaitingAnimationForInfiniteScrolling();\n    }\n\n    return this.fetchAndRenderMoreResults(count);\n  }\n\n  public get templateToHtml() {\n    const templateToHtmlArgs: ITemplateToHtml = {\n      resultTemplate: this.options.resultTemplate,\n      searchInterface: this.searchInterface,\n      queryStateModel: this.queryStateModel\n    };\n    return new TemplateToHtml(templateToHtmlArgs);\n  }\n\n  /**\n   * Gets the list of currently displayed result.\n   * @returns {IQueryResult[]}\n   */\n  public getDisplayedResults(): IQueryResult[] {\n    return this.currentlyDisplayedResults;\n  }\n\n  /**\n   * Gets the list of currently displayed result HTMLElement.\n   * @returns {HTMLElement[]}\n   */\n  public getDisplayedResultsElements(): HTMLElement[] {\n    return this.resultContainer.getResultElements();\n  }\n\n  public enable(): void {\n    super.enable();\n    this.disableLayoutChange = false;\n    each(this.resultLayoutSelectors, resultLayoutSelector => {\n      resultLayoutSelector.enableLayouts([this.options.layout] as ValidLayout[]);\n    });\n    $$(this.element).removeClass('coveo-hidden');\n  }\n\n  public disable(): void {\n    super.disable();\n\n    const otherLayoutsStillActive = map(this.otherResultLists, otherResultList => otherResultList.options.layout);\n    if (!contains(otherLayoutsStillActive, this.options.layout) && !this.disableLayoutChange) {\n      each(this.resultLayoutSelectors, resultLayoutSelector => {\n        resultLayoutSelector.disableLayouts([this.options.layout] as ValidLayout[]);\n      });\n    }\n    this.disableLayoutChange = false;\n    $$(this.element).addClass('coveo-hidden');\n  }\n\n  protected autoCreateComponentsInsideResult(element: HTMLElement, result: IQueryResult): IInitResult {\n    return this.templateToHtml.autoCreateComponentsInsideResult(element, result);\n  }\n\n  protected triggerNewResultDisplayed(result: IQueryResult, resultElement: HTMLElement) {\n    const args: IDisplayedNewResultEventArgs = {\n      result: result,\n      item: resultElement\n    };\n    $$(this.element).trigger(ResultListEvents.newResultDisplayed, args);\n  }\n\n  protected triggerNewResultsDisplayed() {\n    const args: IDisplayedNewResultsEventArgs = {\n      isInfiniteScrollEnabled: this.options.enableInfiniteScroll\n    };\n    $$(this.element).trigger(ResultListEvents.newResultsDisplayed, args);\n  }\n\n  private async fetchAndRenderMoreResults(count: number): Promise<IQueryResults> {\n    this.fetchingMoreResults = this.queryController.fetchMore(count);\n\n    try {\n      const data = await this.fetchingMoreResults;\n      Assert.exists(data);\n      this.usageAnalytics.logCustomEvent<IAnalyticsNoMeta>(analyticsActionCauseList.pagerScrolling, {}, this.element);\n\n      this.reachedTheEndOfResults = count > data.results.length;\n      this.renderNewResults(data);\n\n      this.resetStateAfterFetchingMoreResults();\n\n      return data;\n    } catch (e) {\n      this.resetStateAfterFetchingMoreResults();\n      return Promise.reject(e);\n    }\n  }\n\n  private async renderNewResults(data: IQueryResults) {\n    const elements = await this.buildResults(data);\n    this.renderResults(elements, true);\n    this.currentlyDisplayedResults.push(...data.results);\n    this.triggerNewResultsDisplayed();\n  }\n\n  private resetStateAfterFetchingMoreResults() {\n    this.hideWaitingAnimationForInfiniteScrolling();\n    this.fetchingMoreResults = undefined;\n    Defer.defer(() => {\n      this.successiveScrollCount++;\n      if (this.successiveScrollCount <= ResultList.MAX_AMOUNT_OF_SUCESSIVE_REQUESTS) {\n        this.handleScrollOfResultList();\n      } else {\n        this.logger.info(\n          `Result list has triggered 5 consecutive queries to try and fill up the scrolling container, but it is still unable to do so.\n          Try explicitly setting the 'data-infinite-scroll-container-selector' option on the result list. See: https://coveo.github.io/search-ui/components/resultlist.html#options.infinitescrollcontainer`\n        );\n      }\n    });\n  }\n\n  private handleDuringQuery() {\n    this.logger.trace('Emptying the result container');\n    this.cancelFetchingMoreResultsIfNeeded();\n    this.showWaitingAnimation();\n    this.showOrHideElementsDependingOnState(false, false);\n  }\n\n  private handleQueryError() {\n    this.hideWaitingAnimation();\n    this.resultContainer.empty();\n    this.currentlyDisplayedResults = [];\n    this.reachedTheEndOfResults = true;\n  }\n\n  private handleQuerySuccess(data: IQuerySuccessEventArgs) {\n    Assert.exists(data);\n    Assert.exists(data.results);\n    const results = data.results;\n    this.logger.trace('Received query results from new query', results);\n    this.hideWaitingAnimation();\n\n    ResultList.resultCurrentlyBeingRendered = undefined;\n    this.reachedTheEndOfResults = data.query.numberOfResults > data.results.results.length;\n\n    this.currentlyDisplayedResults = [];\n    this.buildResults(data.results).then(async (elements: HTMLElement[]) => {\n      await this.renderResults(elements);\n\n      this.showOrHideElementsDependingOnState(true, this.currentlyDisplayedResults.length != 0);\n\n      if (DeviceUtils.isMobileDevice() && this.options.mobileScrollContainer != undefined) {\n        this.options.mobileScrollContainer.scrollTop = 0;\n      }\n\n      if (this.options.enableInfiniteScroll && results.results.length == data.queryBuilder.numberOfResults) {\n        // This will check right away if we need to add more results to make the scroll container full & scrolling.\n        this.scrollToTopIfEnabled();\n        this.handleScrollOfResultList();\n      }\n    });\n  }\n\n  private handleScrollOfResultList() {\n    if (this.isCurrentlyFetchingMoreResults() || !this.options.enableInfiniteScroll) {\n      return;\n    }\n    if (this.isScrollingOfResultListAlmostAtTheBottom() && this.hasPotentiallyMoreResultsToDisplay()) {\n      this.displayMoreResults(this.options.infiniteScrollPageSize);\n    }\n  }\n\n  private handlePageChanged() {\n    this.bind.onRootElement(QueryEvents.deferredQuerySuccess, () => {\n      setTimeout(() => {\n        this.scrollToTopIfEnabled();\n      }, 0);\n    });\n  }\n\n  private scrollToTopIfEnabled() {\n    if (!this.options.enableScrollToTop) {\n      return;\n    }\n\n    ResultListUtils.scrollToTop(this.root);\n  }\n\n  private handleNewQuery() {\n    $$(this.element).removeClass('coveo-hidden');\n    ResultList.resultCurrentlyBeingRendered = undefined;\n  }\n\n  private get otherResultLists() {\n    const allResultLists = this.searchInterface.getComponents(ResultList.ID) as ResultList[];\n    return without(allResultLists, this);\n  }\n\n  private get resultLayoutSelectors() {\n    return this.searchInterface.getComponents('ResultLayoutSelector') as ResultLayoutSelectorModule.ResultLayoutSelector[];\n  }\n\n  protected handleBuildingQuery(args: IBuildingQueryEventArgs) {\n    if (this.options.fieldsToInclude != null) {\n      // remove the @\n      args.queryBuilder.addFieldsToInclude(map(this.options.fieldsToInclude, field => field.substr(1)));\n    }\n    if (this.options.autoSelectFieldsToInclude) {\n      const otherFields = flatten(\n        map(this.otherResultLists, otherResultList => {\n          return otherResultList.getAutoSelectedFieldsToInclude();\n        })\n      );\n\n      args.queryBuilder.addRequiredFields(unique(otherFields.concat(this.getAutoSelectedFieldsToInclude())));\n      args.queryBuilder.includeRequiredFields = true;\n    }\n  }\n\n  protected handleChangeLayout(args: IChangeLayoutEventArgs) {\n    if (args.layout === this.options.layout) {\n      this.disableLayoutChange = false;\n      this.enable();\n      this.options.resultTemplate.layout = <ValidLayout>this.options.layout;\n      if (args.results) {\n        // Prevent flickering when switching to a new layout that is empty\n        // add a temporary placeholder, the same that is used on initialization\n        if (this.resultContainer.isEmpty()) {\n          new InitializationPlaceholder(this.root).withVisibleRootElement().withPlaceholderForResultList();\n        }\n        Defer.defer(async () => {\n          const elements = await this.buildResults(args.results);\n          this.renderResults(elements);\n          this.showOrHideElementsDependingOnState(true, this.currentlyDisplayedResults.length !== 0);\n        });\n      }\n    } else {\n      this.disableLayoutChange = true;\n      this.disable();\n      this.resultContainer.empty();\n    }\n  }\n\n  private isCurrentlyFetchingMoreResults(): boolean {\n    return Utils.exists(this.fetchingMoreResults);\n  }\n\n  private getMinimalFieldsToInclude() {\n    // these fields are needed for analytics click event\n    return ['author', 'language', 'urihash', 'objecttype', 'collection', 'source', 'language', 'permanentid'];\n  }\n\n  private isScrollingOfResultListAlmostAtTheBottom(): boolean {\n    // this is in a try catch because the unit test fail otherwise (Window does not exist for phantom js in the console)\n    let isWindow;\n    try {\n      isWindow = this.options.infiniteScrollContainer instanceof Window;\n    } catch (e) {\n      isWindow = false;\n    }\n    return isWindow ? this.isScrollAtBottomForWindowElement() : this.isScrollAtBottomForHtmlElement();\n  }\n\n  private isScrollAtBottomForWindowElement() {\n    const win = new Win(window);\n    const windowHeight = win.height();\n    const scrollTop = win.scrollY();\n    const bodyHeight = new Doc(document).height();\n    return bodyHeight - (windowHeight + scrollTop) < windowHeight / 2;\n  }\n\n  private isScrollAtBottomForHtmlElement() {\n    const el = <HTMLElement>this.options.infiniteScrollContainer;\n    const elementHeight = el.clientHeight;\n    const scrollHeight = el.scrollHeight;\n    const bottomPosition = el.scrollTop + elementHeight;\n    return scrollHeight - bottomPosition < elementHeight / 2;\n  }\n\n  public hasPotentiallyMoreResultsToDisplay(): boolean {\n    return this.currentlyDisplayedResults.length > 0 && !this.reachedTheEndOfResults;\n  }\n\n  private cancelFetchingMoreResultsIfNeeded() {\n    if (this.isCurrentlyFetchingMoreResults()) {\n      this.logger.trace('Cancelling fetching more results');\n      Promise.reject(this.fetchingMoreResults);\n      this.fetchingMoreResults = undefined;\n    }\n  }\n\n  private showOrHideElementsDependingOnState(hasQuery: boolean, hasResults: boolean) {\n    const showIfQuery = $$(this.element).findAll('.coveo-show-if-query');\n    const showIfNoQuery = $$(this.element).findAll('.coveo-show-if-no-query');\n    const showIfResults = $$(this.element).findAll('.coveo-show-if-results');\n    const showIfNoResults = $$(this.element).findAll('.coveo-show-if-no-results');\n\n    each(showIfQuery, (s: HTMLElement) => {\n      $$(s).toggle(hasQuery);\n    });\n    each(showIfNoQuery, (s: HTMLElement) => {\n      $$(s).toggle(!hasQuery);\n    });\n    each(showIfResults, (s: HTMLElement) => {\n      $$(s).toggle(hasQuery && hasResults);\n    });\n    each(showIfNoResults, (s: HTMLElement) => {\n      $$(s).toggle(hasQuery && !hasResults);\n    });\n  }\n\n  private get waitAnimation() {\n    return this.options.waitAnimation.toLowerCase() as WaitAnimation;\n  }\n\n  private showWaitingAnimation() {\n    switch (this.waitAnimation) {\n      case 'fade':\n        $$(this.options.waitAnimationContainer).addClass('coveo-fade-out');\n        break;\n      case 'spinner':\n        this.resultContainer.hideChildren();\n        if ($$(this.options.waitAnimationContainer).find('.coveo-wait-animation') == undefined) {\n          this.options.waitAnimationContainer.appendChild(DomUtils.getBasicLoadingAnimation());\n        }\n        break;\n    }\n  }\n\n  private hideWaitingAnimation() {\n    switch (this.waitAnimation) {\n      case 'fade':\n        $$(this.options.waitAnimationContainer).removeClass('coveo-fade-out');\n        break;\n      case 'spinner':\n        const spinner = $$(this.options.waitAnimationContainer).find('.coveo-loading-spinner');\n        if (spinner) {\n          $$(spinner).detach();\n        }\n        break;\n    }\n  }\n\n  private showWaitingAnimationForInfiniteScrolling() {\n    const spinner = DomUtils.getLoadingSpinner();\n    if (this.options.layout == 'card' && this.options.enableInfiniteScroll) {\n      const previousSpinnerContainer = $$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner-container');\n      each(previousSpinnerContainer, previousSpinner => $$(previousSpinner).remove());\n      const spinnerContainer = $$('div', {\n        className: 'coveo-loading-spinner-container'\n      });\n      spinnerContainer.append(spinner);\n      this.options.waitAnimationContainer.appendChild(spinnerContainer.el);\n    } else {\n      this.options.waitAnimationContainer.appendChild(DomUtils.getLoadingSpinner());\n    }\n  }\n\n  private hideWaitingAnimationForInfiniteScrolling() {\n    const spinners = $$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner');\n    const containers = $$(this.options.waitAnimationContainer).findAll('.coveo-loading-spinner-container');\n    each(spinners, spinner => $$(spinner).remove());\n    each(containers, container => $$(container).remove());\n  }\n\n  private initResultContainer(): ResultContainer {\n    if (!this.options.resultsContainer) {\n      const elemType = this.options.layout === 'table' ? 'table' : 'div';\n      this.options.resultsContainer = $$(elemType, { className: 'coveo-result-list-container' }).el;\n      this.initResultContainerAddToDom();\n    }\n    return new ResultContainer(this.options.resultsContainer, this.searchInterface);\n  }\n\n  protected initResultContainerAddToDom() {\n    this.element.appendChild(this.options.resultsContainer);\n  }\n\n  private initWaitAnimationContainer() {\n    if (!this.options.waitAnimationContainer) {\n      this.options.waitAnimationContainer = this.resultContainer.el;\n    }\n  }\n\n  private setupRenderer() {\n    const initParameters: IInitializationParameters = {\n      options: this.searchInterface.options.originalOptionsObject,\n      bindings: this.bindings\n    };\n\n    const autoCreateComponentsFn = (elem: HTMLElement) => Initialization.automaticallyCreateComponentsInside(elem, initParameters);\n\n    switch (this.options.layout) {\n      case 'card':\n        this.renderer = new ResultListCardRenderer(this.options, autoCreateComponentsFn);\n        break;\n      case 'table':\n        this.renderer = new ResultListTableRenderer(this.options, autoCreateComponentsFn);\n        break;\n      case 'list':\n      default:\n        this.renderer = new ResultListRenderer(this.options, autoCreateComponentsFn);\n        break;\n    }\n  }\n\n  private makeElementFocusable() {\n    $$(this.element).setAttribute('tabindex', '-1');\n  }\n\n  private ensureHasId() {\n    const currentId = this.element.id;\n    if (currentId === '') {\n      this.element.id = uniqueId('coveo-result-list');\n    }\n  }\n}\n\nInitialization.registerAutoCreateComponent(ResultList);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultList/ResultList.ts"],"sourceRoot":""}
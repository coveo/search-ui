{"version":3,"sources":["./src/ui/StarRating/StarRating.ts","./sass/_StarRating.scss"],"names":[],"mappings":"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","file":"StarRating__ec82d15c0e890cb8a4e5.js","sourcesContent":["import 'styling/_StarRating';\nimport { $$ } from '../../utils/Dom';\nimport { Utils } from '../../utils/Utils';\nimport { l } from '../../strings/Strings';\nimport { Component } from '../Base/Component';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { exportGlobally } from '../../GlobalExports';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { Initialization } from '../Base/Initialization';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { IFieldOption } from '../Base/IComponentOptions';\n\nconst DEFAULT_SCALE = 5;\n\nexport interface IStarRatingOptions {\n  ratingField?: IFieldOption;\n  numberOfRatingsField?: IFieldOption;\n  ratingScale?: number;\n}\n/**\n * The `StarRating` component renders a five-star rating widget for use in commerce result templates.\n *\n * @isresulttemplatecomponent\n *\n * @availablesince [January 2020 Release (v2.7968)](https://docs.coveo.com/en/3163/)\n */\nexport class StarRating extends Component {\n  static ID = 'StarRating';\n  private rating: number;\n  private numberOfRatings: number;\n\n  static doExport = () => {\n    exportGlobally({\n      StarRating: StarRating\n    });\n  };\n\n  /**\n   * @componentOptions\n   */\n  static options: IStarRatingOptions = {\n    /**\n     * Specifies the rating to be displayed as stars. If the rating is on a different scale than 0-5, a `ratingScale` value must be provided.\n     */\n    ratingField: ComponentOptions.buildFieldOption({ required: true }),\n\n    /**\n     * A numeric field whose value should be used to display the total number of ratings label for the result item.\n     *\n     * If unspecified, no number of ratings label is displayed. If the `numberOfRatingsField`'s value is `0` or less, a `(No Ratings)` label is displayed.\n     */\n    numberOfRatingsField: ComponentOptions.buildFieldOption(),\n\n    /**\n     * The scale to apply to the [`ratingField`]{@link StarRating.options.ratingField}'s value. Must be smaller than or equal to the highest possible `ratingField`'s value.\n     *\n     * **Example:** If the `ratingScale` is `100` and the current `ratingField`'s value is `75`, the component will render 3 stars (i.e., `75 * (5 / 100)`, rounded down).\n     */\n    ratingScale: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 1, max: 100000 })\n  };\n\n  /**\n   * Creates a new `StarRating` component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `StarRating` component.\n   * @param bindings The bindings that the component requires to function normally.\n   */\n  constructor(\n    public element: HTMLElement,\n    public options: IStarRatingOptions,\n    public bindings?: IComponentBindings,\n    private result?: IQueryResult\n  ) {\n    super(element, StarRating.ID);\n    this.options = ComponentOptions.initComponentOptions(element, StarRating, options);\n\n    if (!result) {\n      this.logger.error('No result passed to Star Rating component.');\n      return;\n    }\n    this.renderComponent();\n  }\n\n  private get configuredFieldsAreValid(): boolean {\n    const rawRating = Utils.getFieldValue(this.result, <string>this.options.ratingField);\n    const rawNumberOfRatings = Utils.getFieldValue(this.result, <string>this.options.numberOfRatingsField);\n\n    if (rawNumberOfRatings !== undefined) {\n      this.numberOfRatings = Number(rawNumberOfRatings) < 0 ? 0 : Number(rawNumberOfRatings) || 0;\n    }\n\n    this.rating = Number(rawRating) < 0 ? 0 : Number(rawRating) || 0;\n    const scale = this.options.ratingScale;\n\n    if (scale < this.rating || scale <= 0) {\n      this.logger.error(`The rating scale property is either missing or invalid.`);\n      return false;\n    }\n\n    this.rating = Math.round(this.rating * (DEFAULT_SCALE / scale));\n    return true;\n  }\n\n  private renderComponent() {\n    if (this.configuredFieldsAreValid) {\n      this.makeAccessible();\n      for (let starNumber = 1; starNumber <= DEFAULT_SCALE; starNumber++) {\n        this.renderStar(starNumber <= this.rating);\n      }\n      if (this.numberOfRatings !== undefined) {\n        this.renderNumberOfReviews(this.numberOfRatings);\n      }\n    }\n  }\n\n  private makeAccessible() {\n    this.setDefaultTabIndex();\n    this.element.setAttribute('aria-label', this.getAriaLabel());\n  }\n\n  private setDefaultTabIndex() {\n    if (Utils.isNullOrUndefined(this.element.getAttribute('tabindex'))) {\n      this.element.tabIndex = 0;\n    }\n  }\n\n  private getAriaLabel() {\n    const numberOfRatingsIsKnown = !Utils.isNullOrUndefined(this.numberOfRatings);\n    const wasRated = !!this.numberOfRatings;\n    if (numberOfRatingsIsKnown && !wasRated) {\n      return l('NoRatings');\n    }\n    const label = l('Rated', this.rating, this.options.ratingScale, this.options.ratingScale);\n    if (numberOfRatingsIsKnown) {\n      return label + ' ' + l('RatedBy', this.numberOfRatings, this.numberOfRatings);\n    }\n    return label;\n  }\n\n  private renderStar(isChecked: boolean) {\n    const star = $$('span', { className: 'coveo-star-rating-star' }, SVGIcons.icons.star);\n    star.toggleClass('coveo-star-rating-star-active', isChecked);\n    this.element.appendChild(star.el);\n  }\n\n  private renderNumberOfReviews(value: number) {\n    const numberString = $$('span', { className: 'coveo-star-rating-label' });\n    numberString.text(value > 0 ? `(${value})` : l('NoRatings'));\n    this.element.appendChild(numberString.el);\n  }\n}\n\nInitialization.registerAutoCreateComponent(StarRating);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/StarRating/StarRating.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_StarRating.scss\n// module id = 658\n// module chunks = 58 88"],"sourceRoot":""}
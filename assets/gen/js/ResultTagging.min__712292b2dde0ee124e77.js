webpackJsonpCoveo__temporary([32],{14:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(){function e(){}return e.addClassToSVGInContainer=function(t,o){var n=t.querySelector("svg");n.setAttribute("class",""+e.getClass(n)+o)},e.removeClassFromSVGInContainer=function(t,o){var n=t.querySelector("svg");n.setAttribute("class",e.getClass(n).replace(o,""))},e.addStyleToSVGInContainer=function(e,t){var o=e.querySelector("svg");n.each(t,function(e,t){o.style[t]=e})},e.getClass=function(e){var t=e.getAttribute("class");return t?t+" ":""},e}();t.SVGDom=i},196:function(e,t,o){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=o(6),a=o(7),l=o(5),s=o(4),u=o(1),r=o(18),c=o(8),p=o(20),d=o(12),g=o(2),h=o(9),m=o(0),v=o(3);o(420);var f=o(13),C=o(14),$=function(e){function t(o,n,i,u){var r=e.call(this,o,t.ID,i)||this;if(r.element=o,r.options=n,r.result=u,r.options=a.ComponentOptions.initComponentOptions(o,t,n),r.result=u||r.resolveResult(),l.Assert.exists(r.componentOptionsModel),l.Assert.exists(r.result),!r.options.field)return r.logger.error("You must specify a field to the ResultTagging component"),r;var c=s.Utils.getFieldValue(r.result,r.options.field);return c&&s.Utils.isNonEmptyString(c)?r.tags=c.split(";"):c&&s.Utils.isNonEmptyArray(c)?r.tags=c:r.tags=[],r.tags=m.map(r.tags,function(e){return e.trim()}),r.tagZone=g.$$("div",{className:"coveo-result-tagging-tag-zone"}).el,o.appendChild(r.tagZone),o.appendChild(r.buildTagIcon()),r.autoCompleteZone=g.$$("div",{className:"coveo-result-tagging-auto-complete-zone"}).el,o.appendChild(r.autoCompleteZone),r.autoCompleteZone.appendChild(r.buildTextBox()),r.autoCompleteZone.appendChild(r.buildAddIcon()),r.autoCompleteZone.appendChild(r.buildClearIcon()),r.buildExistingTags(),r}return n(t,e),t.prototype.buildExistingTags=function(){var e=this;this.tags&&m.each(this.tags,function(t){e.tagZone.appendChild(e.buildTagValue(t))})},t.prototype.buildTagIcon=function(){var e=this,t=g.$$("div",{className:"coveo-result-tagging-add-tag"}),o=g.$$("span",{className:"coveo-result-tagging-add-tag-text"});o.text(c.l("EnterTag"));var n=g.$$("span",{className:"coveo-result-tagging-add-tag-icon"});return n.on("click",function(){m.defer(function(){e.focusOnTextBox()},20)}),t.el.appendChild(n.el),t.append(o.el),t.setAttribute("title",c.l("EnterTag")),t.el},t.prototype.focusOnTextBox=function(){this.textBox.focus()},t.prototype.buildTagValue=function(e){var t=this,o=g.$$("div",{className:"coveo-result-tagging-coveo-tag"});o.el.appendChild(this.buildShortenedTagWithTitle(e));var n=g.$$("span",{className:"coveo-result-tagging-delete-icon"},f.SVGIcons.icons.checkboxHookExclusionMore);return C.SVGDom.addClassToSVGInContainer(n.el,"coveo-result-tagging-delete-icon-svg"),o.el.appendChild(n.el),n.on("click",function(){t.doRemoveTag(o.el,e.toLowerCase())}),o.el},t.prototype.buildShortenedTagWithTitle=function(e){var t=r.StringUtils.removeMiddle(e,16,"..."),o=g.$$("a",{title:e,href:"javascript:void(0);"});return o.text(t),this.bindFacetEventOnValue(o.el,e),o.el},t.prototype.buildTextBox=function(){var e=this;return this.textBox=g.$$("input",{type:"text",className:"coveo-add-tag-textbox",placeholder:c.l("EnterTag")}).el,this.autoCompletePopup=g.$$("div",{className:t.autoCompleteClass}).el,this.autoCompleteZone.appendChild(this.autoCompletePopup),this.manageAutocompleteAutoHide(),g.$$(this.textBox).on("keyup",function(t){t.keyCode==p.KEYBOARD.UP_ARROW||t.keyCode==p.KEYBOARD.DOWN_ARROW||t.keyCode==p.KEYBOARD.ENTER?e.manageUpDownEnter(t.keyCode):p.KeyboardUtils.isArrowKeyPushed(t.keyCode)||e.populateSuggestions(),g.$$(e.element).removeClass("coveo-error")}),g.$$(this.textBox).on("click",function(){e.populateSuggestions()}),this.textBox},t.prototype.buildAddIcon=function(){var e=this,t=g.$$("div",{className:"coveo-result-tagging-add-tag-tick-icon"},f.SVGIcons.icons.taggingOk);C.SVGDom.addClassToSVGInContainer(t.el,"coveo-result-tagging-add-tag-tick-icon-svg");var o=g.$$("span");return o.on("click",function(){e.doAddTag()}),t.el.appendChild(o.el),t.el},t.prototype.buildClearIcon=function(){var e=this,t=g.$$("div",{className:"coveo-result-tagging-clear-icon"},f.SVGIcons.icons.checkboxHookExclusionMore);C.SVGDom.addClassToSVGInContainer(t.el,"coveo-result-tagging-clear-icon-svg");var o=g.$$("span");return o.on("click",function(){e.textBox.value=""}),t.el.appendChild(o.el),t.el},t.prototype.bindFacetEventOnValue=function(e,t){var o=this,n=d.QueryStateModel.getFacetId(this.options.field),i=this.queryStateModel.get(n),a=this.componentStateModel.get(n),l=m.filter(a,function(e){return!e.disabled}).length>0;null!=i&&l&&(g.$$(e).on("click",function(){m.contains(i,t)?o.queryStateModel.set(n,m.without(i,t)):o.queryStateModel.set(n,m.union(i,[t])),o.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchEvent(h.analyticsActionCauseList.documentTag,{facetId:o.options.field,facetValue:t})}})}),m.contains(i,t)&&g.$$(e).addClass("coveo-selected"),g.$$(e).addClass("coveo-clickable"))},t.prototype.clearPopup=function(){g.$$(this.autoCompletePopup).hide(),g.$$(this.autoCompletePopup).empty()},t.prototype.showPopup=function(){g.$$(this.autoCompletePopup).show()},t.prototype.populateSuggestions=function(){var e=this,t=this.queryController.getEndpoint(),o=this.textBox.value,n={field:this.options.field,ignoreAccents:!0,sortCriteria:"occurences",maximumNumberOfValues:this.options.suggestBoxSize,queryOverride:"@uri",pattern:this.buildRegEx(o),patternType:"RegularExpression"};t.listFieldValues(n).then(function(t){e.clearPopup(),m.each(t,function(t){e.autoCompletePopup.appendChild(e.buildSelectableValue(t.lookupValue))}),e.showPopup(),e.autoCompletePopup.style.width=e.textBox.offsetWidth+" px"})},t.prototype.manageAutocompleteAutoHide=function(){var e,o=this;g.$$(this.textBox).on("mouseover",function(){clearTimeout(e)}),g.$$(this.autoCompletePopup).on("mouseout",function(n){g.$$(n.target).hasClass(t.autoCompleteClass)&&(e=setTimeout(function(){o.clearPopup()},o.options.autoCompleteTimer))}),g.$$(this.autoCompletePopup).on("mouseenter",function(){clearTimeout(e)}),g.$$(this.element).on("mouseenter",function(){o.clearPopup(),g.$$(o.element).addClass("coveo-opened")}),g.$$(g.$$(this.element).closest(".CoveoResult")).on("mouseleave",function(){o.clearPopup(),""==o.textBox.value&&g.$$(o.element).removeClass("coveo-opened")}),g.$$(g.$$(this.element).closest(".CoveoResult")).on("focusout",function(e){""!=o.textBox.value&&g.$$(e.target).closest(".CoveoResult")!=g.$$(o.element).closest(".CoveoResult")&&g.$$(o.element).addClass("coveo-error")}),g.$$(g.$$(this.element).closest(".CoveoResult")).on("focusin",function(){g.$$(o.element).removeClass("coveo-error")})},t.prototype.buildRegEx=function(e){var t=this;return"(?=.*"+e+")"+m.map(this.tags,function(e){return t.buildTermToExclude(e)}).join("")+".*"},t.prototype.buildTermToExclude=function(e){return"(?!^"+e+"$)"},t.prototype.manageUpDownEnter=function(e){var t=g.$$(this.element).findAll(".coveo-selectable");if(e==p.KEYBOARD.ENTER)return void this.doAddTag();if(t.length>0){var o=this.computeNextIndex(e,t);o=Math.max(0,o),o=Math.min(t.length-1,o);var n=g.$$(t[o]);n.addClass("coveo-selected"),this.textBox.value=n.text()}},t.prototype.computeNextIndex=function(e,t){var o=0;return m.each(t,function(t,n){g.$$(t).hasClass("coveo-selected")&&(e==p.KEYBOARD.UP_ARROW?o=n-1:e==p.KEYBOARD.DOWN_ARROW&&(o=n+1),g.$$(t).removeClass("coveo-selected"))}),o},t.prototype.buildSelectableValue=function(e){var t=this,o=g.$$("div",{className:"coveo-selectable"});return o.el.appendChild(this.buildShortenedTagWithTitle(e)),o.on("click",function(){t.doAddTagWithValue(e)}),o.el},t.prototype.doRemoveTag=function(e,t){var o=this,n={fieldName:this.options.field,fieldValue:t,doAdd:!1,uniqueId:this.result.uniqueId};this.queryController.getEndpoint().tagDocument(n).then(function(){o.tags.splice(m.indexOf(o.tags,t),1),g.$$(e).detach()})},t.prototype.doAddTagWithValue=function(e){var t=this;m.each(e.split(","),function(e){t.doAddSingleTagValue(e)})},t.prototype.doAddSingleTagValue=function(e){var t=this;if(this.clearPopup(),m.indexOf(this.tags,e)>-1)return void g.$$(this.element).addClass("coveo-error");this.tags.push(e);var o={fieldName:this.options.field,fieldValue:e,doAdd:!0,uniqueId:this.result.uniqueId};this.queryController.getEndpoint().tagDocument(o).then(function(){t.tagZone.appendChild(t.buildTagValue(e)),t.textBox.value="",g.$$(t.element).removeClass("coveo-error")}).catch(function(){t.tags=m.without(t.tags,m.findWhere(t.tags,e))})},t.prototype.doAddTag=function(){var e=s.Utils.trim(this.textBox.value.toLowerCase());this.doAddTagWithValue(e)},t.ID="ResultTagging",t.autoCompleteClass="coveo-result-tagging-auto-complete",t.doExport=function(){v.exportGlobally({ResultTagging:t})},t.options={field:a.ComponentOptions.buildFieldOption({match:function(e){return"Tag"==e.type},required:!0}),suggestBoxSize:a.ComponentOptions.buildNumberOption({defaultValue:5,min:0}),autoCompleteTimer:a.ComponentOptions.buildNumberOption({defaultValue:2e3,min:0})},t.AUTO_COMPLETE_CLASS="coveo-result-tagging-auto-complete",t}(i.Component);t.ResultTagging=$,u.Initialization.registerAutoCreateComponent($)},420:function(e,t){}});
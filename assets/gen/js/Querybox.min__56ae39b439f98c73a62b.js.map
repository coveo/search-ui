{"version":3,"sources":["Querybox.min__56ae39b439f98c73a62b.js","./src/magicbox/Grammars/Basic.ts","./src/ui/Querybox/Querybox.ts","./src/magicbox/Grammar.ts","./src/magicbox/Expression/ExpressionEndOfInput.ts","./src/magicbox/Expression/ExpressionConstant.ts","./src/magicbox/Grammars/Field.ts","./src/magicbox/SuggestionsManager.ts","./src/magicbox/MagicBox.ts","./src/magicbox/MagicBoxUtils.ts","./src/magicbox/Expression/ExpressionRef.ts","./src/magicbox/Result/RefResult.ts","./src/magicbox/Expression/ExpressionOptions.ts","./src/magicbox/Result/OptionResult.ts","./src/magicbox/Expression/ExpressionRegExp.ts","./src/magicbox/Expression/ExpressionFunction.ts","./src/magicbox/Result/Result.ts","./src/magicbox/Expression/ExpressionList.ts","./src/magicbox/Grammars/NestedQuery.ts","./src/magicbox/Grammars/Date.ts","./src/magicbox/Grammars/QueryExtension.ts","./src/magicbox/Grammars/SubExpression.ts","./src/magicbox/InputManager.ts","./src/magicbox/QueryProcessor.ts","./src/magicbox/Grammars/Complete.ts","./src/magicbox/Grammars/Expressions.ts","./src/events/ResultPreviewsManagerEvents.ts","./src/ui/Querybox/QueryboxOptionsProcessing.ts","./src/ui/Querybox/QueryboxQueryParameters.ts","./src/magicbox/doMagicBoxExport.ts","./src/magicbox/Grammars/Grammars.ts","./src/magicbox/ResultPreviewsManager.ts","./src/magicbox/MagicBoxClear.ts"],"names":["webpackJsonpCoveo__temporary","128","module","exports","__webpack_require__","Object","defineProperty","value","notWordStart","notInWord","Basic","basicExpressions","grammars","DoubleQuoted","NotDoubleQuote","SingleQuoted","NotSingleQuote","Number","Word","input","end","expression","regex","RegExp","replace","groups","match","index","result","Result","isSuccess","length","EndOfInputResult","135","__extends","this","extendStatics","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","element","options","bindings","Querybox","ID","HTMLInputElement","logger","error","ComponentOptions","initComponentOptions","QueryboxOptionsProcessing","postProcess","$$","toggleClass","enableQuerySyntax","magicBox","createMagicBox","Grammar","Query","Term","Spaces","inline","find","setAttribute","placeholder","l","bind","onRootElement","QueryEvents","buildingQuery","args","handleBuildingQuery","StandaloneSearchInterfaceEvents","beforeRedirect","updateQueryState","onQueryState","MODEL_EVENTS","CHANGE_ONE","QUERY_STATE_ATTRIBUTES","Q","handleQueryStateChanged","enableSearchAsYouType","addClass","onchange","searchAsYouType","onsubmit","submit","onblur","onclear","triggerQueryOnClear","usageAnalytics","logSearchEvent","analyticsActionCauseList","searchboxClear","triggerNewQuery","_this","clearSuggestion","searchboxSubmit","setText","text","clear","getText","getResult","getDisplayedResult","getCursor","resultAtCursor","Assert","exists","queryBuilder","lastQuery","QueryboxQueryParameters","addParameters","clearTimeout","searchAsYouTypeTimeout","queryController","executeQuery","logInActionsHistory","queryStateModel","set","QueryStateModel","attributesEnum","q","window","setTimeout","logSearchAsYouType","searchboxAsYouType","searchAsYouTypeDelay","doExport","exportGlobally","buildBooleanOption","defaultValue","section","buildNumberOption","min","enableWildcards","enableQuestionMarks","depend","enableLowercaseOperators","enablePartialMatch","partialMatchKeywords","partialMatchThreshold","buildStringOption","Component","Initialization","registerAutoCreateComponent","176","start","expressions","ExpressionRef","addExpressions","_","each","basicExpression","id","addExpression","Error","buildExpression","getExpression","parse","grammar","isString","buildStringExpression","isArray","ExpressionOptions","map","v","i","isRegExp","ExpressionRegExp","isFunction","ExpressionFunction","matchs","stringMatch","spliter","ref","occurrence","ExpressionConstant","ExpressionList","str","re","cloneRegExp","source","group","exec","push","214","ExpressionEndOfInput","215","success","indexOf","toString","216","Field","FieldQuery","FieldQueryOperation","FieldQueryValue","FieldQueryNumeric","FieldSimpleQuery","FieldName","FieldOperator","FieldOperatorNumeric","FieldValue","FieldValueNumeric","FieldValueString","FieldValueList","FieldValueStringList","FieldValueSeparator","FieldValueNotQuoted","NumberRange","include","Date","217","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","done","then","apply","__generator","body","verb","n","op","f","TypeError","y","t","call","label","ops","pop","trys","g","sent","throw","return","Symbol","iterator","Direction","magicBoxContainer","inputManager","suggestionListboxID","QueryUtils","createGuid","suggestionListboxClassName","root","resolveRoot","defaults","suggestionClass","selectedClass","undefined","timeout","on","handleMouseOver","handleMouseOut","suggestionsProcessor","QueryProcessor","resultPreviewsManager","ResultPreviewsManager","suggestionsListbox","buildSuggestionsContainer","append","el","addAccessibilityProperties","appendEmptySuggestionOption","get","currentSuggestions","enumerable","configurable","findClass","hasPreviews","suggestion","dom","classList","contains","target","parents","hasClass","processMouseSelection","targetParents","relatedTarget","isValid","relatedTargetParents","removeSelectedStatus","trigger","OmniboxEvents","querySuggestLoseFocus","moveDown","_a","move","Down","moveUp","Up","moveLeft","Left","moveRight","Right","selectAndReturnKeyboardFocusedElement","selected","keyboardFocusedElement","blur","clearKeyboardFocusedElement","receiveSuggestions","suggestions","results","status","_b","processQueries","ProcessingStatus","Overriden","updateSuggestions","clearSuggestions","empty","activeDescendant","hasSuggestions","expanded","displaySearchResultPreviewsForSuggestion","sort","a","forEach","modifyDomFromExistingSuggestion","createDomFromSuggestion","querySuggestRendered","htmlElementIsSuggestion","returnMoved","processKeyboardSelection","addSelectedStatus","updateSelectedSuggestion","focusedSuggestion","processKeyboardPreviewSelection","preview","className","role","ariaLabel","selectSuggestion","html","innerHTML","separator","suggestionLabel","onSelect","querySuggestSelection","found","direction","firstPreview","focusedPreviewElement","moveWithinPreview","previewElements","moveWithinSuggestion","currentlySelected","selectables","currentIndex","findAll","selectQuerySuggest","removeAttribute","newFocusedPreview","getElementInDirection","previewsOwner","HTMLElement","getElementsByClassName","elem","item","updateAreaSelectedIfDefined","querySuggestGetFocus","removeClass","getAttribute","addAccessibilityPropertiesForMagicBox","addAccessibilityPropertiesForInput","omniboxSelectables","SuggestionsManager","218","MagicBoxInstance","callback","requestAnimationFrame","lastSuggestions","isUndefined","displayedResult","clean","inputContainer","document","createElement","appendChild","InputManager","wordCompletion","onselect","firstSuggestionWithText","addSuggestions","ontabpress","existingValue","getValue","setResult","suggestionsContainer","suggestionsManager","selectableSuggestionClass","selectedSuggestionClass","suggestionTimeout","magicBoxClear","MagicBoxClear","setupHandler","toggleTabindexAndAriaHidden","setCursor","resultAt","onfocus","onkeydown","key","shouldMoveInSuggestions","KEYBOARD","ENTER","ESCAPE","onchangecursor","onkeyup","onmove","UP_ARROW","DOWN_ARROW","LEFT_ARROW","RIGHT_ARROW","selectedSuggestion","focusOnSuggestion","getSuggestions","addSelectEventHandlers","setWordCompletion","firstSuggestionText","onSuggestions","hasFocus","focus","getWordCompletion","doMagicBoxExport","219","escapeRegExp","highlightText","highligth","ignoreCase","matchClass","doNotMatchClass","escaped","stringRegex","notmatch","escapeText","classname","escape","MagicBoxUtils","484","parseOnce","parseMany","refResult","RefResult","all","getBestExpect","expect","subResult","subResults","subInput","substr","getLength","requiredOccurance","isNumber","last","endOfInput","485","lastResult","failAttempt","parent","getExpect","concat","path","first","initial","rest","486","parts","OptionResult","487","reduce","488","489","func","49","until","findParent","subResultFind","expects","groupBy","keys","bestResults","chain","sortBy","pluck","getHumanReadableExpect","getHumanReadable","join","JSON","stringify","before","after","toHtmlElement","createTextNode","nextIndex","clone","subresult","490","491","NestedQuery","NestedField","492","DateYear","DateMonth","DateDay","DateRange","DateRelative","DateRelativeTerm","DateRelativeNegative","DateRelativeNegativeRef","493","QueryExtension","QueryExtensionName","QueryExtensionArguments","QueryExtensionArgumentList","QueryExtensionArgument","QueryExtensionArgumentName","QueryExtensionArgumentValue","494","SubExpression","495","underlay","highlightContainer","ghostTextContainer","insertBefore","addAccessibilitiesProperties","isExpanded","updateInput","updateHighlight","updateWordCompletion","updateScroll","toLowerCase","createTextRange","range","select","selectionStart","setSelectionRange","defer","clientWidth","scrollWidth","style","visibility","scrollLeft","scrollTop","updateScrollDefer","keydown","keyup","oncut","onInputChange","onpaste","keyCode","which","TAB","tabPress","stopPropagation","preventDefault","handleLeftRightArrow","computeCssClassNameForType","496","racePromises","promises","__assign","assign","s","arguments","queries","asyncQueries","overrideIfProcessing","processedResults","query","accumulateResultsChronologically","buildProcessResults","Finished","waitForOverride","waitForTimeout","TimedOut","override","flatten","filter","orderedResults","output","items","499","Complete","500","loadSubGrammar","subGrammar","expressionDef","BasicExpression","Start","Expressions","ExpressionsList","Expression","OptionalSpaces","Empty","subGrammars","501","buildingResultPreviewsQuery","updateResultPreviewsManagerOptions","populateSearchResultPreviews","ResultPreviewsManagerEvents","502","owner","componentOptionsModel","ComponentOptionsModel","searchBox","processQueryOnClearVersusEmptyQuery","processQueryOnClearVersusSearchAsYouType","searchInterface","allowQueriesWithoutKeywords","warn","503","queryIsBlocked","queryIsCurrentlyBlocked","Defer","allowDuplicateQuery","isEmpty","add","556","MagicBox","Grammars","Instance","Utils","GrammarsImportedLocally","557","ExpressionsGrammar","558","previewHeaderText","previewHeaderFieldText","previewClass","previewsProcessor","lastDisplayedSuggestion","suggestionsPreviewContainer","focusedElement","previewSelectables","firstVerticalOffset","offsetTop","firstIndexOnNextRow","findIndex","previewSelectable","externalOptions","currentDelay","isQueryForSuggestionOngoing","arePreviewsForSuggestionCurrentlyDisplayed","getExternalOptions","lastDelay","resolveAfter","isNullOrUndefined","displayAfterDuration","lastQueriedSuggestion","getSearchResultPreviewsQuery","displaySuggestionPreviews","focusedIndex","getIncrementInDirection","numberOfResultsPerRow","setHasPreviews","shouldHavePreviews","initPreviewForSuggestions","revertPreviewForSuggestions","buildPreviewContainer","previewContainerId","remove","resultPreviewsContainer","optionsEventArgs","populateEventArgs","previewsQueries","appendSearchResultPreview","position","elementDom","appendSearchResultPreviews","previews","toggle","559","clearIcon","insertAfter","AccessibleButton","withElement","withLabel","withSelectAction","build","hasText","tabindex","560"],"mappings":"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","file":"Querybox.min__56ae39b439f98c73a62b.js","sourcesContent":["webpackJsonpCoveo__temporary([10],{\n\n/***/ 128:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Result_1 = __webpack_require__(49);\nvar Result_2 = __webpack_require__(49);\nexports.notWordStart = ' ()[],$@\\'\"';\nexports.notInWord = ' ()[],:';\nexports.Basic = {\n    basicExpressions: ['Word', 'DoubleQuoted'],\n    grammars: {\n        DoubleQuoted: '\"[NotDoubleQuote]\"',\n        NotDoubleQuote: /[^\"]*/,\n        SingleQuoted: \"'[NotSingleQuote]'\",\n        NotSingleQuote: /[^']*/,\n        Number: /-?(0|[1-9]\\d*)(\\.\\d+)?/,\n        Word: function (input, end, expression) {\n            var regex = new RegExp('[^' + exports.notWordStart.replace(/(.)/g, '\\\\$1') + '][^' + exports.notInWord.replace(/(.)/g, '\\\\$1') + ']*');\n            var groups = input.match(regex);\n            if (groups != null && groups.index != 0) {\n                groups = null;\n            }\n            var result = new Result_1.Result(groups != null ? groups[0] : null, expression, input);\n            if (result.isSuccess() && end && input.length > result.value.length) {\n                return new Result_2.EndOfInputResult(result);\n            }\n            return result;\n        }\n    }\n};\n\n\n/***/ }),\n\n/***/ 135:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(560);\nvar QueryEvents_1 = __webpack_require__(11);\nvar StandaloneSearchInterfaceEvents_1 = __webpack_require__(95);\nvar GlobalExports_1 = __webpack_require__(3);\nvar Grammar_1 = __webpack_require__(176);\nvar MagicBox_1 = __webpack_require__(218);\nvar Assert_1 = __webpack_require__(5);\nvar Model_1 = __webpack_require__(18);\nvar QueryStateModel_1 = __webpack_require__(13);\nvar Strings_1 = __webpack_require__(6);\nvar Dom_1 = __webpack_require__(1);\nvar AnalyticsActionListMeta_1 = __webpack_require__(10);\nvar Component_1 = __webpack_require__(7);\nvar ComponentOptions_1 = __webpack_require__(8);\nvar Initialization_1 = __webpack_require__(2);\nvar QueryboxOptionsProcessing_1 = __webpack_require__(502);\nvar QueryboxQueryParameters_1 = __webpack_require__(503);\n/**\n * The `Querybox` component renders an input which the end user can interact with to enter and submit queries.\n *\n * When the end user submits a search request, the `Querybox` component triggers a query and logs the corresponding\n * usage analytics data.\n *\n * For technical reasons, it is necessary to instantiate this component on a `div` element rather than on an `input`\n * element.\n *\n * See also the [`Searchbox`]{@link Searchbox} component, which can automatically instantiate a `Querybox` along with an\n * optional [`SearchButton`]{@link SearchButton} component.\n */\nvar Querybox = /** @class */ (function (_super) {\n    __extends(Querybox, _super);\n    /**\n     * Creates a new `Querybox component`. Creates a new `Coveo.Magicbox` instance and wraps the Magicbox methods\n     * (`onblur`, `onsubmit` etc.). Binds event on `buildingQuery` and before redirection (for standalone box).\n     * @param element The HTMLElement on which to instantiate the component. This cannot be an HTMLInputElement for\n     * technical reasons.\n     * @param options The options for the `Querybox` component.\n     * @param bindings The bindings that the component requires to function normally. If not set, these will be\n     * automatically resolved (with a slower execution time).\n     */\n    function Querybox(element, options, bindings) {\n        var _this = _super.call(this, element, Querybox.ID, bindings) || this;\n        _this.element = element;\n        _this.options = options;\n        _this.bindings = bindings;\n        if (element instanceof HTMLInputElement) {\n            _this.logger.error('Querybox cannot be used on an HTMLInputElement');\n        }\n        _this.options = ComponentOptions_1.ComponentOptions.initComponentOptions(element, Querybox, options);\n        new QueryboxOptionsProcessing_1.QueryboxOptionsProcessing(_this).postProcess();\n        Dom_1.$$(_this.element).toggleClass('coveo-query-syntax-disabled', _this.options.enableQuerySyntax == false);\n        _this.magicBox = MagicBox_1.createMagicBox(element, new Grammar_1.Grammar('Query', {\n            Query: '[Term*][Spaces?]',\n            Term: '[Spaces?][Word]',\n            Spaces: / +/,\n            Word: /[^ ]+/\n        }), {\n            inline: true\n        });\n        var input = Dom_1.$$(_this.magicBox.element).find('input');\n        if (input) {\n            Dom_1.$$(input).setAttribute('aria-label', _this.options.placeholder || Strings_1.l('Search'));\n        }\n        _this.bind.onRootElement(QueryEvents_1.QueryEvents.buildingQuery, function (args) { return _this.handleBuildingQuery(args); });\n        _this.bind.onRootElement(StandaloneSearchInterfaceEvents_1.StandaloneSearchInterfaceEvents.beforeRedirect, function () { return _this.updateQueryState(); });\n        _this.bind.onQueryState(Model_1.MODEL_EVENTS.CHANGE_ONE, QueryStateModel_1.QUERY_STATE_ATTRIBUTES.Q, function (args) {\n            return _this.handleQueryStateChanged(args);\n        });\n        if (_this.options.enableSearchAsYouType) {\n            Dom_1.$$(_this.element).addClass('coveo-search-as-you-type');\n            _this.magicBox.onchange = function () {\n                _this.searchAsYouType();\n            };\n        }\n        _this.magicBox.onsubmit = function () {\n            _this.submit();\n        };\n        _this.magicBox.onblur = function () {\n            _this.updateQueryState();\n        };\n        _this.magicBox.onclear = function () {\n            _this.updateQueryState();\n            if (_this.options.triggerQueryOnClear) {\n                _this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.searchboxClear, {});\n                _this.triggerNewQuery(false);\n            }\n        };\n        return _this;\n    }\n    /**\n     * Adds the current content of the input to the query and triggers a query if the current content of the input has\n     * changed since last submit.\n     *\n     * Also logs the `serachboxSubmit` event in the usage analytics.\n     */\n    Querybox.prototype.submit = function () {\n        this.magicBox.clearSuggestion();\n        this.updateQueryState();\n        this.usageAnalytics.logSearchEvent(AnalyticsActionListMeta_1.analyticsActionCauseList.searchboxSubmit, {});\n        this.triggerNewQuery(false);\n    };\n    /**\n     * Sets the content of the input.\n     *\n     * @param text The string to set in the input.\n     */\n    Querybox.prototype.setText = function (text) {\n        this.magicBox.setText(text);\n        this.updateQueryState();\n    };\n    /**\n     * Clears the content of the input.\n     *\n     * See also the [`triggerQueryOnClear`]{@link Querybox.options.triggerQueryOnClear} option.\n     */\n    Querybox.prototype.clear = function () {\n        this.magicBox.clear();\n    };\n    /**\n     * Gets the content of the input.\n     *\n     * @returns {string} The content of the input.\n     */\n    Querybox.prototype.getText = function () {\n        return this.magicBox.getText();\n    };\n    /**\n     * Gets the result from the input.\n     *\n     * @returns {Result} The result.\n     */\n    Querybox.prototype.getResult = function () {\n        return this.magicBox.getResult();\n    };\n    /**\n     * Gets the displayed result from the input.\n     *\n     * @returns {Result} The displayed result.\n     */\n    Querybox.prototype.getDisplayedResult = function () {\n        return this.magicBox.getDisplayedResult();\n    };\n    /**\n     * Gets the current cursor position in the input.\n     *\n     * @returns {number} The cursor position (index starts at 0).\n     */\n    Querybox.prototype.getCursor = function () {\n        return this.magicBox.getCursor();\n    };\n    /**\n     * Gets the result at cursor position.\n     *\n     * @param match {string | { (result): boolean }} The match condition.\n     *\n     * @returns {Result[]} The result.\n     */\n    Querybox.prototype.resultAtCursor = function (match) {\n        return this.magicBox.resultAtCursor(match);\n    };\n    Querybox.prototype.handleBuildingQuery = function (args) {\n        Assert_1.Assert.exists(args);\n        Assert_1.Assert.exists(args.queryBuilder);\n        this.updateQueryState();\n        this.lastQuery = this.magicBox.getText();\n        new QueryboxQueryParameters_1.QueryboxQueryParameters(this.options).addParameters(args.queryBuilder, this.lastQuery);\n    };\n    Querybox.prototype.triggerNewQuery = function (searchAsYouType) {\n        clearTimeout(this.searchAsYouTypeTimeout);\n        var text = this.magicBox.getText();\n        if (this.lastQuery != text && text != null) {\n            this.lastQuery = text;\n            this.queryController.executeQuery({\n                searchAsYouType: searchAsYouType,\n                logInActionsHistory: true\n            });\n        }\n    };\n    Querybox.prototype.updateQueryState = function () {\n        this.queryStateModel.set(QueryStateModel_1.QueryStateModel.attributesEnum.q, this.magicBox.getText());\n    };\n    Querybox.prototype.handleQueryStateChanged = function (args) {\n        Assert_1.Assert.exists(args);\n        var q = args.value;\n        if (q != this.magicBox.getText()) {\n            this.magicBox.setText(q);\n        }\n    };\n    Querybox.prototype.searchAsYouType = function () {\n        var _this = this;\n        clearTimeout(this.searchAsYouTypeTimeout);\n        this.searchAsYouTypeTimeout = window.setTimeout(function () {\n            _this.usageAnalytics.logSearchAsYouType(AnalyticsActionListMeta_1.analyticsActionCauseList.searchboxAsYouType, {});\n            _this.triggerNewQuery(true);\n        }, this.options.searchAsYouTypeDelay);\n    };\n    Querybox.ID = 'Querybox';\n    Querybox.doExport = function () {\n        GlobalExports_1.exportGlobally({\n            Querybox: Querybox,\n            QueryboxQueryParameters: QueryboxQueryParameters_1.QueryboxQueryParameters\n        });\n    };\n    /**\n     * The options for the Querybox.\n     * @componentOptions\n     */\n    Querybox.options = {\n        /**\n         * Whether to enable the search-as-you-type feature.\n         *\n         * **Note:** Enabling this feature can consume lots of queries per month (QPM), especially if the [`searchAsYouTypeDelay`]{@link Querybox.options.searchAsYouTypeDelay} option is set to a low value.\n         *\n         * Default value is `false`.\n         */\n        enableSearchAsYouType: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'Advanced Options' }),\n        /**\n         * If the [`enableSearchAsYouType`]{@link Querybox.options.enableSearchAsYouType} option is `true`, specifies how\n         * long to wait (in milliseconds) between each key press before triggering a new query.\n         *\n         * Default value is `50`. Minimum value is `0`\n         */\n        searchAsYouTypeDelay: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 50, min: 0, section: 'Advanced Options' }),\n        /**\n         * Specifies whether to interpret special query syntax (e.g., `@objecttype=message`) when the end user types\n         * a query in the `Querybox` (see\n         * [Coveo Query Syntax Reference](https://www.coveo.com/go?dest=adminhelp70&lcid=9&context=10005)). Setting this\n         * option to `true` also causes the `Querybox` to highlight any query syntax.\n         *\n         * Regardless of the value of this option, the Coveo Cloud REST Search API always interprets expressions surrounded\n         * by double quotes (`\"`) as exact phrase match requests.\n         *\n         * See also [`enableLowercaseOperators`]{@link Querybox.options.enableLowercaseOperators}.\n         *\n         * **Notes:**\n         * > * End user preferences can override the value you specify for this option.\n         * >\n         * > If the end user selects a value other than **Automatic** for the **Enable query syntax** setting (see\n         * > the [`enableQuerySyntax`]{@link ResultsPreferences.options.enableQuerySyntax} option of the\n         * > [`ResultsPreferences`]{@link ResultsPreferences} component), the end user preference takes precedence over this\n         * > option.\n         * >\n         * > * On-premises versions of the Coveo Search API require this option to be set to `true` in order to interpret\n         * > expressions surrounded by double quotes (`\"`) as exact phrase match requests.\n         *\n         * Default value is `false`.\n         */\n        enableQuerySyntax: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'Advanced Options' }),\n        /**\n         * Specifies whether to expand basic expression keywords containing wildcards characters (`*`) to the possible\n         * matching keywords in order to broaden the query (see\n         * [Using Wildcards in Queries](https://docs.coveo.com/en/1580/)).\n         *\n         * See also [`enableQuestionMarks`]{@link Querybox.options.enableQuestionMarks}.\n         *\n         *  **Note:**\n         * > If you are using an on-premises version of the Coveo Search API, you need to set the\n         * > [`enableQuerySyntax`]{@link Querybox.options.enableQuerySyntax} option to `true` to be able to set\n         * > `enableWildcards` to `true`.\n         *\n         * Default value is `false`.\n         */\n        enableWildcards: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'Advanced Options' }),\n        /**\n         * If [`enableWildcards`]{@link Querybox.options.enableWildcards} is `true`, specifies whether to expand basic\n         * expression keywords containing question mark characters (`?`) to the possible matching keywords in order to\n         * broaden the query (see\n         * [Using Wildcards in Queries](https://docs.coveo.com/en/1580/)).\n         *\n         * **Note:**\n         * > If you are using an on-premises version of the Coveo Search API, you also need to set the\n         * > [`enableQuerySyntax`]{@link Querybox.options.enableQuerySyntax} option to `true` in order to be able to set\n         * > `enableQuestionMarks` to `true`.\n         *\n         * Default value is `false`.\n         */\n        enableQuestionMarks: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, depend: 'enableWildcards' }),\n        /**\n         * If the [`enableQuerySyntax`]{@link Querybox.options.enableQuerySyntax} option is `true`, specifies whether to\n         * interpret the `AND`, `NOT`, `OR`, and `NEAR` keywords in the `Querybox` as query operators in the query, even if\n         * the end user types those keywords in lowercase.\n         *\n         * This option applies to all query operators (see\n         * [Coveo Query Syntax Reference](https://www.coveo.com/go?dest=adminhelp70&lcid=9&context=10005)).\n         *\n         * **Example:**\n         * > If this option and the `enableQuerySyntax` option are both `true`, the Coveo Platform interprets the `near`\n         * > keyword in a query such as `service center near me` as the `NEAR` query operator (not as a query term).\n         *\n         * > Otherwise, if the `enableQuerySyntax` option is `true` and this option is `false`, the end user has to type the\n         * > `NEAR` keyword in uppercase for the Coveo Platform to interpret it as a query operator.\n         *\n         * Default value is `false`.\n         */\n        enableLowercaseOperators: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false, depend: 'enableQuerySyntax' }),\n        /**\n         * Whether to convert a basic expression containing at least a certain number of keywords (see the\n         * [`partialMatchKeywords`]{@link Querybox.options.partialMatchKeywords} option) to *partial match expression*, so\n         * that items containing at least a certain number of those keywords (see the\n         * [`partialMatchThreshold`]{@link Querybox.options.partialMatchThreshold} option) will match the expression.\n         *\n         * **Notes:**\n         * - Only the basic expression of the query (see [`q`]{@link q}) can be converted to a partial match expression.\n         * - When the [`enableQuerySyntax`]{@link Querybox.options.enableQuerySyntax} option is set to `true`, this feature has no effect if the basic expression contains advanced query syntax (field expressions, operators, etc.).\n         *\n         * @notSupportedIn salesforcefree\n         */\n        enablePartialMatch: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false }),\n        /**\n         * The minimum number of keywords that need to be present in the basic expression to convert it to a partial match expression.\n         *\n         * See also the [`partialMatchThreshold`]{@link Querybox.options.partialMatchThreshold} option.\n         *\n         * **Notes:**\n         *\n         * - Repeated keywords count as a single keyword.\n         * - Thesaurus expansions count towards the `partialMatchKeywords` count.\n         * - Stemming expansions **do not** count towards the `partialMatchKeywords` count.\n         *\n         * @notSupportedIn salesforcefree\n         */\n        partialMatchKeywords: ComponentOptions_1.ComponentOptions.buildNumberOption({ defaultValue: 5, min: 1, depend: 'enablePartialMatch' }),\n        /**\n         * An absolute or relative value indicating the minimum number of partial match expression keywords an item must contain to match the expression.\n         *\n         * See also the [`partialMatchKeywords`]{@link Querybox.options.partialMatchKeywords} option.\n         *\n         * **Notes:**\n         * - A keyword and its stemming expansions count as a single keyword when evaluating whether an item meets the `partialMatchThreshold`.\n         * - When a relative `partialMatchThreshold` does not yield a whole integer, the fractional part is truncated (e.g., `3.6` becomes `3`).\n         *\n         * @notSupportedIn salesforcefree\n         */\n        partialMatchThreshold: ComponentOptions_1.ComponentOptions.buildStringOption({ defaultValue: '50%', depend: 'enablePartialMatch' }),\n        /**\n         * Whether to trigger a query when clearing the `Querybox`.\n         *\n         * Default value is `false`.\n         */\n        triggerQueryOnClear: ComponentOptions_1.ComponentOptions.buildBooleanOption({ defaultValue: false })\n    };\n    return Querybox;\n}(Component_1.Component));\nexports.Querybox = Querybox;\nInitialization_1.Initialization.registerAutoCreateComponent(Querybox);\n\n\n/***/ }),\n\n/***/ 176:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ExpressionRef_1 = __webpack_require__(484);\nvar ExpressionOptions_1 = __webpack_require__(486);\nvar ExpressionRegExp_1 = __webpack_require__(488);\nvar _ = __webpack_require__(0);\nvar ExpressionFunction_1 = __webpack_require__(489);\nvar ExpressionConstant_1 = __webpack_require__(215);\nvar ExpressionList_1 = __webpack_require__(490);\nvar Grammar = /** @class */ (function () {\n    function Grammar(start, expressions) {\n        if (expressions === void 0) { expressions = {}; }\n        this.expressions = {};\n        this.start = new ExpressionRef_1.ExpressionRef(start, null, 'start', this);\n        this.addExpressions(expressions);\n    }\n    Grammar.prototype.addExpressions = function (expressions) {\n        var _this = this;\n        _.each(expressions, function (basicExpression, id) {\n            _this.addExpression(id, basicExpression);\n        });\n    };\n    Grammar.prototype.addExpression = function (id, basicExpression) {\n        if (id in this.expressions) {\n            throw new Error('Grammar already contain the id:' + id);\n        }\n        this.expressions[id] = Grammar.buildExpression(basicExpression, id, this);\n    };\n    Grammar.prototype.getExpression = function (id) {\n        return this.expressions[id];\n    };\n    Grammar.prototype.parse = function (value) {\n        return this.start.parse(value, true);\n    };\n    Grammar.buildExpression = function (value, id, grammar) {\n        var type = typeof value;\n        if (type == 'undefined') {\n            throw new Error('Invalid Expression: ' + value);\n        }\n        if (_.isString(value)) {\n            return this.buildStringExpression(value, id, grammar);\n        }\n        if (_.isArray(value)) {\n            return new ExpressionOptions_1.ExpressionOptions(_.map(value, function (v, i) { return new ExpressionRef_1.ExpressionRef(v, null, id + '_' + i, grammar); }), id);\n        }\n        if (_.isRegExp(value)) {\n            return new ExpressionRegExp_1.ExpressionRegExp(value, id, grammar);\n        }\n        if (_.isFunction(value)) {\n            return new ExpressionFunction_1.ExpressionFunction(value, id, grammar);\n        }\n        throw new Error('Invalid Expression: ' + value);\n    };\n    Grammar.buildStringExpression = function (value, id, grammar) {\n        var matchs = Grammar.stringMatch(value, Grammar.spliter);\n        var expressions = _.map(matchs, function (match, i) {\n            if (match[1]) {\n                // Ref\n                var ref = match[1];\n                var occurrence = match[3] ? Number(match[3]) : match[2] || null;\n                return new ExpressionRef_1.ExpressionRef(ref, occurrence, id + '_' + i, grammar);\n            }\n            else {\n                // Constant\n                return new ExpressionConstant_1.ExpressionConstant(match[4], id + '_' + i);\n            }\n        });\n        if (expressions.length == 1) {\n            var expression = expressions[0];\n            expression.id = id;\n            return expression;\n        }\n        else {\n            return new ExpressionList_1.ExpressionList(expressions, id);\n        }\n    };\n    Grammar.stringMatch = function (str, re) {\n        var groups = [];\n        var cloneRegExp = new RegExp(re.source, 'g');\n        var group = cloneRegExp.exec(str);\n        while (group !== null) {\n            groups.push(group);\n            group = cloneRegExp.exec(str);\n        }\n        return groups;\n    };\n    Grammar.spliter = /\\[(\\w+)(\\*|\\+|\\?|\\{([1-9][0-9]*)\\})?\\]|(.[^\\[]*)/;\n    return Grammar;\n}());\nexports.Grammar = Grammar;\n\n\n/***/ }),\n\n/***/ 214:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ExpressionEndOfInput = {\n    id: 'end of input',\n    parse: null\n};\n\n\n/***/ }),\n\n/***/ 215:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Result_1 = __webpack_require__(49);\nvar Result_2 = __webpack_require__(49);\nvar ExpressionConstant = /** @class */ (function () {\n    function ExpressionConstant(value, id) {\n        this.value = value;\n        this.id = id;\n    }\n    ExpressionConstant.prototype.parse = function (input, end) {\n        // the value must be at the start of the input\n        var success = input.indexOf(this.value) == 0;\n        var result = new Result_1.Result(success ? this.value : null, this, input);\n        // if is successful and we require the end but the length of parsed is\n        // lower than the input length, return a EndOfInputExpected Result\n        if (success && end && input.length > this.value.length) {\n            return new Result_2.EndOfInputResult(result);\n        }\n        return result;\n    };\n    ExpressionConstant.prototype.toString = function () {\n        return this.value;\n    };\n    return ExpressionConstant;\n}());\nexports.ExpressionConstant = ExpressionConstant;\n\n\n/***/ }),\n\n/***/ 216:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Basic_1 = __webpack_require__(128);\nvar Date_1 = __webpack_require__(492);\nexports.Field = {\n    basicExpressions: ['FieldSimpleQuery', 'FieldQuery', 'Field'],\n    grammars: {\n        FieldQuery: '[Field][OptionalSpaces][FieldQueryOperation]',\n        FieldQueryOperation: ['FieldQueryValue', 'FieldQueryNumeric'],\n        FieldQueryValue: '[FieldOperator][OptionalSpaces][FieldValue]',\n        FieldQueryNumeric: '[FieldOperatorNumeric][OptionalSpaces][FieldValueNumeric]',\n        FieldSimpleQuery: '[FieldName]:[OptionalSpaces][FieldValue]',\n        Field: '@[FieldName]',\n        FieldName: /[a-zA-Z][a-zA-Z0-9\\.\\_]*/,\n        FieldOperator: /==|=|<>/,\n        FieldOperatorNumeric: /<=|>=|<|>/,\n        FieldValue: ['DateRange', 'NumberRange', 'DateRelative', 'Date', 'Number', 'FieldValueList', 'FieldValueString'],\n        FieldValueNumeric: ['DateRelative', 'Date', 'Number'],\n        FieldValueString: ['DoubleQuoted', 'FieldValueNotQuoted'],\n        FieldValueList: '([FieldValueString][FieldValueStringList*])',\n        FieldValueStringList: '[FieldValueSeparator][FieldValueString]',\n        FieldValueSeparator: / *, */,\n        FieldValueNotQuoted: /[^ \\(\\)\\[\\],]+/,\n        NumberRange: '[Number][Spaces?]..[Spaces?][Number]'\n    },\n    include: [Date_1.Date, Basic_1.Basic]\n};\n\n\n/***/ }),\n\n/***/ 217:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar underscore_1 = __webpack_require__(0);\nvar OmniboxEvents_1 = __webpack_require__(33);\nvar Component_1 = __webpack_require__(7);\nvar Dom_1 = __webpack_require__(1);\nvar ResultPreviewsManager_1 = __webpack_require__(558);\nvar QueryProcessor_1 = __webpack_require__(496);\nvar QueryUtils_1 = __webpack_require__(21);\nvar Direction;\n(function (Direction) {\n    Direction[\"Up\"] = \"Up\";\n    Direction[\"Down\"] = \"Down\";\n    Direction[\"Left\"] = \"Left\";\n    Direction[\"Right\"] = \"Right\";\n})(Direction = exports.Direction || (exports.Direction = {}));\nvar SuggestionsManager = /** @class */ (function () {\n    function SuggestionsManager(element, magicBoxContainer, inputManager, options) {\n        var _this = this;\n        this.element = element;\n        this.magicBoxContainer = magicBoxContainer;\n        this.inputManager = inputManager;\n        this.suggestionListboxID = \"coveo-magicbox-suggestions-\" + QueryUtils_1.QueryUtils.createGuid();\n        this.suggestionListboxClassName = \"coveo-magicbox-suggestions\";\n        this.root = Component_1.Component.resolveRoot(element);\n        this.options = underscore_1.defaults(options, {\n            suggestionClass: 'magic-box-suggestion',\n            selectedClass: 'magic-box-selected'\n        });\n        // Put in a sane default, so as to not reject every suggestions if not set on initialization\n        if (this.options.timeout == undefined) {\n            this.options.timeout = 500;\n        }\n        Dom_1.$$(this.element).on('mouseover', function (e) {\n            _this.handleMouseOver(e);\n        });\n        Dom_1.$$(this.element).on('mouseout', function (e) {\n            _this.handleMouseOut(e);\n        });\n        this.suggestionsProcessor = new QueryProcessor_1.QueryProcessor({ timeout: this.options.timeout });\n        this.resultPreviewsManager = new ResultPreviewsManager_1.ResultPreviewsManager(element, {\n            selectedClass: this.options.selectedClass,\n            timeout: this.options.timeout\n        });\n        this.suggestionsListbox = this.buildSuggestionsContainer();\n        Dom_1.$$(this.element).append(this.suggestionsListbox.el);\n        this.addAccessibilityProperties();\n        this.appendEmptySuggestionOption();\n    }\n    Object.defineProperty(SuggestionsManager.prototype, \"hasSuggestions\", {\n        get: function () {\n            return this.currentSuggestions && this.currentSuggestions.length > 0;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SuggestionsManager.prototype, \"hasFocus\", {\n        get: function () {\n            return Dom_1.$$(this.element).findClass(this.options.selectedClass).length > 0;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SuggestionsManager.prototype, \"hasPreviews\", {\n        get: function () {\n            return this.resultPreviewsManager.hasPreviews;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SuggestionsManager.prototype, \"focusedSuggestion\", {\n        get: function () {\n            var _this = this;\n            return underscore_1.find(this.currentSuggestions, function (suggestion) { return suggestion.dom.classList.contains(_this.options.selectedClass); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    SuggestionsManager.prototype.handleMouseOver = function (e) {\n        var target = Dom_1.$$(e.target);\n        var parents = target.parents(this.options.suggestionClass);\n        if (target.hasClass(this.options.suggestionClass)) {\n            this.processMouseSelection(target.el);\n        }\n        else if (parents.length > 0 && this.element.contains(parents[0])) {\n            this.processMouseSelection(parents[0]);\n        }\n    };\n    SuggestionsManager.prototype.handleMouseOut = function (e) {\n        var target = Dom_1.$$(e.target);\n        var targetParents = target.parents(this.options.suggestionClass);\n        //e.relatedTarget is not available if moving off the browser window or is an empty object `{}` when moving out of namespace in LockerService.\n        if (e.relatedTarget && Dom_1.$$(e.relatedTarget).isValid()) {\n            var relatedTargetParents = Dom_1.$$(e.relatedTarget).parents(this.options.suggestionClass);\n            if (target.hasClass(this.options.selectedClass) && !Dom_1.$$(e.relatedTarget).hasClass(this.options.suggestionClass)) {\n                this.removeSelectedStatus(target.el);\n            }\n            else if (relatedTargetParents.length == 0 && targetParents.length > 0) {\n                this.removeSelectedStatus(targetParents[0]);\n            }\n        }\n        else {\n            if (target.hasClass(this.options.selectedClass)) {\n                this.removeSelectedStatus(target.el);\n            }\n            else if (targetParents.length > 0) {\n                this.removeSelectedStatus(targetParents[0]);\n            }\n        }\n        Dom_1.$$(this.root).trigger(OmniboxEvents_1.OmniboxEvents.querySuggestLoseFocus);\n    };\n    SuggestionsManager.prototype.moveDown = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.move(Direction.Down)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.moveUp = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.move(Direction.Up)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.moveLeft = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.move(Direction.Left)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.moveRight = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.move(Direction.Right)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.selectAndReturnKeyboardFocusedElement = function () {\n        var selected = this.keyboardFocusedElement;\n        if (selected) {\n            Dom_1.$$(selected).trigger('keyboardSelect');\n            // By definition, once an element has been \"selected\" with the keyboard,\n            // it is not longer \"active\" since the event has been processed.\n            this.keyboardFocusedElement = null;\n            this.inputManager.blur();\n        }\n        return selected;\n    };\n    SuggestionsManager.prototype.clearKeyboardFocusedElement = function () {\n        this.keyboardFocusedElement = null;\n    };\n    SuggestionsManager.prototype.receiveSuggestions = function (suggestions) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, results, status;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.suggestionsProcessor.processQueries(suggestions)];\n                    case 1:\n                        _a = _b.sent(), results = _a.results, status = _a.status;\n                        if (status === QueryProcessor_1.ProcessingStatus.Overriden) {\n                            return [2 /*return*/, []];\n                        }\n                        this.updateSuggestions(results);\n                        return [2 /*return*/, results];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.clearSuggestions = function () {\n        this.updateSuggestions([]);\n    };\n    SuggestionsManager.prototype.updateSuggestions = function (suggestions) {\n        var _this = this;\n        this.suggestionsListbox.empty();\n        this.inputManager.activeDescendant = null;\n        this.currentSuggestions = suggestions;\n        Dom_1.$$(this.element).toggleClass('magic-box-hasSuggestion', this.hasSuggestions);\n        this.inputManager.expanded = this.hasSuggestions;\n        this.resultPreviewsManager.displaySearchResultPreviewsForSuggestion(null);\n        if (!this.hasSuggestions) {\n            this.appendEmptySuggestionOption();\n            Dom_1.$$(this.root).trigger(OmniboxEvents_1.OmniboxEvents.querySuggestLoseFocus);\n            return;\n        }\n        suggestions\n            .sort(function (a, b) { return (b.index || 0) - (a.index || 0); })\n            .forEach(function (suggestion) {\n            var dom = suggestion.dom ? _this.modifyDomFromExistingSuggestion(suggestion.dom) : _this.createDomFromSuggestion(suggestion);\n            dom.setAttribute('id', \"magic-box-suggestion-\" + underscore_1.indexOf(suggestions, suggestion));\n            dom.setAttribute('role', 'option');\n            dom.setAttribute('aria-selected', 'false');\n            dom.setAttribute('aria-label', dom.text());\n            dom['suggestion'] = suggestion;\n            _this.suggestionsListbox.append(dom.el);\n        });\n        Dom_1.$$(this.root).trigger(OmniboxEvents_1.OmniboxEvents.querySuggestRendered);\n    };\n    Object.defineProperty(SuggestionsManager.prototype, \"selectedSuggestion\", {\n        get: function () {\n            if (this.htmlElementIsSuggestion(this.keyboardFocusedElement)) {\n                return this.returnMoved(this.keyboardFocusedElement);\n            }\n            return null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    SuggestionsManager.prototype.processKeyboardSelection = function (suggestion) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.addSelectedStatus(suggestion);\n                        this.keyboardFocusedElement = suggestion;\n                        return [4 /*yield*/, this.updateSelectedSuggestion(this.focusedSuggestion)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.processKeyboardPreviewSelection = function (preview) {\n        this.addSelectedStatus(preview);\n        this.keyboardFocusedElement = preview;\n    };\n    SuggestionsManager.prototype.processMouseSelection = function (suggestion) {\n        this.addSelectedStatus(suggestion);\n        this.updateSelectedSuggestion(this.focusedSuggestion);\n        this.keyboardFocusedElement = null;\n    };\n    SuggestionsManager.prototype.buildSuggestionsContainer = function () {\n        return Dom_1.$$('div', {\n            className: this.suggestionListboxClassName,\n            id: this.suggestionListboxID,\n            role: 'listbox',\n            ariaLabel: 'Search Suggestions'\n        });\n    };\n    SuggestionsManager.prototype.createDomFromSuggestion = function (suggestion) {\n        var _this = this;\n        var dom = Dom_1.$$('div', {\n            className: \"magic-box-suggestion \" + this.options.suggestionClass\n        });\n        suggestion.dom = dom.el;\n        dom.on('click', function () {\n            _this.selectSuggestion(suggestion);\n        });\n        dom.on('keyboardSelect', function () {\n            _this.selectSuggestion(suggestion);\n        });\n        if (suggestion.html) {\n            dom.el.innerHTML = suggestion.html;\n            return dom;\n        }\n        if (suggestion.text) {\n            dom.text(suggestion.text);\n            return dom;\n        }\n        if (suggestion.separator) {\n            dom.addClass('magic-box-suggestion-seperator');\n            var suggestionLabel = Dom_1.$$('div', {\n                className: 'magic-box-suggestion-seperator-label'\n            }, suggestion.separator);\n            dom.append(suggestionLabel.el);\n            return dom;\n        }\n        return dom;\n    };\n    SuggestionsManager.prototype.selectSuggestion = function (suggestion) {\n        suggestion.onSelect();\n        Dom_1.$$(this.root).trigger(OmniboxEvents_1.OmniboxEvents.querySuggestSelection, { suggestion: suggestion.text });\n    };\n    SuggestionsManager.prototype.appendEmptySuggestionOption = function () {\n        // Accessibility tools reports that a listbox element must always have at least one child with an option\n        // Even if there is no suggestions to show.\n        this.suggestionsListbox.append(Dom_1.$$('div', { role: 'option' }).el);\n    };\n    SuggestionsManager.prototype.modifyDomFromExistingSuggestion = function (dom) {\n        // this need to be done if the selection is in cache and the dom is set in the suggestion\n        this.removeSelectedStatus(dom);\n        var found = dom.classList.contains(this.options.suggestionClass) ? dom : Dom_1.$$(dom).find('.' + this.options.suggestionClass);\n        this.removeSelectedStatus(found);\n        return Dom_1.$$(dom);\n    };\n    SuggestionsManager.prototype.move = function (direction) {\n        return __awaiter(this, void 0, void 0, function () {\n            var firstPreview;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.resultPreviewsManager.focusedPreviewElement) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.moveWithinPreview(direction)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 2:\n                        if (direction === Direction.Right || direction === Direction.Left) {\n                            firstPreview = this.resultPreviewsManager.previewElements[0];\n                            if (firstPreview) {\n                                this.processKeyboardPreviewSelection(firstPreview);\n                                return [2 /*return*/];\n                            }\n                        }\n                        return [4 /*yield*/, this.moveWithinSuggestion(direction)];\n                    case 3:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.moveWithinSuggestion = function (direction) {\n        return __awaiter(this, void 0, void 0, function () {\n            var currentlySelected, selectables, currentIndex, index;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        currentlySelected = Dom_1.$$(this.element).find(\".\" + this.options.selectedClass);\n                        selectables = Dom_1.$$(this.element).findAll(\".\" + this.options.suggestionClass);\n                        currentIndex = underscore_1.indexOf(selectables, currentlySelected);\n                        index = direction === Direction.Up ? currentIndex - 1 : currentIndex + 1;\n                        index = (index + selectables.length) % selectables.length;\n                        return [4 /*yield*/, this.selectQuerySuggest(selectables[index])];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.selectQuerySuggest = function (suggestion) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!suggestion) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.processKeyboardSelection(suggestion)];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        this.keyboardFocusedElement = null;\n                        this.inputManager.input.removeAttribute('aria-activedescendant');\n                        _a.label = 3;\n                    case 3: return [2 /*return*/, suggestion];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.moveWithinPreview = function (direction) {\n        return __awaiter(this, void 0, void 0, function () {\n            var newFocusedPreview;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        newFocusedPreview = this.resultPreviewsManager.getElementInDirection(direction);\n                        if (!!newFocusedPreview) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.selectQuerySuggest(this.resultPreviewsManager.previewsOwner.dom)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 2:\n                        this.processKeyboardPreviewSelection(newFocusedPreview);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.returnMoved = function (selected) {\n        if (selected) {\n            if (selected['suggestion']) {\n                return selected['suggestion'];\n            }\n            if (selected['no-text-suggestion']) {\n                return null;\n            }\n            if (selected instanceof HTMLElement) {\n                return {\n                    text: Dom_1.$$(selected).text()\n                };\n            }\n        }\n        return null;\n    };\n    SuggestionsManager.prototype.addSelectedStatus = function (element) {\n        var selected = this.element.getElementsByClassName(this.options.selectedClass);\n        for (var i = 0; i < selected.length; i++) {\n            var elem = selected.item(i);\n            this.removeSelectedStatus(elem);\n        }\n        Dom_1.$$(element).addClass(this.options.selectedClass);\n        this.updateAreaSelectedIfDefined(element, 'true');\n    };\n    SuggestionsManager.prototype.updateSelectedSuggestion = function (suggestion) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        Dom_1.$$(this.root).trigger(OmniboxEvents_1.OmniboxEvents.querySuggestGetFocus, {\n                            suggestion: suggestion.text\n                        });\n                        return [4 /*yield*/, this.resultPreviewsManager.displaySearchResultPreviewsForSuggestion(suggestion)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SuggestionsManager.prototype.removeSelectedStatus = function (suggestion) {\n        Dom_1.$$(suggestion).removeClass(this.options.selectedClass);\n        this.updateAreaSelectedIfDefined(suggestion, 'false');\n    };\n    SuggestionsManager.prototype.updateAreaSelectedIfDefined = function (element, value) {\n        if (Dom_1.$$(element).getAttribute('aria-selected')) {\n            this.inputManager.activeDescendant = element;\n            Dom_1.$$(element).setAttribute('aria-selected', value);\n        }\n    };\n    SuggestionsManager.prototype.addAccessibilityProperties = function () {\n        this.addAccessibilityPropertiesForMagicBox();\n        this.addAccessibilityPropertiesForInput();\n    };\n    SuggestionsManager.prototype.addAccessibilityPropertiesForMagicBox = function () {\n        var magicBox = Dom_1.$$(this.magicBoxContainer);\n        magicBox.setAttribute('role', 'search');\n        magicBox.setAttribute('aria-haspopup', 'listbox');\n    };\n    SuggestionsManager.prototype.addAccessibilityPropertiesForInput = function () {\n        var input = Dom_1.$$(this.inputManager.input);\n        this.inputManager.activeDescendant = null;\n        this.inputManager.expanded = false;\n        input.setAttribute('aria-owns', this.suggestionListboxID);\n        input.setAttribute('aria-controls', this.suggestionListboxID);\n    };\n    SuggestionsManager.prototype.htmlElementIsSuggestion = function (selected) {\n        var omniboxSelectables = Dom_1.$$(this.element).findAll(\".\" + this.options.suggestionClass);\n        return underscore_1.indexOf(omniboxSelectables, selected) > -1;\n    };\n    return SuggestionsManager;\n}());\nexports.SuggestionsManager = SuggestionsManager;\n\n\n/***/ }),\n\n/***/ 218:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar underscore_1 = __webpack_require__(0);\nvar Core_1 = __webpack_require__(20);\nvar Dom_1 = __webpack_require__(1);\nvar doMagicBoxExport_1 = __webpack_require__(556);\nvar InputManager_1 = __webpack_require__(495);\nvar MagicBoxClear_1 = __webpack_require__(559);\nvar SuggestionsManager_1 = __webpack_require__(217);\nvar MagicBoxInstance = /** @class */ (function () {\n    function MagicBoxInstance(element, grammar, options) {\n        if (options === void 0) { options = {}; }\n        var _this = this;\n        this.element = element;\n        this.grammar = grammar;\n        this.options = options;\n        this.lastSuggestions = [];\n        if (underscore_1.isUndefined(this.options.inline)) {\n            this.options.inline = false;\n        }\n        Dom_1.$$(element).addClass('magic-box');\n        if (this.options.inline) {\n            Dom_1.$$(element).addClass('magic-box-inline');\n        }\n        this.result = this.grammar.parse('');\n        this.displayedResult = this.result.clean();\n        var inputContainer = Dom_1.$$(element).find('.magic-box-input');\n        if (!inputContainer) {\n            inputContainer = document.createElement('div');\n            inputContainer.className = 'magic-box-input';\n            element.appendChild(inputContainer);\n        }\n        this.inputManager = new InputManager_1.InputManager(inputContainer, function (text, wordCompletion) {\n            if (!wordCompletion) {\n                _this.setText(text);\n                _this.addSuggestions();\n                _this.onchange && _this.onchange();\n            }\n            else {\n                _this.setText(text);\n                _this.onselect && _this.onselect(_this.firstSuggestionWithText);\n            }\n        }, this);\n        this.inputManager.ontabpress = function () {\n            _this.ontabpress && _this.ontabpress();\n        };\n        var existingValue = this.inputManager.getValue();\n        if (existingValue) {\n            this.displayedResult.input = existingValue;\n        }\n        this.inputManager.setResult(this.displayedResult);\n        var suggestionsContainer = document.createElement('div');\n        suggestionsContainer.className = 'magic-box-suggestions';\n        this.element.appendChild(suggestionsContainer);\n        this.suggestionsManager = new SuggestionsManager_1.SuggestionsManager(suggestionsContainer, this.element, this.inputManager, {\n            suggestionClass: this.options.selectableSuggestionClass,\n            selectedClass: this.options.selectedSuggestionClass,\n            timeout: this.options.suggestionTimeout\n        });\n        this.magicBoxClear = new MagicBoxClear_1.MagicBoxClear(this);\n        this.setupHandler();\n    }\n    Object.defineProperty(MagicBoxInstance.prototype, \"firstSuggestionWithText\", {\n        get: function () {\n            return underscore_1.find(this.lastSuggestions, function (suggestion) { return suggestion.text; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(MagicBoxInstance.prototype, \"firstSuggestionText\", {\n        get: function () {\n            var firstSuggestionWithText = this.firstSuggestionWithText;\n            return firstSuggestionWithText ? firstSuggestionWithText.text : '';\n        },\n        enumerable: true,\n        configurable: true\n    });\n    MagicBoxInstance.prototype.getResult = function () {\n        return this.result;\n    };\n    MagicBoxInstance.prototype.getDisplayedResult = function () {\n        return this.displayedResult;\n    };\n    MagicBoxInstance.prototype.setText = function (text) {\n        Dom_1.$$(this.element).toggleClass('magic-box-notEmpty', text.length > 0);\n        this.magicBoxClear.toggleTabindexAndAriaHidden(text.length > 0);\n        this.result = this.grammar.parse(text);\n        this.displayedResult = this.result.clean();\n        this.inputManager.setResult(this.displayedResult);\n    };\n    MagicBoxInstance.prototype.setCursor = function (index) {\n        this.inputManager.setCursor(index);\n    };\n    MagicBoxInstance.prototype.getCursor = function () {\n        return this.inputManager.getCursor();\n    };\n    MagicBoxInstance.prototype.resultAtCursor = function (match) {\n        return this.displayedResult.resultAt(this.getCursor(), match);\n    };\n    MagicBoxInstance.prototype.setupHandler = function () {\n        var _this = this;\n        this.inputManager.onblur = function () {\n            Dom_1.$$(_this.element).removeClass('magic-box-hasFocus');\n            _this.onblur && _this.onblur();\n            if (!_this.options.inline) {\n                _this.clearSuggestion();\n            }\n        };\n        this.inputManager.onfocus = function () {\n            Dom_1.$$(_this.element).addClass('magic-box-hasFocus');\n            _this.addSuggestions();\n            _this.onfocus && _this.onfocus();\n        };\n        this.inputManager.onkeydown = function (key) {\n            if (_this.shouldMoveInSuggestions(key)) {\n                return false;\n            }\n            if (key === Core_1.KEYBOARD.ENTER) {\n                var suggestion = _this.suggestionsManager.selectAndReturnKeyboardFocusedElement();\n                if (suggestion == null) {\n                    _this.onsubmit && _this.onsubmit();\n                }\n                return false;\n            }\n            else if (key === Core_1.KEYBOARD.ESCAPE) {\n                _this.clearSuggestion();\n                _this.blur();\n            }\n            else {\n                _this.suggestionsManager.clearKeyboardFocusedElement();\n            }\n            return true;\n        };\n        this.inputManager.onchangecursor = function () {\n            _this.addSuggestions();\n        };\n        this.inputManager.onkeyup = function (key) {\n            _this.onmove && _this.onmove();\n            if (!_this.shouldMoveInSuggestions(key)) {\n                return true;\n            }\n            switch (key) {\n                case Core_1.KEYBOARD.UP_ARROW:\n                    _this.suggestionsManager.moveUp();\n                    break;\n                case Core_1.KEYBOARD.DOWN_ARROW:\n                    _this.suggestionsManager.moveDown();\n                    break;\n                case Core_1.KEYBOARD.LEFT_ARROW:\n                    _this.suggestionsManager.moveLeft();\n                    break;\n                case Core_1.KEYBOARD.RIGHT_ARROW:\n                    _this.suggestionsManager.moveRight();\n                    break;\n            }\n            if (_this.suggestionsManager.selectedSuggestion) {\n                _this.focusOnSuggestion(_this.suggestionsManager.selectedSuggestion);\n            }\n            _this.onchange && _this.onchange();\n            return false;\n        };\n    };\n    MagicBoxInstance.prototype.addSuggestions = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var suggestions;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.suggestionsManager.receiveSuggestions(this.getSuggestions != null ? this.getSuggestions() : [])];\n                    case 1:\n                        suggestions = _a.sent();\n                        this.addSelectEventHandlers(suggestions);\n                        this.inputManager.setWordCompletion(this.firstSuggestionText);\n                        this.onSuggestions(suggestions);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    MagicBoxInstance.prototype.shouldMoveInSuggestions = function (key) {\n        switch (key) {\n            case Core_1.KEYBOARD.UP_ARROW:\n            case Core_1.KEYBOARD.DOWN_ARROW:\n                return true;\n            case Core_1.KEYBOARD.LEFT_ARROW:\n            case Core_1.KEYBOARD.RIGHT_ARROW:\n                if (this.suggestionsManager.hasFocus && this.suggestionsManager.hasPreviews) {\n                    return true;\n                }\n        }\n        return false;\n    };\n    MagicBoxInstance.prototype.addSelectEventHandlers = function (suggestions) {\n        var _this = this;\n        underscore_1.each(suggestions, function (suggestion) {\n            if (suggestion.onSelect == null && suggestion.text != null) {\n                suggestion.onSelect = function () {\n                    _this.setText(suggestion.text);\n                    _this.onselect && _this.onselect(suggestion);\n                };\n            }\n        });\n    };\n    MagicBoxInstance.prototype.focus = function () {\n        Dom_1.$$(this.element).addClass('magic-box-hasFocus');\n        this.inputManager.focus();\n    };\n    MagicBoxInstance.prototype.blur = function () {\n        this.inputManager.blur();\n    };\n    MagicBoxInstance.prototype.clearSuggestion = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this.inputManager.setWordCompletion(null);\n                this.suggestionsManager.clearSuggestions();\n                this.onSuggestions([]);\n                return [2 /*return*/];\n            });\n        });\n    };\n    MagicBoxInstance.prototype.focusOnSuggestion = function (suggestion) {\n        if (suggestion == null || suggestion.text == null) {\n            this.inputManager.setResult(this.displayedResult, this.firstSuggestionText);\n        }\n        else {\n            this.inputManager.setResult(this.grammar.parse(suggestion.text).clean(), suggestion.text);\n        }\n    };\n    MagicBoxInstance.prototype.getText = function () {\n        return this.inputManager.getValue();\n    };\n    MagicBoxInstance.prototype.getWordCompletion = function () {\n        return this.inputManager.getWordCompletion();\n    };\n    MagicBoxInstance.prototype.clear = function () {\n        this.setText('');\n        this.clearSuggestion();\n        this.focus();\n        this.onclear && this.onclear();\n    };\n    MagicBoxInstance.prototype.hasSuggestions = function () {\n        return this.suggestionsManager.hasSuggestions;\n    };\n    return MagicBoxInstance;\n}());\nexports.MagicBoxInstance = MagicBoxInstance;\nfunction createMagicBox(element, grammar, options) {\n    return new MagicBoxInstance(element, grammar, options);\n}\nexports.createMagicBox = createMagicBox;\nfunction requestAnimationFrame(callback) {\n    if ('requestAnimationFrame' in window) {\n        return window.requestAnimationFrame(callback);\n    }\n    return setTimeout(callback);\n}\nexports.requestAnimationFrame = requestAnimationFrame;\ndoMagicBoxExport_1.doMagicBoxExport();\n\n\n/***/ }),\n\n/***/ 219:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _ = __webpack_require__(0);\nvar MagicBoxUtils = /** @class */ (function () {\n    function MagicBoxUtils() {\n    }\n    MagicBoxUtils.escapeRegExp = function (str) {\n        return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n    };\n    MagicBoxUtils.highlightText = function (text, highligth, ignoreCase, matchClass, doNotMatchClass) {\n        var _this = this;\n        if (ignoreCase === void 0) { ignoreCase = false; }\n        if (matchClass === void 0) { matchClass = 'magic-box-hightlight'; }\n        if (doNotMatchClass === void 0) { doNotMatchClass = ''; }\n        if (highligth.length == 0) {\n            return text;\n        }\n        var escaped = this.escapeRegExp(highligth);\n        var stringRegex = '(' + escaped + ')|(.*?(?=' + escaped + ')|.+)';\n        var regex = new RegExp(stringRegex, ignoreCase ? 'gi' : 'g');\n        return text.replace(regex, function (text, match, notmatch) { return _this.escapeText(match != null ? matchClass : doNotMatchClass, text); });\n    };\n    MagicBoxUtils.escapeText = function (classname, text) {\n        return \"<span class=\\\"\" + classname + \"\\\">\" + _.escape(text) + \"</span>\";\n    };\n    return MagicBoxUtils;\n}());\nexports.MagicBoxUtils = MagicBoxUtils;\n\n\n/***/ }),\n\n/***/ 484:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Result_1 = __webpack_require__(49);\nvar RefResult_1 = __webpack_require__(485);\nvar ExpressionEndOfInput_1 = __webpack_require__(214);\nvar _ = __webpack_require__(0);\nvar ExpressionRef = /** @class */ (function () {\n    function ExpressionRef(ref, occurrence, id, grammar) {\n        this.ref = ref;\n        this.occurrence = occurrence;\n        this.id = id;\n        this.grammar = grammar;\n    }\n    ExpressionRef.prototype.parse = function (input, end) {\n        var ref = this.grammar.getExpression(this.ref);\n        if (ref == null) {\n            throw new Error('Expression not found:' + this.ref);\n        }\n        if (this.occurrence == '?' || this.occurrence == null) {\n            return this.parseOnce(input, end, ref);\n        }\n        else {\n            return this.parseMany(input, end, ref);\n        }\n    };\n    ExpressionRef.prototype.parseOnce = function (input, end, ref) {\n        var refResult = ref.parse(input, end);\n        var success = refResult.isSuccess();\n        if (!success && this.occurrence == '?') {\n            if (end) {\n                // if end was found\n                if (input.length == 0) {\n                    return new RefResult_1.RefResult([], this, input, refResult);\n                }\n                // if end was not found and all error expression are EndOfInput, reparse with end = false.\n                if (_.all(refResult.getBestExpect(), function (expect) { return expect.expression == ExpressionEndOfInput_1.ExpressionEndOfInput; })) {\n                    return new RefResult_1.RefResult([new Result_1.Result(null, ExpressionEndOfInput_1.ExpressionEndOfInput, input)], this, input, refResult);\n                }\n                return refResult;\n            }\n            // the ref is not required and it do not need to end the input\n            return new RefResult_1.RefResult([], this, input, null);\n        }\n        return new RefResult_1.RefResult([refResult], this, input, success ? null : refResult);\n    };\n    ExpressionRef.prototype.parseMany = function (input, end, ref) {\n        var subResults = [];\n        var subResult;\n        var subInput = input;\n        var success;\n        // try to parse until it do not match, do not manage the end yet\n        do {\n            subResult = ref.parse(subInput, false);\n            success = subResult.isSuccess();\n            if (success) {\n                subResults.push(subResult);\n                subInput = subInput.substr(subResult.getLength());\n            }\n        } while (success && subResult.input != subInput);\n        // minimal occurance of a ref\n        var requiredOccurance = _.isNumber(this.occurrence) ? this.occurrence : this.occurrence == '+' ? 1 : 0;\n        // if the minimal occurance is not reached add the fail result to the list\n        if (subResults.length < requiredOccurance) {\n            subResults.push(subResult);\n        }\n        else if (end) {\n            // if there is at least one match, check if the last match is at the end\n            if (subResults.length > 0) {\n                var last = _.last(subResults);\n                subResult = ref.parse(last.input, true);\n                if (subResult.isSuccess()) {\n                    // if successful, replace the last subResult by the one with end\n                    subResults[subResults.length - 1] = subResult;\n                }\n                else {\n                    // if not successful, we keep the last successful result and we add a endOfInputExpected Result after it\n                    subResults.push(new Result_1.Result(null, ExpressionEndOfInput_1.ExpressionEndOfInput, last.input.substr(last.getLength())));\n                    // we parse back the last with the length of the successful Result (at the same place we put the endOfInputExpected) and put it in failAttempt\n                    subResult = ref.parse(last.input.substr(last.getLength()), true);\n                }\n            }\n            else if (input.length != 0) {\n                // if there is no result at all and we are not at the end, return a endOfInputExpected Result\n                var endOfInput = new Result_1.Result(null, ExpressionEndOfInput_1.ExpressionEndOfInput, input);\n                return new RefResult_1.RefResult([endOfInput], this, input, subResult);\n            }\n        }\n        return new RefResult_1.RefResult(subResults, this, input, subResult);\n    };\n    ExpressionRef.prototype.toString = function () {\n        return this.id;\n    };\n    return ExpressionRef;\n}());\nexports.ExpressionRef = ExpressionRef;\n\n\n/***/ }),\n\n/***/ 485:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Result_1 = __webpack_require__(49);\nvar _ = __webpack_require__(0);\nvar RefResult = /** @class */ (function (_super) {\n    __extends(RefResult, _super);\n    function RefResult(results, expression, input, lastResult) {\n        var _this = _super.call(this, results, expression, input) || this;\n        _this.expression = expression;\n        _this.input = input;\n        if (_.last(results) != lastResult) {\n            _this.failAttempt = lastResult;\n            if (_this.failAttempt != null) {\n                _this.failAttempt.parent = _this;\n            }\n        }\n        return _this;\n    }\n    /**\n     * Return all fail result.\n     */\n    RefResult.prototype.getExpect = function () {\n        var expect = _super.prototype.getExpect.call(this);\n        // add the failAttempt to the expect\n        if (this.failAttempt != null) {\n            return expect.concat(this.failAttempt.getExpect());\n        }\n        return expect;\n    };\n    /**\n     * Clean the result to have the most relevant result. If the result is successful just return a clone of it.\n     */\n    RefResult.prototype.clean = function (path) {\n        // if there is no failAttempt, we will use the default clean\n        if (this.failAttempt != null && (path != null || !this.isSuccess())) {\n            path = path || _.last(this.getBestExpect()).path(this);\n            var next = _.first(path);\n            // if the next is in the subResults, not the failAttempt, do the default clean;\n            if (next != null && next == this.failAttempt) {\n                var last = _.last(this.subResults);\n                // if the last is not successful, remove it because we want the failAttempt path\n                var subResults = _.map(last != null && last.isSuccess() ? this.subResults : _.initial(this.subResults), function (subResult) {\n                    return subResult.clean();\n                });\n                subResults.push(next.clean(_.rest(path)));\n                return new Result_1.Result(subResults, this.expression, this.input);\n            }\n        }\n        return _super.prototype.clean.call(this, path);\n    };\n    return RefResult;\n}(Result_1.Result));\nexports.RefResult = RefResult;\n\n\n/***/ }),\n\n/***/ 486:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar OptionResult_1 = __webpack_require__(487);\nvar ExpressionOptions = /** @class */ (function () {\n    function ExpressionOptions(parts, id) {\n        this.parts = parts;\n        this.id = id;\n    }\n    ExpressionOptions.prototype.parse = function (input, end) {\n        var failAttempt = [];\n        for (var i = 0; i < this.parts.length; i++) {\n            var subResult = this.parts[i].parse(input, end);\n            if (subResult.isSuccess()) {\n                return new OptionResult_1.OptionResult(subResult, this, input, failAttempt);\n            }\n            failAttempt.push(subResult);\n        }\n        return new OptionResult_1.OptionResult(null, this, input, failAttempt);\n    };\n    ExpressionOptions.prototype.toString = function () {\n        return this.id;\n    };\n    return ExpressionOptions;\n}());\nexports.ExpressionOptions = ExpressionOptions;\n\n\n/***/ }),\n\n/***/ 487:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Result_1 = __webpack_require__(49);\nvar _ = __webpack_require__(0);\nvar OptionResult = /** @class */ (function (_super) {\n    __extends(OptionResult, _super);\n    function OptionResult(result, expression, input, failAttempt) {\n        var _this = _super.call(this, result != null ? [result] : null, expression, input) || this;\n        _this.result = result;\n        _this.expression = expression;\n        _this.input = input;\n        _this.failAttempt = failAttempt;\n        _.forEach(_this.failAttempt, function (subResult) {\n            subResult.parent = _this;\n        });\n        return _this;\n    }\n    /**\n     * Return all fail result.\n     */\n    OptionResult.prototype.getExpect = function () {\n        var _this = this;\n        var expect = [];\n        if (this.result != null) {\n            expect = this.result.getExpect();\n        }\n        expect = _.reduce(this.failAttempt, function (expect, result) { return expect.concat(result.getExpect()); }, expect);\n        if (expect.length > 0 && _.all(expect, function (result) { return result.input == _this.input; })) {\n            return [this];\n        }\n        return expect;\n    };\n    /**\n     * Clean the result to have the most relevant result. If the result is successful just return a clone of it.\n     */\n    OptionResult.prototype.clean = function (path) {\n        if (path != null || !this.isSuccess()) {\n            // Result will be a ref. We skip it for cleaner tree.\n            path = _.rest(path || _.last(this.getBestExpect()).path(this));\n            // next can be Result or one of the failAttempt. In both case we have only one child\n            var next = _.first(path);\n            if (next == null) {\n                return new Result_1.Result(null, this.expression, this.input);\n            }\n            return new Result_1.Result([next.clean(_.rest(path))], this.expression, this.input);\n        }\n        // Result will be a ref. We skip it for cleaner tree.\n        return new Result_1.Result(_.map(this.result.subResults, function (subResult) { return subResult.clean(); }), this.expression, this.input);\n    };\n    return OptionResult;\n}(Result_1.Result));\nexports.OptionResult = OptionResult;\n\n\n/***/ }),\n\n/***/ 488:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Result_1 = __webpack_require__(49);\nvar Result_2 = __webpack_require__(49);\nvar ExpressionRegExp = /** @class */ (function () {\n    function ExpressionRegExp(value, id, grammar) {\n        this.value = value;\n        this.id = id;\n    }\n    ExpressionRegExp.prototype.parse = function (input, end) {\n        var groups = input.match(this.value);\n        // if the RegExp do not match at the start, ignore it\n        if (groups != null && groups.index != 0) {\n            groups = null;\n        }\n        var result = new Result_1.Result(groups != null ? groups[0] : null, this, input);\n        // if is successful and we require the end but the length of parsed is\n        // lower than the input length, return a EndOfInputExpected Result\n        if (result.isSuccess() && end && input.length > result.value.length) {\n            return new Result_2.EndOfInputResult(result);\n        }\n        return result;\n    };\n    ExpressionRegExp.prototype.toString = function () {\n        return this.id;\n    };\n    return ExpressionRegExp;\n}());\nexports.ExpressionRegExp = ExpressionRegExp;\n\n\n/***/ }),\n\n/***/ 489:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ExpressionFunction = /** @class */ (function () {\n    function ExpressionFunction(func, id, grammar) {\n        this.func = func;\n        this.id = id;\n        this.grammar = grammar;\n    }\n    ExpressionFunction.prototype.parse = function (input, end) {\n        return this.func(input, end, this);\n    };\n    ExpressionFunction.prototype.toString = function () {\n        return this.id;\n    };\n    return ExpressionFunction;\n}());\nexports.ExpressionFunction = ExpressionFunction;\n\n\n/***/ }),\n\n/***/ 49:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ExpressionEndOfInput_1 = __webpack_require__(214);\nvar ExpressionConstant_1 = __webpack_require__(215);\nvar _ = __webpack_require__(0);\nvar Result = /** @class */ (function () {\n    function Result(value, expression, input) {\n        var _this = this;\n        this.expression = expression;\n        this.input = input;\n        if (_.isString(value)) {\n            this.value = value;\n        }\n        else if (_.isArray(value)) {\n            this.subResults = value;\n            _.forEach(this.subResults, function (subResult) {\n                subResult.parent = _this;\n            });\n        }\n    }\n    Result.prototype.isSuccess = function () {\n        // if null is the value, this mean the expression could not parse this input\n        return this.value != null || (this.subResults != null && _.all(this.subResults, function (subResult) { return subResult.isSuccess(); }));\n    };\n    /**\n     * Return path to this result ([parent.parent, parent, this])\n     */\n    Result.prototype.path = function (until) {\n        var path = this.parent != null && this.parent != until ? this.parent.path(until) : [];\n        path.push(this);\n        return path;\n    };\n    /**\n     * Return the closest parent that match the condition (can be it-self). If match is a string, it will search for the result expresion id\n     */\n    Result.prototype.findParent = function (match) {\n        var parent = this;\n        var iterator = _.isString(match) ? function (result) { return match == result.expression.id; } : match;\n        while (parent != null && !iterator(parent)) {\n            parent = parent.parent;\n        }\n        return parent;\n    };\n    /**\n     * Return the first child that match the condition (can be it-self). If match is a string, it will search for the result expresion id\n     */\n    Result.prototype.find = function (match) {\n        var iterator = _.isString(match) ? function (result) { return match == result.expression.id; } : match;\n        if (iterator(this)) {\n            return this;\n        }\n        if (this.subResults) {\n            for (var i = 0; i < this.subResults.length; i++) {\n                var subResultFind = this.subResults[i].find(iterator);\n                if (subResultFind) {\n                    return subResultFind;\n                }\n            }\n        }\n        return null;\n    };\n    /**\n     * Return all children that match the condition (can be it-self). If match is a string, it will search for the result expresion id\n     */\n    Result.prototype.findAll = function (match) {\n        var results = [];\n        var iterator = _.isString(match) ? function (result) { return match == result.expression.id; } : match;\n        if (iterator(this)) {\n            results.push(this);\n        }\n        if (this.subResults) {\n            results = _.reduce(this.subResults, function (results, subResult) { return results.concat(subResult.findAll(iterator)); }, results);\n        }\n        return results;\n    };\n    /**\n     * Return the first child that match the condition (can be it-self). If match is a string, it will search for the result expresion id\n     */\n    Result.prototype.resultAt = function (index, match) {\n        if (index < 0 || index > this.getLength()) {\n            return [];\n        }\n        if (match != null) {\n            if (_.isString(match)) {\n                if (match == this.expression.id) {\n                    return [this];\n                }\n            }\n            else {\n                if (match(this)) {\n                    return [this];\n                }\n            }\n        }\n        else {\n            var value = this.value == null && this.subResults == null ? this.input : this.value;\n            if (value != null) {\n                return [this];\n            }\n        }\n        if (this.subResults != null) {\n            var results = [];\n            for (var i = 0; i < this.subResults.length; i++) {\n                var subResult = this.subResults[i];\n                results = results.concat(subResult.resultAt(index, match));\n                index -= subResult.getLength();\n                if (index < 0) {\n                    break;\n                }\n            }\n            return results;\n        }\n        return [];\n    };\n    /**\n     * Return all fail result.\n     */\n    Result.prototype.getExpect = function () {\n        if (this.value == null && this.subResults == null) {\n            return [this];\n        }\n        if (this.subResults != null) {\n            return _.reduce(this.subResults, function (expect, result) { return expect.concat(result.getExpect()); }, []);\n        }\n        return [];\n    };\n    /**\n     * Return the best fail result (The farthest result who got parsed). We also remove duplicate and always return the simplest result of a kind\n     */\n    Result.prototype.getBestExpect = function () {\n        var expects = this.getExpect();\n        var groups = _.groupBy(expects, function (expect) { return expect.input; });\n        var key = _.last(_.keys(groups).sort(function (a, b) {\n            return b.length - a.length;\n        }));\n        var bestResults = groups[key];\n        var groups = _.groupBy(bestResults, function (expect) { return expect.expression.id; });\n        return _.map(groups, function (bestResults) {\n            return _.chain(bestResults)\n                .map(function (result) {\n                return {\n                    path: result.path().length,\n                    result: result\n                };\n            })\n                .sortBy('path')\n                .pluck('result')\n                .first()\n                .value();\n        });\n    };\n    Result.prototype.getHumanReadableExpect = function () {\n        var expect = this.getBestExpect();\n        var input = expect.length > 0 ? _.last(expect).input : '';\n        return ('Expected ' +\n            _.map(expect, function (result) { return result.getHumanReadable(); }).join(' or ') +\n            ' but ' +\n            (input.length > 0 ? JSON.stringify(input[0]) : 'end of input') +\n            ' found.');\n    };\n    /**\n     * Return a string that represent what is before this result\n     */\n    Result.prototype.before = function () {\n        if (this.parent == null) {\n            return '';\n        }\n        var index = _.indexOf(this.parent.subResults, this);\n        return (this.parent.before() +\n            _.chain(this.parent.subResults)\n                .first(index)\n                .map(function (subResult) { return subResult.toString(); })\n                .join('')\n                .value());\n    };\n    /**\n     * Return a string that represent what is after this result\n     */\n    Result.prototype.after = function () {\n        if (this.parent == null) {\n            return '';\n        }\n        var index = _.indexOf(this.parent.subResults, this);\n        return (_.chain(this.parent.subResults)\n            .last(this.parent.subResults.length - index - 1)\n            .map(function (subResult) { return subResult.toString(); })\n            .join('')\n            .value() + this.parent.after());\n    };\n    /**\n     * Return the length of the result\n     */\n    Result.prototype.getLength = function () {\n        if (this.value != null) {\n            return this.value.length;\n        }\n        if (this.subResults != null) {\n            return _.reduce(this.subResults, function (length, subResult) { return length + subResult.getLength(); }, 0);\n        }\n        return this.input.length;\n    };\n    Result.prototype.toHtmlElement = function () {\n        var element = document.createElement('span');\n        var id = this.expression != null ? this.expression.id : null;\n        if (id != null) {\n            element.setAttribute('data-id', id);\n        }\n        element.setAttribute('data-success', this.isSuccess().toString());\n        if (this.value != null) {\n            element.appendChild(document.createTextNode(this.value));\n            element.setAttribute('data-value', this.value);\n        }\n        else if (this.subResults != null) {\n            _.each(this.subResults, function (subResult) {\n                element.appendChild(subResult.toHtmlElement());\n            });\n        }\n        else {\n            element.appendChild(document.createTextNode(this.input));\n            element.setAttribute('data-input', this.input);\n            element.className = 'magic-box-error' + (this.input.length > 0 ? '' : ' magic-box-error-empty');\n        }\n        element['result'] = this;\n        return element;\n    };\n    /**\n     * Clean the result to have the most relevant result. If the result is successful just return a clone of it.\n     */\n    Result.prototype.clean = function (path) {\n        if (path != null || !this.isSuccess()) {\n            path = path || _.last(this.getBestExpect()).path(this);\n            var next = _.first(path);\n            if (next != null) {\n                var nextIndex = _.indexOf(this.subResults, next);\n                var subResults = nextIndex == -1 ? [] : _.map(_.first(this.subResults, nextIndex), function (subResult) { return subResult.clean(); });\n                subResults.push(next.clean(_.rest(path)));\n                return new Result(subResults, this.expression, this.input);\n            }\n            else {\n                return new Result(null, this.expression, this.input);\n            }\n        }\n        if (this.value != null) {\n            return new Result(this.value, this.expression, this.input);\n        }\n        if (this.subResults != null) {\n            return new Result(_.map(this.subResults, function (subResult) { return subResult.clean(); }), this.expression, this.input);\n        }\n    };\n    Result.prototype.clone = function () {\n        if (this.value != null) {\n            return new Result(this.value, this.expression, this.input);\n        }\n        if (this.subResults != null) {\n            return new Result(_.map(this.subResults, function (subResult) { return subResult.clone(); }), this.expression, this.input);\n        }\n        return new Result(null, this.expression, this.input);\n    };\n    Result.prototype.toString = function () {\n        if (this.value != null) {\n            return this.value;\n        }\n        if (this.subResults != null) {\n            return _.map(this.subResults, function (subresult) { return subresult.toString(); }).join('');\n        }\n        return this.input;\n    };\n    Result.prototype.getHumanReadable = function () {\n        if (this.expression instanceof ExpressionConstant_1.ExpressionConstant) {\n            return JSON.stringify(this.expression.value);\n        }\n        return this.expression.id;\n    };\n    return Result;\n}());\nexports.Result = Result;\nvar EndOfInputResult = /** @class */ (function (_super) {\n    __extends(EndOfInputResult, _super);\n    function EndOfInputResult(result) {\n        var _this = _super.call(this, [result], ExpressionEndOfInput_1.ExpressionEndOfInput, result.input) || this;\n        var endOfInput = new Result(null, ExpressionEndOfInput_1.ExpressionEndOfInput, result.input.substr(result.getLength()));\n        endOfInput.parent = _this;\n        _this.subResults.push(endOfInput);\n        return _this;\n    }\n    return EndOfInputResult;\n}(Result));\nexports.EndOfInputResult = EndOfInputResult;\n\n\n/***/ }),\n\n/***/ 490:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Result_1 = __webpack_require__(49);\nvar ExpressionList = /** @class */ (function () {\n    function ExpressionList(parts, id) {\n        this.parts = parts;\n        this.id = id;\n        if (parts.length == 0) {\n            throw new Error(JSON.stringify(id) + ' should have at least 1 parts');\n        }\n    }\n    ExpressionList.prototype.parse = function (input, end) {\n        var subResults = [];\n        var subResult;\n        var subInput = input;\n        for (var i = 0; i < this.parts.length; i++) {\n            var part = this.parts[i];\n            subResult = part.parse(subInput, end && i == this.parts.length - 1);\n            subResults.push(subResult);\n            // if the subResult do not succeed, stop the parsing\n            if (!subResult.isSuccess()) {\n                break;\n            }\n            else {\n                subInput = subInput.substr(subResult.getLength());\n            }\n        }\n        return new Result_1.Result(subResults, this, input);\n    };\n    ExpressionList.prototype.toString = function () {\n        return this.id;\n    };\n    return ExpressionList;\n}());\nexports.ExpressionList = ExpressionList;\n\n\n/***/ }),\n\n/***/ 491:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Field_1 = __webpack_require__(216);\nexports.NestedQuery = {\n    basicExpressions: ['NestedQuery'],\n    grammars: {\n        NestedQuery: '[[NestedField][OptionalSpaces][Expressions]]',\n        NestedField: '[[Field]]',\n        FieldValue: ['NestedQuery']\n    },\n    include: [Field_1.Field]\n};\n\n\n/***/ }),\n\n/***/ 492:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Basic_1 = __webpack_require__(128);\nexports.Date = {\n    grammars: {\n        Date: '[DateYear]/[DateMonth]/[DateDay]',\n        DateYear: /([0-9]{4})/,\n        DateMonth: /(1[0-2]|0?[1-9])/,\n        DateDay: /([1-2][0-9]|3[0-1]|0?[1-9])/,\n        DateRange: '[Date][Spaces?]..[Spaces?][Date]',\n        DateRelative: ['DateRelativeNegative', 'DateRelativeTerm'],\n        DateRelativeTerm: /now|today|yesterday/,\n        DateRelativeNegative: '[DateRelativeTerm][DateRelativeNegativeRef]',\n        DateRelativeNegativeRef: /([\\-\\+][0-9]+(s|m|h|d|mo|y))/\n    },\n    include: [Basic_1.Basic]\n};\n\n\n/***/ }),\n\n/***/ 493:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Basic_1 = __webpack_require__(128);\nexports.QueryExtension = {\n    basicExpressions: ['QueryExtension'],\n    grammars: {\n        QueryExtension: '$[QueryExtensionName]([QueryExtensionArguments])',\n        QueryExtensionName: /\\w+/,\n        QueryExtensionArguments: '[QueryExtensionArgumentList*][QueryExtensionArgument]',\n        QueryExtensionArgumentList: '[QueryExtensionArgument][Spaces?],[Spaces?]',\n        QueryExtensionArgument: '[QueryExtensionArgumentName]:[Spaces?][QueryExtensionArgumentValue]',\n        QueryExtensionArgumentName: /\\w+/,\n        QueryExtensionArgumentValue: ['SingleQuoted', 'Expressions']\n    },\n    include: [Basic_1.Basic]\n};\n\n\n/***/ }),\n\n/***/ 494:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SubExpression = {\n    basicExpressions: ['SubExpression'],\n    grammars: {\n        SubExpression: '([Expressions])'\n    }\n};\n\n\n/***/ }),\n\n/***/ 495:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _ = __webpack_require__(0);\nvar Core_1 = __webpack_require__(20);\nvar Strings_1 = __webpack_require__(6);\nvar Dom_1 = __webpack_require__(1);\nvar KeyboardUtils_1 = __webpack_require__(25);\nvar InputManager = /** @class */ (function () {\n    function InputManager(element, onchange, magicBox) {\n        this.onchange = onchange;\n        this.magicBox = magicBox;\n        this.hasFocus = false;\n        this.root = Core_1.Component.resolveRoot(element);\n        this.underlay = document.createElement('div');\n        this.underlay.className = 'magic-box-underlay';\n        this.highlightContainer = document.createElement('span');\n        this.highlightContainer.className = 'magic-box-highlight-container';\n        this.underlay.appendChild(this.highlightContainer);\n        this.ghostTextContainer = document.createElement('span');\n        this.ghostTextContainer.className = 'magic-box-ghost-text';\n        this.underlay.appendChild(this.ghostTextContainer);\n        this.input = Dom_1.$$(element).find('input');\n        if (!this.input) {\n            this.input = document.createElement('input');\n            element.appendChild(this.underlay);\n            element.appendChild(this.input);\n        }\n        else {\n            element.insertBefore(this.underlay, this.input);\n        }\n        this.setupHandler();\n        this.addAccessibilitiesProperties();\n    }\n    Object.defineProperty(InputManager.prototype, \"expanded\", {\n        set: function (isExpanded) {\n            this.input.setAttribute('aria-expanded', isExpanded.toString());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(InputManager.prototype, \"activeDescendant\", {\n        set: function (element) {\n            if (element) {\n                this.input.setAttribute('aria-activedescendant', element.id);\n            }\n            else {\n                this.input.removeAttribute('aria-activedescendant');\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Update the input with the result value\n     */\n    InputManager.prototype.updateInput = function () {\n        if (this.input.value != this.result.input) {\n            this.input.value = this.result.input;\n            if (this.hasFocus) {\n                this.setCursor(this.getValue().length);\n            }\n        }\n    };\n    /**\n     * Update the highlight with the result value\n     */\n    InputManager.prototype.updateHighlight = function () {\n        Dom_1.$$(this.highlightContainer).empty();\n        this.highlightContainer.appendChild(this.result.toHtmlElement());\n    };\n    /**\n     * Update the ghostText with the wordCompletion\n     */\n    InputManager.prototype.updateWordCompletion = function () {\n        Dom_1.$$(this.ghostTextContainer).empty();\n        this.ghostTextContainer.innerHTML = '';\n        if (this.wordCompletion != null) {\n            this.ghostTextContainer.appendChild(document.createTextNode(this.wordCompletion.substr(this.result.input.length)));\n        }\n    };\n    /**\n     * Set the result and update visual if needed\n     */\n    InputManager.prototype.setResult = function (result, wordCompletion) {\n        this.result = result;\n        this.updateInput();\n        this.updateHighlight();\n        // reuse last wordCompletion for a better visual\n        if (_.isUndefined(wordCompletion) && this.wordCompletion != null && this.wordCompletion.indexOf(this.result.input) == 0) {\n            this.updateWordCompletion();\n        }\n        else {\n            this.setWordCompletion(wordCompletion);\n        }\n        this.updateScroll();\n    };\n    /**\n     * Set the word completion. will be ignore if the word completion do not start with the result input\n     */\n    InputManager.prototype.setWordCompletion = function (wordCompletion) {\n        if (wordCompletion != null && wordCompletion.toLowerCase().indexOf(this.result.input.toLowerCase()) != 0) {\n            wordCompletion = null;\n        }\n        this.wordCompletion = wordCompletion;\n        this.updateWordCompletion();\n        this.updateScroll();\n    };\n    /**\n     * Set cursor position\n     */\n    InputManager.prototype.setCursor = function (index) {\n        this.input.focus();\n        if (this.input.createTextRange) {\n            var range = this.input.createTextRange();\n            range.move('character', index);\n            range.select();\n        }\n        else if (this.input.selectionStart != null) {\n            this.input.focus();\n            this.input.setSelectionRange(index, index);\n        }\n    };\n    InputManager.prototype.getCursor = function () {\n        return this.input.selectionStart;\n    };\n    InputManager.prototype.updateScroll = function (defer) {\n        var _this = this;\n        if (defer === void 0) { defer = true; }\n        var callback = function () {\n            // this is the cheapest call we can do before update scroll\n            if (_this.underlay.clientWidth < _this.underlay.scrollWidth) {\n                _this.underlay.style.visibility = 'hidden';\n                _this.underlay.scrollLeft = _this.input.scrollLeft;\n                _this.underlay.scrollTop = _this.input.scrollTop;\n                _this.underlay.style.visibility = 'visible';\n            }\n            _this.updateScrollDefer = null;\n            // one day we will have to remove this\n            if (_this.hasFocus) {\n                _this.updateScroll();\n            }\n        };\n        // sometime we want it to be updated as soon as posible to have no flickering\n        if (!defer) {\n            callback();\n        }\n        else if (this.updateScrollDefer == null) {\n            this.updateScrollDefer = requestAnimationFrame(callback);\n        }\n    };\n    InputManager.prototype.setupHandler = function () {\n        var _this = this;\n        this.input.onblur = function () {\n            _this.hasFocus = false;\n            setTimeout(function () {\n                if (!_this.hasFocus) {\n                    _this.onblur && _this.onblur();\n                }\n            }, 300);\n            _this.updateScroll();\n        };\n        this.input.onfocus = function () {\n            if (!_this.hasFocus) {\n                _this.hasFocus = true;\n                _this.updateScroll();\n                _this.onfocus && _this.onfocus();\n            }\n        };\n        this.input.onkeydown = function (e) {\n            _this.keydown(e);\n        };\n        this.input.onkeyup = function (e) {\n            _this.keyup(e);\n        };\n        this.input.oncut = function () {\n            setTimeout(function () {\n                _this.onInputChange();\n            });\n        };\n        this.input.onpaste = function () {\n            setTimeout(function () {\n                _this.onInputChange();\n            });\n        };\n    };\n    InputManager.prototype.addAccessibilitiesProperties = function () {\n        this.input.setAttribute('autocomplete', 'off');\n        this.input.setAttribute('type', 'text');\n        this.input.setAttribute('role', 'combobox');\n        this.input.setAttribute('form', 'coveo-dummy-form');\n        this.input.setAttribute('aria-autocomplete', 'list');\n        this.input.setAttribute('title', Strings_1.l('InsertAQuery') + \". \" + Strings_1.l('PressEnterToSend'));\n    };\n    InputManager.prototype.focus = function () {\n        var _this = this;\n        // neet a timeout for IE8-9\n        setTimeout(function () {\n            _this.input.focus();\n            _this.setCursor(_this.getValue().length);\n        });\n    };\n    InputManager.prototype.blur = function () {\n        if (this.hasFocus) {\n            this.input.blur();\n        }\n    };\n    InputManager.prototype.keydown = function (e) {\n        var _this = this;\n        switch (e.keyCode || e.which) {\n            case KeyboardUtils_1.KEYBOARD.TAB:\n                // Take care of not \"preventing\" the default event behaviour : For accessibility reasons, it is much simpler\n                // to simply let the browser do it's standard action (which is to focus out of the input).\n                // Instead, handle \"tabPress\" immediately instead of \"keyup\".\n                // The focus will be on the next element in the page when the key is released, so keyup on the input will never be triggered.\n                this.tabPress();\n                this.magicBox.clearSuggestion();\n                break;\n            default:\n                e.stopPropagation();\n                if (this.onkeydown == null || this.onkeydown(e.keyCode || e.which)) {\n                    requestAnimationFrame(function () {\n                        _this.onInputChange();\n                    });\n                }\n                else {\n                    e.preventDefault();\n                }\n                break;\n        }\n    };\n    InputManager.prototype.keyup = function (e) {\n        switch (e.keyCode || e.which) {\n            case KeyboardUtils_1.KEYBOARD.LEFT_ARROW:\n            case KeyboardUtils_1.KEYBOARD.RIGHT_ARROW:\n                this.handleLeftRightArrow(e);\n                break;\n            default:\n                if (this.onkeydown == null || this.onkeyup(e.keyCode || e.which)) {\n                    this.onInputChange();\n                }\n                else {\n                    e.preventDefault();\n                }\n                break;\n        }\n    };\n    InputManager.prototype.handleLeftRightArrow = function (e) {\n        var querySuggestPreview = Dom_1.$$(this.root).find(\".\" + Core_1.Component.computeCssClassNameForType('QuerySuggestPreview'));\n        if (!querySuggestPreview) {\n            this.onchangecursor();\n        }\n        var inputChanged = this.onkeydown == null || this.onkeyup(e.keyCode || e.which);\n        inputChanged ? this.onInputChange() : e.preventDefault();\n    };\n    InputManager.prototype.tabPress = function () {\n        this.ontabpress && this.ontabpress();\n        this.onblur && this.onblur();\n    };\n    InputManager.prototype.onInputChange = function () {\n        if (this.result.input != this.input.value) {\n            this.onchange(this.input.value, false);\n        }\n    };\n    InputManager.prototype.getValue = function () {\n        return this.input.value;\n    };\n    InputManager.prototype.getWordCompletion = function () {\n        return this.wordCompletion;\n    };\n    return InputManager;\n}());\nexports.InputManager = InputManager;\n\n\n/***/ }),\n\n/***/ 496:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar underscore_1 = __webpack_require__(0);\nvar ProcessingStatus;\n(function (ProcessingStatus) {\n    ProcessingStatus[ProcessingStatus[\"Finished\"] = 0] = \"Finished\";\n    ProcessingStatus[ProcessingStatus[\"TimedOut\"] = 1] = \"TimedOut\";\n    ProcessingStatus[ProcessingStatus[\"Overriden\"] = 2] = \"Overriden\";\n})(ProcessingStatus = exports.ProcessingStatus || (exports.ProcessingStatus = {}));\n/**\n * IE11 equivalent of Promise.race\n * Adapted from Promise.race(iterable) polyfill on https://www.promisejs.org/api/\n */\nfunction racePromises(promises) {\n    return new Promise(function (resolve, reject) { return promises.forEach(function (value) { return Promise.resolve(value).then(resolve, reject); }); });\n}\nvar QueryProcessor = /** @class */ (function () {\n    function QueryProcessor(options) {\n        if (options === void 0) { options = {}; }\n        this.options = __assign({ timeout: 500 }, options);\n    }\n    /**\n     * Overrides the previous queries and accumulates the result of promise arrays with a timeout.\n     */\n    QueryProcessor.prototype.processQueries = function (queries) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            var asyncQueries;\n            return __generator(this, function (_a) {\n                this.overrideIfProcessing();\n                this.processedResults = new Array(queries.length);\n                asyncQueries = queries.map(function (query) { return (query instanceof Promise ? query : Promise.resolve(query)); });\n                return [2 /*return*/, racePromises([\n                        this.accumulateResultsChronologically(asyncQueries).then(function () { return _this.buildProcessResults(ProcessingStatus.Finished); }),\n                        this.waitForOverride().then(function () { return _this.buildProcessResults(ProcessingStatus.Overriden); }),\n                        this.waitForTimeout().then(function () { return _this.buildProcessResults(ProcessingStatus.TimedOut); })\n                    ])];\n            });\n        });\n    };\n    QueryProcessor.prototype.overrideIfProcessing = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (this.override) {\n                    this.override();\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    Object.defineProperty(QueryProcessor.prototype, \"orderedResults\", {\n        get: function () {\n            return underscore_1.flatten(this.processedResults.filter(function (result) { return !!result; }), true);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    QueryProcessor.prototype.buildProcessResults = function (status) {\n        return {\n            status: status,\n            results: status !== ProcessingStatus.Overriden ? this.orderedResults : []\n        };\n    };\n    QueryProcessor.prototype.accumulateResultsChronologically = function (queries) {\n        return __awaiter(this, void 0, void 0, function () {\n            var output;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        output = this.processedResults;\n                        return [4 /*yield*/, Promise.all(queries.map(function (query, i) { return query.then(function (items) { return (output[i] = items); }); }))];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    QueryProcessor.prototype.waitForOverride = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            _this.override = function () {\n                _this.override = null;\n                resolve();\n            };\n        });\n    };\n    QueryProcessor.prototype.waitForTimeout = function () {\n        var _this = this;\n        return new Promise(function (resolve) { return setTimeout(function () { return resolve(); }, _this.options.timeout); });\n    };\n    return QueryProcessor;\n}());\nexports.QueryProcessor = QueryProcessor;\n\n\n/***/ }),\n\n/***/ 499:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar NestedQuery_1 = __webpack_require__(491);\nvar QueryExtension_1 = __webpack_require__(493);\nvar Basic_1 = __webpack_require__(128);\nvar Field_1 = __webpack_require__(216);\nvar SubExpression_1 = __webpack_require__(494);\nexports.Complete = {\n    include: [NestedQuery_1.NestedQuery, QueryExtension_1.QueryExtension, SubExpression_1.SubExpression, Field_1.Field, Basic_1.Basic]\n};\n\n\n/***/ }),\n\n/***/ 500:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Grammar_1 = __webpack_require__(176);\nvar _ = __webpack_require__(0);\nfunction loadSubGrammar(expressions, basicExpressions, grammars, subGrammar) {\n    _.each(subGrammar.expressions, function (expression) {\n        if (!_.contains(expressions, expression)) {\n            expressions.push(expression);\n        }\n    });\n    _.each(subGrammar.basicExpressions, function (expression) {\n        if (!_.contains(basicExpressions, expression)) {\n            basicExpressions.push(expression);\n        }\n    });\n    _.each(subGrammar.grammars, function (expressionDef, id) {\n        if (!(id in grammars)) {\n            grammars[id] = expressionDef;\n        }\n        else {\n            if (_.isArray(grammars[id]) && _.isArray(expressionDef)) {\n                _.each(expressionDef, function (value) {\n                    grammars[id].push(value);\n                });\n            }\n            else {\n                _.each(expressionDef, function (value) {\n                    grammars[id].push(value);\n                });\n                throw new Error('Can not merge ' + id + '(' + JSON.stringify(expressionDef) + ' => ' + JSON.stringify(grammars[id]) + ')');\n            }\n        }\n    });\n}\nfunction Expressions() {\n    var subGrammars = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        subGrammars[_i] = arguments[_i];\n    }\n    var expressions = [];\n    var BasicExpression = [];\n    var grammars = {\n        Start: ['Expressions', 'Empty'],\n        Expressions: '[OptionalSpaces][Expression][ExpressionsList*][OptionalSpaces]',\n        ExpressionsList: '[Spaces][Expression]',\n        Expression: expressions,\n        BasicExpression: BasicExpression,\n        OptionalSpaces: / */,\n        Spaces: / +/,\n        Empty: /(?!.)/\n    };\n    for (var i = 0; i < subGrammars.length; i++) {\n        loadSubGrammar(expressions, BasicExpression, grammars, subGrammars[i]);\n        _.each(subGrammars[i].include, function (subGrammar) {\n            if (!_.contains(subGrammars, subGrammar)) {\n                subGrammars.push(subGrammar);\n            }\n        });\n    }\n    expressions.push('BasicExpression');\n    return {\n        start: 'Start',\n        expressions: grammars\n    };\n}\nexports.Expressions = Expressions;\nfunction ExpressionsGrammar() {\n    var subGrammars = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        subGrammars[_i] = arguments[_i];\n    }\n    var grammar = Expressions.apply(this, subGrammars);\n    return new Grammar_1.Grammar(grammar.start, grammar.expressions);\n}\nexports.ExpressionsGrammar = ExpressionsGrammar;\n\n\n/***/ }),\n\n/***/ 501:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Those are the string definitions of events for ResultPreviewsManager.\n *\n * Those events should be bound to the element returned by `resolveRoot`.\n */\nvar ResultPreviewsManagerEvents = /** @class */ (function () {\n    function ResultPreviewsManagerEvents() {\n    }\n    /**\n     * Executed when building a query to fetch result previews.\n     * This always receives {@link IBuildingResultPreviewsQueryEventArgs} as arguments.\n     */\n    ResultPreviewsManagerEvents.buildingResultPreviewsQuery = 'buildingResultPreviewsQuery';\n    /**\n     * Executed when a {@link Suggestion} is focused before {@link PopulateSearchResultPreviews} is called to fetch more options.\n     * This always receives {@link IUpdateResultPreviewsManagerOptionsEventArgs} as arguments.\n     */\n    ResultPreviewsManagerEvents.updateResultPreviewsManagerOptions = 'updateResultPreviewsManagerOptions';\n    /**\n     * Executed when a {@link Suggestion} is focused and waiting for search result previews.\n     * This always receives {@link IPopulateSearchResultPreviewsEventArgs} as arguments.\n     */\n    ResultPreviewsManagerEvents.populateSearchResultPreviews = 'populateSearchResultPreviews';\n    return ResultPreviewsManagerEvents;\n}());\nexports.ResultPreviewsManagerEvents = ResultPreviewsManagerEvents;\n\n\n/***/ }),\n\n/***/ 502:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ComponentOptionsModel_1 = __webpack_require__(28);\nvar QueryboxOptionsProcessing = /** @class */ (function () {\n    function QueryboxOptionsProcessing(owner) {\n        this.owner = owner;\n    }\n    Object.defineProperty(QueryboxOptionsProcessing.prototype, \"options\", {\n        get: function () {\n            return this.owner.options;\n        },\n        set: function (options) {\n            this.owner.options = options;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    QueryboxOptionsProcessing.prototype.postProcess = function () {\n        this.options = __assign({}, this.options, this.owner.componentOptionsModel.get(ComponentOptionsModel_1.ComponentOptionsModel.attributesEnum.searchBox));\n        this.processQueryOnClearVersusEmptyQuery();\n        this.processQueryOnClearVersusSearchAsYouType();\n    };\n    QueryboxOptionsProcessing.prototype.processQueryOnClearVersusEmptyQuery = function () {\n        if (this.options.triggerQueryOnClear && this.owner.searchInterface.options.allowQueriesWithoutKeywords === false) {\n            this.owner.logger.warn('Forcing option triggerQueryOnClear to false, as it is not supported when the search interface is configured to not allow queries without keywords (data-allow-queries-without-keywords=\"false\")', this.owner);\n            this.options.triggerQueryOnClear = false;\n        }\n    };\n    QueryboxOptionsProcessing.prototype.processQueryOnClearVersusSearchAsYouType = function () {\n        if (this.owner.searchInterface.options.allowQueriesWithoutKeywords === true &&\n            this.options.triggerQueryOnClear === false &&\n            this.options.enableSearchAsYouType === true) {\n            this.owner.logger.warn('Forcing option triggerQueryOnClear to true, since search-as-you-type is enabled', this.owner);\n            this.options.triggerQueryOnClear = true;\n        }\n    };\n    return QueryboxOptionsProcessing;\n}());\nexports.QueryboxOptionsProcessing = QueryboxOptionsProcessing;\n\n\n/***/ }),\n\n/***/ 503:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _ = __webpack_require__(0);\nvar MiscModules_1 = __webpack_require__(71);\nvar QueryboxQueryParameters = /** @class */ (function () {\n    function QueryboxQueryParameters(options) {\n        this.options = options;\n    }\n    QueryboxQueryParameters.queryIsBlocked = function () {\n        // This code runs on some assumption :\n        // Since all \"buildingQuery\" events would have to be run in the same call stack\n        // We can add a static flag to block 2 or more query box/omnibox from trying to modify the query inside the same event.\n        // If 2 query box are activated, we get duplicate terms in the query, or duplicate term correction with did you mean.\n        // This means that only one query box/searchbox would be able to modify the query in a single search page.\n        // This also means that if there is 2 search box enabled, the first one in the markup in the page would be able to do the job correctly as far as the query is concerned.\n        // The second one is inactive as far as the query is concerned.\n        // The flag gets reset in \"defer\" (setTimeout 0) so that it gets reset correctly when the query event has finished executing\n        if (!QueryboxQueryParameters.queryIsCurrentlyBlocked) {\n            QueryboxQueryParameters.queryIsCurrentlyBlocked = true;\n            MiscModules_1.Defer.defer(function () { return QueryboxQueryParameters.allowDuplicateQuery(); });\n            return false;\n        }\n        return true;\n    };\n    QueryboxQueryParameters.allowDuplicateQuery = function () {\n        QueryboxQueryParameters.queryIsCurrentlyBlocked = false;\n    };\n    QueryboxQueryParameters.prototype.addParameters = function (queryBuilder, lastQuery) {\n        if (!QueryboxQueryParameters.queryIsBlocked()) {\n            if (this.options.enableWildcards) {\n                queryBuilder.enableWildcards = true;\n            }\n            if (this.options.enableQuestionMarks) {\n                queryBuilder.enableQuestionMarks = true;\n            }\n            if (this.options.enableLowercaseOperators) {\n                queryBuilder.enableLowercaseOperators = true;\n            }\n            if (!_.isEmpty(lastQuery)) {\n                queryBuilder.enableQuerySyntax = this.options.enableQuerySyntax;\n                queryBuilder.expression.add(lastQuery);\n                if (this.options.enablePartialMatch) {\n                    queryBuilder.enablePartialMatch = this.options.enablePartialMatch;\n                    if (this.options.partialMatchKeywords) {\n                        queryBuilder.partialMatchKeywords = this.options.partialMatchKeywords;\n                    }\n                    if (this.options.partialMatchThreshold) {\n                        queryBuilder.partialMatchThreshold = this.options.partialMatchThreshold;\n                    }\n                }\n            }\n        }\n    };\n    QueryboxQueryParameters.queryIsCurrentlyBlocked = false;\n    return QueryboxQueryParameters;\n}());\nexports.QueryboxQueryParameters = QueryboxQueryParameters;\n\n\n/***/ }),\n\n/***/ 556:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar GlobalExports_1 = __webpack_require__(3);\nvar ExpressionConstant_1 = __webpack_require__(215);\nvar ExpressionEndOfInput_1 = __webpack_require__(214);\nvar ExpressionFunction_1 = __webpack_require__(489);\nvar ExpressionList_1 = __webpack_require__(490);\nvar ExpressionOptions_1 = __webpack_require__(486);\nvar ExpressionRef_1 = __webpack_require__(484);\nvar ExpressionRegExp_1 = __webpack_require__(488);\nvar Grammar_1 = __webpack_require__(176);\nvar Grammars_1 = __webpack_require__(557);\nvar InputManager_1 = __webpack_require__(495);\nvar MagicBox_1 = __webpack_require__(218);\nvar MagicBoxUtils_1 = __webpack_require__(219);\nvar OptionResult_1 = __webpack_require__(487);\nvar RefResult_1 = __webpack_require__(485);\nvar Result_1 = __webpack_require__(49);\nvar SuggestionsManager_1 = __webpack_require__(217);\nexports.GrammarsImportedLocally = Grammars_1.Grammars;\nfunction doMagicBoxExport() {\n    GlobalExports_1.exportGlobally({\n        MagicBox: {\n            EndOfInputResult: Result_1.EndOfInputResult,\n            ExpressionConstant: ExpressionConstant_1.ExpressionConstant,\n            ExpressionEndOfInput: ExpressionEndOfInput_1.ExpressionEndOfInput,\n            ExpressionFunction: ExpressionFunction_1.ExpressionFunction,\n            ExpressionList: ExpressionList_1.ExpressionList,\n            ExpressionOptions: ExpressionOptions_1.ExpressionOptions,\n            ExpressionRef: ExpressionRef_1.ExpressionRef,\n            ExpressionRegExp: ExpressionRegExp_1.ExpressionRegExp,\n            Grammar: Grammar_1.Grammar,\n            Grammars: Grammars_1.Grammars,\n            InputManager: InputManager_1.InputManager,\n            Instance: MagicBox_1.MagicBoxInstance,\n            OptionResult: OptionResult_1.OptionResult,\n            RefResult: RefResult_1.RefResult,\n            Result: Result_1.Result,\n            SuggestionsManager: SuggestionsManager_1.SuggestionsManager,\n            Utils: MagicBoxUtils_1.MagicBoxUtils,\n            create: MagicBox_1.createMagicBox,\n            requestAnimationFrame: MagicBox_1.requestAnimationFrame\n        }\n    });\n}\nexports.doMagicBoxExport = doMagicBoxExport;\n\n\n/***/ }),\n\n/***/ 557:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Basic_1 = __webpack_require__(128);\nvar Complete_1 = __webpack_require__(499);\nvar Date_1 = __webpack_require__(492);\nvar Expressions_1 = __webpack_require__(500);\nvar Field_1 = __webpack_require__(216);\nvar NestedQuery_1 = __webpack_require__(491);\nvar QueryExtension_1 = __webpack_require__(493);\nvar SubExpression_1 = __webpack_require__(494);\nexports.Grammars = {\n    Basic: Basic_1.Basic,\n    notInWord: Basic_1.notInWord,\n    notWordStart: Basic_1.notWordStart,\n    Complete: Complete_1.Complete,\n    Date: Date_1.Date,\n    Expressions: Expressions_1.Expressions,\n    ExpressionsGrammar: Expressions_1.ExpressionsGrammar,\n    Field: Field_1.Field,\n    NestedQuery: NestedQuery_1.NestedQuery,\n    QueryExtension: QueryExtension_1.QueryExtension,\n    SubExpression: SubExpression_1.SubExpression\n};\n\n\n/***/ }),\n\n/***/ 558:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar Strings_1 = __webpack_require__(6);\nvar underscore_1 = __webpack_require__(0);\nvar Component_1 = __webpack_require__(7);\nvar SuggestionsManager_1 = __webpack_require__(217);\nvar ResultPreviewsManagerEvents_1 = __webpack_require__(501);\nvar QueryProcessor_1 = __webpack_require__(496);\nvar Utils_1 = __webpack_require__(4);\nvar ResultPreviewsManager = /** @class */ (function () {\n    function ResultPreviewsManager(element, options) {\n        if (options === void 0) { options = {}; }\n        this.element = element;\n        this.options = underscore_1.defaults(options, {\n            previewHeaderText: Strings_1.l('QuerySuggestPreview'),\n            previewHeaderFieldText: Strings_1.l('QuerySuggestPreviewWithField'),\n            previewClass: 'coveo-preview-selectable',\n            selectedClass: 'magic-box-selected'\n        });\n        this.root = Component_1.Component.resolveRoot(element);\n        this.previewsProcessor = new QueryProcessor_1.QueryProcessor({ timeout: this.options.timeout });\n    }\n    Object.defineProperty(ResultPreviewsManager.prototype, \"previewsOwner\", {\n        get: function () {\n            return this.lastDisplayedSuggestion;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResultPreviewsManager.prototype, \"hasPreviews\", {\n        get: function () {\n            return !!this.suggestionsPreviewContainer;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResultPreviewsManager.prototype, \"focusedPreviewElement\", {\n        get: function () {\n            if (!this.hasPreviews) {\n                return null;\n            }\n            var focusedElement = this.suggestionsPreviewContainer.findClass(this.options.selectedClass)[0];\n            if (!focusedElement || !focusedElement.classList.contains(this.options.previewClass)) {\n                return null;\n            }\n            return focusedElement;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResultPreviewsManager.prototype, \"previewElements\", {\n        get: function () {\n            if (!this.hasPreviews) {\n                return [];\n            }\n            return this.suggestionsPreviewContainer.findClass(this.options.previewClass);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResultPreviewsManager.prototype, \"suggestionsListbox\", {\n        get: function () {\n            return Dom_1.$$(Dom_1.$$(this.element).findClass('coveo-magicbox-suggestions')[0]);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResultPreviewsManager.prototype, \"numberOfResultsPerRow\", {\n        get: function () {\n            var previewSelectables = this.suggestionsPreviewContainer.findClass(this.options.previewClass);\n            if (previewSelectables.length === 0) {\n                return 0;\n            }\n            var firstVerticalOffset = previewSelectables[0].offsetTop;\n            var firstIndexOnNextRow = underscore_1.findIndex(previewSelectables, function (previewSelectable) { return previewSelectable.offsetTop !== firstVerticalOffset; });\n            return firstIndexOnNextRow !== -1 ? firstIndexOnNextRow : previewSelectables.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ResultPreviewsManager.prototype, \"previewContainerId\", {\n        get: function () {\n            return \"coveo-previews-for-\" + this.lastDisplayedSuggestion.dom.id;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ResultPreviewsManager.prototype.displaySearchResultPreviewsForSuggestion = function (suggestion) {\n        return __awaiter(this, void 0, void 0, function () {\n            var externalOptions, currentDelay, isQueryForSuggestionOngoing, arePreviewsForSuggestionCurrentlyDisplayed, _a, status, results;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        externalOptions = this.getExternalOptions();\n                        currentDelay = (this.lastDelay = Utils_1.Utils.resolveAfter(Utils_1.Utils.isNullOrUndefined(externalOptions.displayAfterDuration) ? 200 : externalOptions.displayAfterDuration));\n                        return [4 /*yield*/, currentDelay];\n                    case 1:\n                        _b.sent();\n                        if (currentDelay !== this.lastDelay) {\n                            return [2 /*return*/];\n                        }\n                        isQueryForSuggestionOngoing = suggestion && this.lastQueriedSuggestion === suggestion;\n                        if (isQueryForSuggestionOngoing) {\n                            return [2 /*return*/];\n                        }\n                        arePreviewsForSuggestionCurrentlyDisplayed = this.lastDisplayedSuggestion === suggestion;\n                        if (arePreviewsForSuggestionCurrentlyDisplayed) {\n                            this.previewsProcessor.overrideIfProcessing();\n                            this.lastQueriedSuggestion = null;\n                            return [2 /*return*/];\n                        }\n                        this.lastQueriedSuggestion = suggestion;\n                        if (!suggestion) {\n                            this.displaySuggestionPreviews(null, []);\n                            return [2 /*return*/];\n                        }\n                        return [4 /*yield*/, this.getSearchResultPreviewsQuery(suggestion)];\n                    case 2:\n                        _a = _b.sent(), status = _a.status, results = _a.results;\n                        if (status === QueryProcessor_1.ProcessingStatus.Overriden) {\n                            return [2 /*return*/];\n                        }\n                        this.lastQueriedSuggestion = null;\n                        this.displaySuggestionPreviews(suggestion, results);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ResultPreviewsManager.prototype.getElementInDirection = function (direction) {\n        var previewElements = this.previewElements;\n        var focusedIndex = previewElements.indexOf(this.focusedPreviewElement);\n        if (focusedIndex === -1) {\n            return null;\n        }\n        if (focusedIndex === 0 && direction === SuggestionsManager_1.Direction.Left) {\n            return null;\n        }\n        return previewElements[(focusedIndex + this.getIncrementInDirection(direction)) % previewElements.length];\n    };\n    ResultPreviewsManager.prototype.getIncrementInDirection = function (direction) {\n        switch (direction) {\n            case SuggestionsManager_1.Direction.Left:\n                return -1;\n            case SuggestionsManager_1.Direction.Right:\n                return 1;\n            case SuggestionsManager_1.Direction.Up:\n                return -this.numberOfResultsPerRow;\n            case SuggestionsManager_1.Direction.Down:\n                return this.numberOfResultsPerRow;\n        }\n    };\n    ResultPreviewsManager.prototype.setHasPreviews = function (shouldHavePreviews) {\n        if (this.hasPreviews === !!shouldHavePreviews) {\n            return;\n        }\n        if (shouldHavePreviews) {\n            this.initPreviewForSuggestions();\n        }\n        else {\n            this.revertPreviewForSuggestions();\n        }\n    };\n    ResultPreviewsManager.prototype.initPreviewForSuggestions = function () {\n        this.suggestionsPreviewContainer = Dom_1.$$('div', {\n            className: 'coveo-suggestion-container'\n        }, this.suggestionsListbox.el, this.buildPreviewContainer());\n        this.element.appendChild(this.suggestionsPreviewContainer.el);\n        this.suggestionsListbox.setAttribute('aria-controls', this.previewContainerId);\n    };\n    ResultPreviewsManager.prototype.revertPreviewForSuggestions = function () {\n        this.element.appendChild(this.suggestionsListbox.el);\n        this.suggestionsPreviewContainer.remove();\n        this.suggestionsPreviewContainer = null;\n    };\n    ResultPreviewsManager.prototype.buildPreviewContainer = function () {\n        return Dom_1.$$('div', {\n            className: 'coveo-preview-container',\n            id: this.previewContainerId\n        }, (this.resultPreviewsContainer = Dom_1.$$('div', {\n            className: 'coveo-preview-results',\n            role: 'listbox',\n            'aria-orientation': 'horizontal'\n        }))).el;\n    };\n    ResultPreviewsManager.prototype.getExternalOptions = function () {\n        var optionsEventArgs = {};\n        Dom_1.$$(this.root).trigger(ResultPreviewsManagerEvents_1.ResultPreviewsManagerEvents.updateResultPreviewsManagerOptions, optionsEventArgs);\n        return optionsEventArgs;\n    };\n    ResultPreviewsManager.prototype.getSearchResultPreviewsQuery = function (suggestion) {\n        var populateEventArgs = {\n            suggestion: suggestion,\n            previewsQueries: []\n        };\n        Dom_1.$$(this.root).trigger(ResultPreviewsManagerEvents_1.ResultPreviewsManagerEvents.populateSearchResultPreviews, populateEventArgs);\n        return this.previewsProcessor.processQueries(populateEventArgs.previewsQueries);\n    };\n    ResultPreviewsManager.prototype.appendSearchResultPreview = function (preview, position) {\n        this.resultPreviewsContainer.append(preview.element);\n        preview.element.id = \"coveo-result-preview-\" + position;\n        var elementDom = Dom_1.$$(preview.element);\n        elementDom.setAttribute('aria-selected', 'false');\n        elementDom.setAttribute('role', 'option');\n        elementDom.on('click', function () { return preview.onSelect(); });\n        elementDom.on('keyboardSelect', function () { return preview.onSelect(); });\n    };\n    ResultPreviewsManager.prototype.appendSearchResultPreviews = function (previews) {\n        var _this = this;\n        this.resultPreviewsContainer.empty();\n        previews.forEach(function (preview, i) { return _this.appendSearchResultPreview(preview, i); });\n    };\n    ResultPreviewsManager.prototype.displaySuggestionPreviews = function (suggestion, previews) {\n        this.lastDisplayedSuggestion = suggestion;\n        this.setHasPreviews(previews && previews.length > 0);\n        this.element.classList.toggle('magic-box-hasPreviews', this.hasPreviews);\n        if (!this.hasPreviews) {\n            return;\n        }\n        this.appendSearchResultPreviews(previews);\n    };\n    return ResultPreviewsManager;\n}());\nexports.ResultPreviewsManager = ResultPreviewsManager;\n\n\n/***/ }),\n\n/***/ 559:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Dom_1 = __webpack_require__(1);\nvar Strings_1 = __webpack_require__(6);\nvar AccessibleButton_1 = __webpack_require__(15);\nvar MagicBoxClear = /** @class */ (function () {\n    function MagicBoxClear(magicBox) {\n        this.element = Dom_1.$$('div', {\n            className: 'magic-box-clear'\n        });\n        var clearIcon = Dom_1.$$('div', {\n            className: 'magic-box-icon'\n        });\n        this.element.append(clearIcon.el);\n        this.element.insertAfter(Dom_1.$$(magicBox.element).find('input'));\n        new AccessibleButton_1.AccessibleButton()\n            .withElement(this.element)\n            .withLabel(Strings_1.l('Clear'))\n            .withSelectAction(function () { return magicBox.clear(); })\n            .build();\n        this.toggleTabindexAndAriaHidden(false);\n    }\n    MagicBoxClear.prototype.toggleTabindexAndAriaHidden = function (hasText) {\n        var tabindex = hasText ? '0' : '-1';\n        this.element.setAttribute('tabindex', tabindex);\n        this.element.setAttribute('aria-hidden', \"\" + !hasText);\n    };\n    return MagicBoxClear;\n}());\nexports.MagicBoxClear = MagicBoxClear;\n\n\n/***/ }),\n\n/***/ 560:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// Querybox.min__56ae39b439f98c73a62b.js","import { SubGrammar } from './Expressions';\nimport { Expression } from '../Expression/Expression';\nimport { Result } from '../Result/Result';\nimport { EndOfInputResult } from '../Result/Result';\n\nexport const notWordStart = ' ()[],$@\\'\"';\nexport const notInWord = ' ()[],:';\n\nexport const Basic: SubGrammar = {\n  basicExpressions: ['Word', 'DoubleQuoted'],\n  grammars: {\n    DoubleQuoted: '\"[NotDoubleQuote]\"',\n    NotDoubleQuote: /[^\"]*/,\n    SingleQuoted: \"'[NotSingleQuote]'\",\n    NotSingleQuote: /[^']*/,\n    Number: /-?(0|[1-9]\\d*)(\\.\\d+)?/,\n    Word: (input: string, end: boolean, expression: Expression) => {\n      const regex = new RegExp('[^' + notWordStart.replace(/(.)/g, '\\\\$1') + '][^' + notInWord.replace(/(.)/g, '\\\\$1') + ']*');\n      let groups = input.match(regex);\n      if (groups != null && groups.index != 0) {\n        groups = null;\n      }\n      const result = new Result(groups != null ? groups[0] : null, expression, input);\n      if (result.isSuccess() && end && input.length > result.value.length) {\n        return new EndOfInputResult(result);\n      }\n      return result;\n    }\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/Basic.ts","import 'styling/_Querybox';\nimport { IBuildingQueryEventArgs, QueryEvents } from '../../events/QueryEvents';\nimport { StandaloneSearchInterfaceEvents } from '../../events/StandaloneSearchInterfaceEvents';\nimport { exportGlobally } from '../../GlobalExports';\nimport { Grammar } from '../../magicbox/Grammar';\nimport { createMagicBox, MagicBoxInstance } from '../../magicbox/MagicBox';\nimport { Result } from '../../magicbox/Result/Result';\nimport { Assert } from '../../misc/Assert';\nimport { IAttributeChangedEventArg, MODEL_EVENTS } from '../../models/Model';\nimport { QueryStateModel, QUERY_STATE_ATTRIBUTES } from '../../models/QueryStateModel';\nimport { l } from '../../strings/Strings';\nimport { $$ } from '../../utils/Dom';\nimport { analyticsActionCauseList, IAnalyticsNoMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { Initialization } from '../Base/Initialization';\nimport { QueryboxOptionsProcessing } from './QueryboxOptionsProcessing';\nimport { QueryboxQueryParameters } from './QueryboxQueryParameters';\n\nexport interface IQueryboxOptions {\n  enableSearchAsYouType?: boolean;\n  searchAsYouTypeDelay?: number;\n  enableQuerySyntax?: boolean;\n  enableWildcards?: boolean;\n  enableQuestionMarks?: boolean;\n  enableLowercaseOperators?: boolean;\n  enablePartialMatch?: boolean;\n  partialMatchKeywords?: number;\n  partialMatchThreshold?: string;\n  placeholder?: string;\n  triggerQueryOnClear?: boolean;\n}\n\n/**\n * The `Querybox` component renders an input which the end user can interact with to enter and submit queries.\n *\n * When the end user submits a search request, the `Querybox` component triggers a query and logs the corresponding\n * usage analytics data.\n *\n * For technical reasons, it is necessary to instantiate this component on a `div` element rather than on an `input`\n * element.\n *\n * See also the [`Searchbox`]{@link Searchbox} component, which can automatically instantiate a `Querybox` along with an\n * optional [`SearchButton`]{@link SearchButton} component.\n */\nexport class Querybox extends Component {\n  static ID = 'Querybox';\n\n  static doExport = () => {\n    exportGlobally({\n      Querybox: Querybox,\n      QueryboxQueryParameters: QueryboxQueryParameters\n    });\n  };\n\n  /**\n   * The options for the Querybox.\n   * @componentOptions\n   */\n  public static options: IQueryboxOptions = {\n    /**\n     * Whether to enable the search-as-you-type feature.\n     *\n     * **Note:** Enabling this feature can consume lots of queries per month (QPM), especially if the [`searchAsYouTypeDelay`]{@link Querybox.options.searchAsYouTypeDelay} option is set to a low value.\n     *\n     * Default value is `false`.\n     */\n    enableSearchAsYouType: ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'Advanced Options' }),\n\n    /**\n     * If the [`enableSearchAsYouType`]{@link Querybox.options.enableSearchAsYouType} option is `true`, specifies how\n     * long to wait (in milliseconds) between each key press before triggering a new query.\n     *\n     * Default value is `50`. Minimum value is `0`\n     */\n    searchAsYouTypeDelay: ComponentOptions.buildNumberOption({ defaultValue: 50, min: 0, section: 'Advanced Options' }),\n\n    /**\n     * Specifies whether to interpret special query syntax (e.g., `@objecttype=message`) when the end user types\n     * a query in the `Querybox` (see\n     * [Coveo Query Syntax Reference](https://www.coveo.com/go?dest=adminhelp70&lcid=9&context=10005)). Setting this\n     * option to `true` also causes the `Querybox` to highlight any query syntax.\n     *\n     * Regardless of the value of this option, the Coveo Cloud REST Search API always interprets expressions surrounded\n     * by double quotes (`\"`) as exact phrase match requests.\n     *\n     * See also [`enableLowercaseOperators`]{@link Querybox.options.enableLowercaseOperators}.\n     *\n     * **Notes:**\n     * > * End user preferences can override the value you specify for this option.\n     * >\n     * > If the end user selects a value other than **Automatic** for the **Enable query syntax** setting (see\n     * > the [`enableQuerySyntax`]{@link ResultsPreferences.options.enableQuerySyntax} option of the\n     * > [`ResultsPreferences`]{@link ResultsPreferences} component), the end user preference takes precedence over this\n     * > option.\n     * >\n     * > * On-premises versions of the Coveo Search API require this option to be set to `true` in order to interpret\n     * > expressions surrounded by double quotes (`\"`) as exact phrase match requests.\n     *\n     * Default value is `false`.\n     */\n    enableQuerySyntax: ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'Advanced Options' }),\n\n    /**\n     * Specifies whether to expand basic expression keywords containing wildcards characters (`*`) to the possible\n     * matching keywords in order to broaden the query (see\n     * [Using Wildcards in Queries](https://docs.coveo.com/en/1580/)).\n     *\n     * See also [`enableQuestionMarks`]{@link Querybox.options.enableQuestionMarks}.\n     *\n     *  **Note:**\n     * > If you are using an on-premises version of the Coveo Search API, you need to set the\n     * > [`enableQuerySyntax`]{@link Querybox.options.enableQuerySyntax} option to `true` to be able to set\n     * > `enableWildcards` to `true`.\n     *\n     * Default value is `false`.\n     */\n    enableWildcards: ComponentOptions.buildBooleanOption({ defaultValue: false, section: 'Advanced Options' }),\n\n    /**\n     * If [`enableWildcards`]{@link Querybox.options.enableWildcards} is `true`, specifies whether to expand basic\n     * expression keywords containing question mark characters (`?`) to the possible matching keywords in order to\n     * broaden the query (see\n     * [Using Wildcards in Queries](https://docs.coveo.com/en/1580/)).\n     *\n     * **Note:**\n     * > If you are using an on-premises version of the Coveo Search API, you also need to set the\n     * > [`enableQuerySyntax`]{@link Querybox.options.enableQuerySyntax} option to `true` in order to be able to set\n     * > `enableQuestionMarks` to `true`.\n     *\n     * Default value is `false`.\n     */\n    enableQuestionMarks: ComponentOptions.buildBooleanOption({ defaultValue: false, depend: 'enableWildcards' }),\n\n    /**\n     * If the [`enableQuerySyntax`]{@link Querybox.options.enableQuerySyntax} option is `true`, specifies whether to\n     * interpret the `AND`, `NOT`, `OR`, and `NEAR` keywords in the `Querybox` as query operators in the query, even if\n     * the end user types those keywords in lowercase.\n     *\n     * This option applies to all query operators (see\n     * [Coveo Query Syntax Reference](https://www.coveo.com/go?dest=adminhelp70&lcid=9&context=10005)).\n     *\n     * **Example:**\n     * > If this option and the `enableQuerySyntax` option are both `true`, the Coveo Platform interprets the `near`\n     * > keyword in a query such as `service center near me` as the `NEAR` query operator (not as a query term).\n     *\n     * > Otherwise, if the `enableQuerySyntax` option is `true` and this option is `false`, the end user has to type the\n     * > `NEAR` keyword in uppercase for the Coveo Platform to interpret it as a query operator.\n     *\n     * Default value is `false`.\n     */\n    enableLowercaseOperators: ComponentOptions.buildBooleanOption({ defaultValue: false, depend: 'enableQuerySyntax' }),\n\n    /**\n     * Whether to convert a basic expression containing at least a certain number of keywords (see the\n     * [`partialMatchKeywords`]{@link Querybox.options.partialMatchKeywords} option) to *partial match expression*, so\n     * that items containing at least a certain number of those keywords (see the\n     * [`partialMatchThreshold`]{@link Querybox.options.partialMatchThreshold} option) will match the expression.\n     *\n     * **Notes:**\n     * - Only the basic expression of the query (see [`q`]{@link q}) can be converted to a partial match expression.\n     * - When the [`enableQuerySyntax`]{@link Querybox.options.enableQuerySyntax} option is set to `true`, this feature has no effect if the basic expression contains advanced query syntax (field expressions, operators, etc.).\n     *\n     * @notSupportedIn salesforcefree\n     */\n    enablePartialMatch: ComponentOptions.buildBooleanOption({ defaultValue: false }),\n\n    /**\n     * The minimum number of keywords that need to be present in the basic expression to convert it to a partial match expression.\n     *\n     * See also the [`partialMatchThreshold`]{@link Querybox.options.partialMatchThreshold} option.\n     *\n     * **Notes:**\n     *\n     * - Repeated keywords count as a single keyword.\n     * - Thesaurus expansions count towards the `partialMatchKeywords` count.\n     * - Stemming expansions **do not** count towards the `partialMatchKeywords` count.\n     *\n     * @notSupportedIn salesforcefree\n     */\n    partialMatchKeywords: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 1, depend: 'enablePartialMatch' }),\n\n    /**\n     * An absolute or relative value indicating the minimum number of partial match expression keywords an item must contain to match the expression.\n     *\n     * See also the [`partialMatchKeywords`]{@link Querybox.options.partialMatchKeywords} option.\n     *\n     * **Notes:**\n     * - A keyword and its stemming expansions count as a single keyword when evaluating whether an item meets the `partialMatchThreshold`.\n     * - When a relative `partialMatchThreshold` does not yield a whole integer, the fractional part is truncated (e.g., `3.6` becomes `3`).\n     *\n     * @notSupportedIn salesforcefree\n     */\n    partialMatchThreshold: ComponentOptions.buildStringOption({ defaultValue: '50%', depend: 'enablePartialMatch' }),\n\n    /**\n     * Whether to trigger a query when clearing the `Querybox`.\n     *\n     * Default value is `false`.\n     */\n    triggerQueryOnClear: ComponentOptions.buildBooleanOption({ defaultValue: false })\n  };\n  MagicBoxImpl;\n\n  public magicBox: MagicBoxInstance;\n  private lastQuery: string;\n  private searchAsYouTypeTimeout: number;\n\n  /**\n   * Creates a new `Querybox component`. Creates a new `Coveo.Magicbox` instance and wraps the Magicbox methods\n   * (`onblur`, `onsubmit` etc.). Binds event on `buildingQuery` and before redirection (for standalone box).\n   * @param element The HTMLElement on which to instantiate the component. This cannot be an HTMLInputElement for\n   * technical reasons.\n   * @param options The options for the `Querybox` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   */\n  constructor(public element: HTMLElement, public options?: IQueryboxOptions, public bindings?: IComponentBindings) {\n    super(element, Querybox.ID, bindings);\n\n    if (element instanceof HTMLInputElement) {\n      this.logger.error('Querybox cannot be used on an HTMLInputElement');\n    }\n\n    this.options = ComponentOptions.initComponentOptions(element, Querybox, options);\n    new QueryboxOptionsProcessing(this).postProcess();\n\n    $$(this.element).toggleClass('coveo-query-syntax-disabled', this.options.enableQuerySyntax == false);\n    this.magicBox = createMagicBox(\n      element,\n      new Grammar('Query', {\n        Query: '[Term*][Spaces?]',\n        Term: '[Spaces?][Word]',\n        Spaces: / +/,\n        Word: /[^ ]+/\n      }),\n      {\n        inline: true\n      }\n    );\n\n    const input = $$(this.magicBox.element).find('input');\n    if (input) {\n      $$(input).setAttribute('aria-label', this.options.placeholder || l('Search'));\n    }\n\n    this.bind.onRootElement(QueryEvents.buildingQuery, (args: IBuildingQueryEventArgs) => this.handleBuildingQuery(args));\n    this.bind.onRootElement(StandaloneSearchInterfaceEvents.beforeRedirect, () => this.updateQueryState());\n    this.bind.onQueryState(MODEL_EVENTS.CHANGE_ONE, QUERY_STATE_ATTRIBUTES.Q, (args: IAttributeChangedEventArg) =>\n      this.handleQueryStateChanged(args)\n    );\n\n    if (this.options.enableSearchAsYouType) {\n      $$(this.element).addClass('coveo-search-as-you-type');\n      this.magicBox.onchange = () => {\n        this.searchAsYouType();\n      };\n    }\n\n    this.magicBox.onsubmit = () => {\n      this.submit();\n    };\n\n    this.magicBox.onblur = () => {\n      this.updateQueryState();\n    };\n\n    this.magicBox.onclear = () => {\n      this.updateQueryState();\n      if (this.options.triggerQueryOnClear) {\n        this.usageAnalytics.logSearchEvent<IAnalyticsNoMeta>(analyticsActionCauseList.searchboxClear, {});\n        this.triggerNewQuery(false);\n      }\n    };\n  }\n\n  /**\n   * Adds the current content of the input to the query and triggers a query if the current content of the input has\n   * changed since last submit.\n   *\n   * Also logs the `serachboxSubmit` event in the usage analytics.\n   */\n  public submit(): void {\n    this.magicBox.clearSuggestion();\n    this.updateQueryState();\n    this.usageAnalytics.logSearchEvent<IAnalyticsNoMeta>(analyticsActionCauseList.searchboxSubmit, {});\n    this.triggerNewQuery(false);\n  }\n\n  /**\n   * Sets the content of the input.\n   *\n   * @param text The string to set in the input.\n   */\n  public setText(text: string): void {\n    this.magicBox.setText(text);\n    this.updateQueryState();\n  }\n\n  /**\n   * Clears the content of the input.\n   *\n   * See also the [`triggerQueryOnClear`]{@link Querybox.options.triggerQueryOnClear} option.\n   */\n  public clear(): void {\n    this.magicBox.clear();\n  }\n\n  /**\n   * Gets the content of the input.\n   *\n   * @returns {string} The content of the input.\n   */\n  public getText(): string {\n    return this.magicBox.getText();\n  }\n\n  /**\n   * Gets the result from the input.\n   *\n   * @returns {Result} The result.\n   */\n  public getResult() {\n    return this.magicBox.getResult();\n  }\n\n  /**\n   * Gets the displayed result from the input.\n   *\n   * @returns {Result} The displayed result.\n   */\n  public getDisplayedResult(): Result {\n    return this.magicBox.getDisplayedResult();\n  }\n\n  /**\n   * Gets the current cursor position in the input.\n   *\n   * @returns {number} The cursor position (index starts at 0).\n   */\n  public getCursor(): number {\n    return this.magicBox.getCursor();\n  }\n\n  /**\n   * Gets the result at cursor position.\n   *\n   * @param match {string | { (result): boolean }} The match condition.\n   *\n   * @returns {Result[]} The result.\n   */\n  public resultAtCursor(match?: string | { (result): boolean }) {\n    return this.magicBox.resultAtCursor(match);\n  }\n\n  private handleBuildingQuery(args: IBuildingQueryEventArgs): void {\n    Assert.exists(args);\n    Assert.exists(args.queryBuilder);\n\n    this.updateQueryState();\n    this.lastQuery = this.magicBox.getText();\n    new QueryboxQueryParameters(this.options).addParameters(args.queryBuilder, this.lastQuery);\n  }\n\n  private triggerNewQuery(searchAsYouType: boolean): void {\n    clearTimeout(this.searchAsYouTypeTimeout);\n    let text = this.magicBox.getText();\n    if (this.lastQuery != text && text != null) {\n      this.lastQuery = text;\n      this.queryController.executeQuery({\n        searchAsYouType: searchAsYouType,\n        logInActionsHistory: true\n      });\n    }\n  }\n\n  private updateQueryState(): void {\n    this.queryStateModel.set(QueryStateModel.attributesEnum.q, this.magicBox.getText());\n  }\n\n  private handleQueryStateChanged(args: IAttributeChangedEventArg): void {\n    Assert.exists(args);\n    let q = <string>args.value;\n    if (q != this.magicBox.getText()) {\n      this.magicBox.setText(q);\n    }\n  }\n\n  private searchAsYouType(): void {\n    clearTimeout(this.searchAsYouTypeTimeout);\n    this.searchAsYouTypeTimeout = window.setTimeout(() => {\n      this.usageAnalytics.logSearchAsYouType<IAnalyticsNoMeta>(analyticsActionCauseList.searchboxAsYouType, {});\n      this.triggerNewQuery(true);\n    }, this.options.searchAsYouTypeDelay);\n  }\n}\nInitialization.registerAutoCreateComponent(Querybox);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Querybox/Querybox.ts","import { ExpressionRef } from './Expression/ExpressionRef';\nimport { Expression, ExpressionDef } from './Expression/Expression';\nimport { ExpressionOptions } from './Expression/ExpressionOptions';\nimport { ExpressionRegExp } from './Expression/ExpressionRegExp';\nimport _ = require('underscore');\nimport { ExpressionFunction, ExpressionFunctionArgument } from './Expression/ExpressionFunction';\nimport { ExpressionConstant } from './Expression/ExpressionConstant';\nimport { ExpressionList } from './Expression/ExpressionList';\nimport { Result } from './Result/Result';\n\nexport class Grammar {\n  public start: ExpressionRef;\n  public expressions: { [id: string]: Expression } = {};\n\n  constructor(start: string, expressions: { [id: string]: ExpressionDef } = {}) {\n    this.start = new ExpressionRef(start, null, 'start', this);\n    this.addExpressions(expressions);\n  }\n\n  public addExpressions(expressions: { [id: string]: ExpressionDef }) {\n    _.each(expressions, (basicExpression: ExpressionDef, id: string) => {\n      this.addExpression(id, basicExpression);\n    });\n  }\n\n  public addExpression(id: string, basicExpression: ExpressionDef) {\n    if (id in this.expressions) {\n      throw new Error('Grammar already contain the id:' + id);\n    }\n    this.expressions[id] = Grammar.buildExpression(basicExpression, id, this);\n  }\n\n  public getExpression(id: string) {\n    return this.expressions[id];\n  }\n\n  public parse(value: string): Result {\n    return this.start.parse(value, true);\n  }\n\n  public static buildExpression(value: ExpressionDef, id: string, grammar: Grammar): Expression {\n    const type = typeof value;\n    if (type == 'undefined') {\n      throw new Error('Invalid Expression: ' + value);\n    }\n    if (_.isString(value)) {\n      return this.buildStringExpression(<string>value, id, grammar);\n    }\n    if (_.isArray(value)) {\n      return new ExpressionOptions(_.map(<string[]>value, (v: string, i) => new ExpressionRef(v, null, id + '_' + i, grammar)), id);\n    }\n    if (_.isRegExp(value)) {\n      return new ExpressionRegExp(<RegExp>value, id, grammar);\n    }\n    if (_.isFunction(value)) {\n      return new ExpressionFunction(<ExpressionFunctionArgument>value, id, grammar);\n    }\n    throw new Error('Invalid Expression: ' + value);\n  }\n\n  public static buildStringExpression(value: string, id: string, grammar: Grammar): Expression {\n    const matchs = Grammar.stringMatch(value, Grammar.spliter);\n    const expressions = _.map(matchs, (match: string[], i: number): Expression => {\n      if (match[1]) {\n        // Ref\n        const ref = match[1];\n        const occurrence = match[3] ? Number(match[3]) : match[2] || null;\n        return new ExpressionRef(ref, occurrence, id + '_' + i, grammar);\n      } else {\n        // Constant\n        return new ExpressionConstant(match[4], id + '_' + i);\n      }\n    });\n    if (expressions.length == 1) {\n      const expression = expressions[0];\n      expression.id = id;\n      return expression;\n    } else {\n      return new ExpressionList(expressions, id);\n    }\n  }\n\n  public static stringMatch(str: string, re: RegExp) {\n    const groups: string[][] = [];\n    const cloneRegExp = new RegExp(re.source, 'g');\n    let group: RegExpExecArray = cloneRegExp.exec(str);\n\n    while (group !== null) {\n      groups.push(group);\n      group = cloneRegExp.exec(str);\n    }\n    return groups;\n  }\n\n  static spliter = /\\[(\\w+)(\\*|\\+|\\?|\\{([1-9][0-9]*)\\})?\\]|(.[^\\[]*)/;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammar.ts","import { Expression } from './Expression';\n\nexport const ExpressionEndOfInput: Expression = {\n  id: 'end of input',\n  parse: null\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Expression/ExpressionEndOfInput.ts","import { Expression } from './Expression';\nimport { Result } from '../Result/Result';\nimport { EndOfInputResult } from '../Result/Result';\n\nexport class ExpressionConstant implements Expression {\n  constructor(public value: string, public id: string) {}\n\n  public parse(input: string, end: boolean): Result {\n    // the value must be at the start of the input\n    var success = input.indexOf(this.value) == 0;\n    var result = new Result(success ? this.value : null, this, input);\n    // if is successful and we require the end but the length of parsed is\n    // lower than the input length, return a EndOfInputExpected Result\n    if (success && end && input.length > this.value.length) {\n      return new EndOfInputResult(result);\n    }\n    return result;\n  }\n\n  public toString() {\n    return this.value;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Expression/ExpressionConstant.ts","import { Basic } from './Basic';\nimport { SubGrammar } from './Expressions';\nimport { Date } from './Date';\nexport const Field: SubGrammar = {\n  basicExpressions: ['FieldSimpleQuery', 'FieldQuery', 'Field'],\n  grammars: {\n    FieldQuery: '[Field][OptionalSpaces][FieldQueryOperation]',\n    FieldQueryOperation: ['FieldQueryValue', 'FieldQueryNumeric'],\n    FieldQueryValue: '[FieldOperator][OptionalSpaces][FieldValue]',\n    FieldQueryNumeric: '[FieldOperatorNumeric][OptionalSpaces][FieldValueNumeric]',\n    FieldSimpleQuery: '[FieldName]:[OptionalSpaces][FieldValue]',\n    Field: '@[FieldName]',\n    FieldName: /[a-zA-Z][a-zA-Z0-9\\.\\_]*/,\n    FieldOperator: /==|=|<>/,\n    FieldOperatorNumeric: /<=|>=|<|>/,\n    FieldValue: ['DateRange', 'NumberRange', 'DateRelative', 'Date', 'Number', 'FieldValueList', 'FieldValueString'],\n    FieldValueNumeric: ['DateRelative', 'Date', 'Number'],\n    FieldValueString: ['DoubleQuoted', 'FieldValueNotQuoted'],\n    FieldValueList: '([FieldValueString][FieldValueStringList*])',\n    FieldValueStringList: '[FieldValueSeparator][FieldValueString]',\n    FieldValueSeparator: / *, */,\n    FieldValueNotQuoted: /[^ \\(\\)\\[\\],]+/,\n    NumberRange: '[Number][Spaces?]..[Spaces?][Number]'\n  },\n  include: [Date, Basic]\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/Field.ts","import { defaults, indexOf, find } from 'underscore';\nimport { IQuerySuggestSelection, OmniboxEvents } from '../events/OmniboxEvents';\nimport { Component } from '../ui/Base/Component';\nimport { $$, Dom } from '../utils/Dom';\nimport { InputManager } from './InputManager';\nimport { ResultPreviewsManager } from './ResultPreviewsManager';\nimport { QueryProcessor, ProcessingStatus } from './QueryProcessor';\nimport { QueryUtils } from '../utils/QueryUtils';\n\nexport interface Suggestion {\n  text?: string;\n  index?: number;\n  html?: string;\n  dom?: HTMLElement;\n  separator?: string;\n  advancedQuery?: string;\n  onSelect?: () => void;\n}\n\nexport interface SuggestionsManagerOptions {\n  suggestionClass?: string;\n  selectedClass?: string;\n  timeout?: number;\n  previewHeaderText?: string;\n}\n\nexport enum Direction {\n  Up = 'Up',\n  Down = 'Down',\n  Left = 'Left',\n  Right = 'Right'\n}\n\nexport class SuggestionsManager {\n  public suggestionsListbox: Dom;\n  private suggestionsProcessor: QueryProcessor<Suggestion>;\n  private currentSuggestions: Suggestion[];\n  private options: SuggestionsManagerOptions;\n  private keyboardFocusedElement: HTMLElement;\n  private resultPreviewsManager: ResultPreviewsManager;\n  private root: HTMLElement;\n  private suggestionListboxID = `coveo-magicbox-suggestions-${QueryUtils.createGuid()}`;\n  private suggestionListboxClassName = `coveo-magicbox-suggestions`;\n\n  public get hasSuggestions() {\n    return this.currentSuggestions && this.currentSuggestions.length > 0;\n  }\n\n  public get hasFocus() {\n    return $$(this.element).findClass(this.options.selectedClass).length > 0;\n  }\n\n  public get hasPreviews() {\n    return this.resultPreviewsManager.hasPreviews;\n  }\n\n  private get focusedSuggestion() {\n    return find(this.currentSuggestions, suggestion => suggestion.dom.classList.contains(this.options.selectedClass));\n  }\n\n  constructor(\n    private element: HTMLElement,\n    private magicBoxContainer: HTMLElement,\n    private inputManager: InputManager,\n    options?: SuggestionsManagerOptions\n  ) {\n    this.root = Component.resolveRoot(element);\n    this.options = defaults(options, <SuggestionsManagerOptions>{\n      suggestionClass: 'magic-box-suggestion',\n      selectedClass: 'magic-box-selected'\n    });\n    // Put in a sane default, so as to not reject every suggestions if not set on initialization\n    if (this.options.timeout == undefined) {\n      this.options.timeout = 500;\n    }\n\n    $$(this.element).on('mouseover', e => {\n      this.handleMouseOver(e);\n    });\n\n    $$(this.element).on('mouseout', e => {\n      this.handleMouseOut(e);\n    });\n\n    this.suggestionsProcessor = new QueryProcessor({ timeout: this.options.timeout });\n    this.resultPreviewsManager = new ResultPreviewsManager(element, {\n      selectedClass: this.options.selectedClass,\n      timeout: this.options.timeout\n    });\n    this.suggestionsListbox = this.buildSuggestionsContainer();\n    $$(this.element).append(this.suggestionsListbox.el);\n    this.addAccessibilityProperties();\n    this.appendEmptySuggestionOption();\n  }\n\n  public handleMouseOver(e) {\n    const target = $$(<HTMLElement>e.target);\n    const parents = target.parents(this.options.suggestionClass);\n    if (target.hasClass(this.options.suggestionClass)) {\n      this.processMouseSelection(target.el);\n    } else if (parents.length > 0 && this.element.contains(parents[0])) {\n      this.processMouseSelection(parents[0]);\n    }\n  }\n\n  public handleMouseOut(e) {\n    const target = $$(<HTMLElement>e.target);\n    const targetParents = target.parents(this.options.suggestionClass);\n\n    //e.relatedTarget is not available if moving off the browser window or is an empty object `{}` when moving out of namespace in LockerService.\n    if (e.relatedTarget && $$(e.relatedTarget).isValid()) {\n      const relatedTargetParents = $$(<HTMLElement>e.relatedTarget).parents(this.options.suggestionClass);\n      if (target.hasClass(this.options.selectedClass) && !$$(<HTMLElement>e.relatedTarget).hasClass(this.options.suggestionClass)) {\n        this.removeSelectedStatus(target.el);\n      } else if (relatedTargetParents.length == 0 && targetParents.length > 0) {\n        this.removeSelectedStatus(targetParents[0]);\n      }\n    } else {\n      if (target.hasClass(this.options.selectedClass)) {\n        this.removeSelectedStatus(target.el);\n      } else if (targetParents.length > 0) {\n        this.removeSelectedStatus(targetParents[0]);\n      }\n    }\n    $$(this.root).trigger(OmniboxEvents.querySuggestLoseFocus);\n  }\n\n  public async moveDown() {\n    await this.move(Direction.Down);\n  }\n\n  public async moveUp() {\n    await this.move(Direction.Up);\n  }\n\n  public async moveLeft() {\n    await this.move(Direction.Left);\n  }\n\n  public async moveRight() {\n    await this.move(Direction.Right);\n  }\n\n  public selectAndReturnKeyboardFocusedElement(): HTMLElement {\n    const selected = this.keyboardFocusedElement;\n    if (selected) {\n      $$(selected).trigger('keyboardSelect');\n      // By definition, once an element has been \"selected\" with the keyboard,\n      // it is not longer \"active\" since the event has been processed.\n      this.keyboardFocusedElement = null;\n      this.inputManager.blur();\n    }\n    return selected;\n  }\n\n  public clearKeyboardFocusedElement() {\n    this.keyboardFocusedElement = null;\n  }\n\n  public async receiveSuggestions(suggestions: (Promise<Suggestion[]> | Suggestion[])[]) {\n    const { results, status } = await this.suggestionsProcessor.processQueries(suggestions);\n    if (status === ProcessingStatus.Overriden) {\n      return [];\n    }\n    this.updateSuggestions(results);\n    return results;\n  }\n\n  public clearSuggestions() {\n    this.updateSuggestions([]);\n  }\n\n  public updateSuggestions(suggestions: Suggestion[]) {\n    this.suggestionsListbox.empty();\n    this.inputManager.activeDescendant = null;\n\n    this.currentSuggestions = suggestions;\n\n    $$(this.element).toggleClass('magic-box-hasSuggestion', this.hasSuggestions);\n    this.inputManager.expanded = this.hasSuggestions;\n\n    this.resultPreviewsManager.displaySearchResultPreviewsForSuggestion(null);\n\n    if (!this.hasSuggestions) {\n      this.appendEmptySuggestionOption();\n      $$(this.root).trigger(OmniboxEvents.querySuggestLoseFocus);\n      return;\n    }\n\n    suggestions\n      .sort((a, b) => (b.index || 0) - (a.index || 0))\n      .forEach(suggestion => {\n        const dom = suggestion.dom ? this.modifyDomFromExistingSuggestion(suggestion.dom) : this.createDomFromSuggestion(suggestion);\n\n        dom.setAttribute('id', `magic-box-suggestion-${indexOf(suggestions, suggestion)}`);\n        dom.setAttribute('role', 'option');\n        dom.setAttribute('aria-selected', 'false');\n        dom.setAttribute('aria-label', dom.text());\n\n        dom['suggestion'] = suggestion;\n        this.suggestionsListbox.append(dom.el);\n      });\n\n    $$(this.root).trigger(OmniboxEvents.querySuggestRendered);\n  }\n\n  public get selectedSuggestion(): Suggestion {\n    if (this.htmlElementIsSuggestion(this.keyboardFocusedElement)) {\n      return this.returnMoved(this.keyboardFocusedElement) as Suggestion;\n    }\n    return null;\n  }\n\n  private async processKeyboardSelection(suggestion: HTMLElement) {\n    this.addSelectedStatus(suggestion);\n    this.keyboardFocusedElement = suggestion;\n    await this.updateSelectedSuggestion(this.focusedSuggestion);\n  }\n\n  private processKeyboardPreviewSelection(preview: HTMLElement) {\n    this.addSelectedStatus(preview);\n    this.keyboardFocusedElement = preview;\n  }\n\n  private processMouseSelection(suggestion: HTMLElement) {\n    this.addSelectedStatus(suggestion);\n    this.updateSelectedSuggestion(this.focusedSuggestion);\n    this.keyboardFocusedElement = null;\n  }\n\n  private buildSuggestionsContainer() {\n    return $$('div', {\n      className: this.suggestionListboxClassName,\n      id: this.suggestionListboxID,\n      role: 'listbox',\n      ariaLabel: 'Search Suggestions'\n    });\n  }\n\n  private createDomFromSuggestion(suggestion: Suggestion) {\n    const dom = $$('div', {\n      className: `magic-box-suggestion ${this.options.suggestionClass}`\n    });\n\n    suggestion.dom = dom.el;\n\n    dom.on('click', () => {\n      this.selectSuggestion(suggestion);\n    });\n\n    dom.on('keyboardSelect', () => {\n      this.selectSuggestion(suggestion);\n    });\n\n    if (suggestion.html) {\n      dom.el.innerHTML = suggestion.html;\n      return dom;\n    }\n\n    if (suggestion.text) {\n      dom.text(suggestion.text);\n\n      return dom;\n    }\n\n    if (suggestion.separator) {\n      dom.addClass('magic-box-suggestion-seperator');\n      const suggestionLabel = $$(\n        'div',\n        {\n          className: 'magic-box-suggestion-seperator-label'\n        },\n        suggestion.separator\n      );\n      dom.append(suggestionLabel.el);\n      return dom;\n    }\n\n    return dom;\n  }\n\n  private selectSuggestion(suggestion: Suggestion) {\n    suggestion.onSelect();\n    $$(this.root).trigger(OmniboxEvents.querySuggestSelection, <IQuerySuggestSelection>{ suggestion: suggestion.text });\n  }\n\n  private appendEmptySuggestionOption() {\n    // Accessibility tools reports that a listbox element must always have at least one child with an option\n    // Even if there is no suggestions to show.\n    this.suggestionsListbox.append($$('div', { role: 'option' }).el);\n  }\n\n  private modifyDomFromExistingSuggestion(dom: HTMLElement) {\n    // this need to be done if the selection is in cache and the dom is set in the suggestion\n    this.removeSelectedStatus(dom);\n    const found = dom.classList.contains(this.options.suggestionClass) ? dom : $$(dom).find('.' + this.options.suggestionClass);\n    this.removeSelectedStatus(found);\n    return $$(dom);\n  }\n\n  private async move(direction: Direction) {\n    if (this.resultPreviewsManager.focusedPreviewElement) {\n      await this.moveWithinPreview(direction);\n      return;\n    }\n    if (direction === Direction.Right || direction === Direction.Left) {\n      const firstPreview = this.resultPreviewsManager.previewElements[0];\n      if (firstPreview) {\n        this.processKeyboardPreviewSelection(firstPreview);\n        return;\n      }\n    }\n    await this.moveWithinSuggestion(direction);\n  }\n\n  private async moveWithinSuggestion(direction: Direction) {\n    const currentlySelected = $$(this.element).find(`.${this.options.selectedClass}`);\n    const selectables = $$(this.element).findAll(`.${this.options.suggestionClass}`);\n    const currentIndex = indexOf(selectables, currentlySelected);\n\n    let index = direction === Direction.Up ? currentIndex - 1 : currentIndex + 1;\n    index = (index + selectables.length) % selectables.length;\n\n    await this.selectQuerySuggest(selectables[index]);\n  }\n\n  private async selectQuerySuggest(suggestion: HTMLElement) {\n    if (suggestion) {\n      await this.processKeyboardSelection(suggestion);\n    } else {\n      this.keyboardFocusedElement = null;\n      this.inputManager.input.removeAttribute('aria-activedescendant');\n    }\n\n    return suggestion;\n  }\n\n  private async moveWithinPreview(direction: Direction) {\n    const newFocusedPreview = this.resultPreviewsManager.getElementInDirection(direction);\n    if (!newFocusedPreview) {\n      await this.selectQuerySuggest(this.resultPreviewsManager.previewsOwner.dom);\n      return;\n    }\n    this.processKeyboardPreviewSelection(newFocusedPreview);\n  }\n\n  private returnMoved(selected) {\n    if (selected) {\n      if (selected['suggestion']) {\n        return selected['suggestion'];\n      }\n      if (selected['no-text-suggestion']) {\n        return null;\n      }\n      if (selected instanceof HTMLElement) {\n        return {\n          text: $$(selected).text()\n        };\n      }\n    }\n    return null;\n  }\n\n  private addSelectedStatus(element: HTMLElement): void {\n    const selected = this.element.getElementsByClassName(this.options.selectedClass);\n    for (let i = 0; i < selected.length; i++) {\n      const elem = <HTMLElement>selected.item(i);\n      this.removeSelectedStatus(elem);\n    }\n    $$(element).addClass(this.options.selectedClass);\n    this.updateAreaSelectedIfDefined(element, 'true');\n  }\n\n  private async updateSelectedSuggestion(suggestion: Suggestion) {\n    $$(this.root).trigger(OmniboxEvents.querySuggestGetFocus, <IQuerySuggestSelection>{\n      suggestion: suggestion.text\n    });\n    await this.resultPreviewsManager.displaySearchResultPreviewsForSuggestion(suggestion);\n  }\n\n  private removeSelectedStatus(suggestion: HTMLElement): void {\n    $$(suggestion).removeClass(this.options.selectedClass);\n    this.updateAreaSelectedIfDefined(suggestion, 'false');\n  }\n\n  private updateAreaSelectedIfDefined(element: HTMLElement, value: string): void {\n    if ($$(element).getAttribute('aria-selected')) {\n      this.inputManager.activeDescendant = element;\n      $$(element).setAttribute('aria-selected', value);\n    }\n  }\n\n  private addAccessibilityProperties() {\n    this.addAccessibilityPropertiesForMagicBox();\n    this.addAccessibilityPropertiesForInput();\n  }\n\n  private addAccessibilityPropertiesForMagicBox() {\n    const magicBox = $$(this.magicBoxContainer);\n\n    magicBox.setAttribute('role', 'search');\n    magicBox.setAttribute('aria-haspopup', 'listbox');\n  }\n\n  private addAccessibilityPropertiesForInput() {\n    const input = $$(this.inputManager.input);\n\n    this.inputManager.activeDescendant = null;\n    this.inputManager.expanded = false;\n    input.setAttribute('aria-owns', this.suggestionListboxID);\n    input.setAttribute('aria-controls', this.suggestionListboxID);\n  }\n\n  private htmlElementIsSuggestion(selected: HTMLElement) {\n    const omniboxSelectables = $$(this.element).findAll(`.${this.options.suggestionClass}`);\n    return indexOf(omniboxSelectables, selected) > -1;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/SuggestionsManager.ts","import { each, find, isUndefined } from 'underscore';\nimport { KEYBOARD } from '../Core';\nimport { $$ } from '../utils/Dom';\nimport { doMagicBoxExport } from './doMagicBoxExport';\nimport { Grammar } from './Grammar';\nimport { InputManager } from './InputManager';\nimport { MagicBoxClear } from './MagicBoxClear';\nimport { Result } from './Result/Result';\nimport { Suggestion, SuggestionsManager } from './SuggestionsManager';\n\nexport interface Options {\n  inline?: boolean;\n  selectableSuggestionClass?: string;\n  selectedSuggestionClass?: string;\n  suggestionTimeout?: number;\n}\n\nexport class MagicBoxInstance {\n  public onblur: () => void;\n  public onfocus: () => void;\n  public onchange: () => void;\n  public onSuggestions: (suggestions: Suggestion[]) => void;\n  public onsubmit: () => void;\n  public onselect: (suggestion: Suggestion) => void;\n  public onclear: () => void;\n  public onmove: () => void;\n  public ontabpress: () => void;\n\n  public getSuggestions: () => Array<Promise<Suggestion[]> | Suggestion[]>;\n\n  private inputManager: InputManager;\n  private suggestionsManager: SuggestionsManager;\n  private magicBoxClear: MagicBoxClear;\n\n  private lastSuggestions: Suggestion[] = [];\n\n  private result: Result;\n  private displayedResult: Result;\n\n  private get firstSuggestionWithText(): Suggestion {\n    return find(this.lastSuggestions, suggestion => suggestion.text);\n  }\n\n  private get firstSuggestionText() {\n    const firstSuggestionWithText = this.firstSuggestionWithText;\n    return firstSuggestionWithText ? firstSuggestionWithText.text : '';\n  }\n\n  constructor(public element: HTMLElement, public grammar: Grammar, public options: Options = {}) {\n    if (isUndefined(this.options.inline)) {\n      this.options.inline = false;\n    }\n    $$(element).addClass('magic-box');\n    if (this.options.inline) {\n      $$(element).addClass('magic-box-inline');\n    }\n\n    this.result = this.grammar.parse('');\n    this.displayedResult = this.result.clean();\n\n    let inputContainer = $$(element).find('.magic-box-input');\n    if (!inputContainer) {\n      inputContainer = document.createElement('div');\n      inputContainer.className = 'magic-box-input';\n      element.appendChild(inputContainer);\n    }\n\n    this.inputManager = new InputManager(\n      inputContainer,\n      (text, wordCompletion) => {\n        if (!wordCompletion) {\n          this.setText(text);\n          this.addSuggestions();\n          this.onchange && this.onchange();\n        } else {\n          this.setText(text);\n          this.onselect && this.onselect(this.firstSuggestionWithText);\n        }\n      },\n      this\n    );\n\n    this.inputManager.ontabpress = () => {\n      this.ontabpress && this.ontabpress();\n    };\n\n    const existingValue = this.inputManager.getValue();\n    if (existingValue) {\n      this.displayedResult.input = existingValue;\n    }\n\n    this.inputManager.setResult(this.displayedResult);\n\n    const suggestionsContainer = document.createElement('div');\n    suggestionsContainer.className = 'magic-box-suggestions';\n    this.element.appendChild(suggestionsContainer);\n\n    this.suggestionsManager = new SuggestionsManager(suggestionsContainer, this.element, this.inputManager, {\n      suggestionClass: this.options.selectableSuggestionClass,\n      selectedClass: this.options.selectedSuggestionClass,\n      timeout: this.options.suggestionTimeout\n    });\n\n    this.magicBoxClear = new MagicBoxClear(this);\n    this.setupHandler();\n  }\n\n  public getResult() {\n    return this.result;\n  }\n\n  public getDisplayedResult() {\n    return this.displayedResult;\n  }\n\n  public setText(text: string) {\n    $$(this.element).toggleClass('magic-box-notEmpty', text.length > 0);\n    this.magicBoxClear.toggleTabindexAndAriaHidden(text.length > 0);\n\n    this.result = this.grammar.parse(text);\n    this.displayedResult = this.result.clean();\n\n    this.inputManager.setResult(this.displayedResult);\n  }\n\n  public setCursor(index: number) {\n    this.inputManager.setCursor(index);\n  }\n\n  public getCursor() {\n    return this.inputManager.getCursor();\n  }\n\n  public resultAtCursor(match?: string | { (result: Result): boolean }): Result[] {\n    return this.displayedResult.resultAt(this.getCursor(), match);\n  }\n\n  private setupHandler() {\n    this.inputManager.onblur = () => {\n      $$(this.element).removeClass('magic-box-hasFocus');\n      this.onblur && this.onblur();\n      if (!this.options.inline) {\n        this.clearSuggestion();\n      }\n    };\n\n    this.inputManager.onfocus = () => {\n      $$(this.element).addClass('magic-box-hasFocus');\n      this.addSuggestions();\n      this.onfocus && this.onfocus();\n    };\n\n    this.inputManager.onkeydown = (key: number) => {\n      if (this.shouldMoveInSuggestions(key)) {\n        return false;\n      }\n      if (key === KEYBOARD.ENTER) {\n        const suggestion = this.suggestionsManager.selectAndReturnKeyboardFocusedElement();\n        if (suggestion == null) {\n          this.onsubmit && this.onsubmit();\n        }\n        return false;\n      } else if (key === KEYBOARD.ESCAPE) {\n        this.clearSuggestion();\n        this.blur();\n      } else {\n        this.suggestionsManager.clearKeyboardFocusedElement();\n      }\n      return true;\n    };\n\n    this.inputManager.onchangecursor = () => {\n      this.addSuggestions();\n    };\n\n    this.inputManager.onkeyup = (key: number) => {\n      this.onmove && this.onmove();\n      if (!this.shouldMoveInSuggestions(key)) {\n        return true;\n      }\n      switch (key) {\n        case KEYBOARD.UP_ARROW:\n          this.suggestionsManager.moveUp();\n          break;\n        case KEYBOARD.DOWN_ARROW:\n          this.suggestionsManager.moveDown();\n          break;\n        case KEYBOARD.LEFT_ARROW:\n          this.suggestionsManager.moveLeft();\n          break;\n        case KEYBOARD.RIGHT_ARROW:\n          this.suggestionsManager.moveRight();\n          break;\n      }\n      if (this.suggestionsManager.selectedSuggestion) {\n        this.focusOnSuggestion(this.suggestionsManager.selectedSuggestion);\n      }\n      this.onchange && this.onchange();\n      return false;\n    };\n  }\n\n  public async addSuggestions() {\n    const suggestions = await this.suggestionsManager.receiveSuggestions(this.getSuggestions != null ? this.getSuggestions() : []);\n    this.addSelectEventHandlers(suggestions);\n    this.inputManager.setWordCompletion(this.firstSuggestionText);\n    this.onSuggestions(suggestions);\n  }\n\n  private shouldMoveInSuggestions(key: KEYBOARD) {\n    switch (key) {\n      case KEYBOARD.UP_ARROW:\n      case KEYBOARD.DOWN_ARROW:\n        return true;\n      case KEYBOARD.LEFT_ARROW:\n      case KEYBOARD.RIGHT_ARROW:\n        if (this.suggestionsManager.hasFocus && this.suggestionsManager.hasPreviews) {\n          return true;\n        }\n    }\n    return false;\n  }\n\n  private addSelectEventHandlers(suggestions: Suggestion[]) {\n    each(suggestions, (suggestion: Suggestion) => {\n      if (suggestion.onSelect == null && suggestion.text != null) {\n        suggestion.onSelect = () => {\n          this.setText(suggestion.text);\n          this.onselect && this.onselect(suggestion);\n        };\n      }\n    });\n  }\n\n  public focus() {\n    $$(this.element).addClass('magic-box-hasFocus');\n    this.inputManager.focus();\n  }\n\n  public blur() {\n    this.inputManager.blur();\n  }\n\n  public async clearSuggestion() {\n    this.inputManager.setWordCompletion(null);\n    this.suggestionsManager.clearSuggestions();\n    this.onSuggestions([]);\n  }\n\n  private focusOnSuggestion(suggestion: Suggestion) {\n    if (suggestion == null || suggestion.text == null) {\n      this.inputManager.setResult(this.displayedResult, this.firstSuggestionText);\n    } else {\n      this.inputManager.setResult(this.grammar.parse(suggestion.text).clean(), suggestion.text);\n    }\n  }\n\n  public getText() {\n    return this.inputManager.getValue();\n  }\n\n  public getWordCompletion() {\n    return this.inputManager.getWordCompletion();\n  }\n\n  public clear() {\n    this.setText('');\n    this.clearSuggestion();\n    this.focus();\n    this.onclear && this.onclear();\n  }\n\n  public hasSuggestions() {\n    return this.suggestionsManager.hasSuggestions;\n  }\n}\n\nexport function createMagicBox(element: HTMLElement, grammar: Grammar, options?: Options) {\n  return new MagicBoxInstance(element, grammar, options);\n}\n\nexport function requestAnimationFrame(callback: () => void) {\n  if ('requestAnimationFrame' in window) {\n    return window.requestAnimationFrame(callback);\n  }\n  return setTimeout(callback);\n}\n\ndoMagicBoxExport();\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/MagicBox.ts","import _ = require('underscore');\n\nexport class MagicBoxUtils {\n  static escapeRegExp(str) {\n    return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n  }\n\n  static highlightText(\n    text: string,\n    highligth: string,\n    ignoreCase = false,\n    matchClass: string = 'magic-box-hightlight',\n    doNotMatchClass: string = ''\n  ) {\n    if (highligth.length == 0) {\n      return text;\n    }\n    const escaped = this.escapeRegExp(highligth);\n    const stringRegex = '(' + escaped + ')|(.*?(?=' + escaped + ')|.+)';\n    const regex = new RegExp(stringRegex, ignoreCase ? 'gi' : 'g');\n    return text.replace(regex, (text, match, notmatch) => this.escapeText(match != null ? matchClass : doNotMatchClass, text));\n  }\n\n  private static escapeText = (classname: string, text: string) => {\n    return `<span class=\"${classname}\">${_.escape(text)}</span>`;\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/MagicBoxUtils.ts","import { Expression } from './Expression';\nimport { Result } from '../Result/Result';\nimport { Grammar } from '../Grammar';\nimport { RefResult } from '../Result/RefResult';\nimport { ExpressionEndOfInput } from './ExpressionEndOfInput';\nimport _ = require('underscore');\n\nexport class ExpressionRef implements Expression {\n  constructor(public ref: string, public occurrence: string | number, public id: string, public grammar: Grammar) {}\n\n  parse(input: string, end: boolean): Result {\n    var ref = this.grammar.getExpression(this.ref);\n    if (ref == null) {\n      throw new Error('Expression not found:' + this.ref);\n    }\n    if (this.occurrence == '?' || this.occurrence == null) {\n      return this.parseOnce(input, end, ref);\n    } else {\n      return this.parseMany(input, end, ref);\n    }\n  }\n\n  parseOnce(input: string, end: boolean, ref: Expression): Result {\n    var refResult = ref.parse(input, end);\n    var success = refResult.isSuccess();\n    if (!success && this.occurrence == '?') {\n      if (end) {\n        // if end was found\n        if (input.length == 0) {\n          return new RefResult([], this, input, refResult);\n        }\n        // if end was not found and all error expression are EndOfInput, reparse with end = false.\n        if (_.all(refResult.getBestExpect(), expect => expect.expression == ExpressionEndOfInput)) {\n          return new RefResult([new Result(null, ExpressionEndOfInput, input)], this, input, refResult);\n        }\n        return refResult;\n      }\n      // the ref is not required and it do not need to end the input\n      return new RefResult([], this, input, null);\n    }\n    return new RefResult([refResult], this, input, success ? null : refResult);\n  }\n\n  parseMany(input: string, end: boolean, ref: Expression) {\n    var subResults: Result[] = [];\n    var subResult: Result;\n    var subInput = input;\n    var success: boolean;\n\n    // try to parse until it do not match, do not manage the end yet\n    do {\n      subResult = ref.parse(subInput, false);\n      success = subResult.isSuccess();\n      if (success) {\n        subResults.push(subResult);\n        subInput = subInput.substr(subResult.getLength());\n      }\n    } while (success && subResult.input != subInput);\n\n    // minimal occurance of a ref\n    var requiredOccurance = _.isNumber(this.occurrence) ? <number>this.occurrence : this.occurrence == '+' ? 1 : 0;\n\n    // if the minimal occurance is not reached add the fail result to the list\n    if (subResults.length < requiredOccurance) {\n      subResults.push(subResult);\n    } else if (end) {\n      // if there is at least one match, check if the last match is at the end\n      if (subResults.length > 0) {\n        var last = _.last(subResults);\n        subResult = ref.parse(last.input, true);\n        if (subResult.isSuccess()) {\n          // if successful, replace the last subResult by the one with end\n          subResults[subResults.length - 1] = subResult;\n        } else {\n          // if not successful, we keep the last successful result and we add a endOfInputExpected Result after it\n          subResults.push(new Result(null, ExpressionEndOfInput, last.input.substr(last.getLength())));\n          // we parse back the last with the length of the successful Result (at the same place we put the endOfInputExpected) and put it in failAttempt\n          subResult = ref.parse(last.input.substr(last.getLength()), true);\n        }\n      } else if (input.length != 0) {\n        // if there is no result at all and we are not at the end, return a endOfInputExpected Result\n        var endOfInput = new Result(null, ExpressionEndOfInput, input);\n        return new RefResult([endOfInput], this, input, subResult);\n      }\n    }\n    return new RefResult(subResults, this, input, subResult);\n  }\n\n  public toString() {\n    return this.id;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Expression/ExpressionRef.ts","import { Result } from './Result';\nimport { Expression } from '../Expression/Expression';\nimport _ = require('underscore');\n\nexport class RefResult extends Result {\n  public failAttempt: Result;\n  constructor(results: Result[], public expression: Expression, public input: string, lastResult: Result) {\n    super(results, expression, input);\n    if (_.last(results) != lastResult) {\n      this.failAttempt = lastResult;\n      if (this.failAttempt != null) {\n        this.failAttempt.parent = this;\n      }\n    }\n  }\n\n  /**\n   * Return all fail result.\n   */\n  public getExpect(): Result[] {\n    var expect = super.getExpect();\n    // add the failAttempt to the expect\n    if (this.failAttempt != null) {\n      return expect.concat(this.failAttempt.getExpect());\n    }\n    return expect;\n  }\n\n  /**\n   * Clean the result to have the most relevant result. If the result is successful just return a clone of it.\n   */\n  public clean(path?: Result[]): Result {\n    // if there is no failAttempt, we will use the default clean\n    if (this.failAttempt != null && (path != null || !this.isSuccess())) {\n      path = path || _.last(this.getBestExpect()).path(this);\n      var next = _.first(path);\n      // if the next is in the subResults, not the failAttempt, do the default clean;\n      if (next != null && next == this.failAttempt) {\n        var last = _.last(this.subResults);\n        // if the last is not successful, remove it because we want the failAttempt path\n        var subResults: Result[] = _.map(last != null && last.isSuccess() ? this.subResults : _.initial(this.subResults), subResult =>\n          subResult.clean()\n        );\n        subResults.push(next.clean(_.rest(path)));\n        return new Result(subResults, this.expression, this.input);\n      }\n    }\n    return super.clean(path);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Result/RefResult.ts","import { Expression } from './Expression';\nimport { ExpressionRef } from './ExpressionRef';\nimport { Result } from '../Result/Result';\nimport { OptionResult } from '../Result/OptionResult';\n\nexport class ExpressionOptions implements Expression {\n  constructor(public parts: ExpressionRef[], public id: string) {}\n\n  parse(input: string, end: boolean): Result {\n    var failAttempt: Result[] = [];\n    for (var i = 0; i < this.parts.length; i++) {\n      var subResult = this.parts[i].parse(input, end);\n      if (subResult.isSuccess()) {\n        return new OptionResult(subResult, this, input, failAttempt);\n      }\n      failAttempt.push(subResult);\n    }\n    return new OptionResult(null, this, input, failAttempt);\n  }\n\n  public toString() {\n    return this.id;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Expression/ExpressionOptions.ts","import { Result } from './Result';\nimport _ = require('underscore');\nimport { Expression } from '../Expression/Expression';\n\nexport class OptionResult extends Result {\n  constructor(private result: Result, public expression: Expression, public input: string, public failAttempt: Result[]) {\n    super(result != null ? [result] : null, expression, input);\n    _.forEach(this.failAttempt, subResult => {\n      subResult.parent = this;\n    });\n  }\n\n  /**\n   * Return all fail result.\n   */\n  public getExpect(): Result[] {\n    var expect = [];\n    if (this.result != null) {\n      expect = this.result.getExpect();\n    }\n    expect = _.reduce(this.failAttempt, (expect: Result[], result: Result) => expect.concat(result.getExpect()), expect);\n    if (expect.length > 0 && _.all(expect, result => result.input == this.input)) {\n      return [this];\n    }\n    return expect;\n  }\n\n  /**\n   * Clean the result to have the most relevant result. If the result is successful just return a clone of it.\n   */\n  public clean(path?: Result[]): Result {\n    if (path != null || !this.isSuccess()) {\n      // Result will be a ref. We skip it for cleaner tree.\n      path = _.rest(path || _.last(this.getBestExpect()).path(this));\n      // next can be Result or one of the failAttempt. In both case we have only one child\n      var next = _.first(path);\n      if (next == null) {\n        return new Result(null, this.expression, this.input);\n      }\n      return new Result([next.clean(_.rest(path))], this.expression, this.input);\n    }\n    // Result will be a ref. We skip it for cleaner tree.\n    return new Result(_.map(this.result.subResults, subResult => subResult.clean()), this.expression, this.input);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Result/OptionResult.ts","import { Expression } from './Expression';\nimport { Grammar } from '../Grammar';\nimport { Result } from '../Result/Result';\nimport { EndOfInputResult } from '../Result/Result';\n\nexport class ExpressionRegExp implements Expression {\n  constructor(public value: RegExp, public id: string, grammar: Grammar) {}\n\n  parse(input: string, end: boolean): Result {\n    var groups = input.match(this.value);\n    // if the RegExp do not match at the start, ignore it\n    if (groups != null && groups.index != 0) {\n      groups = null;\n    }\n    var result = new Result(groups != null ? groups[0] : null, this, input);\n    // if is successful and we require the end but the length of parsed is\n    // lower than the input length, return a EndOfInputExpected Result\n    if (result.isSuccess() && end && input.length > result.value.length) {\n      return new EndOfInputResult(result);\n    }\n    return result;\n  }\n\n  public toString() {\n    return this.id;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Expression/ExpressionRegExp.ts","import { Expression } from './Expression';\nimport { Result } from '../Result/Result';\nimport { Grammar } from '../Grammar';\n\nexport interface ExpressionFunctionArgument {\n  (input: string, end: boolean, expression: Expression): Result;\n}\n\nexport class ExpressionFunction implements Expression {\n  constructor(public func: ExpressionFunctionArgument, public id: string, public grammar: Grammar) {}\n\n  public parse(input: string, end: boolean): Result {\n    return this.func(input, end, this);\n  }\n\n  public toString() {\n    return this.id;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Expression/ExpressionFunction.ts","import { Expression } from '../Expression/Expression';\nimport { ExpressionEndOfInput } from '../Expression/ExpressionEndOfInput';\nimport { ExpressionConstant } from '../Expression/ExpressionConstant';\nimport _ = require('underscore');\n\nexport class Result {\n  public value: string;\n  public subResults: Result[];\n  public parent: Result;\n\n  constructor(value: string | Result[], public expression: Expression, public input: string) {\n    if (_.isString(value)) {\n      this.value = <string>value;\n    } else if (_.isArray(value)) {\n      this.subResults = <Result[]>value;\n      _.forEach(this.subResults, (subResult: Result) => {\n        subResult.parent = this;\n      });\n    }\n  }\n\n  public isSuccess() {\n    // if null is the value, this mean the expression could not parse this input\n    return this.value != null || (this.subResults != null && _.all(this.subResults, subResult => subResult.isSuccess()));\n  }\n\n  /**\n   * Return path to this result ([parent.parent, parent, this])\n   */\n  public path(until?: Result): Result[] {\n    var path: Result[] = this.parent != null && this.parent != until ? this.parent.path(until) : [];\n    path.push(this);\n    return path;\n  }\n\n  /**\n   * Return the closest parent that match the condition (can be it-self). If match is a string, it will search for the result expresion id\n   */\n  public findParent(match: string | { (result: Result): boolean }): Result {\n    var parent = <Result>this;\n    var iterator = _.isString(match) ? (result: Result) => match == result.expression.id : <{ (result: Result): boolean }>match;\n    while (parent != null && !iterator(parent)) {\n      parent = parent.parent;\n    }\n    return parent;\n  }\n\n  /**\n   * Return the first child that match the condition (can be it-self). If match is a string, it will search for the result expresion id\n   */\n  public find(match: string | { (result: Result): boolean }): Result {\n    var iterator = _.isString(match) ? (result: Result) => match == result.expression.id : <{ (result: Result): boolean }>match;\n    if (iterator(this)) {\n      return this;\n    }\n    if (this.subResults) {\n      for (var i = 0; i < this.subResults.length; i++) {\n        var subResultFind = this.subResults[i].find(iterator);\n        if (subResultFind) {\n          return subResultFind;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return all children that match the condition (can be it-self). If match is a string, it will search for the result expresion id\n   */\n  public findAll(match: string | { (result: Result): boolean }): Result[] {\n    var results: Result[] = [];\n    var iterator = _.isString(match) ? (result: Result) => match == result.expression.id : <{ (result: Result): boolean }>match;\n    if (iterator(this)) {\n      results.push(this);\n    }\n    if (this.subResults) {\n      results = _.reduce(this.subResults, (results, subResult: Result) => results.concat(subResult.findAll(iterator)), results);\n    }\n    return results;\n  }\n\n  /**\n   * Return the first child that match the condition (can be it-self). If match is a string, it will search for the result expresion id\n   */\n  public resultAt(index: number, match?: string | { (result: Result): boolean }): Result[] {\n    if (index < 0 || index > this.getLength()) {\n      return [];\n    }\n    if (match != null) {\n      if (_.isString(match)) {\n        if (match == this.expression.id) {\n          return [this];\n        }\n      } else {\n        if ((<{ (result: Result): boolean }>match)(this)) {\n          return [this];\n        }\n      }\n    } else {\n      var value = this.value == null && this.subResults == null ? this.input : this.value;\n      if (value != null) {\n        return [this];\n      }\n    }\n\n    if (this.subResults != null) {\n      var results = [];\n      for (var i = 0; i < this.subResults.length; i++) {\n        var subResult = this.subResults[i];\n        results = results.concat(subResult.resultAt(index, match));\n        index -= subResult.getLength();\n        if (index < 0) {\n          break;\n        }\n      }\n      return results;\n    }\n\n    return [];\n  }\n\n  /**\n   * Return all fail result.\n   */\n  public getExpect(): Result[] {\n    if (this.value == null && this.subResults == null) {\n      return [this];\n    }\n    if (this.subResults != null) {\n      return _.reduce(this.subResults, (expect: Result[], result: Result) => expect.concat(result.getExpect()), []);\n    }\n    return [];\n  }\n\n  /**\n   * Return the best fail result (The farthest result who got parsed). We also remove duplicate and always return the simplest result of a kind\n   */\n  public getBestExpect(): Result[] {\n    var expects = this.getExpect();\n    var groups = _.groupBy(expects, expect => expect.input);\n    var key = _.last(\n      _.keys(groups).sort((a, b) => {\n        return b.length - a.length;\n      })\n    );\n    var bestResults = groups[key];\n    var groups = _.groupBy(bestResults, expect => expect.expression.id);\n    return _.map(groups, (bestResults: Result[]): Result => {\n      return _.chain(bestResults)\n        .map(result => {\n          return {\n            path: result.path().length,\n            result: result\n          };\n        })\n        .sortBy('path')\n        .pluck('result')\n        .first()\n        .value();\n    });\n  }\n\n  public getHumanReadableExpect() {\n    var expect = this.getBestExpect();\n    var input = expect.length > 0 ? _.last(expect).input : '';\n    return (\n      'Expected ' +\n      _.map(expect, (result: Result) => result.getHumanReadable()).join(' or ') +\n      ' but ' +\n      (input.length > 0 ? JSON.stringify(input[0]) : 'end of input') +\n      ' found.'\n    );\n  }\n\n  /**\n   * Return a string that represent what is before this result\n   */\n  public before(): string {\n    if (this.parent == null) {\n      return '';\n    }\n    var index = _.indexOf(this.parent.subResults, this);\n    return (\n      this.parent.before() +\n      _.chain(this.parent.subResults)\n        .first(index)\n        .map(subResult => subResult.toString())\n        .join('')\n        .value()\n    );\n  }\n\n  /**\n   * Return a string that represent what is after this result\n   */\n  public after(): string {\n    if (this.parent == null) {\n      return '';\n    }\n    var index = _.indexOf(this.parent.subResults, this);\n    return (\n      _.chain(this.parent.subResults)\n        .last(this.parent.subResults.length - index - 1)\n        .map(subResult => subResult.toString())\n        .join('')\n        .value() + this.parent.after()\n    );\n  }\n\n  /**\n   * Return the length of the result\n   */\n  public getLength() {\n    if (this.value != null) {\n      return this.value.length;\n    }\n\n    if (this.subResults != null) {\n      return _.reduce(this.subResults, (length: number, subResult: Result) => length + subResult.getLength(), 0);\n    }\n\n    return this.input.length;\n  }\n\n  public toHtmlElement(): HTMLElement {\n    var element = document.createElement('span');\n    var id = this.expression != null ? this.expression.id : null;\n\n    if (id != null) {\n      element.setAttribute('data-id', id);\n    }\n\n    element.setAttribute('data-success', this.isSuccess().toString());\n\n    if (this.value != null) {\n      element.appendChild(document.createTextNode(this.value));\n      element.setAttribute('data-value', this.value);\n    } else if (this.subResults != null) {\n      _.each(this.subResults, (subResult: Result) => {\n        element.appendChild(subResult.toHtmlElement());\n      });\n    } else {\n      element.appendChild(document.createTextNode(this.input));\n      element.setAttribute('data-input', this.input);\n      element.className = 'magic-box-error' + (this.input.length > 0 ? '' : ' magic-box-error-empty');\n    }\n\n    element['result'] = this;\n\n    return element;\n  }\n\n  /**\n   * Clean the result to have the most relevant result. If the result is successful just return a clone of it.\n   */\n  public clean(path?: Result[]): Result {\n    if (path != null || !this.isSuccess()) {\n      path = path || _.last(this.getBestExpect()).path(this);\n      var next = _.first(path);\n      if (next != null) {\n        var nextIndex = _.indexOf(this.subResults, next);\n        var subResults: Result[] = nextIndex == -1 ? [] : _.map(_.first(this.subResults, nextIndex), subResult => subResult.clean());\n        subResults.push(next.clean(_.rest(path)));\n        return new Result(subResults, this.expression, this.input);\n      } else {\n        return new Result(null, this.expression, this.input);\n      }\n    }\n    if (this.value != null) {\n      return new Result(this.value, this.expression, this.input);\n    }\n    if (this.subResults != null) {\n      return new Result(_.map(this.subResults, subResult => subResult.clean()), this.expression, this.input);\n    }\n  }\n\n  public clone(): Result {\n    if (this.value != null) {\n      return new Result(this.value, this.expression, this.input);\n    }\n    if (this.subResults != null) {\n      return new Result(_.map(this.subResults, subResult => subResult.clone()), this.expression, this.input);\n    }\n    return new Result(null, this.expression, this.input);\n  }\n\n  public toString() {\n    if (this.value != null) {\n      return this.value;\n    }\n    if (this.subResults != null) {\n      return _.map(this.subResults, subresult => subresult.toString()).join('');\n    }\n    return this.input;\n  }\n\n  public getHumanReadable() {\n    if (this.expression instanceof ExpressionConstant) {\n      return JSON.stringify((<ExpressionConstant>this.expression).value);\n    }\n    return this.expression.id;\n  }\n}\n\nexport class EndOfInputResult extends Result {\n  constructor(result: Result) {\n    super([result], ExpressionEndOfInput, result.input);\n    var endOfInput = new Result(null, ExpressionEndOfInput, result.input.substr(result.getLength()));\n    endOfInput.parent = this;\n    this.subResults.push(endOfInput);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Result/Result.ts","import { Result } from '../Result/Result';\nimport { Expression } from './Expression';\n\nexport class ExpressionList implements Expression {\n  constructor(private parts: Expression[], public id: string) {\n    if (parts.length == 0) {\n      throw new Error(JSON.stringify(id) + ' should have at least 1 parts');\n    }\n  }\n\n  parse(input: string, end: boolean): Result {\n    var subResults: Result[] = [];\n    var subResult: Result;\n    var subInput = input;\n\n    for (var i = 0; i < this.parts.length; i++) {\n      var part = this.parts[i];\n      subResult = part.parse(subInput, end && i == this.parts.length - 1);\n      subResults.push(subResult);\n      // if the subResult do not succeed, stop the parsing\n      if (!subResult.isSuccess()) {\n        break;\n      } else {\n        subInput = subInput.substr(subResult.getLength());\n      }\n    }\n    return new Result(subResults, this, input);\n  }\n\n  public toString() {\n    return this.id;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Expression/ExpressionList.ts","import { SubGrammar } from './Expressions';\nimport { Field } from './Field';\n\nexport var NestedQuery: SubGrammar = {\n  basicExpressions: ['NestedQuery'],\n  grammars: {\n    NestedQuery: '[[NestedField][OptionalSpaces][Expressions]]',\n    NestedField: '[[Field]]',\n    FieldValue: ['NestedQuery']\n  },\n  include: [Field]\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/NestedQuery.ts","import { SubGrammar } from './Expressions';\nimport { Basic } from './Basic';\n\nexport const Date: SubGrammar = {\n  grammars: {\n    Date: '[DateYear]/[DateMonth]/[DateDay]',\n    DateYear: /([0-9]{4})/,\n    DateMonth: /(1[0-2]|0?[1-9])/,\n    DateDay: /([1-2][0-9]|3[0-1]|0?[1-9])/,\n    DateRange: '[Date][Spaces?]..[Spaces?][Date]',\n    DateRelative: ['DateRelativeNegative', 'DateRelativeTerm'],\n    DateRelativeTerm: /now|today|yesterday/,\n    DateRelativeNegative: '[DateRelativeTerm][DateRelativeNegativeRef]',\n    DateRelativeNegativeRef: /([\\-\\+][0-9]+(s|m|h|d|mo|y))/\n  },\n  include: [Basic]\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/Date.ts","import { Basic } from './Basic';\nimport { SubGrammar } from './Expressions';\nexport const QueryExtension: SubGrammar = {\n  basicExpressions: ['QueryExtension'],\n  grammars: {\n    QueryExtension: '$[QueryExtensionName]([QueryExtensionArguments])',\n    QueryExtensionName: /\\w+/,\n    QueryExtensionArguments: '[QueryExtensionArgumentList*][QueryExtensionArgument]',\n    QueryExtensionArgumentList: '[QueryExtensionArgument][Spaces?],[Spaces?]',\n    QueryExtensionArgument: '[QueryExtensionArgumentName]:[Spaces?][QueryExtensionArgumentValue]',\n    QueryExtensionArgumentName: /\\w+/,\n    QueryExtensionArgumentValue: ['SingleQuoted', 'Expressions']\n  },\n  include: [Basic]\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/QueryExtension.ts","import { SubGrammar } from './Expressions';\n\nexport const SubExpression: SubGrammar = {\n  basicExpressions: ['SubExpression'],\n  grammars: {\n    SubExpression: '([Expressions])'\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/SubExpression.ts","import * as _ from 'underscore';\nimport { Component } from '../Core';\nimport { l } from '../strings/Strings';\nimport { $$ } from '../utils/Dom';\nimport { KEYBOARD } from '../utils/KeyboardUtils';\nimport { MagicBoxInstance } from './MagicBox';\nimport { Result } from './Result/Result';\n\nexport class InputManager {\n  public input: HTMLInputElement;\n  private underlay: HTMLElement;\n  private highlightContainer: HTMLElement;\n  private ghostTextContainer: HTMLElement;\n  private root: HTMLElement;\n\n  private result: Result;\n  private wordCompletion: string;\n\n  private hasFocus: boolean = false;\n\n  /**\n   * Binding event\n   */\n  public onblur: () => void;\n  public onfocus: () => void;\n  public onkeyup: (key: number) => boolean;\n  public onkeydown: (key: number) => boolean;\n  public onchangecursor: () => void;\n  public ontabpress: () => void;\n\n  public set expanded(isExpanded: boolean) {\n    this.input.setAttribute('aria-expanded', isExpanded.toString());\n  }\n\n  public set activeDescendant(element: HTMLElement) {\n    if (element) {\n      this.input.setAttribute('aria-activedescendant', element.id);\n    } else {\n      this.input.removeAttribute('aria-activedescendant');\n    }\n  }\n\n  constructor(element: HTMLElement, private onchange: (text: string, wordCompletion: boolean) => void, private magicBox: MagicBoxInstance) {\n    this.root = Component.resolveRoot(element);\n    this.underlay = document.createElement('div');\n    this.underlay.className = 'magic-box-underlay';\n\n    this.highlightContainer = document.createElement('span');\n    this.highlightContainer.className = 'magic-box-highlight-container';\n    this.underlay.appendChild(this.highlightContainer);\n\n    this.ghostTextContainer = document.createElement('span');\n    this.ghostTextContainer.className = 'magic-box-ghost-text';\n    this.underlay.appendChild(this.ghostTextContainer);\n\n    this.input = $$(element).find('input') as HTMLInputElement;\n    if (!this.input) {\n      this.input = document.createElement('input');\n      element.appendChild(this.underlay);\n      element.appendChild(this.input);\n    } else {\n      element.insertBefore(this.underlay, this.input);\n    }\n\n    this.setupHandler();\n    this.addAccessibilitiesProperties();\n  }\n\n  /**\n   * Update the input with the result value\n   */\n  private updateInput() {\n    if (this.input.value != this.result.input) {\n      this.input.value = this.result.input;\n      if (this.hasFocus) {\n        this.setCursor(this.getValue().length);\n      }\n    }\n  }\n\n  /**\n   * Update the highlight with the result value\n   */\n  private updateHighlight() {\n    $$(this.highlightContainer).empty();\n    this.highlightContainer.appendChild(this.result.toHtmlElement());\n  }\n\n  /**\n   * Update the ghostText with the wordCompletion\n   */\n  private updateWordCompletion() {\n    $$(this.ghostTextContainer).empty();\n    this.ghostTextContainer.innerHTML = '';\n    if (this.wordCompletion != null) {\n      this.ghostTextContainer.appendChild(document.createTextNode(this.wordCompletion.substr(this.result.input.length)));\n    }\n  }\n\n  /**\n   * Set the result and update visual if needed\n   */\n  public setResult(result: Result, wordCompletion?: string) {\n    this.result = result;\n\n    this.updateInput();\n\n    this.updateHighlight();\n\n    // reuse last wordCompletion for a better visual\n    if (_.isUndefined(wordCompletion) && this.wordCompletion != null && this.wordCompletion.indexOf(this.result.input) == 0) {\n      this.updateWordCompletion();\n    } else {\n      this.setWordCompletion(wordCompletion);\n    }\n\n    this.updateScroll();\n  }\n\n  /**\n   * Set the word completion. will be ignore if the word completion do not start with the result input\n   */\n  public setWordCompletion(wordCompletion: string) {\n    if (wordCompletion != null && wordCompletion.toLowerCase().indexOf(this.result.input.toLowerCase()) != 0) {\n      wordCompletion = null;\n    }\n    this.wordCompletion = wordCompletion;\n    this.updateWordCompletion();\n    this.updateScroll();\n  }\n\n  /**\n   * Set cursor position\n   */\n  public setCursor(index: number) {\n    this.input.focus();\n    if ((<any>this.input).createTextRange) {\n      var range = (<any>this.input).createTextRange();\n      range.move('character', index);\n      range.select();\n    } else if (this.input.selectionStart != null) {\n      this.input.focus();\n      this.input.setSelectionRange(index, index);\n    }\n  }\n\n  public getCursor() {\n    return this.input.selectionStart;\n  }\n\n  /**\n   * Update the scroll of the underlay this allowed the highlight to match the text\n   */\n\n  private updateScrollDefer: number;\n  private updateScroll(defer = true) {\n    var callback = () => {\n      // this is the cheapest call we can do before update scroll\n      if (this.underlay.clientWidth < this.underlay.scrollWidth) {\n        this.underlay.style.visibility = 'hidden';\n        this.underlay.scrollLeft = this.input.scrollLeft;\n        this.underlay.scrollTop = this.input.scrollTop;\n        this.underlay.style.visibility = 'visible';\n      }\n      this.updateScrollDefer = null;\n      // one day we will have to remove this\n      if (this.hasFocus) {\n        this.updateScroll();\n      }\n    };\n    // sometime we want it to be updated as soon as posible to have no flickering\n    if (!defer) {\n      callback();\n    } else if (this.updateScrollDefer == null) {\n      this.updateScrollDefer = requestAnimationFrame(callback);\n    }\n  }\n\n  private setupHandler() {\n    this.input.onblur = () => {\n      this.hasFocus = false;\n      setTimeout(() => {\n        if (!this.hasFocus) {\n          this.onblur && this.onblur();\n        }\n      }, 300);\n      this.updateScroll();\n    };\n    this.input.onfocus = () => {\n      if (!this.hasFocus) {\n        this.hasFocus = true;\n        this.updateScroll();\n        this.onfocus && this.onfocus();\n      }\n    };\n    this.input.onkeydown = e => {\n      this.keydown(e);\n    };\n    this.input.onkeyup = e => {\n      this.keyup(e);\n    };\n    this.input.oncut = () => {\n      setTimeout(() => {\n        this.onInputChange();\n      });\n    };\n    this.input.onpaste = () => {\n      setTimeout(() => {\n        this.onInputChange();\n      });\n    };\n  }\n\n  private addAccessibilitiesProperties() {\n    this.input.setAttribute('autocomplete', 'off');\n    this.input.setAttribute('type', 'text');\n    this.input.setAttribute('role', 'combobox');\n    this.input.setAttribute('form', 'coveo-dummy-form');\n    this.input.setAttribute('aria-autocomplete', 'list');\n    this.input.setAttribute('title', `${l('InsertAQuery')}. ${l('PressEnterToSend')}`);\n  }\n\n  public focus() {\n    // neet a timeout for IE8-9\n    setTimeout(() => {\n      this.input.focus();\n      this.setCursor(this.getValue().length);\n    });\n  }\n\n  public blur() {\n    if (this.hasFocus) {\n      this.input.blur();\n    }\n  }\n\n  private keydown(e: KeyboardEvent) {\n    switch (e.keyCode || e.which) {\n      case KEYBOARD.TAB:\n        // Take care of not \"preventing\" the default event behaviour : For accessibility reasons, it is much simpler\n        // to simply let the browser do it's standard action (which is to focus out of the input).\n        // Instead, handle \"tabPress\" immediately instead of \"keyup\".\n        // The focus will be on the next element in the page when the key is released, so keyup on the input will never be triggered.\n        this.tabPress();\n        this.magicBox.clearSuggestion();\n        break;\n      default:\n        e.stopPropagation();\n        if (this.onkeydown == null || this.onkeydown(e.keyCode || e.which)) {\n          requestAnimationFrame(() => {\n            this.onInputChange();\n          });\n        } else {\n          e.preventDefault();\n        }\n        break;\n    }\n  }\n\n  private keyup(e: KeyboardEvent) {\n    switch (e.keyCode || e.which) {\n      case KEYBOARD.LEFT_ARROW:\n      case KEYBOARD.RIGHT_ARROW:\n        this.handleLeftRightArrow(e);\n        break;\n      default:\n        if (this.onkeydown == null || this.onkeyup(e.keyCode || e.which)) {\n          this.onInputChange();\n        } else {\n          e.preventDefault();\n        }\n        break;\n    }\n  }\n\n  private handleLeftRightArrow(e: KeyboardEvent) {\n    const querySuggestPreview = $$(this.root).find(`.${Component.computeCssClassNameForType('QuerySuggestPreview')}`);\n    if (!querySuggestPreview) {\n      this.onchangecursor();\n    }\n\n    const inputChanged = this.onkeydown == null || this.onkeyup(e.keyCode || e.which);\n    inputChanged ? this.onInputChange() : e.preventDefault();\n  }\n\n  private tabPress() {\n    this.ontabpress && this.ontabpress();\n    this.onblur && this.onblur();\n  }\n\n  private onInputChange() {\n    if (this.result.input != this.input.value) {\n      this.onchange(this.input.value, false);\n    }\n  }\n\n  public getValue() {\n    return this.input.value;\n  }\n\n  public getWordCompletion() {\n    return this.wordCompletion;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/InputManager.ts","import { flatten } from 'underscore';\n\nexport interface IQueryProcessorOptions {\n  timeout: number;\n}\n\nexport enum ProcessingStatus {\n  Finished,\n  TimedOut,\n  Overriden\n}\n\nexport interface IQueryProcessResult<T> {\n  status: ProcessingStatus;\n  results: T[];\n}\n\n/**\n * IE11 equivalent of Promise.race\n * Adapted from Promise.race(iterable) polyfill on https://www.promisejs.org/api/\n */\nfunction racePromises<T>(promises: Thenable<T>[]): Promise<T> {\n  return new Promise<T>((resolve, reject) => promises.forEach(value => Promise.resolve(value).then(resolve, reject)));\n}\n\nexport class QueryProcessor<T> {\n  private override: () => void;\n  private options: IQueryProcessorOptions;\n  private processedResults: T[][];\n\n  constructor(options: Partial<IQueryProcessorOptions> = {}) {\n    this.options = { timeout: 500, ...options };\n  }\n\n  /**\n   * Overrides the previous queries and accumulates the result of promise arrays with a timeout.\n   */\n  public async processQueries(queries: (T[] | Promise<T[]>)[]): Promise<IQueryProcessResult<T>> {\n    this.overrideIfProcessing();\n    this.processedResults = new Array(queries.length);\n    const asyncQueries = queries.map(query => (query instanceof Promise ? query : Promise.resolve(query)));\n\n    return racePromises([\n      this.accumulateResultsChronologically(asyncQueries).then(() => this.buildProcessResults(ProcessingStatus.Finished)),\n      this.waitForOverride().then(() => this.buildProcessResults(ProcessingStatus.Overriden)),\n      this.waitForTimeout().then(() => this.buildProcessResults(ProcessingStatus.TimedOut))\n    ]);\n  }\n\n  public async overrideIfProcessing() {\n    if (this.override) {\n      this.override();\n    }\n  }\n\n  private get orderedResults(): T[] {\n    return flatten(this.processedResults.filter(result => !!result), true);\n  }\n\n  private buildProcessResults(status: ProcessingStatus): IQueryProcessResult<T> {\n    return {\n      status,\n      results: status !== ProcessingStatus.Overriden ? this.orderedResults : []\n    };\n  }\n\n  private async accumulateResultsChronologically(queries: Promise<T[]>[]) {\n    const output = this.processedResults;\n    await Promise.all(queries.map((query, i) => query.then(items => (output[i] = items))));\n  }\n\n  private waitForOverride() {\n    return new Promise<void>(resolve => {\n      this.override = () => {\n        this.override = null;\n        resolve();\n      };\n    });\n  }\n\n  private waitForTimeout() {\n    return new Promise<void>(resolve => setTimeout(() => resolve(), this.options.timeout));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/QueryProcessor.ts","import { SubGrammar } from './Expressions';\nimport { NestedQuery } from './NestedQuery';\nimport { QueryExtension } from './QueryExtension';\nimport { Basic } from './Basic';\nimport { Field } from './Field';\nimport { SubExpression } from './SubExpression';\n\nexport const Complete: SubGrammar = {\n  include: [NestedQuery, QueryExtension, SubExpression, Field, Basic]\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/Complete.ts","import { Grammar } from '../Grammar';\nimport { ExpressionDef } from '../Expression/Expression';\nimport * as _ from 'underscore';\n\nexport interface SubGrammar {\n  grammars?: { [id: string]: ExpressionDef };\n  expressions?: string[];\n  basicExpressions?: string[];\n  include?: SubGrammar[];\n}\n\nfunction loadSubGrammar(\n  expressions: string[],\n  basicExpressions: string[],\n  grammars: { [id: string]: ExpressionDef },\n  subGrammar: SubGrammar\n) {\n  _.each(subGrammar.expressions, expression => {\n    if (!_.contains(expressions, expression)) {\n      expressions.push(expression);\n    }\n  });\n  _.each(subGrammar.basicExpressions, expression => {\n    if (!_.contains(basicExpressions, expression)) {\n      basicExpressions.push(expression);\n    }\n  });\n  _.each(subGrammar.grammars, (expressionDef: ExpressionDef, id: string) => {\n    if (!(id in grammars)) {\n      grammars[id] = expressionDef;\n    } else {\n      if (_.isArray(grammars[id]) && _.isArray(expressionDef)) {\n        _.each(<string[]>expressionDef, (value: string) => {\n          (<string[]>grammars[id]).push(value);\n        });\n      } else {\n        _.each(<string[]>expressionDef, (value: string) => {\n          (<string[]>grammars[id]).push(value);\n        });\n        throw new Error('Can not merge ' + id + '(' + JSON.stringify(expressionDef) + ' => ' + JSON.stringify(grammars[id]) + ')');\n      }\n    }\n  });\n}\n\nexport function Expressions(...subGrammars: SubGrammar[]): { start: string; expressions: { [id: string]: ExpressionDef } } {\n  var expressions: string[] = [];\n  var BasicExpression: string[] = [];\n  var grammars: { [id: string]: ExpressionDef } = {\n    Start: ['Expressions', 'Empty'],\n    Expressions: '[OptionalSpaces][Expression][ExpressionsList*][OptionalSpaces]',\n    ExpressionsList: '[Spaces][Expression]',\n    Expression: expressions,\n    BasicExpression: BasicExpression,\n    OptionalSpaces: / */,\n    Spaces: / +/,\n    Empty: /(?!.)/\n  };\n  for (var i = 0; i < subGrammars.length; i++) {\n    loadSubGrammar(expressions, BasicExpression, grammars, subGrammars[i]);\n    _.each(subGrammars[i].include, subGrammar => {\n      if (!_.contains(subGrammars, subGrammar)) {\n        subGrammars.push(subGrammar);\n      }\n    });\n  }\n  expressions.push('BasicExpression');\n  return {\n    start: 'Start',\n    expressions: grammars\n  };\n}\n\nexport function ExpressionsGrammar(...subGrammars: SubGrammar[]) {\n  var grammar = Expressions.apply(this, subGrammars);\n  return new Grammar(grammar.start, grammar.expressions);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/Expressions.ts","import { ISearchResultPreview } from '../magicbox/ResultPreviewsManager';\nimport { Suggestion } from '../magicbox/SuggestionsManager';\nimport { IQuery } from '../rest/Query';\n\nexport interface IBuildingResultPreviewsQueryEventArgs {\n  /**\n   * The query to be sent to Search API.\n   */\n  query: IQuery;\n}\n\n/**\n * Executed when a {@link Suggestion} is focused before {@link PopulateSearchResultPreviews} is called to fetch more options.\n */\nexport interface IUpdateResultPreviewsManagerOptionsEventArgs {\n  /**\n   * How many milliseconds should a {@link Suggestion} be focused for before {@link PopulateSearchResultPreviews} is called.\n   *\n   * If this is not defined, it will default to 200ms.\n   */\n  displayAfterDuration?: number;\n}\n\n/**\n * Executed when a {@link Suggestion} is focused and waiting for search result previews.\n */\nexport interface IPopulateSearchResultPreviewsEventArgs {\n  /**\n   * The suggestion to look up search result previews for.\n   */\n  suggestion: Suggestion;\n  /**\n   * The result previews query. This must be set synchronously before the event resolves.\n   * Setting this to a non-empty array will display the given search result previews.\n   */\n  previewsQueries: (ISearchResultPreview[] | Promise<ISearchResultPreview[]>)[];\n}\n\n/**\n * Those are the string definitions of events for ResultPreviewsManager.\n *\n * Those events should be bound to the element returned by `resolveRoot`.\n */\nexport class ResultPreviewsManagerEvents {\n  /**\n   * Executed when building a query to fetch result previews.\n   * This always receives {@link IBuildingResultPreviewsQueryEventArgs} as arguments.\n   */\n  public static buildingResultPreviewsQuery = 'buildingResultPreviewsQuery';\n  /**\n   * Executed when a {@link Suggestion} is focused before {@link PopulateSearchResultPreviews} is called to fetch more options.\n   * This always receives {@link IUpdateResultPreviewsManagerOptionsEventArgs} as arguments.\n   */\n  public static updateResultPreviewsManagerOptions = 'updateResultPreviewsManagerOptions';\n  /**\n   * Executed when a {@link Suggestion} is focused and waiting for search result previews.\n   * This always receives {@link IPopulateSearchResultPreviewsEventArgs} as arguments.\n   */\n  public static populateSearchResultPreviews = 'populateSearchResultPreviews';\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/events/ResultPreviewsManagerEvents.ts","import { Omnibox, IOmniboxOptions } from '../Omnibox/Omnibox';\nimport { Querybox, IQueryboxOptions } from './Querybox';\nimport { ComponentOptionsModel } from '../../models/ComponentOptionsModel';\n\nexport class QueryboxOptionsProcessing {\n  constructor(public owner: Omnibox | Querybox) {}\n\n  private get options() {\n    return this.owner.options;\n  }\n\n  private set options(options: IOmniboxOptions | IQueryboxOptions) {\n    this.owner.options = options;\n  }\n\n  public postProcess() {\n    this.options = { ...this.options, ...this.owner.componentOptionsModel.get(ComponentOptionsModel.attributesEnum.searchBox) };\n    this.processQueryOnClearVersusEmptyQuery();\n    this.processQueryOnClearVersusSearchAsYouType();\n  }\n\n  private processQueryOnClearVersusEmptyQuery() {\n    if (this.options.triggerQueryOnClear && this.owner.searchInterface.options.allowQueriesWithoutKeywords === false) {\n      this.owner.logger.warn(\n        'Forcing option triggerQueryOnClear to false, as it is not supported when the search interface is configured to not allow queries without keywords (data-allow-queries-without-keywords=\"false\")',\n        this.owner\n      );\n      this.options.triggerQueryOnClear = false;\n    }\n  }\n\n  private processQueryOnClearVersusSearchAsYouType() {\n    if (\n      this.owner.searchInterface.options.allowQueriesWithoutKeywords === true &&\n      this.options.triggerQueryOnClear === false &&\n      this.options.enableSearchAsYouType === true\n    ) {\n      this.owner.logger.warn('Forcing option triggerQueryOnClear to true, since search-as-you-type is enabled', this.owner);\n      this.options.triggerQueryOnClear = true;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Querybox/QueryboxOptionsProcessing.ts","import { IQueryboxOptions } from './Querybox';\nimport { QueryBuilder } from '../Base/QueryBuilder';\nimport * as _ from 'underscore';\nimport { Defer } from '../../MiscModules';\n\nexport class QueryboxQueryParameters {\n  private static queryIsCurrentlyBlocked = false;\n\n  constructor(private options: IQueryboxOptions) {}\n\n  private static queryIsBlocked() {\n    // This code runs on some assumption :\n    // Since all \"buildingQuery\" events would have to be run in the same call stack\n    // We can add a static flag to block 2 or more query box/omnibox from trying to modify the query inside the same event.\n    // If 2 query box are activated, we get duplicate terms in the query, or duplicate term correction with did you mean.\n    // This means that only one query box/searchbox would be able to modify the query in a single search page.\n    // This also means that if there is 2 search box enabled, the first one in the markup in the page would be able to do the job correctly as far as the query is concerned.\n    // The second one is inactive as far as the query is concerned.\n\n    // The flag gets reset in \"defer\" (setTimeout 0) so that it gets reset correctly when the query event has finished executing\n    if (!QueryboxQueryParameters.queryIsCurrentlyBlocked) {\n      QueryboxQueryParameters.queryIsCurrentlyBlocked = true;\n      Defer.defer(() => QueryboxQueryParameters.allowDuplicateQuery());\n      return false;\n    }\n    return true;\n  }\n\n  public static allowDuplicateQuery() {\n    QueryboxQueryParameters.queryIsCurrentlyBlocked = false;\n  }\n\n  public addParameters(queryBuilder: QueryBuilder, lastQuery: string) {\n    if (!QueryboxQueryParameters.queryIsBlocked()) {\n      if (this.options.enableWildcards) {\n        queryBuilder.enableWildcards = true;\n      }\n\n      if (this.options.enableQuestionMarks) {\n        queryBuilder.enableQuestionMarks = true;\n      }\n\n      if (this.options.enableLowercaseOperators) {\n        queryBuilder.enableLowercaseOperators = true;\n      }\n\n      if (!_.isEmpty(lastQuery)) {\n        queryBuilder.enableQuerySyntax = this.options.enableQuerySyntax;\n        queryBuilder.expression.add(lastQuery);\n        if (this.options.enablePartialMatch) {\n          queryBuilder.enablePartialMatch = this.options.enablePartialMatch;\n          if (this.options.partialMatchKeywords) {\n            queryBuilder.partialMatchKeywords = this.options.partialMatchKeywords;\n          }\n          if (this.options.partialMatchThreshold) {\n            queryBuilder.partialMatchThreshold = this.options.partialMatchThreshold;\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Querybox/QueryboxQueryParameters.ts","import { exportGlobally } from '../GlobalExports';\nimport { Expression } from './Expression/Expression';\nimport { ExpressionConstant } from './Expression/ExpressionConstant';\nimport { ExpressionEndOfInput } from './Expression/ExpressionEndOfInput';\nimport { ExpressionFunction, ExpressionFunctionArgument } from './Expression/ExpressionFunction';\nimport { ExpressionList } from './Expression/ExpressionList';\nimport { ExpressionOptions } from './Expression/ExpressionOptions';\nimport { ExpressionRef } from './Expression/ExpressionRef';\nimport { ExpressionRegExp } from './Expression/ExpressionRegExp';\nimport { Grammar } from './Grammar';\nimport { SubGrammar } from './Grammars/Expressions';\nimport { Grammars } from './Grammars/Grammars';\nimport { InputManager } from './InputManager';\nimport { createMagicBox, MagicBoxInstance, requestAnimationFrame } from './MagicBox';\nimport { MagicBoxUtils as Utils } from './MagicBoxUtils';\nimport { OptionResult } from './Result/OptionResult';\nimport { RefResult } from './Result/RefResult';\nimport { EndOfInputResult, Result } from './Result/Result';\nimport { Suggestion, SuggestionsManager } from './SuggestionsManager';\nexport type ExpressionImportedLocally = Expression;\nexport type SuggestionImportedLocally = Suggestion;\nexport type SubGrammarLocally = SubGrammar;\nexport type ExpressionFunctionArgumentLocally = ExpressionFunctionArgument;\nexport const GrammarsImportedLocally = Grammars;\n\nexport function doMagicBoxExport() {\n  exportGlobally({\n    MagicBox: {\n      EndOfInputResult,\n      ExpressionConstant,\n      ExpressionEndOfInput,\n      ExpressionFunction,\n      ExpressionList,\n      ExpressionOptions,\n      ExpressionRef,\n      ExpressionRegExp,\n      Grammar,\n      Grammars,\n      InputManager,\n      Instance: MagicBoxInstance,\n      OptionResult,\n      RefResult,\n      Result,\n      SuggestionsManager,\n      Utils,\n      create: createMagicBox,\n      requestAnimationFrame\n    }\n  });\n}\n\nexport declare namespace MagicBox {\n  export const EndOfInputResult: EndOfInputResult;\n  export const ExpressionConstant: ExpressionConstant;\n  export const ExpressionFunction: ExpressionFunction;\n  export const ExpressionList: ExpressionList;\n  export const ExpressionOptions: ExpressionOptions;\n  export const ExpressionRef: ExpressionRef;\n  export const ExpressionRegExp: ExpressionRegExp;\n  export const Grammar: Grammar;\n  export const InputManager: InputManager;\n  export const Instance: MagicBoxInstance;\n  export const OptionResult: OptionResult;\n  export const RefResult: RefResult;\n  export const Result: Result;\n  export const SuggestionsManager: SuggestionsManager;\n  export const Utils: Utils;\n  export const ExpressionEndOfInput;\n  export type Instance = MagicBoxInstance;\n  export type Suggestion = SuggestionImportedLocally;\n\n  export namespace Grammars {\n    export const Basic: typeof GrammarsImportedLocally.Basic;\n    export const notInWord: typeof GrammarsImportedLocally.notInWord;\n    export const notWordStart: typeof GrammarsImportedLocally.notWordStart;\n    export const Complete: typeof GrammarsImportedLocally.Complete;\n    export const Date: typeof GrammarsImportedLocally.Date;\n    export const Expressions: typeof GrammarsImportedLocally.Expressions;\n    export const ExpressionsGrammar: typeof GrammarsImportedLocally.ExpressionsGrammar;\n    export const Field: typeof GrammarsImportedLocally.Field;\n    export const NestedQuery: typeof GrammarsImportedLocally.NestedQuery;\n    export const QueryExtension: typeof GrammarsImportedLocally.QueryExtension;\n    export const SubExpression: typeof GrammarsImportedLocally.SubExpression;\n  }\n\n  export const createMagicBox;\n  export const create;\n  export const requestAnimationFrame;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/doMagicBoxExport.ts","import { Basic, notInWord, notWordStart } from './Basic';\nimport { Complete } from './Complete';\nimport { Date } from './Date';\nimport { Expressions, ExpressionsGrammar, SubGrammar } from './Expressions';\nimport { ExpressionFunctionArgument } from '../Expression/ExpressionFunction';\nimport { Field } from './Field';\nimport { NestedQuery } from './NestedQuery';\nimport { QueryExtension } from './QueryExtension';\nimport { SubExpression } from './SubExpression';\nexport type SubGrammarImported = SubGrammar;\nexport type ExpressionFunctionArgumentImported = ExpressionFunctionArgument;\n\nexport const Grammars = {\n  Basic,\n  notInWord,\n  notWordStart,\n  Complete,\n  Date,\n  Expressions,\n  ExpressionsGrammar,\n  Field,\n  NestedQuery,\n  QueryExtension,\n  SubExpression\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/Grammars/Grammars.ts","import { $$, Dom } from '../utils/Dom';\nimport { l } from '../strings/Strings';\nimport { defaults, findIndex } from 'underscore';\nimport { Component } from '../ui/Base/Component';\nimport { Direction, Suggestion } from './SuggestionsManager';\nimport {\n  ResultPreviewsManagerEvents,\n  IPopulateSearchResultPreviewsEventArgs,\n  IUpdateResultPreviewsManagerOptionsEventArgs\n} from '../events/ResultPreviewsManagerEvents';\nimport { QueryProcessor, ProcessingStatus } from './QueryProcessor';\nimport { Utils } from '../utils/Utils';\n\nexport interface ISearchResultPreview {\n  element: HTMLElement;\n  onSelect: () => void;\n}\n\nexport interface IResultPreviewsManagerOptions {\n  previewClass: string;\n  selectedClass: string;\n  previewHeaderText: string;\n  previewHeaderFieldText: string;\n  timeout: number;\n}\n\nexport class ResultPreviewsManager {\n  private options: IResultPreviewsManagerOptions;\n  private suggestionsPreviewContainer: Dom;\n  private resultPreviewsContainer: Dom;\n  private lastQueriedSuggestion: Suggestion;\n  private lastDisplayedSuggestion: Suggestion;\n  private previewsProcessor: QueryProcessor<ISearchResultPreview>;\n  private lastDelay: Promise<void>;\n  private root: HTMLElement;\n\n  public get previewsOwner() {\n    return this.lastDisplayedSuggestion;\n  }\n\n  public get hasPreviews() {\n    return !!this.suggestionsPreviewContainer;\n  }\n\n  public get focusedPreviewElement() {\n    if (!this.hasPreviews) {\n      return null;\n    }\n    const focusedElement = this.suggestionsPreviewContainer.findClass(this.options.selectedClass)[0];\n    if (!focusedElement || !focusedElement.classList.contains(this.options.previewClass)) {\n      return null;\n    }\n    return focusedElement;\n  }\n\n  public get previewElements() {\n    if (!this.hasPreviews) {\n      return [];\n    }\n    return this.suggestionsPreviewContainer.findClass(this.options.previewClass);\n  }\n\n  private get suggestionsListbox() {\n    return $$($$(this.element).findClass('coveo-magicbox-suggestions')[0]);\n  }\n\n  private get numberOfResultsPerRow() {\n    const previewSelectables = this.suggestionsPreviewContainer.findClass(this.options.previewClass);\n    if (previewSelectables.length === 0) {\n      return 0;\n    }\n    const firstVerticalOffset = previewSelectables[0].offsetTop;\n    const firstIndexOnNextRow = findIndex(previewSelectables, previewSelectable => previewSelectable.offsetTop !== firstVerticalOffset);\n    return firstIndexOnNextRow !== -1 ? firstIndexOnNextRow : previewSelectables.length;\n  }\n\n  private get previewContainerId() {\n    return `coveo-previews-for-${this.lastDisplayedSuggestion.dom.id}`;\n  }\n\n  constructor(private element: HTMLElement, options: Partial<IResultPreviewsManagerOptions> = {}) {\n    this.options = defaults(options, <IResultPreviewsManagerOptions>{\n      previewHeaderText: l('QuerySuggestPreview'),\n      previewHeaderFieldText: l('QuerySuggestPreviewWithField'),\n      previewClass: 'coveo-preview-selectable',\n      selectedClass: 'magic-box-selected'\n    });\n    this.root = Component.resolveRoot(element);\n    this.previewsProcessor = new QueryProcessor({ timeout: this.options.timeout });\n  }\n\n  public async displaySearchResultPreviewsForSuggestion(suggestion: Suggestion) {\n    const externalOptions = this.getExternalOptions();\n    const currentDelay = (this.lastDelay = Utils.resolveAfter(\n      Utils.isNullOrUndefined(externalOptions.displayAfterDuration) ? 200 : externalOptions.displayAfterDuration\n    ));\n    await currentDelay;\n    if (currentDelay !== this.lastDelay) {\n      return;\n    }\n    const isQueryForSuggestionOngoing = suggestion && this.lastQueriedSuggestion === suggestion;\n    if (isQueryForSuggestionOngoing) {\n      return;\n    }\n    const arePreviewsForSuggestionCurrentlyDisplayed = this.lastDisplayedSuggestion === suggestion;\n    if (arePreviewsForSuggestionCurrentlyDisplayed) {\n      this.previewsProcessor.overrideIfProcessing();\n      this.lastQueriedSuggestion = null;\n      return;\n    }\n    this.lastQueriedSuggestion = suggestion;\n    if (!suggestion) {\n      this.displaySuggestionPreviews(null, []);\n      return;\n    }\n    const { status, results } = await this.getSearchResultPreviewsQuery(suggestion);\n    if (status === ProcessingStatus.Overriden) {\n      return;\n    }\n    this.lastQueriedSuggestion = null;\n    this.displaySuggestionPreviews(suggestion, results);\n  }\n\n  public getElementInDirection(direction: Direction) {\n    const previewElements = this.previewElements;\n    const focusedIndex = previewElements.indexOf(this.focusedPreviewElement);\n\n    if (focusedIndex === -1) {\n      return null;\n    }\n\n    if (focusedIndex === 0 && direction === Direction.Left) {\n      return null;\n    }\n\n    return previewElements[(focusedIndex + this.getIncrementInDirection(direction)) % previewElements.length];\n  }\n\n  private getIncrementInDirection(direction: Direction) {\n    switch (direction) {\n      case Direction.Left:\n        return -1;\n      case Direction.Right:\n        return 1;\n      case Direction.Up:\n        return -this.numberOfResultsPerRow;\n      case Direction.Down:\n        return this.numberOfResultsPerRow;\n    }\n  }\n\n  private setHasPreviews(shouldHavePreviews: boolean) {\n    if (this.hasPreviews === !!shouldHavePreviews) {\n      return;\n    }\n    if (shouldHavePreviews) {\n      this.initPreviewForSuggestions();\n    } else {\n      this.revertPreviewForSuggestions();\n    }\n  }\n\n  private initPreviewForSuggestions() {\n    this.suggestionsPreviewContainer = $$(\n      'div',\n      {\n        className: 'coveo-suggestion-container'\n      },\n      this.suggestionsListbox.el,\n      this.buildPreviewContainer()\n    );\n    this.element.appendChild(this.suggestionsPreviewContainer.el);\n    this.suggestionsListbox.setAttribute('aria-controls', this.previewContainerId);\n  }\n\n  private revertPreviewForSuggestions() {\n    this.element.appendChild(this.suggestionsListbox.el);\n    this.suggestionsPreviewContainer.remove();\n    this.suggestionsPreviewContainer = null;\n  }\n\n  private buildPreviewContainer() {\n    return $$(\n      'div',\n      {\n        className: 'coveo-preview-container',\n        id: this.previewContainerId\n      },\n      (this.resultPreviewsContainer = $$('div', {\n        className: 'coveo-preview-results',\n        role: 'listbox',\n        'aria-orientation': 'horizontal'\n      }))\n    ).el;\n  }\n\n  private getExternalOptions() {\n    const optionsEventArgs: IUpdateResultPreviewsManagerOptionsEventArgs = {};\n    $$(this.root).trigger(ResultPreviewsManagerEvents.updateResultPreviewsManagerOptions, optionsEventArgs);\n    return optionsEventArgs;\n  }\n\n  private getSearchResultPreviewsQuery(suggestion: Suggestion) {\n    const populateEventArgs: IPopulateSearchResultPreviewsEventArgs = {\n      suggestion,\n      previewsQueries: []\n    };\n    $$(this.root).trigger(ResultPreviewsManagerEvents.populateSearchResultPreviews, populateEventArgs);\n    return this.previewsProcessor.processQueries(populateEventArgs.previewsQueries);\n  }\n\n  private appendSearchResultPreview(preview: ISearchResultPreview, position: number) {\n    this.resultPreviewsContainer.append(preview.element);\n    preview.element.id = `coveo-result-preview-${position}`;\n    const elementDom = $$(preview.element);\n    elementDom.setAttribute('aria-selected', 'false');\n    elementDom.setAttribute('role', 'option');\n    elementDom.on('click', () => preview.onSelect());\n    elementDom.on('keyboardSelect', () => preview.onSelect());\n  }\n\n  private appendSearchResultPreviews(previews: ISearchResultPreview[]) {\n    this.resultPreviewsContainer.empty();\n    previews.forEach((preview, i) => this.appendSearchResultPreview(preview, i));\n  }\n\n  private displaySuggestionPreviews(suggestion: Suggestion, previews: ISearchResultPreview[]) {\n    this.lastDisplayedSuggestion = suggestion;\n    this.setHasPreviews(previews && previews.length > 0);\n    this.element.classList.toggle('magic-box-hasPreviews', this.hasPreviews);\n    if (!this.hasPreviews) {\n      return;\n    }\n    this.appendSearchResultPreviews(previews);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/ResultPreviewsManager.ts","import { $$, Dom } from '../utils/Dom';\nimport { MagicBoxInstance } from './MagicBox';\nimport { l } from '../strings/Strings';\nimport { AccessibleButton } from '../utils/AccessibleButton';\n\nexport class MagicBoxClear {\n  public element: Dom;\n\n  constructor(magicBox: MagicBoxInstance) {\n    this.element = $$('div', {\n      className: 'magic-box-clear'\n    });\n    const clearIcon = $$('div', {\n      className: 'magic-box-icon'\n    });\n    this.element.append(clearIcon.el);\n\n    this.element.insertAfter($$(magicBox.element).find('input'));\n\n    new AccessibleButton()\n      .withElement(this.element)\n      .withLabel(l('Clear'))\n      .withSelectAction(() => magicBox.clear())\n      .build();\n\n    this.toggleTabindexAndAriaHidden(false);\n  }\n\n  public toggleTabindexAndAriaHidden(hasText: boolean) {\n    const tabindex = hasText ? '0' : '-1';\n    this.element.setAttribute('tabindex', tabindex);\n    this.element.setAttribute('aria-hidden', `${!hasText}`);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/magicbox/MagicBoxClear.ts"],"sourceRoot":""}